import SolutionManifest from"/solution-manifest.js";class R0{static readable(e,t,a){const s=Number.parseInt(e||0,10);if(!s)return"0 "+a[0];const n=Math.floor(Math.log(s)/Math.log(t));return`${1*(s/t**n).toFixed(2)} ${a[n]}`}}const mxReadable=e=>class extends e{static readableFileSize(e){return R0.readable(e,1024,["B","KB","MB","GB","TB","PB"])}static readableBitrate(e){return R0.readable(e,1024,["bps","Kbps","Mbps","Gbps","Tbps","Pbps"])}static readableDuration(e=0,t=!0){const a=Math.floor(e/36e5),s=Math.floor(e%36e5/6e4),n=Math.floor(e%6e4/1e3),i=Math.ceil(e%1e3),o=`${a.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`;return t?o:`${o}.${i.toString().padStart(3,"0")}`}static capitalize(e){return e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}static shorten(e,t=40){switch(typeof e){case"number":case"boolean":case"symbol":case"undefined":return e}const a=Array.isArray(e)?e.join(", "):e.toString(),s=Math.max(t,20);return a.length<=s?a:`${a.substring(0,s-10)}...${a.substring(a.length-7)}`}static isoDateTime(e){return e?new Date(e).toISOString():void 0}},mxZero=e=>class extends e{static zeroMd5(){return new Array(32).fill("0").join("")}static zeroUuid(){const e=new Array(36).fill("0");return e[8]=e[13]=e[18]=e[23]="-",e.join("")}static zeroAccountId(){return new Array(12).fill("0").join("")}},THUMBNAIL_W=72,THUMBNAIL_H=72;class AppUtils extends(mxReadable(mxZero(class{}))){static sanitize(e){return e.toString().replace(/</g,"&lt;").replace(/>/g,"&gt;")}static async pause(e=0){return new Promise(t=>{setTimeout(()=>t(),e)})}static uuid4(e){const t=(e||CryptoJS.lib.WordArray.random(16)).toString(),a=t.match(/([0-9a-fA-F]{8})([0-9a-fA-F]{4})([0-9a-fA-F]{4})([0-9a-fA-F]{4})([0-9a-fA-F]{12})/);if(!a)throw new Error(`failed to generate uuid from '${t}'`);return a.shift(),a.join("-").toLowerCase()}static toMD5String(e,t="hex"){if(!e)return;const a=e.match(/^[0-9a-fA-F]{32}$/)?"hex":"base64";if(a===t)return e;const s="hex"===a?CryptoJS.enc.Hex.parse(e):CryptoJS.enc.Base64.parse(e);return"hex"===t?CryptoJS.enc.Hex.stringify(s):CryptoJS.enc.Base64.stringify(s)}static randomHexstring(){const e=new Uint32Array(1);return(window.crypto||window.msCrypto).getRandomValues(e),e[0].toString(16)}static randomNumber(e=1e3,t=0){const a=new Uint32Array(1);(window.crypto||window.msCrypto).getRandomValues(a);const s=Math.max(1,e-t+1);return a[0]%s+t}static randomRGB(){const e=new Uint32Array(3);(window.crypto||window.msCrypto).getRandomValues(e);return`rgb(${e[0]%256}, ${e[1]%256}, ${e[2]%256})`}static randomRGBNumber(){const e=new Uint32Array(3);return(window.crypto||window.msCrypto).getRandomValues(e),[e[0]%256,e[1]%256,e[2]%256]}static parsePrefix(e){return e&&"/"!==e[e.length-1]?e.substring(0,e.lastIndexOf("/")):e}static toFriendlyName(e){return(e||"").replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}static async downscale(e,t=72,a=72){return new Promise((s,n)=>{if(!e)return void n(new Error("missing url"));const i=new Image;i.onload=()=>{const e=t/i.width,n=a/i.height,o=Math.max(e,n);let r=Math.floor(i.width*o);r-=r%2;let l=Math.floor(i.height*o);l-=l%2;const d=document.createElement("canvas");d.width=r,d.height=l;d.getContext("2d").drawImage(i,0,0,i.width,i.height,0,0,r,l);const c=d.toDataURL("image/png");s(c)},i.crossOrigin="anonymous",i.src=e})}}const{Buffer:Buffer$1}=window.Polyfill;class JwtToken{constructor(e){this.$token=e||"",this.$payload=JwtToken.decodePayload(e)}static decodePayload(e=""){try{const t=e.split(".")[1];return JSON.parse(Buffer$1.from(t,"base64").toString())}catch(e){return{}}}get token(){return this.$token}get payload(){return this.$payload}get jwtToken(){return this.token}get expiration(){return this.payload.exp}get issueAt(){return this.payload.iat}}const EXPIRE_IN_7DAYS=6048e5,StoreDefinitions={Stores:{Images:"local-images",Settings:"settings",Dataset:"dataset",Faces:"faces"},TimeToLive:{Name:"ttl",Value:6048e5}},DATABASE_NAME="m2cv3-0",DATABASE_VERSION=1,RW="readwrite";let _singleton$a;class LocalStoreDB{constructor(){this.monkeyPatch(),this.$db=void 0,_singleton$a=this}get db(){return this.$db}set db(e){this.$db=e}isSupported(){return!!window.indexedDB}monkeyPatch(){window.indexedDB||(window.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB),window.IDBTransaction||(window.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction||{READ_WRITE:RW}),window.IDBKeyRange||(window.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange)}async open(){if(!this.isSupported())throw new Error("indexedDB not supported");return this.db||(this.db=await new Promise((e,t)=>{const a=indexedDB.open("m2cv3-0",1);a.onerror=e=>{console.error(e),t(e)},a.onsuccess=async()=>{const t=Object.values(StoreDefinitions.Stores),s=a.result;await Promise.all(t.map(e=>this.removeExpired(s,e).catch(t=>(console.error(`ERR: onsuccess: ${e}: ${t.message}`),t)))),e(s)},a.onupgradeneeded=e=>{const t=Object.values(StoreDefinitions.Stores),s=StoreDefinitions.TimeToLive.Name,n=a.result;t.map(e=>n.createObjectStore(e).createIndex(s,s))}})),this.db}async close(){this.db&&(this.db.close(),this.db=void 0)}async openStore(e,t=RW){return this.db||await this.open(),this.db.transaction([e],t).objectStore(e)}async getItem(e,t){const a=await this.openStore(e);return new Promise(e=>{const s=a.get(t);s.onerror=t=>{console.error("getItem.onerror: "+t.message),e(void 0)},s.onsuccess=t=>e((t.target.result||{}).value)})}async putItem(e,t,a,s=StoreDefinitions.TimeToLive.Value){const n=await this.openStore(e);return new Promise(e=>{const i=n.put({value:a,[StoreDefinitions.TimeToLive.Name]:new Date(Date.now()+s)},t);i.onerror=t=>{console.error("putItem.onerror: "+t.message),e(void 0)},i.onsuccess=t=>e(t.target.result.value)})}async deleteItem(e,t){const a=await this.openStore(e);return new Promise(e=>{const s=a.delete(t);s.onerror=t=>{console.error("deleteItem.onerror: "+t.message),e()},s.onsuccess=()=>e()})}async deleteItemsBy(e,t){const a=await this.openStore(e);return new Promise(e=>{const s=IDBKeyRange.bound(t,t+"ï¿¿",!1,!1),n=a.openCursor(s);n.onsuccess=t=>{const a=t.target.result;a?(console.log("deleteItemsByPrefix: "+a.primaryKey),a.delete(),a.continue()):e()},n.onerror=t=>{console.error("deleteItemsByPrefix.onerror: "+t.message),e()}})}async removeExpired(e,t){return new Promise((a,s)=>{let n;try{n=e.transaction([t],RW)}catch(e){return void s(e)}const i=StoreDefinitions.TimeToLive.Name,o=n.objectStore(t).index(i),r=IDBKeyRange.upperBound(new Date);o.openCursor(r).onsuccess=t=>{const s=t.target.result;s?(console.log("expired item: "+s.primaryKey),s.delete(),s.continue()):a(e)}})}async clearAllStores(){const e=Object.values(StoreDefinitions.Stores);return Promise.all(e.map(e=>this.cleanStore(e)))}async cleanStore(e){if(!e)return;return(await this.openStore(e)).clear()}}const GetLocalStoreDB=()=>(void 0===_singleton$a&&new LocalStoreDB,_singleton$a);class BaseStore{constructor(e){this.$storeName=e,this.$db=GetLocalStoreDB()}get storeName(){return this.$storeName}get db(){return this.$db}async getItem(e){return this.db.getItem(this.storeName,e)}async putItem(e,t){return this.db.putItem(this.storeName,e,t)}async deleteItem(e){return this.db.deleteItem(this.storeName,e)}async deleteItemsBy(e){return this.db.deleteItemsBy(this.storeName,e)}}const EXPIRES_IN_YEAR=31536e6;let _singleton$9;class SettingStore extends BaseStore{constructor(){super(StoreDefinitions.Stores.Settings),_singleton$9=this}async putItem(e,t,a=31536e6){return this.db.putItem(this.storeName,e,t,a)}}const GetSettingStore=()=>(void 0===_singleton$9&&new SettingStore,_singleton$9),{CognitoIdentityProviderClient:CognitoIdentityProviderClient$1,AuthFlowType:AuthFlowType$1,InitiateAuthCommand:InitiateAuthCommand$1,GlobalSignOutCommand,CognitoIdentityClient,GetIdCommand,GetCredentialsForIdentityCommand}=window.AWSv3,REGION$4=SolutionManifest.Region,CLIENT_ID$1=SolutionManifest.Cognito.ClientId,IDENTITYPOOL_ID=SolutionManifest.Cognito.IdentityPoolId;SolutionManifest.Cognito.Group.Viewer;const GROUP_CREATOR=SolutionManifest.Cognito.Group.Creator,GROUP_ADMIN=SolutionManifest.Cognito.Group.Admin,GROUP_CAN_WRITE=[GROUP_CREATOR,GROUP_ADMIN],GROUP_CAN_MODIFY=[GROUP_ADMIN],ATTR_COGNITO_GROUP="cognito:groups",SESSION_SIGNIN="session:signin",SESSION_SIGNOUT="session:signout",SESSION_TOKEN_REFRESHED="session:token:refreshed",OPT_USERNAME="cognito.username",OPT_REFRESH_TOKEN="cognito.refreshtoken";let _singleton$8;const _receivers$3={},_onUserSessionChangeEvent=(e,t)=>{setTimeout(async()=>{const a=Object.keys(_receivers$3);try{await Promise.all(a.map(a=>_receivers$3[a](e,t).catch(e=>{console.error("ERR:",`_onUserSessionChangeEvent.${a}:`,e.message)}))),console.log("INFO:",`_onUserSessionChangeEvent.${e}:`,a.length+" receivers:",a.join(", "))}catch(t){console.error("ERR:",`_onUserSessionChangeEvent.${e}:`,t)}},10)},_cognitoIdpClient$1=new CognitoIdentityProviderClient$1({region:REGION$4});class UserSession{constructor(e){this.reinitialize(e),this.$id=AppUtils.randomHexstring(),_singleton$8=this}reinitialize(e){this.$accessToken=void 0,this.$idToken=void 0,this.$expiresIn=void 0,this.$tokenType=void 0,this.$newDeviceMetadata=void 0,this.$identityId=void 0,this.$credentials=void 0,(e||{}).RefreshToken&&(this.$refreshToken=new JwtToken(e.RefreshToken)),this.$refreshTimer&&this.$refreshTimer>0&&clearTimeout(this.$refreshTimer),this.$refreshTimer=-1,void 0!==e&&(this.$accessToken=new JwtToken(e.AccessToken),this.$idToken=new JwtToken(e.IdToken),this.$expiresIn=Number(e.ExpiresIn),this.$tokenType=e.TokenType,this.$newDeviceMetadata=e.NewDeviceMetadata)}get id(){return this.$id}get accessToken(){return this.$accessToken}get idToken(){return this.$idToken}get refreshToken(){return this.$refreshToken}get expiresIn(){return this.$expiresIn}get tokenType(){return this.$tokenType}get newDeviceMetadata(){return this.$newDeviceMetadata}get identityId(){return this.$identityId}set identityId(e){this.$identityId=e}get credentials(){return this.$credentials}set credentials(e){this.$credentials=e}get refreshTimer(){return this.$refreshTimer}set refreshTimer(e){this.$refreshTimer=e}get username(){return((this.accessToken||{}).payload||{}).username}get email(){return((this.idToken||{}).payload||{}).email}get assignedGroup(){return(((this.accessToken||{}).payload||{})["cognito:groups"]||[])[0]}canRead(){return void 0!==this.assignedGroup}canWrite(){return GROUP_CAN_WRITE.indexOf(this.assignedGroup)>=0}canModify(){return GROUP_CAN_MODIFY.indexOf(this.assignedGroup)>=0}getAccessToken(){return(this.accessToken||{}).token}getIdToken(){return(this.idToken||{}).token}getRefreshToken(){return(this.refreshToken||{}).token}sessionIsValid(){return void 0!==this.credentials}async signIn(){try{return await this.getCredentials(!0),this.startRefreshTimer(this.credentials.Expiration),_onUserSessionChangeEvent(SESSION_SIGNIN,this),this.credentials}catch(e){throw this.credentials=void 0,e}}async signOut(){try{this.stopRefreshTimer();const e=GetSettingStore();await Promise.all([OPT_REFRESH_TOKEN].map(t=>e.deleteItem(t))),_onUserSessionChangeEvent(SESSION_SIGNOUT,this);const t=this.accessToken,a=new GlobalSignOutCommand({AccessToken:t}),s=await _cognitoIdpClient$1.send(a);return console.log("GlobalSignOutCommand",s),s}catch(e){return void console.log("ERR:","UserSession.signOut:","GlobalSignOutCommand",e.$metadata.httpStatusCode,e.name,e.message)}finally{this.reinitialize()}}async getCredentials(e=!1){let t,a;if(e&&(this.credentials=void 0,this.identityId=void 0),void 0!==this.credentials)return this.credentials;const s=new CognitoIdentityClient({region:REGION$4});let n=new URL(this.idToken.payload.iss);n=[n.hostname,n.pathname].join("");const i={[n]:this.idToken.token};return void 0===this.identityId&&(t=new GetIdCommand({IdentityPoolId:IDENTITYPOOL_ID,Logins:i}),a=await s.send(t),console.log("GetIdCommand",a),this.identityId=a.IdentityId),this.identityId&&(t=new GetCredentialsForIdentityCommand({IdentityId:a.IdentityId,Logins:i}),a=await s.send(t),console.log("GetCredentialsForIdentityCommand",a),this.credentials=a.Credentials),this.credentials}async update(e){if(this.reinitialize(e),void 0!==e)return this.signIn()}startRefreshTimer(e){this.stopRefreshTimer();const t=new Date(e),a=new Date,s=Math.floor(t-a-3e5);console.log("Schedule refresh in",Math.floor(s/1e3),"secs"),s>0&&(this.refreshTimer=setTimeout(async()=>{await this.refreshTokenAuth(),this.startRefreshTimer(this.credentials.Expiration),_onUserSessionChangeEvent(SESSION_TOKEN_REFRESHED,this)},s))}stopRefreshTimer(){this.refreshTimer>0&&clearTimeout(this.refreshTimer),this.refreshTimer=-1}async refreshTokenAuth(e){try{console.log("== refreshTokenAuth BEGIN ==");const t={ClientId:CLIENT_ID$1,AuthFlow:AuthFlowType$1.REFRESH_TOKEN_AUTH,AuthParameters:{REFRESH_TOKEN:e||this.getRefreshToken()}},a=new InitiateAuthCommand$1(t),s=await _cognitoIdpClient$1.send(a).then(e=>e.AuthenticationResult);this.reinitialize(s),await this.getCredentials(!0),console.log("== refreshTokenAuth SUCCEEDED ==")}catch(e){console.log("== refreshTokenAuth FAILED =="),console.log("ERR:","UserSession.refreshTokenAuth:","InitiateAuthCommand:",(e.$metadata||{}).httpStatusCode,e.name,e.message)}}fromCredentials(){return new Promise(e=>{const t=this.credentials;e({accessKeyId:t.AccessKeyId,secretAccessKey:t.SecretKey,sessionToken:t.SessionToken,expiration:t.Expiration})})}withCognitoIdentityPool(){let e=new URL(this.idToken.payload.iss);e=[e.hostname,e.pathname].join("");const t={[e]:this.idToken.token};return{identityPoolId:IDENTITYPOOL_ID,logins:t,clientConfig:{region:REGION$4}}}withCognitoIdentity(){let e=new URL(this.idToken.payload.iss);e=[e.hostname,e.pathname].join("");const t={[e]:this.idToken.token};return{identityId:this.identityId,logins:t,clientConfig:{region:REGION$4}}}}const CreateUserSessionFromAuth=async e=>{_singleton$8?(console.log("CreateUserSessionFromAuth","singleton exists, update user session"),await _singleton$8.update(e)):(console.log("CreateUserSessionFromAuth","singleton not exists, create a new user session"),new UserSession(e));const t=GetSettingStore();return await Promise.all([[OPT_USERNAME,_singleton$8.username],[OPT_REFRESH_TOKEN,_singleton$8.getRefreshToken()]].map(e=>t.putItem(e[0],e[1]))),_singleton$8},GetUserSession=()=>(void 0===_singleton$8&&new UserSession,_singleton$8),LoadUserSessionFromCache=async()=>{try{const e=GetSettingStore(),[t,a]=await Promise.all([OPT_USERNAME,OPT_REFRESH_TOKEN].map(t=>e.getItem(t)));if(void 0===t||void 0===a)return;const s=GetUserSession();return await s.refreshTokenAuth(a),s}catch(e){return void console.error("ERR:","UserSession.LoadUserSessionFromCache:",e.message)}},RegisterUserSessionEvent=(e,t)=>!(!e||"function"!=typeof t)&&(_receivers$3[e]=t,!0),{S3Client,HeadObjectCommand,GetObjectCommand,PutObjectCommand,DeleteObjectCommand,ListObjectsV2Command,Upload,getSignedUrl}=window.AWSv3,REGION$3=SolutionManifest.Region,EXPECTED_BUCKET_OWNER=SolutionManifest.S3.ExpectedBucketOwner,EXPIRES_IN=7200,MAX_CONCURRENT_UPLOAD=4,MULTIPART_SIZE=8388608;let _s3Client,_singleton$7;function updateClient(e){_s3Client=new S3Client({region:REGION$3,credentials:e.fromCredentials(),computeChecksums:!0,applyChecksum:!0})}async function onUserSessionChangeEvent(e,t){e!==SESSION_SIGNIN&&e!==SESSION_TOKEN_REFRESHED||updateClient(t)}RegisterUserSessionEvent("s3utils",onUserSessionChangeEvent.bind(void 0));class S3Utils{constructor(){_singleton$7=this,this.$id=AppUtils.randomHexstring()}get id(){return this.$id}async signUrl(e,t){const a=new GetObjectCommand({Bucket:e,Key:t});return getSignedUrl(_s3Client,a,{expiresIn:7200})}async headObject(e,t){const a=new HeadObjectCommand({Bucket:e,Key:t,ExpectedBucketOwner:EXPECTED_BUCKET_OWNER});return _s3Client.send(a).then(e=>(delete e.$metadata,e))}async getObject(e,t){const a=new GetObjectCommand({Bucket:e,Key:t,ExpectedBucketOwner:EXPECTED_BUCKET_OWNER});return _s3Client.send(a).then(e=>(delete e.$metadata,e))}async listObjects(e,t){let a,s=[];do{const n=new ListObjectsV2Command({Bucket:e,Prefix:t,MaxKeys:100,ContinuationToken:(a||{}).NextContinuationToken,ExpectedBucketOwner:EXPECTED_BUCKET_OWNER});a=await _s3Client.send(n),s=s.concat(a.Contents)}while((a||{}).NextContinuationToken);return s}async deleteObject(e,t){const a=new DeleteObjectCommand({Bucket:e,Key:t,ExpectedBucketOwner:EXPECTED_BUCKET_OWNER});return _s3Client.send(a).then(e=>(delete e.$metadata,e))}async upload(e,t){const a=new Upload({client:_s3Client,params:{...e,ExpectedBucketOwner:EXPECTED_BUCKET_OWNER},queueSize:4,partSize:8388608,leavePartsOnError:!1});return a.on("httpUploadProgress",a=>{"function"==typeof t?t(a):console.log("INFO:","httpUploadProgress:",a,`(${e.Key})`)}),a.done()}}const GetS3Utils=()=>{if(void 0===_singleton$7){new S3Utils;updateClient(GetUserSession())}return _singleton$7};let _singleton$6;class ImageStore extends BaseStore{constructor(){super(StoreDefinitions.Stores.Images),_singleton$6=this}async getImageURL(e,t,a){let s=await this.getItem(e);if(!s){const n=GetS3Utils(),i=await n.getObject(t,a);s=await i.Body.transformToByteArray().then(e=>new Blob([e.buffer],{type:i.ContentType})),await this.putItem(e,s)}return URL.createObjectURL(s)}async getBlob(e){let t=await this.getItem(e);if(!t){if(t=await fetch(e).then(e=>{if(!e.ok)return;const t=(e.headers.get("Content-Type")||"").split("/").shift();return t&&"image"===t.toLowerCase()?e.blob():void 0}),!t)return;await this.putItem(e,t)}return URL.createObjectURL(t)}}const GetImageStore=()=>(void 0===_singleton$6&&new ImageStore,_singleton$6);let _singleton$5;class DatasetStore extends BaseStore{constructor(){super(StoreDefinitions.Stores.Dataset),_singleton$5=this}async getDataset(e,t){let a=await this.getItem(t).catch(()=>{});if(!a){const s=GetS3Utils();a=await s.getObject(e,t).catch(()=>{}),a&&(a=await a.Body.transformToString().then(e=>JSON.parse(e)),await this.putItem(t,a))}return a}}const GetDatasetStore=()=>(void 0===_singleton$5&&new DatasetStore,_singleton$5);let _singleton$4;class FaceStore extends BaseStore{constructor(){super(StoreDefinitions.Stores.Faces),_singleton$4=this}}const GetFaceStore=()=>(void 0===_singleton$4&&new FaceStore,_singleton$4),FIELD_PWD=["P","a","s","s","w","o","r","d"].join("");class Localization{static get isoCode(){return"en-US"}static get Messages(){return Localization.Languages[Localization.isoCode].Messages}static get Tooltips(){return Localization.Languages[Localization.isoCode].Tooltips}static get Buttons(){return Localization.Languages[Localization.isoCode].Buttons}static get Alerts(){return Localization.Languages[Localization.isoCode].Alerts}static get Statuses(){return Localization.Languages[Localization.isoCode].Statuses}static get Languages(){return{"en-US":{Messages:{Title:'Media2Cloud Demo Portal <span style="font-size:0.85rem">by AWS Solutions Team</span>',PwdRequirement:FIELD_PWD+' must be at least <abbr title="eight characters">eight</abbr> characters long and contain <abbr title="one uppercase character">one</abbr> uppercase, <abbr title="one lowercase character">one</abbr> lowercase, <abbr title="one numeric character">one</abbr> number, and <abbr title="one special character">one</abbr> special character.',ResetSendCode:`Please enter the username and press <strong>Send code</strong>. You should receive a 6-digits code in mail in a few minutes. You will need the code to reset the ${FIELD_PWD}.`,ResetPwd:`Please enter the verification code that has sent to your email address and your new ${FIELD_PWD}.`,SolutionName:"AWS Media2Cloud Solution",AboutTab:"About",Mission:"AWS Media2Cloud Solution is designed to help customers to blah...",Design:"Architecture Design goes here...",Team:"Team member goes here...",StatsTab:"Stats",FaceCollectionTab:"FaceCollection",SettingsTab:"Settings",SettingsDesc:"This setting page allows you to configure and fine tune AI/ML settings for each of the Amazon AI services. (Admin privileges required)",DatastoreFeature:"Local Data Store (IndexedDB)",DatastoreFeatureDesc:'Media2Cloud uses <a href="https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API" target="_blank">IndexedDB</a> to cache thumbnail images, datasets, and other settings locally. Click <strong/>Clean up data store</strong> to delete the local data.',RekognitionFeatures:"Amazon Rekognition Settings",RekognitionFeaturesDesc:'<a href="https://aws.amazon.com/rekognition" target="_blank">Amazon Rekognition</a> allows you to detect celebrities, faces, labels, objects or create your own <a href="https://docs.aws.amazon.com/rekognition/latest/dg/collections.html" target="_blank">Face Collection</a> to match faces in your collection.',ComprehendFeatures:"Amazon Comprehend Settings",ComprehendFeaturesDesc:'<a href="https://aws.amazon.com/comprehend/" target="_blank">Amazon Comprehend</a> allows you to extract keyphrases, entities, sentiments, and classification. You can also train your <a href="https://docs.aws.amazon.com/comprehend/latest/dg/custom-entity-recognition.html" target="_blank">Custom Entity Recognizer</a> to identify custom entities for your business needs. Check out this blog post, <a href="https://aws.amazon.com/blogs/machine-learning/build-a-custom-entity-recognizer-using-amazon-comprehend/" target="_blank">Build a custom entity recognizer using Amazon Comprehend</a>.',TranscribeFeatures:"Amazon Transcribe Settings",TranscribeFeaturesDesc:'<a href="https://aws.amazon.com/transcribe/" target="_blank">Amazon Transcribe</a> is a automatic speech recognition (ASR) service. Media2Cloud extracts audio stream from your asset and autmatically create subtitle track using <a href="https://aws.amazon.com/blogs/aws/amazon-transcribe-now-supports-automatic-language-identification/" target="_blank">Amazon Transcribe Automatic Language Identification feature</a>. You can also train a custom language model to improve the ASR result. Check out this blog post, <a href="https://aws.amazon.com/blogs/machine-learning/building-custom-language-models-to-supercharge-speech-to-text-performance-for-amazon-transcribe/" target="_blank">Building custom language models to supercharge speech-to-text performance for Amazon Transcribe</a>. (Note that Custom Language Model currently supports English only.)',TextractFeatures:"Amazon Textract Settings",TextractFeaturesDesc:'<a href="https://aws.amazon.com/textract/" target="_blank">Amazon Textract</a> is an optical character recognition (OCR) service that allows you to extract text and relationship of a document such as PDF file.',AIMLSetting:"AI/ML Settings",AdvanceFeatures:"Advanced Features",CollectionTab:"Collection",UploadTab:"Upload",ReviewAnalysisSettings:"Carefully review the following AI/ML settings that are used to analyze the contents.",Enabled:"Enabled",Disabled:"Disabled",NotSet:"Not set",Search:"Search",Submit:"Submit",SearchDesc:'The search feature is powered by <a href="https://aws.amazon.com/opensearch-service/features/serverless/" target="_blank">Amazon OpenSearch Serverless</a>, a managed service that scales to support petabyte storage without configuring or managing clusters. It now supports <strong>complex search query</strong> where you can use keywords such as <code>and</code>, <code>or</code>, <code>not</code> logical operators, <code>parenthesis</code> to group terms, <code>quotation</code> for exact phrase match, and <code>wildcard</code> search. See examples and syntax below.',SearchQueryFailed:"Fail to query the search results",ExactMatch:"Exact match",PageSize10:"10 results per page",PageSize30:"30 results per page",PageSize50:"50 results per page",SearchResultDesc:"Search results",Category:"Category",SearchExampleSyntax:"Search examples and syntax",SearchExampleSyntaxDesc:'The Amazon OpenSearch Service (search engine) can support complex search. For instance, you can search for multiple people who are present in the same video such as <code>Andy Jassy</code> and <code>Werner Vogels</code>. You can search for videos where <code>Andy Jassy</code> has said <code>"There is no compression algorithm for experience."</code>. Or, you can search for <code>Jeff Bezos</code> in video where <code>Blue Origins rocket launch</code>. Also note that, the search query is <strong>case insensitive</strong> that implies searching <code>Andy Jassy</code> and <code>andy jassy</code> returns the same results.  Let\'s take a look at a few search examples below.',SearchExample1:"Example 1: Simple search with a name",SearchExample1Desc:"Search: <code>Andy Jassy</code><br/>The results may return <code>Andy Jassy</code>, <code>Peter Jassy</code>, <code>Andy Jo</code>, and so forth. This is because the search query searches for any name that contains either <code>Andy</code> or <code>Jassy</code>. Obviously, some names are not really what you are looking for. The next example shows you how to perform an exact match search.",SearchExample2:"Example 2: Exact match search of a name",SearchExample2Desc:'Search: <code>"Andy Jassy"</code><br/>Instead of typing <code>Andy Jassy</code>, use the double quotation mark, <code>"Andy Jassy"</code>. When the search query is quoted, the search engine performs a search of the entire phrase instead of individual word of the phrase. This can be very useful when you are searching a phrase in the transcription. For instance, searching Andy Jassy\'s famous quote, <code>"no compression algorithm for experience."</code>',SearchExample3:"Example 3: Search for multiple names and phrases",SearchExample3Desc:'Search: <code>"Andy Jassy" AND "no compression algorithm for experience."</code><br/>You can use <code>AND</code>, <code>OR</code>, and/or <code>NOT</code> keywords to perform complex search. The search query above returns videos where <span class="text-success">Andy Jassy</span> says <span class="text-success">"no compression algorithm for experience."</span>.',SearchExample4:"Example 4: Complex search with grouping",SearchExample4Desc:'Search: <code>(("Andy Jassy" OR "Werner Vogels") NOT "AWS Summit")</code><br/>You can use parenthesis, <code>(</code> and <code>)</code> to build a complex search query. In this example, searching <code>(("Andy Jassy" OR "Werner Vogels") NOT "AWS Summit")</code> returns videos where both <span class="text-success">Andy Jassy</span> and <span class="text-success">Werner Vogels</span> are present but NOT in an <span class="text-success">AWS Summit</span> event.',SearchExample5:"Example 5: Wildcard search??",SearchExample5Desc:'Search: <code>(Werner AND Vog*) OR (Andy AND Jas??)</code><br/>Yes, you can do wildcard search, an asterisk <code>*</code> or a question mark, <code>?</code> where <code>*</code> matches multiple characters and <code>?</code> matches one character. <span class="font-weight-bold">It is important to note that <code>*</code> and <code>?</code> inside a double quotation (a phrase) is literal and will not match multiple characters.</span> In this example, <code>(Werner AND Vog*) OR (Andy AND Jas??)</code> will match <span class="text-success">Werner Vog<strong>els</strong></span> or <span class="text-success">Andy Jas<strong>sy</strong></span>',Transcript:"Transcript",KnownFaces:"Known faces",Keyphrases:"Key phrases",Entities:"Entities",VisualText:"Visual text",ContentAttributes:"Content attributes",TranscriptPhrasesEntities:"Transcript, Phrases, & Entities",LabelsModeration:"Labels & Moderation",ContentTab:"Content",VideoTab:"Video",PhotoTab:"Photo",PodcastTab:"Podcast",DocumentTab:"Document",SearchTab:"Search",GroupTab:"Group",NoMediaPresent:'You don\'t have any <abbr title="media">{{MEDIATYPE}}</abbr> files in your collection. Navigate to <abbr title="upload">{{UPLOADTAB}} Tab</abbr> to start adding files.',MediaInProcess:"<p><strong>{{BASENAME}}</strong> media is still in process. Please navigate to <strong>{{PROCESSINGTAB}} Tab</strong> to check the progress.</p>",MediaError:"<p><strong>{{BASENAME}}</strong> media has failed to process. Please navigate to <strong>{{PROCESSINGTAB}} Tab</strong> to see more details.</p>",RemoveMedia:"<p/>Removing <strong/>{{BASENAME}}</strong> will <u>delete</u> all proxies, metadata, and records from the collection.</p><p>Would you like to proceed?</p>",ProcessingTab:"Processing",ProcessingDesc:"List of processing jobs",ProcessingError:'Fail to process <abbr title="basename">{{BASENAME}}</abbr>. Navigate to <abbr title="processing">{{PROCESSINGTAB}} Tab</abbr> to check the details.',ErrorDesc:"List of recent error jobs",Name:"Name",Uuid:"Unique Id",Status:"Current status",OverallStatus:"Overall status",DropzoneDesc:"Drag and drop file(s) to the 'drop area' or click on 'Browse files' to select file(s) to start the process. You can drop multiple files or folders. (Note: Folder is supported in Chrome, Firefox, and Edge browsers.)",AttributeDesc:'Associate additional information to the files. The information will be indexed to <a href="https://aws.amazon.com/elasticsearch-service/" target="_blank">Amazon Elasticsearch service</a> and be made available through the search feature.',AnalysisDesc:'Media2Cloud uses various AWS AI services to analyze video, images, audio, and documents. The analysis includes detecting celebrities, faces, labels, moderations, key phrases, entities, sentiments, and transcription. To learn more about AWS AI services, please visit <a href="https://aws.amazon.com/rekognition/" target="_blank">Amazon Rekognition</a>, <a href="https://aws.amazon.com/transcribe/" target="_blank">Amazon Transcribe</a>, and <a href="https://aws.amazon.com/comprehend/" target="_blank">Amazon Comprehend</a>.',FinalizeUploadDesc:'This final upload process assigns an unique ID (uuid) to each file, checks for collision, computes a MD5 checksum of the file, and uses <a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/mpuoverview.html" target="_blank">multipart upload</a> to transfer the file to your Amazon S3 Bucket, {{BUCKET}}. Please confirm the final list below and click on \'Start now\' to start the process.',DropFileHere:"Drop file(s) here to start",FileToBeProcessed:"File(s) to be processed:",GroupName:"Specify group name",GroupDesc:"Specify a group name to tie all the files together. You can then search the files by group later on. The group name should only contain alphanumeric, dash, and underscore characters. Leave it blank if you don't want to group them.",AttrDesc:"Attach additional attributes such as author, synopsis, or genre to the files. The attribute is a set of key-value pairs. Key can contain alphanumeric, dash and underscore characters. Value can contain alphanumeric, dash, underscore, comma, period, or percent sign characters. Use encodeURIComponent to encode the value if it contains other characters.",FramebasedDesc:'<span class="text-success">New feature:</span> Frame based analysis uses Amazon Rekognition Image APIs instead of Amazon Rekognition Video APIs to analyze video files. Detections include celebrities, faces, labels, moderations, and texts. (Note: segment and person pathing detections continue to use Amazon Rekognition Video APIs.)',Framebased:"Frame based analysis",FaceCollectionId:"Face Collection",CustomLabelModels:"Custom label model(s)",FrameCaptureMode:"Frame capture mode",FrameCaptureModeNone:"Disable frame capture",FrameCaptureMode1FPS:"1 frame per second",FrameCaptureMode2FPS:"2 frames per second",FrameCaptureMode3FPS:"3 frames per second",FrameCaptureMode4FPS:"4 frames per second",FrameCaptureMode5FPS:"5 frames per second",FrameCaptureMode10FPS:"10 frames per second",FrameCaptureMode12FPS:"12 frames per second",FrameCaptureMode15FPS:"15 frames per second",FrameCaptureModeAllFrames:"Every frame",FrameCaptureModeEveryOtherFrame:"Every other frame",FrameCaptureMode1FramePer2Seconds:"1 frame every 2 seconds",FrameCaptureMode1FramePer5Seconds:"1 frame every 5 seconds",FrameCaptureMode1FramePer10Seconds:"1 frame every 10 seconds",FrameCaptureMode1FramePer30Seconds:"1 frame every 30 seconds",FrameCaptureMode1FramePer1Minute:"1 frame every 1 minute",FrameCaptureMode1FramePer2Minutes:"1 frame every 2 minutes",FrameCaptureMode1FramePer5Minutes:"1 frame every 5 minutes",TextROI:"Text regions of interest",LanguageCode:"Language code",CustomLanguageModel:"Custom Language Model",CustomVocabulary:"Custom vocabulary",CustomEntityRecognizer:"Custom Entity Recognizer",TextRegionOfInterest:"Region of Interest for Amazon Rekognition Text Detection",SelectModel:"Select a model...",SelectModels:"Select model(s)...",SelectFrameCaptureMode:"Auto select...",SelectLanguageCode:"Auto detect language...",SelectCollection:"Select a collection...",MinConfidence:"Min. confidence",Celeb:"Celebrity detection",Label:"Label detection",Face:"Face detection",Facematch:"Face match detection",Person:"Person detection",Moderation:"Moderation detection",Text:"Text detection",Entity:"Entity detection",Keyphrase:"Keyphrase detection",Sentiment:"Sentiment analysis",Topic:"Topic analysis",Document:"Document analysis",Segment:"Shot segment detection",CustomlabelDesc:'<span class="text-success">New feature:</span> With <a href="https://aws.amazon.com/rekognition/custom-labels-features/" target="_blank">Amazon Rekognition Custom Labels Feature</a>, you can quickly train a computer vision (CV) model such as image classification or object detection model to identify objects or classes based on your business needs. Select up to <strong>{{MAX_CUSTOMALBELMODELS}}</strong> models. Check out this GitHub sample solution, <a href="https://github.com/aws-samples/amazon-rekognition-custom-brand-detection" target="_blank">Building brand (custom object) detection demo</a>.',Customlabel:"Custom label detection",ComprehendInCertainLanguage:"** Comprehend features may not be available in certain languages",Summary:"Summary",Source:"Source",FileName:"Name",FileSize:"Size",FileType:"Type",LastModified:"Last modified",Destination:"Destination",Bucket:"Bucket",Key:"Key",Attributes:"Attributes",UploadStatus:"Upload status",ValidateUuid:"Validate uuid",ComputeChecksum:"Compute checksum",UploadS3:"Upload to S3",VideoCategory:"Video category",PhotoCategory:"Photo category",PodcastCategory:"Podcast category",DocumentCategory:"Document category",GroupCategory:"Group category",CelebrityCategory:"Celebrity category",LoadMore:"Load more...",NoMoreData:"No more data...",NoData:"No relevant data...",GeneralGroup:"General",ProxyGroup:"Proxies",MediaInfoGroup:"MediaInfo",EXIFGroup:"EXIF",BasicGroup:"Basic",GPSGroup:"GPS",PDFGroup:"PDF Info",OthersGroup:"Others",TechnicalGroup:"Technical",SourceTab:"Source",ProxiesTab:"Proxies",MediainfoTab:"Mediainfo",ImageinfoTab:"EXIF Info",Basic:"Basic",GPS:"GPS",ShowMap:"Show location",More:"More...",DocinfoTab:"Docinfo",AnalysisGroup:"Analysis",StatisticsTab:"Statistics",SearchResultTab:"Search Results",ReAnalyzeTab:"Re-Analyze",SummaryTab:"Summary",WorkflowHistory:"AWS Step Functions (workflow history)",Rekognition:"Amazon Rekognition",Comprehend:"Amazon Comprehend",Transcribe:"Amazon Transcribe",Textract:"Amazon Textract",Labels:"Labels",DownloadJson:"Download JSON",TranscribeTab:"Transcribe",ImageCaptionTab:"Captioning",CelebTab:"Celebrity",LabelTab:"Label",FaceMatchTab:"Face Match",FaceTab:"Face",PersonTab:"Person",SegmentTab:"Segment",TextTab:"Text",ModerationTab:"Moderation",KeyphraseTab:"Keyphrase",EntityTab:"Entity",SentimentTab:"Sentiment",TopicTab:"Topic",ClassificationTab:"Classification",TextractTab:"Textract",CustomLabelTab:"Custom label",EnableAll:"Enable all labels",ToggleAll:"Toggle all labels",ToggleTextOverlay:"Enable text overlay",TranscriptionJob:"Transcription Job",SubtitleSwitch:"Turn subtitle on/off",DownloadEDLDesc:"Media2Cloud converts AI/ML detection results to Edit Decision List (EDL) format that allows you to import the detection results as timelines into popular editing software.",ScatterGraphDesc:"Toggle a legend to show or hide data points of the selected label. Click on individual data point to seek to the timestamp on the video to see the detection results.",SearchSpecificLabel:"(Search specific label)",Row:"Row",Rows:"Rows",Table:"Table",Tables:"Tables",KeyValueSets:"Key Value Sets",Lines:"Lines",Page:"Page",ToolsGroup:"Tools",SnapshotTab:"Snapshot",EnableSnapshot:"Enable snapshot",DoneSnapshot:"Done snapshot",CaptureImage:"Capture image",SelectLabels:"Select label(s)...",SelectNone:"Deselect all",SelectAll:"Select all",StatsDesc:"Provide overall and categorized statistics of your collection.",OverallStats:"Overall stats",TotalCount:"Total number of media per category",TotalSize:"Total sizes of media per category",WorkflowStatuses:"Overview of workflow statuses",MostRecentStats:"Most recently ingested media",Aggregations:"Aggregations of AI/ML metadata",TopKnownFaces:"Top known faces in library",TopLabels:"Top labels in library",TopModerations:"Top moderation labels in library",TopKeyphrases:"Top keyphrases in library",TopEntities:"Top entities in library",LongestFile:"Longest duration in library",LargestFile:"Largest filesize in library",FaceCollectionDesc:"Create, view and manage your Amazon Rekognition Face Collection(s).",AvailableFaceCollections:"List of available face collection(s)",IndexedFacesInCollection:"Indexed faces found in <strong>{{FACE_COLLECTION}}</strong> collection",SelectFaceCollection:"Select a face collection...",Alternatively:"Alternatively,",EnableSnapshotMode:"Snapshot mode",UserManagementTab:"User Management",UserManagementDesc:'The page provides a simple way to manage users and control user accesses to the Media2Cloud solution web portal. The user directory is managed by <a href="https://aws.amazon.com/cognito/" target="_blank">Amazon Cognito User Pool</a>. (Administrator privilege required.) Alternatively, you can manage your user directory from <a href="{{CONSOLE_USERPOOL}}" target="_blank">Amazon Cognito User Pools Console</a>.',Username:"Username",Email:"Email",Group:"Group",Permission:"Permission",RemoveUser:"Remove user?",PermissionViewer:"Can view assets",PermissionCreator:"Can view and ingest assets",PermissionAdmin:"Full admin access",CurrentUsers:"List of current user(s)",CreateNewUsers:"Create new user(s)",CreateNewUsersDesc:"To add a new user, click on <strong>{{ADD_EMAIL}}</strong> button, enter a valid <em>email address</em>, assign user to a <em>group</em>, and (optionally) specify an <em>username</em>. Repeat the process to add multiple users. When you are ready, click on <strong>{{CONFIRM_AND_ADD}}</strong> button to create the user(s).",ImageCaptionDesc:'(Image caption generated by BLIP: Bootstrapping Language-Image Pre-training for Unified Vision-Language Understanding and Generation machine learning model. Learn more about <a href="https://arxiv.org/abs/2201.12086" target="_blank">BLIP</a>)',KnowledgeGraphTab:"Knowledge Graph",KnowledgeGraphTabDesc:"Demonstrates a graph representation of the content and how it is related to other contents in your archive library",KGViewConnections:"View search results' connections (Note: the query could take a few seconds)"},Tooltips:{VisitSolutionPage:"Visit AWS Solutions page",Logout:"ready to logout?",RemoveMedia:"Remove media from collection",MinConfidence:"Set the minimum confidence level for various Amazon Rekognition detection(s) to return the result set",FaceColection:"Uses Amazon Rekognition Face Collection",CustomLabelModels:"Uses Amazon Rekognition Custom Labels feature",FrameCaptureMode:"Define frame interval to run Custom Labels detection",TextROI:"Define the regions of interest to run Amazon Rekognition Text detection",LanguageCode:"Specify language code to run Amazon Transcribe",CustomLanguageModel:"Uses Amazon Transcribe Custom Language Model (English only)",CustomVocabulary:"Uses Amazon Transcribe Custom Vocabulary",CustomEntityRecognizer:"Uses Amazon Comprehend Custom Entity Recognizer",TextRegionOfInterest:"Define region of interest for Amazon Rekognition Text Detection",Celeb:"Uses Amazon Rekognition celebrity recognition detection",Label:"Uses Amazon Rekognition label detection",Face:"Uses Amazon Rekognition face detection",Facematch:"Uses Amazon Rekognition face search to match indexed faces in your own face collection",Person:"Uses Amazon Rekognition person pathing detection",Moderation:"Uses Amazon Rekognition moderation detection",Text:"Uses Amazon Rekognition text detection to extract texts from images and videos",Customlabel:"Uses Amazon Rekognition Custom Labels to detect objects",Framebased:"Opt in to use Amazon Rekognition Image APIs",Transcribe:"Uses Amazon Transcribe to convert speech to text from audio file or track",Entity:"Uses Amazon Comprehend to extract entities such as locations, dates, and quantities from the transcription",Keyphrase:"Uses Amazon Comprehend to extract key phrases from the transcription",Sentiment:"Uses Amazon Comprehend to analyze sentiments of the phrases from the transcription",Topic:"Uses Amazon Comprehend to analyze topics of the phrases from the transcription",Document:"Uses Amazon Textract to extract form, key-value pairs, and texts from documents",SetAsDefault:"Save settings as default on your local browser",RestoreOriginal:"Restore settings to the originals",ApplyToAllUsers:"Store settings globally and apply to all users",ToggleAll:"Show all datapoints for all labels in the graph. Rendering all datapoints can affect performance. Recommend to use the 'search' feature and select label that you are interested in.",ToggleTextOverlay:"Display labels on screen while playing video. Rendering large number of labels can affect video playback performance. Recommend to disable text overlay when you have over 200 labels.",RemoveFromList:"Remove file from the list?",UploadOnly:"File will be uploaded but won't be analyzed",ViewOnAWSConsole:"view on console",ViewJobOnAWSConsole:"View job on AWS Console",DownloadFile:"download file",DeveloperWarning:"To remove 'For development purposes only' message, go to 'Settings' page, enter your Google Map API Key, and refresh the page.",Confidence:"Confidence",DeleteImage:"Delete image",SelectMultipleItems:"Select multiple items",PreviewMedia:"Preview media",RefreshStats:"Refresh stats",RemoveFaceFromCollection:"Remove face from collection",RemoveFaceCollection:"Delete the entire face collection!",IndexFace:"Enter a name of the cropped face and select a face collection to store the face",RemoveUserFromCognito:"Remove user from user directory",RefreshUserTable:"Fetch users from Amazon Cognito User Pool again"},Buttons:{Back:"Back",Next:"Next",Cancel:"Cancel",Close:"Close",Done:"Done",QuickUpload:"Quick upload",Startover:"Start over",StartNow:"Start now",Remove:"Remove",BrowseFiles:"Browse files",SetAsDefault:"Save as default",RestoreOriginal:"Restore original settings",ApplyToAllUsers:"Apply settings to all users",DownloadSummary:"Download summary",ClosePreview:"Close preview window",DownloadEDL:"Download EDL Package",Refresh:"Refresh",CreateNewCollection:"Create new collection",RemoveFaceCollection:"Delete face collection",IndexFace:"Index face",CleanupDatastore:"Clean up data store",ReAnalyzeContent:"Re-run AI/ML analysis",AddEmail:"Add email",ConfirmAndAddUsers:"Confirm and add users",LoadMore:"Load more..."},Statuses:{NotStarted:"Not started",Queuing:"Queuing",Waiting:"Waiting",Processing:"Processing",Completed:"Completed",Error:"Error",Total:"Total"},Alerts:{Oops:"Oops...",Warning:"Warning",Confirmed:"Confirmed",PwdConformance:`${FIELD_PWD} doesn't conform with the requirements. Please make sure the ${FIELD_PWD} is at least 8 characters, 1 uppercase, 1 lowercase, 1 numeric, and 1 special character.`,UsernameConformance:"Username don't conform with the requirements. Please make sure the username only contains alphanumeric and/or '.', '_', '%', '+', '-' characters",SignInProblem:"Problem to sign in. Please try again.",MismatchPwds:`${FIELD_PWD} doesn't match. Please re-enter the ${FIELD_PWD}`,PwdConfirmed:`Your new ${FIELD_PWD} has been set. Please re-sign in to the portal.`,SessionExpired:"Session expired. Please sign in again.",NoValidFile:"No valid file has been imported.",FileTypeNotSupported:"File type is not supported",FileCannotImported:"A few files cannot be imported.",InvalidGroupName:"Invalid group name. <strong>Group Name</strong> can contain alphnumeric, dash, or underscore characters and must be less than 128 characters.",InvalidKeyValue:"Invalid key or value. <strong>Key</strong> can contain alphnumeric, dash, or underscore characters and must be less than 128 characters. <strong>Value</strong> can contain alphanumeric, dash, underscore, comma, period, or percent sign characters and must be less than 255 characters",MaxNumOfAttrs:"You can add at most 20 attributes.",CreateUuidError:"fail to create an unique uuid...",ComputeChecksumError:"fail to compute MD5 checksum...",UploadS3Error:"fail to upload file to S3 bucket...",StartWorkflowError:"fail to start ingest workflow...",InvalidFaceCollectionName:"Face Collection name can only contain alphnumeric, period, dash, and underscore characters and be less than 255 characters",InvalidIndexedName:"Name can only contain alphnumeric, space, period, dash, and underscore characters and be less than 255 characters",InvalidFaceCollectionSelection:"Make sure to select a face collection. If you don`t have any face collection, navigate to <strong>FaceCollection Tab</strong> to create one.",ConfirmFaceIndexed:"<strong>{{NAME}}</strong> has successfully added to <strong>{{FACECOLLECTION}}</strong> collection!",ReAnalzyeFailed:"Fail to re-run AI/ML analysis process for <strong>{{BASENAME}}</strong> media.",ReAnalyzeSubmitted:"Re-runing the AI/ML analysis process for <strong>{{BASENAME}}</strong> media.",DeleteMediaNotAllowed:"You don't have permission to delete the media.",InvalidEmailAddress:"Invalid email address",NoNewUsers:"No user to add",FailAddingUsers:"Problem adding the following users: {{USERS}}",InvalidSearchTerm:"Search query should only contain letters, numbers, punctunations, currencies, and space characters, <code>[\\p{L}\\p{P}\\p{N}\\p{Sc}\\s]+</code>"}}}}}const MediaTypes={Video:"video",Podcast:"audio",Photo:"image",Document:"document",Audio:"audio",Image:"image",Group:"group",Celebrity:"celebrity",Unknown:"unknown"},{FetchHttpHandler,streamCollector,HttpRequest,SignatureV4,Sha256}=window.AWSv3;function encodeRFC3986URIComponent(e){return encodeURIComponent(e).replace(/[!'()*]/g,e=>"%"+e.charCodeAt(0).toString(16).toUpperCase())}function sanitizeQS(e={}){const t={},a=new URLSearchParams(e);for(const[e,s]of a.entries())void 0!==s&&"undefined"!==s&&(t[e]=encodeRFC3986URIComponent(s));return t}class AuthHttpRequest{async send(e,t,a={},s="",n={}){const i=sanitizeQS(a);let o=s;"string"!=typeof s&&(o=JSON.stringify(s));const r=new URL(t),l={method:e,protocol:r.protocol,hostname:r.hostname,path:r.pathname,query:i,body:o,headers:{"Content-Type":"application/json",host:r.hostname,...n}},d=new HttpRequest(l),c=GetUserSession(),p=new SignatureV4({region:SolutionManifest.Region,service:"execute-api",sha256:Sha256,credentials:c.fromCredentials(),uriEscapePath:!1}),h=await p.sign(d),u=new FetchHttpHandler,m=await u.handle(h).then(e=>streamCollector(e.response.body)),g=new TextDecoder("utf-8");return JSON.parse(g.decode(await m))}}const{ApiEndpoint,ApiOps,KnowledgeGraph:KnowledgeGraph$1}=SolutionManifest,ENDPOINTS={Asset:`${ApiEndpoint}/${ApiOps.Assets}`,Analysis:`${ApiEndpoint}/${ApiOps.Analysis}`,Search:`${ApiEndpoint}/${ApiOps.Search}`,Execution:`${ApiEndpoint}/${ApiOps.Execution}`,AttachIot:`${ApiEndpoint}/${ApiOps.AttachPolicy}`,FaceCollections:`${ApiEndpoint}/${ApiOps.FaceCollections}`,FaceCollection:`${ApiEndpoint}/${ApiOps.FaceCollection}`,Faces:`${ApiEndpoint}/${ApiOps.Faces}`,Face:`${ApiEndpoint}/${ApiOps.Face}`,CustomLabelModels:`${ApiEndpoint}/${ApiOps.CustomLabelModels}`,CustomVocabularies:`${ApiEndpoint}/${ApiOps.CustomVocabularies}`,CustomLanguageModels:`${ApiEndpoint}/${ApiOps.CustomLanguageModels}`,CustomEntityRecognizers:`${ApiEndpoint}/${ApiOps.CustomEntityRecognizers}`,Stats:`${ApiEndpoint}/${ApiOps.Stats}`,Users:`${ApiEndpoint}/${ApiOps.Users}`,AIOptionsSettings:`${ApiEndpoint}/${ApiOps.AIOptionsSettings}`};let GRAPH_ENDPOINT,GRAPH_APIKEY;KnowledgeGraph$1&&KnowledgeGraph$1.Endpoint&&KnowledgeGraph$1.ApiKey&&(GRAPH_ENDPOINT=KnowledgeGraph$1.Endpoint+"/graph",GRAPH_APIKEY=KnowledgeGraph$1.ApiKey);const _authHttpRequest=new AuthHttpRequest;class ApiHelper{static async scanRecords(e){return _authHttpRequest.send("GET",ENDPOINTS.Asset,e)}static async getRecord(e){return _authHttpRequest.send("GET",`${ENDPOINTS.Asset}/${e}`)}static async purgeRecord(e){return _authHttpRequest.send("DELETE",`${ENDPOINTS.Asset}/${e}`)}static async getAnalysisResults(e){return _authHttpRequest.send("GET",`${ENDPOINTS.Analysis}/${e}`)}static async attachIot(){return _authHttpRequest.send("POST",ENDPOINTS.AttachIot)}static async search(e){return _authHttpRequest.send("GET",ENDPOINTS.Search,e)}static async searchInDocument(e,t){return _authHttpRequest.send("GET",`${ENDPOINTS.Search}/${e}`,t)}static async startIngestWorkflow(e,t){return _authHttpRequest.send("POST",ENDPOINTS.Asset,t,e)}static async startAnalysisWorkflow(e,t,a){return _authHttpRequest.send("POST",`${ENDPOINTS.Analysis}/${e}`,a,t)}static async startWorkflow(e,t){return _authHttpRequest.send("POST",ENDPOINTS.Asset,t,e)}static async getRekognitionFaceCollections(){return _authHttpRequest.send("GET",ENDPOINTS.FaceCollections)}static async getRekognitionCustomLabelModels(){return _authHttpRequest.send("GET",ENDPOINTS.CustomLabelModels)}static async getTranscribeCustomVocabulary(){return _authHttpRequest.send("GET",ENDPOINTS.CustomVocabularies)}static async getTranscribeCustomLanguageModels(){return _authHttpRequest.send("GET",ENDPOINTS.CustomLanguageModels)}static async getComprehendCustomEntityRecognizers(){return _authHttpRequest.send("GET",ENDPOINTS.CustomEntityRecognizers)}static async getStats(e){return _authHttpRequest.send("GET",ENDPOINTS.Stats,e)}static async getFaceCollections(){return _authHttpRequest.send("GET",ENDPOINTS.FaceCollections)}static async createFaceCollection(e){return _authHttpRequest.send("POST",ENDPOINTS.FaceCollection,void 0,{collectionId:e})}static async deleteFaceCollection(e){return _authHttpRequest.send("DELETE",ENDPOINTS.FaceCollection,{collectionId:e})}static async getFacesInCollection(e,t){return _authHttpRequest.send("GET",ENDPOINTS.Faces,{...t,collectionId:e})}static async deleteFaceFromCollection(e,t){return _authHttpRequest.send("DELETE",ENDPOINTS.Face,{collectionId:e,faceId:t})}static async indexFaceToCollection(e,t){return _authHttpRequest.send("POST",ENDPOINTS.Face,void 0,{...t,collectionId:e})}static async getUsers(){return _authHttpRequest.send("GET",ENDPOINTS.Users)}static async addUsers(e){return _authHttpRequest.send("POST",ENDPOINTS.Users,void 0,e)}static async deleteUser(e){return _authHttpRequest.send("DELETE",ENDPOINTS.Users,{user:e})}static async getGlobalAIOptions(){return _authHttpRequest.send("GET",ENDPOINTS.AIOptionsSettings)}static async setGlobalAIOptions(e){return _authHttpRequest.send("POST",ENDPOINTS.AIOptionsSettings,void 0,e)}static async deleteGlobalAIOptions(){return _authHttpRequest.send("DELETE",ENDPOINTS.AIOptionsSettings)}static async graph(e){const t={"Content-Type":"application/json","x-api-key":GRAPH_APIKEY};let a=4;for(;a--;)try{return await _authHttpRequest.send("GET",GRAPH_ENDPOINT,e,"",t)}catch(e){console.log("== ApiHelper.graph: #"+a),console.error(e)}}}const DEFAULT_IMAGE$2="./images/image.png";class BaseMedia extends(mxReadable(class{})){constructor(e){super(),this.$data={...e},this.$analysisResults=void 0,this.$store=(void 0===_singleton$6&&new ImageStore,_singleton$6),this.$datasetStore=GetDatasetStore()}get data(){return this.$data}set data(e){this.$data=e}get analysisResults(){return this.$analysisResults}set analysisResults(e){this.$analysisResults=e}get store(){return this.$store}get datasetStore(){return this.$datasetStore}get uuid(){return this.$data.uuid}get type(){return this.$data.type}get lastModified(){return this.$data.lastModified}get lastModifiedISOFormat(){return BaseMedia.isoDateTime(this.lastModified)}get timestamp(){return this.$data.timestamp}get timestampISOFormat(){return BaseMedia.isoDateTime(this.timestamp)}get basename(){return this.$data.basename}get bucket(){return this.$data.bucket}get key(){return this.$data.key}get schemaVersion(){return this.$data.schemaVersion}get storageClass(){return this.$data.storageClass}get fileSize(){return this.$data.fileSize}get readableFileSize(){return BaseMedia.readableFileSize(this.fileSize)}get mime(){return this.$data.mime}get md5(){return this.$data.md5}get proxies(){return this.$data.proxies}get mediainfo(){return this.$data.mediainfo}set mediainfo(e){this.$data.mediainfo=e}get imageinfo(){return this.$data.imageinfo}set imageinfo(e){this.$data.imageinfo=e}get docinfo(){return this.$data.docinfo}set docinfo(e){this.$data.docinfo=e}get executionArn(){return this.$data.executionArn}get status(){return this.$data.status}get overallStatus(){return this.$data.overallStatus}get errorMessage(){return this.$data.errorMessage}get aiOptions(){return this.$data.aiOptions}get attributes(){return this.$data.attributes}get duration(){return this.$data.duration}get readableDuration(){return BaseMedia.readableDuration(this.duration)}get proxyBucket(){return(this.$data.destination||{}).bucket}get proxyPrefix(){return(this.$data.destination||{}).prefix}get defaultImage(){return DEFAULT_IMAGE$2}getVideoDimension(){const e=this.mediainfo.media.track.find(e=>"video"===e.$.type.toLowerCase())||{};return{width:e.width||0,height:e.height||0}}async refresh(){const e=this.datasetStore.deleteItemsBy(this.uuid);return this.data=await ApiHelper.getRecord(this.uuid),await Promise.all([this.loadMediaInfo(),this.loadImageInfo()]),this.status===SolutionManifest.Statuses.AnalysisCompleted&&await this.getAnalysisResults(!0),await e,this}async setError(){const e=await ApiHelper.getRecord(this.uuid);this.data=e}async getThumbnail(){const e=(this.proxies||[]).filter(e=>"image"===e.type);if(!e.length)return this.defaultImage;const t=AppUtils.randomNumber(e.length-1,0);return this.getImageUrl(this.uuid,this.proxyBucket,e[t].key)}async getImageUrl(e,t,a){let s=await this.store.getImageURL(e,t,a).catch(()=>{});if(!s){const e=GetS3Utils();s=await e.signUrl(t,a)}return s}async getUrl(e,t){return GetS3Utils().signUrl(e,t)}getMediainfo(){return this.mediainfo}getImageinfo(){return this.imageinfo}getDocinfo(){return this.docinfo}getProxyBucket(){return this.proxyBucket}async getProxyVideo(){const e=this.proxies.find(e=>"video"===e.type);if(void 0!==e){return GetS3Utils().signUrl(this.proxyBucket,e.key)}}async getProxyAudio(){const e=this.proxies.find(e=>"audio"===e.type);if(void 0!==e){return GetS3Utils().signUrl(this.proxyBucket,e.key)}}getBasename(e){return e.substring(e.lastIndexOf("/")+1,e.length)}async getProxyImage(){const e=this.proxies.filter(e=>"image"===e.type).sort((e,t)=>t.fileSize-e.fileSize)[0];if(void 0!==e){const t=[this.uuid,this.getBasename(e.key)].join("-");return this.getImageUrl(t,this.proxyBucket,e.key)}return this.defaultImage}async getNamedImageUrl(e,t){const a=this.getBasename(t),s=[this.uuid,a].join("-");return{name:a,url:await this.getImageUrl(s,e,t)}}async getProxyNamedImageAll(){const e=this.proxies.filter(e=>"image"===e.type);if(e&&e.length>0)return Promise.all(e.map(e=>this.getNamedImageUrl(this.proxyBucket,e.key)))}async getAnalysisResults(e=!1){return this.analysisResults&&!e||(this.analysisResults=await ApiHelper.getAnalysisResults(this.uuid)),this.analysisResults}async getDataset(e,t){return this.datasetStore.getDataset(e,t)}getRekognitionResults(){return(this.analysisResults||[]).map(e=>e.rekognition).filter(e=>e)[0]}getRekognitionImageResults(){return(this.analysisResults||[]).map(e=>e["rekog-image"]).filter(e=>e)[0]}getTranscribeResults(){return(this.analysisResults||[]).map(e=>e.transcribe).filter(e=>e)[0]}getComprehendResults(){return(this.analysisResults||[]).map(e=>e.comprehend).filter(e=>e)[0]}getTextractResults(){return(this.analysisResults||[]).map(e=>e.textract).filter(e=>e)[0]}getImageAutoCaptioning(){return((this.analysisResults||[])[0]||{}).caption}async loadMediaInfo(){if(Array.isArray(this.mediainfo)&&this.mediainfo.length>0){const e=this.proxyBucket,t=this.mediainfo.find(e=>/\.json$/.test(e));if(e&&t){const a=GetS3Utils();let s=await a.getObject(e,t).catch(e=>{console.error("ERR:","fail to get mediainfo",t,e.message)});s&&(s=await s.Body.transformToString().then(e=>JSON.parse(e).mediaInfo),this.mediainfo=s)}}return this.mediainfo}async loadImageInfo(){if("string"==typeof this.imageinfo&&this.proxyBucket){const e=GetS3Utils();let t=await e.getObject(this.proxyBucket,this.imageinfo).catch(e=>{console.error("ERR:","fail to get imageinfo",this.imageinfo,e.message)});t&&(t=await t.Body.transformToString().then(e=>JSON.parse(e)),this.imageinfo=t)}return this.imageinfo}}class VideoMedia extends BaseMedia{}const SUFFIX="_thumbnail";class PhotoMedia extends BaseMedia{get width(){return(this.imageinfo||{}).ImageWidth}get height(){return(this.imageinfo||{}).ImageHeight}async getThumbnail(){const e=(this.proxies||[]).filter(e=>"image"===e.type).sort((e,t)=>e.fileSize-t.fileSize);if(!e.length)return this.defaultImage;let t,a=e[0].key.lastIndexOf(SUFFIX+".jpg");if(a<0){a=e[0].key.lastIndexOf(".jpg");let s=e[0].key.substring(0,a);s=`${s}${SUFFIX}.jpg`;const n=[this.uuid,SUFFIX].join("");t=await this.store.getImageURL(n,this.proxyBucket,s).catch(()=>{})}if(t||(t=await this.store.getImageURL(this.uuid,this.proxyBucket,e[0].key).catch(()=>{})),!t){const a=GetS3Utils();t=await a.signUrl(this.proxyBucket,e[0].key)}return t}}const DEFAULT_IMAGE$1="./images/podcast.png";class PodcastMedia extends BaseMedia{get defaultImage(){return DEFAULT_IMAGE$1}}const DEFAULT_IMAGE="./images/document.png";class DocumentMedia extends BaseMedia{constructor(e){super(e),this.$pages=[]}get fingerprint(){return(this.docinfo||{}).fingerprint}get numPages(){return(this.docinfo||{}).numPages}get defaultImage(){return DEFAULT_IMAGE}get pages(){return this.$pages}set pages(e){this.$pages=e}async loadPages(){return this.loadJsonResults().then(e=>(this.pages=e,this.pages))}async loadJsonResults(){const e=this.getTextractResults();if(!e||!e.output)return;const t=this.getProxyBucket();if(/json$/.test(e.output))return this.loadSingleJsonResults(t,e.output);const a=GetS3Utils();let s=[];for(let n=0;n<e.numOutputs;n++){const i=this.makeSequnceFileName(n),o=`${e.output}${i}`;s.push(a.getObject(t,o).catch(e=>{console.error("ERR:",`fail to get textract result (page #${n})`,i,e.message)}))}return s=await Promise.all(s),s=await Promise.all(s.filter(e=>void 0!==e).map(e=>e.Body.transformToString().then(e=>JSON.parse(e).Documents))),s.reduce((e,t)=>e.concat(t),[]).map(e=>({name:this.getBasename(e.FileName),data:e}))}makeSequnceFileName(e){return String(e).padStart(8,"0")+".json"}async loadSingleJsonResults(e,t){const a=GetS3Utils();let s=await a.getObject(e,t).catch(e=>{console.error("ERR:","loadSingleJsonResults:","fail to get textract result",e)});if(void 0!==s)return s=await s.Body.transformToString().then(e=>JSON.parse(e).Documents),s=s.map(e=>({name:this.getBasename(e.FileName),data:e})),s}}class BasePreview{constructor(e,t){this.$ids={container:"preview-"+AppUtils.randomHexstring()},this.$container=$("<div/>").addClass("p-0 m-0 w-100").attr("id",this.$ids.container).attr("data-media-type",e.type),this.$media=e,this.$searchResults=t}get ids(){return this.$ids}get container(){return this.$container}get media(){return this.$media}get searchResults(){return this.$searchResults}getView(){}async load(){return this}async unload(){return this.container.children().remove(),this}async pause(){}async unpause(){}async beforeViewHide(){return this}async viewHidden(){return this}getContainerDimensions(){return{width:this.container.outerWidth(),height:this.container.outerHeight()}}}const TRACK_SUBTITLES="subtitles",TRACK_METADATA="metadata",TRACK_CHAPTERS="chapters";class VideoPreview extends BasePreview{constructor(e,t){super(e,t);const a=AppUtils.randomHexstring();this.$ids={...this.$ids,player:"vjs-"+a},this.$player=void 0,this.$subtitleView=$("<div/>").addClass("lead"),this.$trackCached={},this.$proxyBucket=void 0,this.$mediaType="video/mp4",this.$canvasView=$("<div/>").attr("id","canvas-"+a)}static get Events(){return{Track:{Loaded:"v:preview:track:loaded"}}}static get Constants(){return{Subtitle:"subtitle"}}get player(){return this.$player}set player(e){this.$player=e}get subtitleView(){return this.$subtitleView}set subtitleView(e){this.$subtitleView=e}get canvasView(){return this.$canvasView}set canvasView(e){this.$canvasView=e}get trackCached(){return this.$trackCached}set trackCached(e){this.$trackCached=e}get proxyBucket(){return this.$proxyBucket||(this.$proxyBucket=this.media.getProxyBucket()),this.$proxyBucket}set proxyBucket(e){this.$proxyBucket=e}get mediaType(){return this.$mediaType}getSubtitleView(){return this.subtitleView}getVideoPlayer(){return this.player}getView(){return this.player?$("video",this.player.el()):void 0}getCanvasView(){return this.$canvasView}appendSubtitleViewTo(e){return e.append(this.subtitleView),this}async getProxyMedia(){return this.media.getProxyVideo()}async load(){await this.unload();const e=this.container,t=this.ids.player,a=$("<video/>").addClass("video-js vjs-fluid w-100").attr("id",t).attr("controls","controls").attr("preload","metadata").attr("crossorigin","anonymous");return e.append(a),a.ready(async()=>{const[e,s,n]=await Promise.all([this.getProxyMedia(),this.media.getThumbnail(),this.media.loadMediaInfo()]);a.attr("poster",s);const i=this.media.getVideoDimension(),o={textTrackDisplay:{allowMultipleShowingTracks:!0},aspectRatio:i.height>i.width?"16:9":void 0,autoplay:!0},r=videojs(t,o);r.markers({markers:[]}),r.src({type:this.mediaType,src:e}),r.ready(async()=>{r.volume(.5);const e=this.media.getTranscribeResults()||{};e.vtt&&(this.trackRegister(VideoPreview.Constants.Subtitle,e.vtt,"subtitles",e.languageCode||"en"),await this.trackToggle(VideoPreview.Constants.Subtitle,!0)),r.on("play",()=>this.canvasView.children().remove())}),r.load(),this.player=r,this.createObserver(a,r)}),e.append(this.canvasView),super.load()}async unload(){return this.player&&this.player.dispose(),this.player=void 0,this.subtitleView.children().remove(),this.canvasView.children().remove(),super.unload()}async play(){return this.player&&(this.canvasView.children().remove(),this.player.play()),this}async pause(){return this.player&&this.player.pause(),this}async seek(e){return this.player&&this.player.currentTime(e),this}getCurrentTime(){return this.player?Math.floor(1e3*this.player.currentTime()+.5):void 0}trackIsSub(e){return"string"==typeof e?e===VideoPreview.Constants.Subtitle:(e||{}).label===VideoPreview.Constants.Subtitle}trackIsEnabled(e){if(this.player){const t=this.player.remoteTextTracks();for(let a=0;a<t.length;a++)if(t[a].label===e)return"showing"===t[a].mode}return!1}trackRegister(e,t,a="metadata",s="en"){return this.trackCached[e]={key:t,language:s,kind:a,loaded:!1},this}trackUnregister(e){return this.trackCached[e]&&(this.removeTrackByLabel(e),0===this.trackCached[e].key.indexOf("blob")&&URL.revokeObjectURL(this.trackCached[e].key),delete this.trackCached[e]),this}async trackLoad(e){if(this.player){let t;t=0===this.trackCached[e].key.indexOf("blob")?this.trackCached[e].key:await this.media.getUrl(this.proxyBucket,this.trackCached[e].key);const a=this.player.addRemoteTextTrack({kind:this.trackCached[e].kind,language:this.trackCached[e].language,label:e,src:t},!1);a.off("load"),a.on("load",t=>{const a=t.target.track;a.mode="showing",this.trackIsSub(e)&&(a.off("cuechange"),a.on("cuechange",()=>this.cueChangedEvent(a))),this.trackLoadedEvent(a)})}return this}async trackToggle(e,t){if(this.player){const a=this.player.remoteTextTracks();for(let s=0;s<a.length;s++)if(a[s].label===e)return a[s].mode=t?"showing":"hidden",this.markerToggle(a[s],t)}return t&&this.trackCached[e]&&!this.trackCached[e].loaded?this.trackLoad(e):this}removeTrackByLabel(e){if(this.player){const t=this.player.remoteTextTracks();for(let a=0;a<t.length;a+=1){const s=t[a];if(s.label===e)return this.player.removeRemoteTextTrack(s)}}}trackLoadedEvent(e){return this.trackCached[e.label].loaded=!0,this.trackIsSub(e)?this.cueToHtml(e):this.markerAdd(e),this.subtitleView.trigger(VideoPreview.Events.Track.Loaded,[e]),this}cueChangedEvent(e){if((e.activeCues||[]).length>0){this.subtitleView.find(`[data-cue-index="${e.activeCues[0].id}"]`).addClass("cue-highlight").siblings().removeClass("cue-highlight")}}cueToHtml(e){for(let t=0;t<e.cues.length;t++){const a=$(e.cues[t].getCueAsHTML()).addClass("d-inline pr-1").attr("data-cue-index",t);a.text(a.text().replace(/-{2}\s/g," ")),this.subtitleView.append(a)}}markerAdd(e){const t=[];for(let a=0;a<e.cues.length;a++)t.push({time:e.cues[a].startTime,duration:e.cues[a].endTime-e.cues[a].startTime,text:e.label,overlayText:e.label});return this.player.markers.add(t),this}markerRemove(e){const t=[],a=this.player.markers.getMarkers();for(let s=0;s<a.length;s++)a[s].overlayText===e.label&&t.push(s);return this.player.markers.remove(t),this}markerToggle(e,t){return e.label===VideoPreview.Constants.Subtitle?void 0:t?this.markerAdd(e):this.markerRemove(e)}createTrackFromCues(e,t){if(this.player){const a=this.player.remoteTextTracks();for(let t=0;t<a.length;t+=1){const s=a[t];if("chapters"===s.kind&&s.label===e)return s}const s=this.player.addRemoteTextTrack({kind:"chapters",language:"en",label:e},!1);return t.forEach(e=>s.track.addCue(e)),s.track.mode="hidden",s.track}}createObserver(e,t){const a={root:null,rootMargin:"0px",threshold:[.1]},s=new IntersectionObserver(e=>{e.forEach(e=>{e.intersectionRatio<=a.threshold[0]&&(console.log("videoPreview.createObserver","entry.intersectionRatio",e.intersectionRatio),t&&t.pause())})},a);return s.observe(e[0]),s}}class PodcastPreview extends VideoPreview{constructor(e,t){super(e,t),this.$mediaType="audio/mp4"}async getProxyMedia(){return this.media.getProxyAudio()}}const AnalysisTypes=SolutionManifest.AnalysisTypes,CANVAS_BASE_ZINDEX=100;class PhotoPreview extends BasePreview{constructor(e,t){super(e,t),this.$imageView=void 0,this.$canvases={},this.$canvasIndex=100}get imageView(){return this.$imageView}set imageView(e){this.$imageView=e}get canvases(){return this.$canvases}set canvases(e){this.$canvases=e}get canvasIndex(){return this.$canvasIndex}set canvasIndex(e){this.$canvasIndex=e}getView(){return this.imageView}getCanvasesByType(e){return Object.keys(this.canvases).map(t=>{if(this.canvases[t].type===e)return this.canvases[t]}).filter(e=>void 0!==e)}async load(){await this.unload();const e=$("<div/>").addClass("col-9 p-0 m-0 mx-auto");this.container.append(e);const t=$("<div/>").addClass("overlay-container");e.append(t);const a=$("<img/>").addClass("h-600max w-100 img-contain").attr("alt",this.media.basename);t.append(a),a.ready(async()=>{const e=await this.media.getProxyImage();a.attr("src",e)}),this.imageView=a;const s=$("<div/>").addClass("canvas-list");return t.append(s),s.ready(async()=>{const e=await this.createCanvases();s.append(e)}),this}async unload(){return this.canvases={},this.canvasIndex=100,this.imageView=void 0,super.unload()}async pause(){this.container.find("div.canvas-list").addClass("collapse")}async unpause(){this.container.find("div.canvas-list").removeClass("collapse")}async createCanvases(){const e=this.media.getRekognitionImageResults()||{},t=Object.keys(e);let a=await Promise.all(t.map(t=>{if(e[t].output)return this.createCanvasesByType(t,e[t].output)}));return a=a.filter(e=>void 0!==e).flat(1),a}async createCanvasesByType(e,t){const a=GetS3Utils(),s=await a.getObject(this.media.getProxyBucket(),t).catch(()=>{});if(!s)return;const n=await s.Body.transformToString().then(e=>JSON.parse(e));return n.CelebrityFaces?this.createCelebCanvas(n):n.FaceDetails?this.createFaceCanvas(n):n.FaceMatches?this.createFaceMatchCanvas(n):n.Labels?this.createLabelCanvas(n):n.ModerationLabels?this.createModerationCanvas(n):n.TextDetections?this.createTextCanvas(n):void 0}createCelebCanvas(e){const t=[];for(;e.CelebrityFaces.length;){const a=e.CelebrityFaces.shift(),s=this.canvasRegister({type:AnalysisTypes.Rekognition.Celeb,name:a.Name,confidence:Number(Number(a.MatchConfidence).toFixed(2)),coord:{y:Number(Number(a.Face.BoundingBox.Top).toFixed(2)),x:Number(Number(a.Face.BoundingBox.Left).toFixed(2)),w:Number(Number(a.Face.BoundingBox.Width).toFixed(2)),h:Number(Number(a.Face.BoundingBox.Height).toFixed(2))}}),n=$("<canvas/>").addClass("image-canvas-overlay collapse").attr("data-canvas-id",s).attr("data-init",!1);t.push(n)}return t}createFaceCanvas(e){const t=[];let a=0;for(;e.FaceDetails.length;){const s=e.FaceDetails.shift(),n=this.canvasRegister({type:AnalysisTypes.Rekognition.Face,name:"Face "+a++,confidence:Number(Number(s.Confidence).toFixed(2)),coord:{y:s.BoundingBox.Top,x:s.BoundingBox.Left,w:s.BoundingBox.Width,h:s.BoundingBox.Height},gender:(s.Gender||{}).Value?`${s.Gender.Value} (${Number(s.Gender.Confidence).toFixed(2)})`:void 0,ageRange:(s.AgeRange||{}).Value?`${s.AgeRange.Low}/${s.AgeRange.High}`:void 0}),i=$("<canvas/>").addClass("image-canvas-overlay collapse").attr("data-canvas-id",n).attr("data-init",!1);t.push(i)}return t}createFaceMatchCanvas(e){const t=[];for(;e.FaceMatches.length;){const a=e.FaceMatches.shift(),s=this.canvasRegister({type:AnalysisTypes.Rekognition.FaceMatch,name:a.Face.ExternalImageId.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),confidence:Number(Number(a.Similarity).toFixed(2)),coord:{y:Number(Number(e.SearchedFaceBoundingBox.Top).toFixed(2)),x:Number(Number(e.SearchedFaceBoundingBox.Left).toFixed(2)),w:Number(Number(e.SearchedFaceBoundingBox.Width).toFixed(2)),h:Number(Number(e.SearchedFaceBoundingBox.Height).toFixed(2))}}),n=$("<canvas/>").addClass("image-canvas-overlay collapse").attr("data-canvas-id",s).attr("data-init",!1);t.push(n)}return t}createLabelCanvas(e){const t=[];for(;e.Labels.length;){const a=e.Labels.shift();let s=a.Parents.map(e=>e.Name);if(s=s.length>0?s.join(", "):"",a.Instances.length>0){let e=0;for(;a.Instances.length;){const n=a.Instances.shift(),i=this.canvasRegister({type:AnalysisTypes.Rekognition.Label,name:`${a.Name} ${e++}`,confidence:Number(Number(n.Confidence).toFixed(2)),coord:{y:n.BoundingBox.Top,x:n.BoundingBox.Left,w:n.BoundingBox.Width,h:n.BoundingBox.Height},parentName:s}),o=$("<canvas/>").addClass("image-canvas-overlay collapse").attr("data-canvas-id",i).attr("data-init",!1);t.push(o)}}else{const e=this.canvasRegister({type:AnalysisTypes.Rekognition.Label,name:a.Name,confidence:Number(Number(a.Confidence).toFixed(2)),coord:void 0,parentName:s}),n=$("<canvas/>").addClass("image-canvas-overlay collapse").attr("data-canvas-id",e).attr("data-init",!1);t.push(n)}}return t}createModerationCanvas(e){const t=[];for(;e.ModerationLabels.length;){const a=e.ModerationLabels.shift();if(!a.ParentName)continue;const s=this.canvasRegister({type:AnalysisTypes.Rekognition.Moderation,name:a.Name,confidence:Number(Number(a.Confidence).toFixed(2)),coord:void 0,parentName:a.ParentName}),n=$("<canvas/>").addClass("image-canvas-overlay collapse").attr("data-canvas-id",s).attr("data-init",!1);t.push(n)}return t}createTextCanvas(e){const t=[];for(;e.TextDetections.length;){const a=e.TextDetections.shift();if("WORD"===a.Type)continue;const s=this.canvasRegister({type:AnalysisTypes.Rekognition.Text,name:a.DetectedText,confidence:Number(Number(a.Confidence).toFixed(2)),coord:{y:a.Geometry.BoundingBox.Top,x:a.Geometry.BoundingBox.Left,w:a.Geometry.BoundingBox.Width,h:a.Geometry.BoundingBox.Height}}),n=$("<canvas/>").addClass("image-canvas-overlay collapse").attr("data-canvas-id",s).attr("data-init",!1);t.push(n)}return t}canvasRegister(e){const t="canvas-"+this.canvasIndex++;return this.canvases[t]={...e,id:t},t}canvasUnregister(e){this.container.find(`[data-canvas-id="${e}"]`).remove(),delete this.canvases[e]}canvasToggle(e,t,a){const s=this.container.find(`[data-canvas-id="${e}"]`);return t?(!1===s.data("init")&&this.canvasInit(s,this.canvases[e],a),s.removeClass("collapse")):s.addClass("collapse"),s}canvasInit(e,t,a){const s=(a||this.imageView).width(),n=(a||this.imageView).height(),i=e[0];i.width=s,i.height=n;const o=e[0].getContext("2d");let r=0,l=0,d=0,c=0;t.coord&&(r=Math.floor(t.coord.w*s),l=Math.floor(t.coord.h*n),d=Math.floor(t.coord.x*s),c=Math.floor(t.coord.y*n));const p=r||l||d||c;p&&(o.strokeStyle="#ffffff",o.moveTo(0,0),o.strokeRect(d,c,r,l),o.fillStyle="rgba(255, 255, 255, 0.2)",o.fillRect(d,c,r,l));const h=[`${t.name} (${t.confidence}%)`,t.gender&&"Gender: "+t.gender,t.ageRange&&"Age: "+t.ageRange,t.parentName&&`(${t.parentName})`].filter(e=>e);let u;switch(p?(u=14,o.textAlign="left",o.textBaseline="top"):(d=.5*s,c=.5*n,u=18,o.textAlign="center",o.textBaseline="middle"),o.font=u+"px sans-serif",t.type){case AnalysisTypes.Rekognition.Celeb:case AnalysisTypes.Rekognition.Label:case AnalysisTypes.Rekognition.Face:case AnalysisTypes.Rekognition.FaceMatch:case AnalysisTypes.Rekognition.Moderation:case AnalysisTypes.Rekognition.Text:default:o.fillStyle="#ffffff"}let m=Math.max(c-h.length*(u+0),2);for(;h.length;)o.fillText(h.shift(),d,m),m+=u+0;return e.data("init",!0),e}}const SPINNER_ID="spinner-"+AppUtils.randomHexstring();class Spinner{static loading(e=!0){const t=$("#"+SPINNER_ID);return e?t.removeClass("collapse"):t.addClass("collapse")}static useSpinner(){let e=$("#"+SPINNER_ID);if(e.length>0)return e;const t=$("body");e=$("<div/>").attr("id",SPINNER_ID).addClass("spinner-grow text-secondary loading-4 collapse"),t.append(e);const a=$("<span/>").addClass("lead-sm sr-only").html("Loading...");return e.append(a),e}}const MSG_TABLE=Localization.Messages.Table,MSG_TABLES=Localization.Messages.Tables,MSG_ROW=Localization.Messages.Row,MSG_ROWS=Localization.Messages.Rows,MSG_LINES=Localization.Messages.Lines,MSG_KEY_VALUE_SETS=Localization.Messages.KeyValueSets,MSG_NO_DATA$6=Localization.Messages.NoData,TOOLTIP_CONFIDENCE=Localization.Tooltips.Confidence,CANVAS_LIST="canvas-list",CAROUSEL_IMAGE="carousel-image",PAGE_DETAILS="page-details",PAGE_DETAILS_CONTAINER="page-details-container",PAGE_BUTTONS_CONTAINER="page-buttons-container",DATA_PAGEINDEX="data-page-idx",DATA_COORD="data-coord",DATA_BOX="data-box",DATA_CANVAS_ID="data-canvas-id",DATA_CANVAS_TYPE="data-canvas-type",TYPE_LINE="line",TYPE_KEYVAL="keyval",TYPE_CELL="cell";class DocumentPreview extends BasePreview{constructor(e,t){super(e,t),this.$slide=void 0,this.$pageControlContainer=void 0,this.$ids={...this.ids,carousel:"doc-"+AppUtils.randomHexstring()},Spinner.useSpinner()}get slide(){return this.$slide}set slide(e){this.$slide=e}get pageControlContainer(){return this.$pageControlContainer}set pageControlContainer(e){this.$pageControlContainer=e}getPageControlContainer(){return this.pageControlContainer}slideTo(e){return this.slide.carousel(e)}async load(){try{Spinner.loading(),await this.unload();const e=await this.media.loadPages(),t=$("<div/>").addClass("col-12 p-0 m-0");this.container.append(t);const a=$("<div/>").addClass("carousel slide w-100").attr("data-ride",!1).attr("data-interval",!1).attr("id",this.ids.carousel);t.append(a),this.slide=a;const s=$("<div/>").addClass("col-12 my-4 p-0 m-0");this.pageControlContainer=s;const n=$("<div/>").addClass("no-gutters d-flex overflow-auto").addClass(PAGE_BUTTONS_CONTAINER);s.append(n);const i=$("<div/>").addClass("col-12 p-0 m-0").addClass(PAGE_DETAILS_CONTAINER);s.append(i);const o=$("<div/>").addClass("carousel-inner");if(a.append(o),e&&e.length)e.forEach(e=>{const t=this.createPage(e);o.append(t.carouselItem),n.append(t.pageButton),i.append(t.pageDetails)}),o.children().first().addClass("active");else{const e=this.noData();o.append(e)}}catch(e){console.error(e)}finally{Spinner.loading(!1)}return this}async unload(){return this.pageControlContainer&&this.pageControlContainer.remove(),this.slide&&this.slide.remove(),super.unload()}createPage(e){const t=this.creatCarouselItem(e);return{carouselItem:t,...this.createPageControl(e,t)}}creatCarouselItem(e){const t=e.data.PageNum,a=$("<div/>").addClass("carousel-item").attr(DATA_PAGEINDEX,t),s=$("<div/>").addClass("overlay-container mx-auto");a.append(s);const n=$("<img/>").addClass("h-800max img-contain carousel-image").attr("alt","Page "+(t+1));s.append(n);const i=$("<div/>").addClass(CANVAS_LIST);return s.append(i),n.ready(async()=>{const t=this.media.getProxyBucket(),a=e.data.FileName,s=await this.media.getNamedImageUrl(t,a);n.attr("src",s.url)}),a}createPageControl(e,t){const a=$("<div/>").addClass("col-11 p-0 ml-4 h-600max overflow-auto").addClass(PAGE_DETAILS).addClass("collapse").attr(DATA_PAGEINDEX,e.data.PageNum),s=this.createLineDetails(t,e.data.Blocks),n=this.createKeyValueDetails(t,e.data.Blocks),i=this.createTableCellDetails(t,e.data.Blocks);a.append(n),a.append(i),a.append(s);const o=$("<img/>").addClass("thumbnail d-inline-flex m-3").attr(DATA_PAGEINDEX,e.data.PageNum);return o.ready(async()=>{const t=this.media.getProxyBucket(),a=e.data.FileName,s=await this.media.getNamedImageUrl(t,a);o.attr("src",s.url)}),o.on("click",async t=>(t.preventDefault(),this.onPageButtonSelected(o,a,e))),{pageButton:o,pageDetails:a}}createLineDetails(e,t){if(!Array.isArray(t))return;const a=t.filter(e=>"LINE"===e.BlockType).map(t=>this.createCanvasButton(e,{type:"line",text:t.Text,coord:t.Geometry.Polygon,box:t.Geometry.BoundingBox,confidence:t.Confidence}));if(0===a.length)return;const s=$("<details/>").addClass("ml-1"),n=$("<summary/>").addClass("my-2");s.append(n);const i=$("<span/>").addClass("lead-sm text-capitalize").append(`${MSG_LINES} (${a.length})`);return n.append(i),s.append(a),s}createKeyValueDetails(e,t){const a=[],s=(t||[]).filter(e=>"KEY_VALUE_SET"===e.BlockType),n=[],i=[];for(let e=0;e<s.length;e++){const t=s[e];"KEY"===t.EntityTypes[0]?n.push(t):i.push(t)}for(;n.length;){const s=n.shift(),o=$("<div/>").addClass("btn-group").attr("role","group").attr("aria-label","KeyValue Set");let r="Blank";if(s.Relationships){r=s.Relationships.filter(e=>"CHILD"===e.Type).reduce((e,t)=>e.concat(t.Ids),[]).reduce((e,a)=>{const s=(t||[]).find(e=>e.Id===a);return s?e.concat(s.Text):e},[]).filter(e=>e).join(" ")}const l=this.createCanvasButton(e,{text:r,coord:s.Geometry.Polygon,box:s.Geometry.BoundingBox,confidence:s.Confidence,type:"keyval"});o.append(l);const d=s.Relationships.filter(e=>"VALUE"===e.Type).reduce((e,t)=>e.concat(t.Ids),[]).shift(),c=this.findAndSplice(i,"Id",d);let p="Blank";if(c&&c.Relationships){p=c.Relationships.filter(e=>"CHILD"===e.Type).reduce((e,t)=>e.concat(t.Ids),[]).reduce((e,a)=>{const s=(t||[]).find(e=>e.Id===a);return s?e.concat(s.Text||s.SelectionStatus):e},[]).filter(e=>e).join(" ")}const h=this.createCanvasButton(e,{text:p,coord:s.Geometry.Polygon,box:s.Geometry.BoundingBox,confidence:s.Confidence,type:"keyval"});h.removeClass("btn-primary").addClass("btn-light"),o.append(h),a.push(o)}if(0===a.length)return;return $("<details/>").addClass("ml-1").append($("<summary/>").addClass("my-2").append($("<span/>").addClass("lead-sm text-capitalize").append(`${MSG_KEY_VALUE_SETS} (${a.length})`))).append(a)}createTableCellDetails(e,t){if(!Array.isArray(t))return;const a=[],s=[];t.forEach(e=>{"TABLE"===e.BlockType?a.push(e):"CELL"===e.BlockType&&s.push(e)});let n=0;const i=[];for(;a.length;){const o=a.shift().Relationships.find(e=>"CHILD"===e.Type).Ids;for(;o.length;){const a=this.findAndSplice(s,"Id",o.shift());if(a){let s="Blank";if(a.Relationships){s=a.Relationships.find(e=>"CHILD"===e.Type).Ids.reduce((e,a)=>{const s=t.find(e=>e.Id===a);return s?e.concat(s.Text):e},[]).filter(e=>e).join(" ")}const o=a.RowIndex-1;i[n]||(i[n]=[]),i[n][o]||(i[n][o]=[]);const r=this.createCanvasButton(e,{text:s,coord:a.Geometry.Polygon,box:a.Geometry.BoundingBox,confidence:a.Confidence,type:"cell"});i[n][o].push(r)}}n++}if(0===i.length)return;const o=$("<details/>").addClass("ml-1"),r=$("<summary/>").addClass("my-2");o.append(r);const l=$("<span/>").addClass("lead-sm text-capitalize").append();r.append(l);const d=`${MSG_TABLES} (${i.length})`;return l.append(d),i.forEach((e,t)=>{const a=$("<details/>").addClass("ml-2"),s=$("<summary/>").addClass("my-1");a.append(s);const n=$("<span/>").addClass("lead-xs text-captialize");s.append(n);const i=`${MSG_TABLE} ${t+1} (${e.length} ${MSG_ROWS})`;n.append(i),e.forEach((e,t)=>{const s=$("<details/>").addClass("ml-3"),n=$("<summary/>").addClass("my-1");s.append(n);const i=$("<span/>").addClass("lead-xxs text-captialize");n.append(i);const o=`${MSG_ROW} ${t+1}`;i.append(o),e.forEach(e=>{s.append(e)}),a.append(s)}),o.append(a)}),o}createCanvasButton(e,t={}){const a="control-"+AppUtils.randomHexstring(),s=Number(Number(t.confidence).toFixed(2)),n=[t.box.Width,t.box.Height,t.box.Left,t.box.Top].join(","),i=t.coord.reduce((e,t)=>e.concat(t.X,t.Y),[]).join(","),o=$("<button/>").addClass("btn btn-sm btn-primary mb-1 ml-1 text-left").attr("type","button").attr("data-toggle","button").attr("aria-pressed",!1).attr("autocomplete","off").attr("data-placement","bottom").attr(DATA_BOX,n).attr(DATA_COORD,i).attr(DATA_CANVAS_ID,a).attr(DATA_CANVAS_TYPE,t.type).attr("title",`${TOOLTIP_CONFIDENCE}: ${s}%`).tooltip({trigger:"hover"}),r=$("<span/>").addClass("lead-xxs").append(t.text);return o.append(r),o.on("click",t=>"false"===o.attr("aria-pressed")?this.showCanvas(o,e):this.hideCanvas(o,e)),o}showCanvas(e,t){const a=e.attr(DATA_CANVAS_ID),s=t.find("div.canvas-list");let n=s.find(`canvas[data-canvas-id="${a}"]`).first();if(n.length)return n.removeClass("collapse");const i=t.find("img.carousel-image").first(),[o,r,l,d]=e.attr(DATA_BOX).split(",").map(e=>Number(e)),c=i.width()*o,p=i.height()*r,h=i.width()*l,u=i.height()*d,m=e.attr(DATA_CANVAS_TYPE);return n=$("<canvas/>").addClass("canvas-type-"+m).attr(DATA_CANVAS_ID,a).attr("width",c).attr("height",p).css("left",h).css("top",u).css("position","absolute"),s.append(n),n}hideCanvas(e,t){const a=e.attr(DATA_CANVAS_ID);return t.find("div.canvas-list").find(`canvas[data-canvas-id="${a}"]`).first().addClass("collapse")}onPageButtonSelected(e,t,a){return e.parent().find("img").removeClass("active"),e.addClass("active"),t.parent().find("div.page-details").addClass("collapse"),t.removeClass("collapse"),this.slideTo(a.data.PageNum)}noData(){const e=$("<div/>").addClass("carousel-item").addClass("active"),t=$("<h5/>").addClass("lead").append(MSG_NO_DATA$6);return e.append(t),e}findAndSplice(e,t,a){const s=e.findIndex(e=>e[t]===a);if(!(s<0))return e.splice(s,1).shift()}}class MediaFactory{static async createMedia(e){const t=await ApiHelper.getRecord(e);if(!Object.keys(t).length)throw new Error(e+" contains no data");if(Array.isArray(t.mediainfo)&&t.mediainfo.length>0){const e=await MediaFactory.fetchMediainfo(t);e&&(t.mediainfo=e)}else if(t.imageinfo){const e=await MediaFactory.fetchImageinfo(t);e&&(t.imageinfo=e)}let a;switch(t.type){case MediaTypes.Video:case"mxf":a=new VideoMedia(t);break;case MediaTypes.Audio:a=new PodcastMedia(t);break;case MediaTypes.Image:a=new PhotoMedia(t);break;case MediaTypes.Document:a=new DocumentMedia(t);break;default:throw new Error(`${e} type '${t.type}' not supported`)}return a}static async lazyCreateMedia(e){const t=await ApiHelper.getRecord(e);if(!Object.keys(t).length)throw new Error(e+" contains no data");let a;switch(t.type){case MediaTypes.Video:case"mxf":a=new VideoMedia(t);break;case MediaTypes.Audio:a=new PodcastMedia(t);break;case MediaTypes.Image:a=new PhotoMedia(t);break;case MediaTypes.Document:a=new DocumentMedia(t);break;default:throw new Error(`${e} type '${t.type}' not supported`)}return a}static async createPreviewComponent(e,t){return await e.getAnalysisResults(),e.type===MediaTypes.Video?new VideoPreview(e,t):e.type===MediaTypes.Audio?new PodcastPreview(e,t):e.type===MediaTypes.Image?new PhotoPreview(e,t):e.type===MediaTypes.Document?new DocumentPreview(e,t):void 0}static async fetchMediainfo(e){if((e.mediainfo||{}).media)return e.mediainfo;const t=e.destination.bucket,a=e.mediainfo.find(e=>/\.json$/.test(e));if(!t||!a)return;const s=GetS3Utils();let n=await s.getObject(t,a).catch(e=>{console.error("ERR:","fail to download mediainfo",a)});return void 0!==n&&(n=await n.Body.tranformToString().then(e=>JSON.parse(e).mediaInfo)),n}static async fetchImageinfo(e){const t=e.destination.bucket,a=e.imageinfo;if(!t||!a)return;const s=GetS3Utils();let n=await s.getObject(t,a).catch(e=>{console.error("ERR:","fail to download imageinfo",a)});return void 0!==n&&(n=await n.Body.tranformToString().then(e=>JSON.parse(e))),n}}const{AwsIotMqtt5ClientConfigBuilder,Mqtt5Client,QoS,once}=window.AWSIotDeviceSDKv2,REGION$2=SolutionManifest.Region,IOT_HOST=SolutionManifest.IotHost,IOT_TOPIC=SolutionManifest.IotTopic;let _singleton$3;const _receivers$2={},_onMessageReceived=e=>{setTimeout(async()=>{const t=Object.keys(_receivers$2);try{await Promise.all(t.map(t=>_receivers$2[t](e).catch(e=>{console.error("ERR:",`_onMessageReceived.${t}:`,e.message)}))),console.log("INFO:","_onMessageReceived:",t.length+" receivers:",t.join(", "))}catch(e){console.error("ERR:","_onMessageReceived:",e)}},10)};class IotSubscriber{constructor(){_singleton$3=this,this.$id=AppUtils.randomHexstring(),this.$client=void 0,this.$cachedCredentials=void 0,this.$lastReceivedMessage=void 0,RegisterUserSessionEvent("iotsubscriber",this.onUserSessionChangeEvent.bind(this))}get id(){return this.$id}getCredentials(){return this.$cachedCredentials}setCredentials(e={}){this.$cachedCredentials={aws_region:REGION$2,aws_access_id:e.accessKeyId,aws_secret_key:e.secretAccessKey,aws_sts_token:e.sessionToken}}get lastReceivedMessage(){return this.$lastReceivedMessage}set lastReceivedMessage(e){this.$lastReceivedMessage=e}async onUserSessionChangeEvent(e,t){if(console.log("=== IotSubscriber.onUserSessionChangeEvent ==="),e===SESSION_SIGNOUT)return this.unsubscribe();if(e===SESSION_SIGNIN)return this.connect();const a=await t.fromCredentials();return this.setCredentials(a),this.reconnect()}get client(){return this.$client}set client(e){this.$client=e}async connect(){try{if(this.client)return;const e=GetUserSession();await ApiHelper.attachIot(),console.log("INFO:","iot.connect:","permission granted to "+e.username);const t=await e.fromCredentials();this.setCredentials(t);const a={credentialsProvider:this,region:REGION$2},s=AwsIotMqtt5ClientConfigBuilder.newWebsocketMqttBuilderWithSigv4Auth(IOT_HOST,a),n=new TextDecoder("utf-8"),i=new Mqtt5Client(s.build());i.on("error",e=>{console.error("ERR:","Mqtt5Client.error:",e)}),i.on("messageReceived",e=>{const t=n.decode(e.message.payload);var a;this.lastReceivedMessage!==t?(this.lastReceivedMessage=t,console.log("INFO:","Mqtt5Client.messageReceived:",e,t),a=JSON.parse(t),setTimeout(async()=>{const e=Object.keys(_receivers$2);try{await Promise.all(e.map(e=>_receivers$2[e](a).catch(t=>{console.error("ERR:",`_onMessageReceived.${e}:`,t.message)}))),console.log("INFO:","_onMessageReceived:",e.length+" receivers:",e.join(", "))}catch(e){console.error("ERR:","_onMessageReceived:",e)}},10)):console.log("[DUPLICATED]","INFO:","Mqtt5Client.messageReceived:",e,t)}),i.on("attemptingConnect",e=>{console.log("INFO:","Mqtt5Client.attemptingConnect:",e)}),i.on("connectionSuccess",e=>{console.log("INFO:","Mqtt5Client.connectionSuccess:",e)}),i.on("connectionFailure",e=>{console.log("INFO:","Mqtt5Client.connectionFailure:",e)}),i.on("disconnection",e=>{console.log("INFO:","Mqtt5Client.disconnection:",e)}),i.on("stopped",e=>{console.log("INFO:","Mqtt5Client.stopped:",e)});const o=[once(i,"attemptingConnect"),once(i,"connectionSuccess")];i.start(),await Promise.all(o);const r=await i.subscribe({subscriptions:[{qos:QoS.AtLeastOnce,topicFilter:IOT_TOPIC}]});console.log("INFO:","client.subscribe:",r),this.client=i}catch(e){throw console.error("ERR:","IotSubscriber.connect",e),e}}async reconnect(){try{await this.unsubscribe();const e=this.client,t=[once(e,"attemptingConnect"),once(e,"connectionSuccess")];e.start(),await Promise.any(t);const a=await e.subscribe({subscriptions:[{qos:QoS.AtLeastOnce,topicFilter:IOT_TOPIC}]});console.log("RECONNECT: client.subscribe",a)}catch(e){throw console.error("ERR:","IotSubscriber.reconnect",e),e}}async unsubscribe(){try{const e=this.client,t=await e.unsubscribe({topicFilters:[IOT_TOPIC]});console.log("RECONNECT: client.unsubscribe",t);const a=[once(e,"disconnection"),once(e,"stopped")];e.stop(),await Promise.all(a)}catch(e){throw console.error("ERR:","IotSubscriber.unsubscribe",e),e}}}const GetIotSubscriber=()=>(void 0===_singleton$3&&new IotSubscriber,_singleton$3),RegisterIotMessageEvent=(e,t)=>!(!e||"function"!=typeof t)&&(_receivers$2[e]=t,!0),{Statuses:{Processing:STATUS_PROCESSING$2,Completed:STATUS_COMPLETED$2,Error:STATUS_ERROR$2,IngestStarted:STATUS_INGEST_STARTED,IngestCompleted:STATUS_INGEST_COMPLETED,AnalysisStarted:STATUS_ANALYSIS_STARTED,AnalysisCompleted:STATUS_ANALYSIS_COMPLETED}}=SolutionManifest,DEFAULT_PAGESIZE=10,PROCESSINGJOBS_PAGESIZE=20,PAGING_NOTSTARTED=Symbol("Paging not started"),PAGING_NOMOREDATA=Symbol("Paging no more data"),MEDIATYPES=[MediaTypes.Video,MediaTypes.Podcast,MediaTypes.Photo,MediaTypes.Document],ON_MEDIA_ADDED="mediamanager:media:added",ON_MEDIA_UPDATED="mediamanager:media:updated",ON_MEDIA_ERROR="mediamanager:media:error";let _singleton$2;const _receivers$1={},_onMediaEvent=(e,t)=>{setTimeout(async()=>{const a=Object.keys(_receivers$1);try{await Promise.all(a.map(a=>_receivers$1[a](e,t).catch(t=>{console.error("ERR:",`_onMediaEvent.${e}.${a}:`,t.message)}))),console.log("INFO:",`_onMediaEvent.${e}:`,a.length+" receivers:",a.join(", "))}catch(t){console.error("ERR:",`_onMediaEvent.${e}:`,t)}},10)};class MediaManager{constructor(){var e,t;this.$collection=MEDIATYPES.reduce((e,t)=>({...e,[t]:{nextToken:PAGING_NOTSTARTED,items:[]}}),{}),this.$overallStatusNextTokens=[STATUS_PROCESSING$2,STATUS_COMPLETED$2,STATUS_ERROR$2].reduce((e,t)=>({...e,[t]:PAGING_NOTSTARTED})),this.$pageSize=10,e="mediamanager",t=this.onIotMessage.bind(this),e&&"function"==typeof t&&(_receivers$2[e]=t),console.log("RegisterIotMessageEvent","mediamanager"),_singleton$2=this}get collection(){return this.$collection}get pageSize(){return this.$pageSize}set pageSize(e){this.$pageSize=Number(e||10)}get overallStatusNextTokens(){return this.$overallStatusNextTokens}addMediaToCollection(e){if(!e)return;let t=e;return Array.isArray(e)||(t=[e]),t.forEach(e=>{const t=this.collection[e.type];if(void 0!==(t||{}).items){t.items.find(t=>t.uuid===e.uuid)||t.items.push(e)}}),t}getNextTokenByType(e){return(this.collection[e]||{}).nextToken}setNextTokenByType(e,t){this.collection[e].nextToken=t||PAGING_NOMOREDATA}noMoreData(e){return this.getNextTokenByType(e)===PAGING_NOMOREDATA}async scanRecordsByCategory(e){try{if(this.noMoreData(e))return;const t={pageSize:this.pageSize,type:e},a=this.getNextTokenByType(e);a&&"symbol"!=typeof a&&(t.token=a);const s=await ApiHelper.scanRecords(t);this.setNextTokenByType(e,s.NextToken);const n=await this.batchInsertMedia(s.Items);return this.addMediaToCollection(n),n}catch(e){return console.error(e),[]}}async scanRecords(){let e=await Promise.all(MEDIATYPES.map(e=>this.scanRecordsByCategory(e)));return e=e.flat(1),e}async scanProcessingRecords(){try{let e=await this.scanRecordsByStatus(STATUS_PROCESSING$2,1).then(e=>e.Items);return e&&(e=await this.batchInsertMedia(e)),this.addMediaToCollection(e),e}catch(e){return void console.error(e)}}async scanErrorRecords(){try{let e=await this.scanRecordsByStatus(STATUS_ERROR$2).then(e=>e.Items);return e&&(e=await this.batchInsertMedia(e)),this.addMediaToCollection(e),e}catch(e){return void console.error(e)}}async scanCompletedRecords(){try{let e=await this.scanRecordsByStatus(STATUS_COMPLETED$2).then(e=>e.Items);return e&&(e=await this.batchInsertMedia(e)),this.addMediaToCollection(e),e}catch(e){return void console.error(e)}}async scanRecordsByStatus(e,t=20){try{const a={overallStatus:e,pageSize:t},s=this.overallStatusNextTokens[e];return s&&"symbol"!=typeof s&&(a.token=s),ApiHelper.scanRecords(a).then(t=>((t||{}).NextToken&&(this.overallStatusNextTokens[e]=t.NextToken),t))}catch(e){return void console.error(e)}}noMoreProccessingJob(){return this.noMoreDataByStatus(STATUS_PROCESSING$2)}noMoreCompletedJob(){return this.noMoreDataByStatus(STATUS_COMPLETED$2)}noMoreErrorJob(){return this.noMoreDataByStatus(STATUS_ERROR$2)}noMoreDataByStatus(e){return this.overallStatusNextTokens[e]===PAGING_NOMOREDATA}async batchInsertMedia(e){return(await Promise.all(e.map(e=>this.insertMedia(e)))).filter(e=>void 0!==e)}async insertMedia(e){try{if(void 0!==this.findMediaByUuid(e.uuid))return;return MediaFactory.lazyCreateMedia(e.uuid)}catch(e){return void console.error(e)}}async removeMedia(e){try{await ApiHelper.purgeRecord(e.uuid);const t=Object.keys(this.collection);for(;t.length;){const a=t.shift();let s=(this.collection[a].items||[]).findIndex(t=>t.uuid===e.uuid);if(s>-1)return s=this.collection[a].items.splice(s,1),s[0]}return}catch(e){return void console.error(e)}}findMediaByType(e){return(this.collection[e]||{}).items||[]}findMediaByUuid(e){const t=Object.keys(this.collection);for(;t.length;){const a=this.findMediaByType(t.shift()).find(t=>t.uuid===e);if(void 0!==a)return a}}findMediaByStatus(e){return Object.keys(this.collection).map(t=>this.findMediaByType(t).filter(t=>t.status===e)).flat(1).filter(e=>void 0!==e)}findMediaByOverallStatus(e){return Object.keys(this.collection).map(t=>this.findMediaByType(t).filter(t=>t.overallStatus===e)).flat(1).filter(e=>void 0!==e)}findProcessingMedias(){return this.findMediaByOverallStatus(STATUS_PROCESSING$2)}findCompletedMedias(){return this.findMediaByOverallStatus(STATUS_COMPLETED$2)}findErrorMedias(){return this.findMediaByOverallStatus(STATUS_ERROR$2)}async onIotMessage(e){let t=this.findMediaByUuid(e.uuid);return t?(e.status!==STATUS_ANALYSIS_STARTED&&e.status!==STATUS_ANALYSIS_COMPLETED||await t.refresh(),e.status===STATUS_INGEST_STARTED||e.status===STATUS_INGEST_COMPLETED||e.status===STATUS_ANALYSIS_STARTED||e.status===STATUS_ANALYSIS_COMPLETED?_onMediaEvent(ON_MEDIA_UPDATED,t):e.overallStatus===STATUS_ERROR$2?(await t.setError(),_onMediaEvent(ON_MEDIA_ERROR,t)):t):(console.log("onIotMessage","insertMedia",e),t=await this.insertMedia(e),this.addMediaToCollection(t),t?_onMediaEvent(ON_MEDIA_ADDED,t):void 0)}async lazyGetByUuid(e){try{const t=this.findMediaByUuid(e);return t||MediaFactory.lazyCreateMedia(e)}catch(e){return void console.error(e)}}}const GetMediaManager=()=>(void 0===_singleton$2&&new MediaManager,_singleton$2),RegisterMediaEvent=(e,t)=>!(!e||"function"!=typeof t)&&(_receivers$1[e]=t,!0),{Messages:{SolutionName}}=Localization;class ObserverHelper{static setHashOnVisible(e,t,a=[.1]){if(!e||!t)return;const s={root:null,rootMargin:"0px",threshold:a},n=new IntersectionObserver(e=>{e.forEach(e=>{if(e.intersectionRatio>=s.threshold[0]){console.log("setHashOnVisible","entry.intersectionRatio",e.intersectionRatio,t);if(document.location.hash.slice(1)===t)return;const a=new URL(document.location);a.hash=t,history.pushState(void 0,void 0,a);const s=t.split("/");s.unshift(SolutionName),document.title=s.join(" > ")}})},s);return n.observe(e[0]),n}}const CategorySlideComponentEvents={Media:{Selected:"media:selected",Removing:"media:removing",Preview:{Close:"media:preview:close"}}},mxAlert=e=>class extends e{shake(e,t=200){e.addClass("shake-sm").off("webkitAnimationEnd oanimationend msAnimationEnd animationend").on("webkitAnimationEnd oanimationend msAnimationEnd animationend",a=>e.delay(t).removeClass("shake-sm"))}async showMessage(e,t,a,s,n=5e3){return new Promise((i,o)=>{const r=$("<div/>").addClass("up-alert"),l=$("<div/>").addClass("alert alert-dismissible fade show alert-"+t).attr("role","alert").append($("<h4/>").addClass("alert-heading").html(a)).append($("<p/>").html(s)).append($("<button/>").addClass("close").attr("type","button").attr("data-dismiss","alert").attr("aria-label","Close").append($("<span/>").attr("aria-hidden",!0).html("&times;")));let d=setTimeout(()=>{l.alert("close"),d=void 0},n);l.on("close.bs.alert",()=>{clearInterval(d),d=void 0}),l.on("closed.bs.alert",()=>{l.alert("dispose"),r.remove(),i()}),r.append(l),e.append(r)})}},{Alerts:{Oops:OOPS$6}}=Localization;class BaseSlideComponent extends(mxAlert(class{})){constructor(){super(),this.$id=AppUtils.randomHexstring(),this.$ids={slide:"slide-"+this.id},this.$slide=$("<div/>").addClass("container p-0 m-0 col-12"),this.$initialized=!1,Spinner.useSpinner()}get id(){return this.$id}get ids(){return this.$ids}get slideId(){return"slide-"+this.id}get slide(){return this.$slide}set slide(e){this.$slide=e}get initialized(){return this.$initialized}set initialized(e){this.$initialized=e}loading(e){return Spinner.loading(e)}getSlide(){return this.slide}async show(){return this.initialized=!0,this.slide}async hide(){this.slide.children().remove(),this.initialized=!1}async saveData(){return this}async clearData(){return this}async getData(){return this}async showAlert(e,t){return super.showMessage(this.slide,"danger",OOPS$6,e,t)}async createSlide(){return this.slide}on(e,t){return this.slide.on(e,t)}off(e){return this.slide.off(e)}}const{Statuses:{Processing:STATUS_PROCESSING$1,Completed:STATUS_COMPLETED$1,Error:STATUS_ERROR$1}}=SolutionManifest,OVERALL_STATUSES=[STATUS_COMPLETED$1,STATUS_PROCESSING$1,STATUS_PROCESSING$1],{Messages:{CollectionTab:COLLECTION_TAB$3,VideoTab:VIDEO_TAB$3,PhotoTab:PHOTO_TAB$3,PodcastTab:PODCAST_TAB$3,DocumentTab:DOCUMENT_TAB$3,UploadTab:UPLOAD_TAB$1,ProcessingTab:PROCESSING_TAB$1,NoMediaPresent:MSG_NO_MEDIA_PRESENT,LoadMore:MSG_LOAD_MORE$1,NoMoreData:MSG_NO_MORE_DATA$2,ProcessingError:MSG_PROCESSING_ERR},Statuses:{Error:MSG_STATUS_ERROR$1,Processing:MSG_STATUS_PROCESSING$1},Tooltips:{RemoveMedia:TOOLTIP_REMOVE_MEDIA}}=Localization,MEDIATYPE_TO_TAB$1={[MediaTypes.Video]:VIDEO_TAB$3,[MediaTypes.Photo]:PHOTO_TAB$3,[MediaTypes.Podcast]:PODCAST_TAB$3,[MediaTypes.Document]:DOCUMENT_TAB$3},DATA_UUID$2="data-uuid",DATA_ROLE$1="data-role",DATA_STATUS="data-status",ROLE_MEDIADESC="media-desc",ROLE_LOADMORE="load-more";class BaseCategorySlideComponent extends BaseSlideComponent{constructor(e,t={}){super(),this.$ids={...super.ids,mediaList:"media-"+AppUtils.randomHexstring()},this.$mediaType=e,this.$displayOptions=t,this.$mediaManager=GetMediaManager(),RegisterMediaEvent("basecategoryslidecomponent:"+e,this.onMediaEvent.bind(this))}static get Events(){return CategorySlideComponentEvents}get mediaType(){return this.$mediaType}get displayOptions(){return this.$displayOptions}get mediaManager(){return this.$mediaManager}async show(e){if(this.initialized)await this.refreshContent();else{const t=this.createSkeleton();this.slide.append(t),await this.refreshWithHashtag(e)}return super.show()}async refreshWithHashtag(e=""){const t=e.split("/").pop();if(t){const e=(await this.refreshContent(t)).find(e=>e.attr("data-uuid")===t);e&&e.click()}}async onMediaEvent(e,t){return e===ON_MEDIA_ADDED?this.onMediaAdded(t,!0):e===ON_MEDIA_UPDATED?this.onMediaUpdated(t):e===ON_MEDIA_ERROR?this.onMediaError(t):void 0}async onMediaAdded(e,t=!1){if(e.type!==this.mediaType)return;const a=this.slide.find("#"+this.ids.mediaList);let s=a.find(`div[data-uuid="${e.uuid}"]`);if(0===s.length){s=await this.createMediaListItem(e);let n=a.children();n=t?n.first():n.last(),s.insertBefore(n)}return s}async onMediaUpdated(e){if(e.type!==this.mediaType)return;const t=this.slide.find("#"+this.ids.mediaList).find(`div[data-uuid="${e.uuid}"]`);let a;return t.length>0&&(t.attr(DATA_STATUS)!==e.overallStatus||e.status===SolutionManifest.Statuses.IngestStarted||e.status===SolutionManifest.Statuses.AnalysisStarted)&&(a=await this.createMediaListItem(e),t.replaceWith(a)),a}async onMediaRemoved(e){await this.mediaManager.removeMedia(e);this.slide.find("#"+this.ids.mediaList).find(`div[data-uuid="${e.uuid}"]`).remove()}async onMediaError(e){if(e.type!==this.mediaType)return;const t=this.slide.find("#"+this.ids.mediaList).find(`div[data-uuid="${e.uuid}"]`);if(t.length>0){const a=await this.createMediaListItem(e);t.replaceWith(a)}const a=MSG_PROCESSING_ERR.replace("{{BASENAME}}",e.basename).replace("{{PROCESSINGTAB}}",PROCESSING_TAB$1);return this.showAlert(a)}createSkeleton(){const e=$("<div/>").addClass("row no-gutters"),t=$("<div/>").addClass("col-9 p-0 mx-auto mt-4").addClass("collapse").attr("data-role","media-desc");e.append(t);const a=this.createNoMediaMessage();t.append(a);const s=$("<div/>").addClass("col-12 p-0 mx-auto mt-4");e.append(s);const n=this.createMediaList();return s.append(n),e.ready(async()=>{try{this.loading(),await this.mediaManager.scanRecordsByCategory(this.mediaType),await this.refreshContent()}catch(e){console.error(e)}finally{this.loading(!1)}}),s.ready(async()=>{const t=[COLLECTION_TAB$3,MEDIATYPE_TO_TAB$1[this.mediaType]].join("/");ObserverHelper.setHashOnVisible(e,t)}),e}createNoMediaMessage(){const e=$("<p/>").addClass("lead"),t=MSG_NO_MEDIA_PRESENT.replace("{{MEDIATYPE}}",this.mediaType).replace("{{UPLOADTAB}}",UPLOAD_TAB$1);return e.append(t),e}showNoMediaMessage(e=!0){const t=this.slide.find('div[data-role="media-desc"]');return e?t.removeClass("collapse"):t.addClass("collapse")}createMediaList(){return $("<div/>").addClass("row no-gutters").attr("id",this.ids.mediaList)}async refreshContent(e){try{this.loading();const t=this.slide.find("#"+this.ids.mediaList);t.children().remove();let a=[];if(e){const t=await this.mediaManager.lazyGetByUuid(e);t&&t.type===this.mediaType&&a.push(t)}0===a.length&&(a=this.mediaManager.findMediaByType(this.mediaType).filter(e=>e.overallStatus!==STATUS_ERROR$1));let s=[];a.length>0?(s=await Promise.all(a.map(e=>this.createMediaListItem(e,t))),this.showNoMediaMessage(!1)):this.showNoMediaMessage(!0);const n=this.createLoadMoreMedia();return t.append(n),s}catch(e){return console.error(e),[]}finally{this.loading(!1)}}async createMediaListItem(e,t){const a=$("<div/>").addClass("col-3").addClass("media-"+e.overallStatus.toLowerCase()).attr("data-uuid",e.uuid).attr(DATA_STATUS,e.overallStatus);return a.on("click",async t=>(t.preventDefault(),this.slide.trigger(BaseCategorySlideComponent.Events.Media.Selected,[e]))),t&&t.append(a),a.ready(()=>{const t=this.createThumbnail(e),s=this.createMediaOverlay(e);a.append(t).append(s)}),a}createLoadMoreMedia(){const e=AppUtils.randomHexstring(),t=["data:image/svg+xml;charset=UTF-8",encodeURIComponent(`<svg width="80" height="45" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 80 45" preserveAspectRatio="none">\n      <g id="${e}"><rect width="80" height="45" stroke="none" stroke-width="1"></rect></g>\n    </svg>`)].join(","),a=$("<div/>").addClass("col-3").attr("data-uuid","load-more"),s=$("<img/>").addClass("w-100").css("aspect-ratio","16 / 9").css("object-fit","cover").attr("src",t).attr("alt",MSG_LOAD_MORE$1);a.append(s);const n=$("<div/>").addClass("card-img-overlay category").css("background-color","#777777");a.append(n);const i=$("<div/>").addClass("h-100 d-flex");n.append(i);const o=$("<h5/>").addClass("text-white lead m-0 align-self-center").attr("data-role","load-more").append(MSG_LOAD_MORE$1);i.append(o);const r=$("<i/>").addClass("fas fa-ellipsis-h icon-3 ml-auto my-auto");return i.append(r),a.on("click",async e=>{e.preventDefault(),await this.scanNextByMediaType(),this.mediaManager.noMoreData(this.mediaType)&&this.disableScan(a)}),a}createThumbnail(e){let t="cover";(this.displayOptions||{}).objectFit&&(t=this.displayOptions.objectFit);const a=$("<img/>").addClass("w-100").css("aspect-ratio","16 / 9").css("object-fit",t).attr("alt",e.basename);return a.ready(async()=>{const t=await e.getThumbnail();a.attr("src",t)}),a}createMediaOverlay(e){const t=$("<div/>").addClass("card-img-overlay category p-2"),a=$("<div/>").addClass("row no-gutters h-100");t.append(a);const s=$("<div/>").addClass("col-6 p-0 m-0");a.append(s);const n=AppUtils.shorten(e.basename,54),i=$("<h5/>").addClass("lead-s m-0 text-white text-contain").append(n);s.append(i);const o=this.createMediaStatus(e);a.append(o);const r=$("<div/>").addClass("col-12 p-0 align-self-end d-flex");a.append(r);const l=$("<div/>").addClass("col-6 p-0 m-0 mt-auto");r.append(l);const d=$("<button/>").addClass("btn btn-sm btn-outline-danger lead-sm media-action").attr("data-toggle","tooltip").attr("data-placement","bottom").attr("title",TOOLTIP_REMOVE_MEDIA).tooltip({trigger:"hover"});l.append(d);const c=$("<i/>").addClass("far fa-trash-alt");d.append(c);const p=$("<div/>").addClass("col-6 p-0 m-0 ml-auto text-right");r.append(p);const h=$("<button/>").addClass("btn btn-link media-action");p.append(h);const u=$("<i/>").addClass("far fa-play-circle icon-4");return h.append(u),d.on("click",async t=>(t.preventDefault(),t.stopPropagation(),d.tooltip("hide"),this.slide.trigger(BaseCategorySlideComponent.Events.Media.Removing,[e]))),t}createMediaStatus(e){if(!OVERALL_STATUSES.includes(e.overallStatus))return;const t=$("<div/>").addClass("col-6 p-0 m-0"),a=$("<div/>").addClass("p-0 m-0 d-flex justify-content-end");t.append(a);const s=$("<span/>").addClass("lead-xs px-2 text-white text-right");return a.append(s),e.overallStatus===STATUS_COMPLETED$1&&e.duration?(s.addClass("bg-dark").append(e.readableDuration),t):e.overallStatus===STATUS_PROCESSING$1?(s.addClass("bg-primary").append(MSG_STATUS_PROCESSING$1),t):e.overallStatus===STATUS_ERROR$1?(s.addClass("bg-danger").append(MSG_STATUS_ERROR$1),t):void 0}async scanNextByMediaType(){try{this.loading();const e=await this.mediaManager.scanRecordsByCategory(this.mediaType);if(e)for(let t=0;t<e.length;t++)await this.onMediaAdded(e[t])}catch(e){console.error(e)}finally{this.loading(!1)}}disableScan(e){e.find(".category").attr("disabled","disabled"),e.find('[data-role="load-more"]').html(MSG_NO_MORE_DATA$2)}}class VideoCategorySlideComponent extends BaseCategorySlideComponent{constructor(){super(MediaTypes.Video,{objectFit:"cover"})}}const PreviewSlideComponentEvents={Preview:{Close:"media:preview:close"}};class AWSConsoleS3{static getLink(e,t){return t?`https://s3.console.aws.amazon.com/s3/object/${e}/${t}?region=${SolutionManifest.Region}`:`https://s3.console.aws.amazon.com/s3/buckets/${e}/?region=${SolutionManifest.Region}`}}class AWSConsoleStepFunctions{static getExecutionLink(e){return`https://console.aws.amazon.com/states/home?region=${SolutionManifest.Region}#/executions/details/${e}`}}class AWSConsoleTranscribe{static getJobLink(e){return`https://console.aws.amazon.com/transcribe/home?region=${SolutionManifest.Region}#job-details/${e}`}}class AWSConsoleCongito{static getUserPoolLink(e){return`https://${SolutionManifest.Region}.console.aws.amazon.com/cognito/users/?region=${SolutionManifest.Region}#pool/${e}/users`}}const MSG_VIEW_ON_CONSOLE=Localization.Tooltips.ViewOnAWSConsole,MSG_DOWNLOAD_FILE=Localization.Tooltips.DownloadFile,CSS_DL="row text-left lead-xs ml-2 mb-2",CSS_DT="col-sm-2",CSS_DD="col-sm-10",DEFAULT_CSS={dl:CSS_DL,dt:CSS_DT,dd:CSS_DD};class DescriptionList extends(mxReadable(class{})){constructor(e){super(),this.$cssOptions={...DEFAULT_CSS,...e}}get cssOptions(){return this.$cssOptions}createTableList(){return $("<dl/>").addClass(this.cssOptions.dl)}createListTitle(e){return $("<dt/>").addClass(this.cssOptions.dt).addClass("text-capitalize text-truncate").append(e)}createListData(e){const t=$("<dd/>").addClass(this.cssOptions.dd);return Array.isArray(e)?(e.forEach(e=>t.append(e)),t):t.append(e)}appendTableList(e,t,a){return e.append(this.createListTitle(a)).append(this.createListData(this.readableValue(t,a)))}createDetailGroup(e,t=0){const a=t?1===t?{margin:"ml-2",lead:"lead-s"}:{margin:"ml-4",lead:"lead-s"}:{margin:"",lead:"lead-s"};return $("<details/>").addClass(a.margin).append($("<summary/>").addClass("my-2").append($("<span/>").addClass(a.lead+" text-capitalize").append(e)))}readableValue(e,t){if("key"===t&&e.bucket){const t=$("<div/>"),a=$("<a/>").addClass("mr-1").addClass("badge badge-pill badge-primary mr-1 mb-1 lead-xs").attr("href",AWSConsoleS3.getLink(e.bucket,e.key)).attr("target","_blank").html(MSG_VIEW_ON_CONSOLE);t.append(a);const s=$("<a/>").addClass("mr-1").attr("download","").attr("target","_blank").attr("data-toggle","tooltip").attr("data-placement","bottom").attr("title",MSG_DOWNLOAD_FILE).append(e.key).tooltip({trigger:"hover"});return t.append(s),t.ready(async()=>{const t=GetS3Utils(),a=await t.signUrl(e.bucket,e.key);s.attr("href",a)}),t}return"fileSize"===t?DescriptionList.readableFileSize(e.fileSize):"duration"===t?DescriptionList.readableDuration(e[t]):"timestamp"===t||"lastModified"===t||"startTime"===t||"endTime"===t?DescriptionList.isoDateTime(e[t]):"executionArn"===t?$("<a/>").addClass("badge badge-pill badge-primary mr-1 mb-1 lead-xs").attr("href",AWSConsoleStepFunctions.getExecutionLink(e[t])).attr("target","_blank").attr("data-toggle","tooltip").attr("data-placement","bottom").attr("title",MSG_VIEW_ON_CONSOLE).html(e[t].split(":").pop()).tooltip({trigger:"hover"}):Array.isArray(e[t])?e[t].join(", "):e[t]}}class GeneralGroup{static createGroup(e){if(!e)return;const t=new DescriptionList,a=t.createDetailGroup(Localization.Messages.GeneralGroup),s=t.createTableList();return Object.keys(e).filter(t=>!("object"==typeof e[t]||Array.isArray(e[t])||"storageClass"===t)).forEach(a=>t.appendTableList(s,e,a)),a.append(s)}}class ProxyGroup{static createGroup(e){if(!e&&!e.length)return;const t=new DescriptionList,a=t.createDetailGroup(Localization.Messages.ProxyGroup);return e.forEach(e=>{const s=e.key.substring(e.key.lastIndexOf("/")+1),n=t.createDetailGroup(s,1);n.find("span.text-capitalize").removeClass("text-capitalize");const i=t.createTableList();Object.keys(e).filter(t=>!("object"==typeof e[t]||Array.isArray(e[t])||"storageClass"===t)).forEach(a=>t.appendTableList(i,e,a)),n.append(i),a.append(n)}),a}}class MediaInfoGroup{static createGroup(e){if(!e)return;const t=new DescriptionList({dt:"col-sm-3",dd:"col-sm-9"}),a=t.createDetailGroup(Localization.Messages.MediaInfoGroup);return((e.media||{}).track||[]).forEach(e=>{const s=t.createDetailGroup(e.$.type,1),n=t.createTableList();Object.keys(e).filter(t=>!("object"==typeof e[t]||Array.isArray(e[t])||"storageClass"===t)).forEach(a=>t.appendTableList(n,e,a)),s.append(n),a.append(s)}),a}}class GoogleMap{static async getSingleton(e){return new Promise(t=>{GoogleMap.singleton?t(GoogleMap.singleton):GoogleMap.loadMap(t,e)})}static loadMap(e,t=""){const a=document.createElement("script");a.src="https://maps.googleapis.com/maps/api/js?key="+t,a.onerror=t=>{console.error("GoogleMapLaoder onerror: "+encodeURIComponent(t.message)),e(void 0)},a.onload=()=>{GoogleMap.singleton=new GoogleMap,e(GoogleMap.singleton)},window.document.body.appendChild(a)}static initMap(){GoogleMap.mapIsReady=!0}get mapIsReady(){return GoogleMap.mapIsReady}static dms2dd(e){const[t,a,s,n]=e.split(" ").map(e=>e.trim());let i=Number.parseFloat(t)+Number.parseFloat(a)/60+Number.parseFloat(s)/3600;return"W"!==n&&"S"!==n||(i=0-i),i}render(e,t,a){const s={lat:GoogleMap.dms2dd(t),lng:GoogleMap.dms2dd(a)},n=new google.maps.Map(e,{zoom:8,center:s,mapTypeControl:!1,fullscreenControl:!1,streetViewControl:!1});new google.maps.Marker({position:s,map:n})}}GoogleMap.mapIsReady=!1,GoogleMap.singleton=void 0;const OPT_MAPAPIKEY="mapApiKey",DATA_INIT="data-initialized",DATA_LAT="data-lat",DATA_LNG="data-lng",DATA_ROLE="data-role",ROLE_MAP="map",ATTRB_BASIC=["Make","Model","ImageSize","ImageHeight","ImageWidth","Orientation","ColorSpace","XResolution","YResolution","CreateDate"];class EXIFGroup{static createGroup(e){if(!e)return;const t=new DescriptionList({dt:"col-sm-3",dd:"col-sm-9"}),a=t.createDetailGroup(Localization.Messages.EXIFGroup),s={},n={},i={};Object.keys(e).forEach(t=>{ATTRB_BASIC.indexOf(t)>=0?s[t]=e[t]:0===t.indexOf("GPS")?n[t]=e[t]:i[t]=e[t]});let o=Object.keys(s);if(o.length){const e=t.createDetailGroup(Localization.Messages.BasicGroup,1),n=t.createTableList();o.forEach(e=>t.appendTableList(n,s,e)),e.append(n),a.append(e)}if(o=Object.keys(n),o.length){const e=t.createDetailGroup(Localization.Messages.GPSGroup,1),s=t.createTableList();if(o.forEach(e=>t.appendTableList(s,n,e)),e.append(s),n.GPSLongitude&&n.GPSLatitude){const t=EXIFGroup.createMap(n.GPSLongitude,n.GPSLatitude);e.prepend(t)}a.append(e)}if(o=Object.keys(i),o.length){const e=t.createDetailGroup(Localization.Messages.OthersGroup,1),s=t.createTableList();o.forEach(e=>t.appendTableList(s,i,e)),e.append(s),a.append(e)}return a}static createMap(e,t){const a=$("<div/>").addClass("collapse ml-4 mb-2 h-400").attr(DATA_ROLE,"map").attr(DATA_INIT,!1).attr(DATA_LAT,t).attr(DATA_LNG,e).css("width","90%"),s=$("<input/>").attr("type","checkbox");s.off("click").on("click",async e=>EXIFGroup.showMap(a,s.prop("checked")));const n=$("<label/>").addClass("xs-switch").append(s).append($("<span/>").addClass("xs-slider round")),i=$("<div/>").addClass("form-group ml-4 mb-2").append($("<div/>").addClass("input-group").append(n).append($("<span/>").addClass("lead-sm ml-2").html(Localization.Messages.ShowMap)));return $("<div/>").append(i).append(a)}static async showMap(e,t){if(!t)return e.addClass("collapse");if(e.removeClass("collapse"),!0===e.data("initialized"))return e;const a=e.data("lat"),s=e.data("lng"),n=GetSettingStore(),i=await n.getItem("mapApiKey"),o=await GoogleMap.getSingleton(i);return o&&(o.render(e[0],a,s),e.prop(DATA_INIT,!0)),e}}class PDFGroup{static createGroup(e){if(!e)return;const t=new DescriptionList,a=t.createDetailGroup(Localization.Messages.PDFGroup),s=t.createTableList();return Object.keys(e).filter(t=>!("object"==typeof e[t]||Array.isArray(e[t])||"storageClass"===t)).forEach(a=>t.appendTableList(s,e,a)),a.append(s)}}class TechnicalComponentHelper{static createContents(e){if(!e)return;const t=$("<div/>").addClass("col-12 p-0 m-4"),a=$("<div/>").addClass("col-12 p-0 m-0");t.append(a);const s=$("<h5/>").addClass("lead my-2 text-left").html(`${e.basename} (${e.readableDuration||e.readableFileSize})`);if(a.append(s),e.data){const a=$("<div/>").addClass("col-12 p-0 my-2 mx-0");t.append(a);const s=GeneralGroup.createGroup(e.data);a.append(s)}if(e.data.proxies&&e.data.proxies.length>0){const a=$("<div/>").addClass("col-12 p-0 my-2 mx-0");t.append(a);const s=ProxyGroup.createGroup(e.data.proxies);a.append(s)}if(e.data.mediainfo){const a=$("<div/>").addClass("col-12 p-0 my-2 mx-0");t.append(a),a.ready(async()=>{const t=await e.loadMediaInfo(),s=MediaInfoGroup.createGroup(t);a.append(s)})}if(e.data.imageinfo){const a=$("<div/>").addClass("col-12 p-0 my-2 mx-0");t.append(a),a.ready(async()=>{const t=await e.loadImageInfo(),s=EXIFGroup.createGroup(t);a.append(s)})}if(e.data.docinfo){const a=$("<div/>").addClass("col-12 p-0 my-2 mx-0");t.append(a);const s=e.data.docinfo,n=PDFGroup.createGroup(s);a.append(n)}return t}}class MapData{constructor(e){this.$version=0,this.$labels=[],this.$files=[],this.initialize(e)}get version(){return this.$version}set version(e){this.$version=e}get labels(){return this.$labels}set labels(e){this.$labels=e}get files(){return this.$files}set files(e){this.$files=Array.isArray(e)?e:[e]}get basenames(){return this.$labels.map(e=>e.toLowerCase().replace(/\s/g,"_").replace(/\//g,"-"))}initialize(e){e&&(e.version>0?(this.$version=e.version,this.$labels=e.data,this.$files=[e.file]):(this.$labels=Object.keys(e),this.$files=[...new Set(Object.values(e).flat(1))]))}static async load(e,t){return"/"===t[t.length-1]?this.loadFromPrefix(e,t):this.loadFromKey(e,t)}static async loadFromKey(e,t){const a=GetS3Utils();let s=await a.getObject(e,t).catch(()=>{});return s&&(s=await s.Body.transformToString().then(e=>JSON.parse(e))),new MapData(s)}static async loadFromPrefix(e,t){const a=GetS3Utils(),s=await a.listObjects(e,t).then(e=>e.map(e=>e.Key.substring(e.Key.lastIndexOf("/")+1,e.Key.lastIndexOf(".")))).catch(()=>[]),n=new MapData;return n.labels=s,n}}class BaseTab{constructor(e,t={}){this.$id=AppUtils.randomHexstring(),this.$ids={tabId:"tab-"+this.$id,contentId:"tabcontent-"+this.$id},this.$title=e,this.$hashtag=t.hashtag;const a=$("<a/>").addClass("nav-link").attr("id",this.tabId).attr("href","#"+this.contentId).attr("role","tab").attr("data-toggle","tab").attr("aria-controls",this.contentId).attr("aria-selected",!1).css("font-size",t.fontSize||"1.2rem").html(this.title);this.$tabLink=$("<li/>").addClass("nav-item").append(a),this.$tabContent=$("<div/>").addClass("tab-pane fade").attr("id",this.contentId).attr("role","tabpanel").attr("aria-labelledby",this.tabId),this.tabContent.ready(()=>{ObserverHelper.setHashOnVisible(this.tabContent,this.hashtag)}),a.on("shown.bs.tab",async e=>{const t=$(e.target);return t.parent().siblings().children(".nav-link").removeClass("show active"),t.prop("id")===this.tabId&&await this.show(),!0}),this.$initialized=!1}get id(){return this.$id}get ids(){return this.$ids}get tabId(){return"tab-"+this.id}get contentId(){return"tabcontent-"+this.id}get title(){return this.$title}set title(e){this.$title=e,this.tabLink.children("a.nav-link").html(this.$title)}get tabLink(){return this.$tabLink}get tabContent(){return this.$tabContent}get initialized(){return this.$initialized}set initialized(e){this.$initialized=e}get hashtag(){return this.$hashtag}parseHashtag(e=""){let t=e;"#"===t[0]&&(t=t.slice(1));const a=t.split("/");return{current:a[0],next:a.slice(1).join("/")}}async show(e){return this.initialized=!0,this.tabLink.children("a").addClass("show active"),this.tabContent.tab("show"),this.tabContent}async hide(){this.tabContent.children().remove(),this.initialized=!1}}const{Tooltips:{ViewOnAWSConsole:TOOLTIP_VIEW_ON_CONSOLE$1,DownloadFile:TOOLTIP_DOWNLOAD_FILE$1}}=Localization,COL_TAB$4="col-11";class BaseAnalysisTab extends(mxReadable(BaseTab)){constructor(e,t){super(e,{fontSize:"1rem"}),this.$previewComponent=t,this.$css={dl:{dt:"col-sm-2",dd:"col-sm-10"}},Spinner.useSpinner()}get ids(){return this.$ids}get css(){return this.$css}get previewComponent(){return this.$previewComponent}get media(){return(this.$previewComponent||{}).media}loading(e){return Spinner.loading(e)}async show(){if(!this.initialized){const e=$("<div/>").addClass("row no-gutters justify-content-md-center min-h24r");this.tabContent.append(e);const t=this.createBackgroundTitle();e.append(t);const a=await this.createContent();e.append(a)}return super.show()}async download(e){if(!e)return;return GetS3Utils().getObject(this.media.getProxyBucket(),e).catch(t=>{console.error("ERR:","fail to download",e,t.message)})}createBackgroundTitle(){return $("<div/>").addClass("col-11 d-flex justify-content-center custom-bg min-h24r").append($("<span/>").addClass("align-self-center text-uppercase").html(this.title))}async createContent(){return $("<div/>").addClass("col-11 my-4 max-h36r").html(Localization.Messages.NoData)}readableValue(e,t){if("key"===t&&e.bucket){const t=$("<div/>"),a=$("<a/>").addClass("mr-1").addClass("badge badge-pill badge-primary mr-1 mb-1 lead-xs").attr("href",AWSConsoleS3.getLink(e.bucket,e.key)).attr("target","_blank").html(TOOLTIP_VIEW_ON_CONSOLE$1);t.append(a);const s=$("<a/>").addClass("mr-1").attr("download","").attr("target","_blank").attr("data-toggle","tooltip").attr("data-placement","bottom").attr("title",TOOLTIP_DOWNLOAD_FILE$1).append(e.key).tooltip({trigger:"hover"});return t.append(s),t.ready(async()=>{const t=GetS3Utils(),a=await t.signUrl(e.bucket,e.key);s.attr("href",a)}),t}return"fileSize"===t?BaseMedia.readableFileSize(e.fileSize):"timestamp"===t||"lastModified"===t||"startTime"===t||"endTime"===t?BaseMedia.isoDateTime(e[t]):"executionArn"===t?$("<a/>").addClass("badge badge-pill badge-primary mr-1 mb-1 lead-xs").attr("href",AWSConsoleStepFunctions.getExecutionLink(e[t])).attr("target","_blank").attr("data-toggle","tooltip").attr("data-placement","bottom").attr("title",TOOLTIP_VIEW_ON_CONSOLE$1).html(e[t].split(":").pop()).tooltip({trigger:"hover"}):Array.isArray(e[t])?e[t].join(", "):e[t]}createGrouping(e,t=0){const a=t?1===t?{margin:"ml-2",lead:"lead-xs"}:{margin:"ml-4",lead:"lead-xxs"}:{margin:"",lead:"lead-sm"},s=$("<details/>").addClass(a.margin).data("rendered",!1),n=$("<summary/>").addClass("my-2");s.append(n);const i=$("<span/>").addClass("text-capitalize").addClass(a.lead).append(e);return n.append(i),s}createTableList(){return $("<dl/>").addClass("row text-left lead-xs ml-2 mb-2")}createListTitle(e){return $("<dt/>").addClass(this.css.dl.dt).addClass("text-capitalize text-truncate").append(e)}createListData(e){const t=$("<dd/>").addClass(this.css.dl.dd);return Array.isArray(e)?(e.forEach(e=>t.append(e)),t):t.append(e)}createBadge(e,t,a){const s=t?$("<a/>").addClass("badge-primary").attr("href",t):$("<span/>").addClass("badge-secondary");return s.addClass("badge badge-pill mr-1 mb-1 lead-xs").append(e),a&&s.attr("data-toggle","tooltip").attr("data-placement","bottom").attr("title",a).tooltip({trigger:"hover"}),s}appendTableList(e,t,a){return e.append(this.createListTitle(t)).append(this.createListData(a))}createButton(e,t){const a=(t?`${t} ${e}`:e).replace(/_/g," "),s=$("<button/>").addClass("btn btn-sm btn-primary text-capitalize mb-1 ml-1").attr("type","button").attr("data-toggle","button").attr("aria-pressed",!1).attr("autocomplete","off").attr("data-track-name",e).append(a);return s.off("click").on("click",async t=>{const a="false"===s.attr("aria-pressed");return this.previewComponent.trackToggle(e,a)}),s}createEnableAll(e){const t=$("<input/>").attr("type","checkbox");t.off("click").on("click",async a=>{const s=t.prop("checked");e.forEach(e=>{"false"===e.attr("aria-pressed")===s&&e.click()})});return $("<div/>").addClass("form-group px-0 mt-2 mb-2").append($("<div/>").addClass("input-group").append($("<label/>").addClass("xs-switch").append(t).append($("<span/>").addClass("xs-slider round"))).append($("<span/>").addClass("lead ml-2").html(Localization.Messages.EnableAll)))}}const{Messages:{StatisticsTab:TITLE$l,DownloadJson:MSG_DOWNLOAD_JSON,WorkflowHistory:MSG_WORKFLOW_HISTORY,Rekognition:MSG_REKOGNITION,Labels:MSG_LABELS,Transcribe:MSG_TRANSCRIBE,TranscriptionJob:MSG_TRANSCRIPTION_JOB,Comprehend:MSG_COMPREHEND,Textract:MSG_TEXTRACT,NoData:MSG_NO_DATA$5},Tooltips:{DownloadFile:TOOLTIP_DOWNLOAD_FILE}}=Localization,COL_TAB$3="col-11";class StatisticsTab extends BaseAnalysisTab{constructor(e){super(TITLE$l,e)}async createWorkflowHistory(e){const t=this.createGrouping(MSG_WORKFLOW_HISTORY);return e.forEach(e=>{const a=this.createTableList();Object.keys(e).filter(t=>"object"!=typeof e[t]&&!Array.isArray(e[t])).forEach(t=>this.appendTableList(a,t,this.readableValue(e,t))),t.append(this.createGrouping(e.type,1).append(a))}),t}async createRekognition(e){const t=this.createGrouping(MSG_REKOGNITION);return Object.keys(e).forEach(async a=>t.append(await this.iterateAndCreateRekognitionItemByType(e[a],a))),t}async iterateAndCreateRekognitionItemByType(e,t){const a=[].concat(e);return Promise.all(a.map(e=>this.createRekognitionByType(e,t)))}async createRekognitionByType(e,t){const a=this.media.getProxyBucket(),s=this.createGrouping(t,1),n=this.createTableList();return s.append(n),["startTime","endTime","id","customLabelModels"].forEach(t=>e[t]&&this.appendTableList(n,t,this.readableValue(e,t))),s.on("click",async()=>{const t=s.prop("open");if(!s.data("rendered")&&!t){const t=await MapData.load(a,e.output),s=t.labels.map(e=>this.createBadge(e).addClass("text-captialize"));this.appendTableList(n,MSG_LABELS,s);const i=e.output.lastIndexOf("/"),o=e.output.substring(i+1),r=e.output.substring(0,i),l=[...t.files,o],d=GetS3Utils(),c=l.map(e=>{const t=`${r}/${e}`,s=this.createBadge(e,"href",t);return s.ready(async()=>{const e=await d.signUrl(a,t);s.attr("href",e)}),s});this.appendTableList(n,MSG_DOWNLOAD_JSON,c)}}),s}async createTranscribe(e){const t=GetS3Utils(),a=this.media.getProxyBucket(),s=this.createTableList(),n=this.createGrouping(MSG_TRANSCRIBE).append(s),i=$("<a/>").addClass("mr-1").attr("href",AWSConsoleTranscribe.getJobLink(e.jobId)).attr("target","_blank").html(e.name);return this.appendTableList(s,MSG_TRANSCRIPTION_JOB,i),["startTime","endTime"].forEach(t=>this.appendTableList(s,t,this.readableValue(e,t))),["output","vtt"].forEach(n=>{if(e[n]){const i=e[n].substring(e[n].lastIndexOf("/")+1,e[n].length),o=this.createBadge(i,"placeholder",TOOLTIP_DOWNLOAD_FILE);o.ready(async()=>{const s=await t.signUrl(a,e[n]);o.attr("href",s)}),this.appendTableList(s,n,o)}}),n}async createComprehend(e){const t=this.createGrouping(MSG_COMPREHEND);return Object.keys(e).forEach(async a=>t.append(await this.createComprehendByType(e[a],a))),t}async createComprehendByType(e,t){const a=GetS3Utils(),s=this.media.getProxyBucket(),n=this.createTableList(),i=this.createGrouping(t,1).append(n);return["startTime","endTime"].forEach(t=>this.appendTableList(n,t,this.readableValue(e,t))),["output","metadata"].forEach(t=>{if(e[t]){const i=e[t].substring(e[t].lastIndexOf("/")+1,e[t].length),o=this.createBadge(i,"placeholder",TOOLTIP_DOWNLOAD_FILE);o.ready(async()=>{const n=await a.signUrl(s,e[t]);o.attr("href",n)}),this.appendTableList(n,t,o)}}),i}async createTextract(e){const t=GetS3Utils(),a=this.media.getProxyBucket(),s=this.createTableList(),n=this.createGrouping(MSG_TEXTRACT).append(s);return["startTime","endTime"].forEach(t=>this.appendTableList(s,t,this.readableValue(e,t))),["output"].forEach(n=>{const i=e[n].substring(e[n].lastIndexOf("/")+1,e[n].length),o=this.createBadge(i,"placeholder",TOOLTIP_DOWNLOAD_FILE);o.ready(async()=>{const s=await t.signUrl(a,e[n]);o.attr("href",s)}),this.appendTableList(s,n,o)}),n}async createContent(){const e=$("<div/>").addClass("col-11 my-4 max-h36r");return setTimeout(async()=>{this.loading(!0);const t=await this.media.getAnalysisResults();return t&&t.length?(e.append(await this.createWorkflowHistory(t)),t.forEach(async t=>{t.type===MediaTypes.Video&&t.rekognition?e.append(await this.createRekognition(t.rekognition)):t.type===MediaTypes.Audio?(t.transcribe&&e.append(await this.createTranscribe(t.transcribe)),t.comprehend&&e.append(await this.createComprehend(t.comprehend))):t.type===MediaTypes.Image?e.append(await this.createRekognition(t["rekog-image"])):t.type===MediaTypes.Document&&e.append(await this.createTextract(t.textract))}),this.loading(!1)):(e.html(MSG_NO_DATA$5),this.loading(!1))},10),e}}const EVENT_DATA_SELECTED="scatter:data:selected",EVENT_LEGEND_CHANGED="scatter:legend:changed";class ScatterGraph extends(mxReadable(class{})){constructor(e){super(),this.$datasets=e.filter(e=>e.data.length>0),this.$labels=this.$datasets.map(e=>e.label),this.$graphContainer=$("<div/>").addClass("scatter-graph").attr("id","scatter-"+AppUtils.randomHexstring());const t=this.makeGraphOptions(this.$datasets),a=echarts.init(this.$graphContainer[0]);this.registerGraphEvents(this.$datasets,a),a.setOption(t),this.$graph=a}static get Events(){return{Data:{Selected:EVENT_DATA_SELECTED},Legend:{Changed:EVENT_LEGEND_CHANGED}}}get graphContainer(){return this.$graphContainer}set graphContainer(e){this.$graphContainer=e}get graph(){return this.$graph}set graph(e){this.$graph=e}get datasets(){return this.$datasets}set datasets(e){this.$datasets=e}get labels(){return this.$labels}get graphId(){return this.graphContainer.prop("id")}getGraphContainer(){return this.graphContainer}makeGraphOptions(e){const t={type:"scroll",orient:"horizontal",data:e.sort((e,t)=>t.appearance-e.appearance).map(e=>({name:e.label})),selected:e.reduce((e,t)=>({...e,[t.label]:!1}),{}),tooltip:{show:!0,trigger:"item",formatter:t=>{const a=e.find(e=>e.label===t.name)||{},s=a.data||[],n=AppUtils.readableDuration((s[0]||{}).x||0,!0),i=AppUtils.readableDuration((s[s.length-1]||{}).x||0,!0);let o="";if(a.duration&&a.appearance){o=`Show rate <strong>${Number(a.appearance/a.duration*100).toFixed(2)}%</strong> (${AppUtils.readableDuration(a.appearance,!0)} of ${AppUtils.readableDuration(a.duration,!0)})`}return s.length?`<span>Total <strong>${s.length}</strong> data points</span><br/>Starting at <strong>${n}</strong><br/>Ended at <strong>${i}</strong><br/>${o}`:`<span>${t.name}</span>`}}},a={type:"time",scale:!1,minInterval:1e3,axisLabel:{formatter:e=>AppUtils.readableDuration(e,!0),rotate:45},splitLine:{show:!0}};let s=10;e[0].duration&&(s=Math.round(Math.min(e[0].duration,6e4)/e[0].duration*100)),s=Math.max(s,10);return{legend:t,grid:{containLabel:!0,show:!0},xAxis:a,yAxis:{type:"value",scale:!0,axisLabel:{formatter:"{value}"},splitLine:{show:!0},min:0,interval:1},dataZoom:[{type:"slider",show:!0,xAxisIndex:[0],start:0,end:s,minValueSpan:2e3,labelFormatter:e=>AppUtils.readableDuration(e,!0)}],tooltip:{show:!0,trigger:"item",formatter:e=>`<span style="color:${e.color}">${e.seriesName}</span> (x${e.data[1]})<br/>at ${AppUtils.readableDuration(e.data[0],!0)}`},series:e.map(e=>({name:e.label,type:"scatter",large:!0,largeThreshold:5e3,data:e.data.map(e=>[e.x,e.y])}))}}destroy(){this.graph&&this.graph.dispose(),this.graph=void 0,this.graphContainer&&this.graphContainer.remove(),this.graphContainer=void 0,this.datasets&&(this.datasets.length=0)}onDataPointClickEvent(e,t){if("series"!==t.componentType)return;const a={...e[t.seriesIndex].data[t.dataIndex],color:t.color,label:t.seriesName,desc:e[t.seriesIndex].desc};return this.graphContainer.trigger(ScatterGraph.Events.Data.Selected,[a])}onLegendSelectChangedEvent(e,t){const a=e.find(e=>e.label===t.name),s=[{name:t.name,enabled:t.selected[t.name],basename:(a||{}).basename}];return this.graphContainer.trigger(ScatterGraph.Events.Legend.Changed,[s])}onInverseLegendsEvent(e,t){const a=[];return e.forEach((e,s)=>{void 0!==t.selected[e.label]&&a.push({name:e.label,enabled:t.selected[e.label],basename:e.basename})}),this.graphContainer.trigger(ScatterGraph.Events.Legend.Changed,[a])}onRenderedEvent(e){e.getWidth()<=0||e.getHeight()<=0?setTimeout(()=>e.resize(),200):e.off("rendered")}resize(){return this.graph.resize()}on(e,t){return this.graphContainer.on(e,t)}off(e){return this.graphContainer.off(e)}async toggleAllLegends(e){return this.graph.dispatchAction({type:"legendInverseSelect"})}registerGraphEvents(e,t){const a=this.onRenderedEvent.bind(this,t);t.off("rendered").on("rendered",async()=>a());const s=this.onDataPointClickEvent.bind(this,e);t.off("click").on("click",async e=>s(e));const n=this.onLegendSelectChangedEvent.bind(this,e);t.off("legendselectchanged").on("legendselectchanged",async e=>n(e));const i=this.onInverseLegendsEvent.bind(this,e);t.off("legendinverseselect").on("legendinverseselect",async e=>i(e))}updateLegends(e){const t=this.datasets,a=this.graph.getOption(),s=[];for(let n=0;n<a.legend.length;n+=1){const i=a.legend[n],o=Object.keys(i.selected);for(;o.length;){const e=o.shift();if(!0===i.selected[e]){const a=t.find(t=>t.label===e);a&&s.push({name:a.label,enabled:!1,basename:a.basename}),i.selected[e]=!1}}this.graph.setOption({legend:{data:e,selected:i.selected}})}s.length>0&&this.graphContainer.trigger(ScatterGraph.Events.Legend.Changed,[s])}getLegendsState(){if(this.graph){const e=this.graph.getOption().legend[0];if(e)return Object.keys(e.selected||{}).map(t=>({name:t,enabled:e.selected[t],basename:t.toLowerCase().replace(/\s/g,"_").replace(/\//g,"-")}))}return[]}}const{Messages:{CelebTab:CELEB_TAB,LabelTab:LABEL_TAB,FaceTab:FACE_TAB,FaceMatchTab:FACEMATCH_TAB,ModerationTab:MODERATION_TAB,PersonTab:PERSON_TAB,TextTab:TEXT_TAB,SegmentTab:SEGMENT_TAB,CustomLabelTab:CUSTOMLABEL_TAB}}=Localization,{Rekognition:{Celeb:Celeb$4,Label:Label$4,Face:Face$1,FaceMatch:FaceMatch$4,Moderation:Moderation$4,Person:Person$1,Text:Text$3,Segment:Segment$1,CustomLabel:CustomLabel$4}}=AnalysisTypes;class BaseRekognitionImageTab extends BaseAnalysisTab{constructor(e,t,a){let s="Unknown";e===Celeb$4?s=CELEB_TAB:e===Label$4?s=LABEL_TAB:e===Face$1?s=FACE_TAB:e===FaceMatch$4?s=FACEMATCH_TAB:e===Moderation$4?s=MODERATION_TAB:e===Person$1?s=PERSON_TAB:e===Text$3?s=TEXT_TAB:e===Segment$1?s=SEGMENT_TAB:e===CustomLabel$4&&(s=CUSTOMLABEL_TAB),super(s,t),this.$category=e,this.$data=a}get category(){return this.$category}get data(){return this.$data}async createContent(){const e=$("<div/>").addClass("col-9 my-4 max-h36r"),t=this.createCanvasButtons(this.category);if(!t.length)return super.createContent();const a=this.createEnableAll(t);return e.append(a),t.forEach(t=>e.append(t)),e}createCanvasButtons(e){return this.previewComponent.getCanvasesByType(e).map(e=>{const t=$("<button/>").addClass("btn btn-sm btn-primary text-capitalize mb-1 ml-1").attr("type","button").attr("data-toggle","button").attr("aria-pressed",!1).attr("autocomplete","off").attr("data-canvas-id",e.id).attr("data-placement","bottom").attr("title",`${Localization.Tooltips.Confidence}: ${e.confidence}%`).append(e.name).tooltip({trigger:"hover"});return t.off("click").on("click",async a=>{t.tooltip("hide");const s="false"===t.attr("aria-pressed");return this.previewComponent.canvasToggle(e.id,s)}),t})}}const{Messages:{SearchSpecificLabel:MSG_SEARCH_SPECIFIC_LABEL,ToggleAll:MSG_TOGGLE_ALL,ToggleTextOverlay:MSG_TEXT_OVERLAY,NoData:MSG_NO_DATA$4,ScatterGraphDesc:MSG_SCATTERGRAPH_DESC},Tooltips:{ToggleAll:TOOLTIP_ALL_LABELS,ToggleTextOverlay:TOOLTIP_TEXT_OVERLAY}}=Localization;class BaseRekognitionTab extends BaseRekognitionImageTab{constructor(e,t,a){super(e,t,a),this.$scatterGraph=void 0,this.$datasetStore=GetDatasetStore(),this.$mapData=void 0,this.onRender(this.tabContent)}get scatterGraph(){return this.$scatterGraph}set scatterGraph(e){this.$scatterGraph&&this.$scatterGraph.destroy(),this.$scatterGraph=e}get datasetStore(){return this.$datasetStore}get mapData(){return this.$mapData}set mapData(e){this.$mapData=e}get trackBasenames(){return(this.mapData||{}).basenames||[]}get canPreloadContent(){return!0}get canRenderVtt(){return!0}async createContent(){let e=this.tabContent.find(".rekog-tab");return e.length>0||(e=this.loadContent()),e}async delayContentLoad(e){this.loading(!0);const t=await this.createScatterGraph(this.category);if(t){const a=$("<p/>").addClass("lead-sm").append(MSG_SCATTERGRAPH_DESC);e.append(a);const s=this.createToggleAll();e.append(s),e.append(t)}else e.html(MSG_NO_DATA$4);this.loading(!1)}async registerVttTracks(e){const t=this.data||{};if(t.vtt){if(/json$/.test(t.vtt)){const a=this.media.getProxyBucket();return this.registerVttTracksFromJson(e,a,t.vtt)}if(this.trackBasenames.length)return this.trackBasenames.map(e=>this.previewComponent.trackRegister(e,`${t.vtt}${e}.vtt`))}}unregisterVttTracks(){this.scatterGraph.datasets.map(e=>e.basename).forEach(e=>{this.previewComponent.trackToggle(e,!1),this.previewComponent.trackUnregister(e)})}async createTrackButtons(e,t){const a=this.data||{};if(a.vtt){if(/json$/.test(a.vtt)){const s=this.media.getProxyBucket();return this.createTrackButtonsFromJson(e,t,s,a.vtt)}if(this.trackBasenames.length)return this.trackBasenames.map(e=>(this.previewComponent.trackRegister(e,`${a.vtt}${e}.vtt`),this.createButton(e,t)))}}async createScatterGraph(e,t){const a=this.data||{};if(!a.timeseries)return;let s;if(this.mapData&&this.mapData.version>0)s=await this.downloadAllMergedDataset(a.timeseries);else{if(!this.trackBasenames.length)return;s=await this.downloadDatasets(a.timeseries,this.trackBasenames)}if(!s||!s.length)return;this.scatterGraph=new ScatterGraph(s),this.scatterGraph.on(ScatterGraph.Events.Data.Selected,async(e,t)=>this.onDataPointSelected(t)),this.scatterGraph.on(ScatterGraph.Events.Legend.Changed,async(e,t)=>this.onLegendChanged(t));return $("<div/>").addClass("col-12").addClass("p-0 m-4 mx-auto").append(this.scatterGraph.getGraphContainer())}async downloadAllMergedDataset(e){let t=await this.datasetStore.getItem(e).catch(()=>{});return t&&t[0]&&void 0!==t[0].duration||(t=await this.download(e).catch(t=>{console.log("ERR:","fail to download rekognition dataset",e,t.message)}),t&&(t=await t.Body.transformToString().then(e=>Object.values(JSON.parse(e)).map(e=>({...e,basename:e.label.toLowerCase().replace(/\s/g,"_").replace(/\//g,"-")}))),await this.datasetStore.putItem(e,t).catch(()=>{}))),t}async downloadDatasets(e,t){let a=await this.datasetStore.getItem(e).catch(()=>{});if(a&&void 0!==a[0].duration)return a;let s=await Promise.all(t.map(t=>{const a=`${e}${t}.json`;return this.download(a).catch(e=>{console.log("ERR:","fail to download rekognition dataset",a,e.message)})}));s=s.filter(e=>void 0!==e),s=await Promise.all(s.map(e=>e.Body.transformToString().then(e=>JSON.parse(e)))),a=[];for(let e=0;e<s.length;e++)void 0!==s[e]&&a.push({...s[e],basename:t[e]});return await this.datasetStore.putItem(e,a).catch(()=>{}),a}async selectAll(){return await Promise.all(this.scatterGraph.datasets.map(e=>this.previewComponent.trackToggle(e.basename,!0))),this.scatterGraph.selectAllDataset()}async deselectAll(){return await Promise.all(this.scatterGraph.datasets.map(e=>this.previewComponent.trackToggle(e.basename,!1))),this.scatterGraph.deselectAllDataset()}async select(e){const t=(this.scatterGraph.findDataset(e)||{}).basename;return t&&await this.previewComponent.trackToggle(t,!0),this.scatterGraph.selectDataset(e)}async deselect(e){const t=(this.scatterGraph.findDataset(e)||{}).basename;return t&&await this.previewComponent.trackToggle(t,!1),this.scatterGraph.deselectDataset(e)}async onDataPointSelected(e){this.previewComponent.pause(),this.previewComponent.seek(e.x/1e3);const t=this.previewComponent.getContainerDimensions(),a=this.previewComponent.getCanvasView();a.children().remove();const s=$("<div/>").addClass("lead-sm").css("position","absolute").css("top","1rem").css("left","1rem");for(let n=0;n<e.details.length;n++){const i=this.createBadges(e,n);let[o,r,l,d]=this.computeCoordinate(e.details[n],t.width,t.height);if(void 0!==o){let c=this.createCanvas(o,r,l,d,e.color);a.append(c),e.details[n].xy&&([o,r,l,d]=this.computeCoordinate(e.details[n].xy,t.width,t.height),c=this.createCanvas(o,r,l,d,e.color),a.append(c));const p=i.map(e=>e.prop("outerHTML"));c.hover(()=>s.html(p).removeClass("collapse"),()=>s.html(p).addClass("collapse"))}else s.append(i)}a.append(s)}async onLegendChanged(e){return this.previewComponent.getCanvasView().children().remove(),e.filter(e=>e.basename).map(e=>this.previewComponent.trackToggle(e.basename,e.enabled))}computeCoordinate(e,t,a){return void 0===e.w?[]:[Math.min(Math.round(e.w*t),t),Math.min(Math.round(e.h*a),a),Math.max(Math.round(e.l*t),0),Math.max(Math.round(e.t*a),0)]}createCanvas(e,t,a,s,n){return $("<canvas/>").addClass("canvas-item").attr("width",e).attr("height",t).css("left",a).css("top",s).css("background-color",n+"4C").css("border-color",n)}createBadges(e,t,a){const s=[],n=e.details[t].c||(e.details[t].xy||{}).c||"--";let i=`${e.label} (${n}%)`;return a&&(i=`${a} ${i}`),s.push(this.createBadge(i)),e.desc&&e.desc.split(";").forEach(e=>s.push(this.createBadge(e))),e.details[t].desc&&e.details[t].desc.split(";").forEach(e=>s.push(this.createBadge(e,"badge-dark"))),s}createBadge(e,t="badge-success"){return $("<span/>").addClass("badge badge-pill lead-xs mb-1").addClass(t).css("display","block").html(e)}async hide(){return this.scatterGraph&&this.scatterGraph.destroy(),this.scatterGraph=void 0,super.hide()}createToggleAll(){const e=$("<div/>").addClass("form-group px-0 mt-2 mb-2"),t=$("<div/>").addClass("input-group");e.append(t);const a=this.createAllLabelToggle();t.append(a);const s=a[0].find("input").first(),n=this.createTextOverlayToggle();t.append(n);const i=$("<div/>").addClass("dropdown col-3 p-0 ml-auto");t.append(i);const o="dropdown-"+AppUtils.randomHexstring(),r=$("<input/>").addClass("form-control form-control-sm").attr("type","text").attr("id",o).attr("autocomplete","off").attr("data-toggle","dropdown").attr("aria-haspopup",!0).attr("aria-expanded",!1).attr("placeholder",MSG_SEARCH_SPECIFIC_LABEL);i.append(r);const l=$("<div/>").addClass("dropdown-menu col-12 lead-xs").attr("aria-labelledby",o);i.append(l);const d=this.scatterGraph.labels.map(e=>this.createDropdownItem(e,i,r,s));l.append(d),r.on("keyup",()=>{const e=r.val();let t=this.scatterGraph.labels;if(e.length>0){const a=new RegExp(e,"gi");t=this.scatterGraph.labels.filter(e=>e.match(a))}t=t.map(e=>this.createDropdownItem(e,i,r,s)),l.children().remove(),l.append(t),i.dropdown("show")});const c=$("<button/>").addClass("btn btn-sm btn-secondary").append($("<i/>").addClass("far fa-times-circle"));return t.append(c),c.on("click",e=>{e.preventDefault(),e.stopPropagation();if(r.val().length>0){r.val("");let e=this.scatterGraph.datasets.map(e=>e.label);this.scatterGraph.updateLegends(e),e=e.map(e=>this.createDropdownItem(e,i,r,s)),l.children().remove(),l.append(e),i.dropdown("hide"),s.prop("checked",!1)}}),e}createAllLabelToggle(){const e=$("<label/>").addClass("xs-switch"),t=$("<input/>").attr("type","checkbox");e.append(t);const a=$("<span/>").addClass("xs-slider round");e.append(a);const s=$("<span/>").addClass("lead ml-2").append(MSG_TOGGLE_ALL).attr("data-toggle","tooltip").attr("data-placement","bottom").attr("title",TOOLTIP_ALL_LABELS).tooltip({trigger:"hover"});return t.on("click",async e=>this.scatterGraph.toggleAllLegends(t.prop("checked"))),[e,s]}createTextOverlayToggle(){if(!this.canRenderVtt)return;const e=$("<label/>").addClass("xs-switch ml-4"),t=$("<input/>").attr("type","checkbox");e.append(t);const a=$("<span/>").addClass("xs-slider round");e.append(a);const s=$("<span/>").addClass("lead ml-2").append(MSG_TEXT_OVERLAY).attr("data-toggle","tooltip").attr("data-placement","bottom").attr("title",TOOLTIP_TEXT_OVERLAY).tooltip({trigger:"hover"});return t.on("click",async e=>{if(t.prop("checked")){await this.registerVttTracks(this.category);this.scatterGraph.getLegendsState().forEach(e=>{e.enabled&&this.previewComponent.trackToggle(e.basename,!0)})}else this.unregisterVttTracks()}),[e,s]}createDropdownItem(e,t,a,s){const n=$("<a/>").addClass("dropdown-item").attr("href","#").attr("data-value",e).append(e);return n.on("click",async e=>{e.preventDefault(),e.stopPropagation();const i=n.data("value");a.val(i),t.dropdown("hide");const o=this.scatterGraph.datasets.filter(e=>e.label===i).map(e=>e.label);this.scatterGraph.updateLegends(o),s.prop("checked",!1)}),n}onRender(e){e.ready(async()=>{console.log("BaseRekognitionTab.onReady");const t=this.media.getProxyBucket(),a=this.data.output;/json$/.test(a)&&(this.mapData=await MapData.loadFromKey(t,a)),this.canPreloadContent&&this.loadContent(e)})}loadContent(e){const t=$("<div/>").addClass("col-9 my-4 max-h36r").addClass("rekog-tab");return t.ready(async()=>{await this.delayContentLoad(t)}),e&&e.append(t),t}async registerVttTracksFromJson(e,t,a){let s=await this.datasetStore.getItem(a).catch(()=>{});if(void 0===s){const e=GetS3Utils();s=await e.getObject(t,a).catch(e=>{console.error("ERR:","fail to download",a)}),s&&(s=await s.Body.transformToString().then(e=>JSON.parse(e)),await this.datasetStore.putItem(a,s).catch(()=>{}))}return Object.keys(s||{}).map(e=>{const t=new Blob([s[e]],{type:"text/vtt"}),a=e.toLowerCase().replace(/\s/g,"_").replace(/\//g,"-");return this.previewComponent.trackRegister(a,URL.createObjectURL(t))})}async createTrackButtonsFromJson(e,t,a,s){const n=GetS3Utils();let i=await n.getObject(a,s).catch(e=>{console.error("ERR:","fail to download",s)});return i&&(i=await i.Body.transformToString().then(e=>JSON.parse(e))),Object.keys(i||{}).map(e=>{const a=new Blob([i[e]],{type:"text/vtt"});return this.previewComponent.trackRegister(e,URL.createObjectURL(a)),this.createButton(e,t)})}}class CelebTab extends BaseRekognitionTab{constructor(e,t){super(AnalysisTypes.Rekognition.Celeb,e,t)}}class LabelTab extends BaseRekognitionTab{constructor(e,t){super(AnalysisTypes.Rekognition.Label,e,t)}}class FaceMatchTab extends BaseRekognitionTab{constructor(e,t){super(AnalysisTypes.Rekognition.FaceMatch,e,t)}}class FaceTab extends BaseRekognitionTab{constructor(e,t){super(AnalysisTypes.Rekognition.Face,e,t)}}class ModerationTab extends BaseRekognitionTab{constructor(e,t){super(AnalysisTypes.Rekognition.Moderation,e,t)}}const NAMED_PREFIX="Person";class PersonTab extends BaseRekognitionTab{constructor(e,t){super(AnalysisTypes.Rekognition.Person,e,t)}get canPreloadContent(){return!1}get canRenderVtt(){return!1}createBadges(e,t,a){return super.createBadges(e,t,"Person")}}const DEFAULT_OUTPUT="00000000.json";class SegmentTab extends BaseRekognitionTab{constructor(e,t){super(AnalysisTypes.Rekognition.Segment,e,t)}async createContent(){const e=await this.createButtonList(),t=$("<div/>").addClass("col-12 m-0 p-0 my-4"),a=await this.createEDLButton();if(a){const e=$("<p/>").addClass("lead-sm").append(Localization.Messages.DownloadEDLDesc);t.append(e).append(a)}return $("<div/>").addClass("col-9 m-0 p-0 max-h36r").append(e).append(t)}async createButtonList(){const e=$("<div/>").addClass("col-12 m-0 p-0 my-4"),t=await this.createTrackButtons(this.category);if(!(t||[]).length)return e.html(Localization.Messages.NoData);const a=this.createEnableAll(t);return e.append(a),t.forEach(t=>e.append(t)),e}async createEDLButton(){const e=(this.data||{}).edl;if(!e)return;const t=this.media.getProxyBucket();let a=AnalysisTypes.Rekognition.Segment+".zip",s=`${e}${a}`;/zip$/.test(e)&&(a=e.substring(e.lastIndexOf("/")+1),s=e);const n=await this.media.getUrl(t,s);return $("<a/>").addClass("btn btn-sm btn-success text-capitalize mb-1 ml-1").attr("href",n).attr("target","_blank").attr("download",`${this.media.basename}-${a}`).attr("role","button").append(Localization.Buttons.DownloadEDL)}onRender(e){e.ready(async()=>{console.log("SegmentTab.onReady");const e=this.media.getProxyBucket(),t=this.data.output;/json$/.test(t)?this.mapData=await MapData.loadFromKey(e,t):(this.mapData=await MapData.loadFromPrefix(e,this.data.vtt),this.mapData.files=[DEFAULT_OUTPUT])})}}class TextTab extends BaseRekognitionTab{constructor(e,t){super(AnalysisTypes.Rekognition.Text,e,t)}get canPreloadContent(){return!1}get canRenderVtt(){return!1}}const{Messages:{ImageCaptionTab:TITLE$k,ImageCaptionDesc:DESCRIPTION$1,NoData:MSG_NO_DATA$3}}=Localization;class ImageCaptionTab extends BaseAnalysisTab{constructor(e){super(TITLE$k,e)}async createContent(){const e=$("<div/>").addClass("col-9 my-4 max-h36r"),t=this.previewComponent.media.getImageAutoCaptioning()||MSG_NO_DATA$3,a=$("<p/>").addClass("lead-sm font-italic").append(DESCRIPTION$1);e.append(a);const s=$("<p/>").addClass("lead").append(t);return e.append(s),e}}class CelebImageTab extends BaseRekognitionImageTab{constructor(e,t){super(AnalysisTypes.Rekognition.Celeb,e,t)}}class LabelImageTab extends BaseRekognitionImageTab{constructor(e,t){super(AnalysisTypes.Rekognition.Label,e,t)}}class FaceMatchImageTab extends BaseRekognitionImageTab{constructor(e,t){super(AnalysisTypes.Rekognition.FaceMatch,e,t)}}class FaceImageTab extends BaseRekognitionImageTab{constructor(e,t){super(AnalysisTypes.Rekognition.Face,e,t)}}class ModerationImageTab extends BaseRekognitionImageTab{constructor(e,t){super(AnalysisTypes.Rekognition.Moderation,e,t)}}class TextImageTab extends BaseRekognitionImageTab{constructor(e,t){super(AnalysisTypes.Rekognition.Text,e,t)}}const{Messages:{TranscribeTab:TITLE$j}}=Localization;class TranscribeTab extends BaseAnalysisTab{constructor(e){super(TITLE$j,e)}async createContent(){const e=$("<div/>").addClass("col-9 my-4 max-h36r"),t=this.previewComponent.trackIsEnabled(VideoPreview.Constants.Subtitle),a=$("<input/>").attr("type","checkbox").attr("data-category","transcribe").attr("data-type","subtitle").attr("checked",t);a.off("click").on("click",async e=>{const t=a.prop("checked");await this.previewComponent.trackToggle(VideoPreview.Constants.Subtitle,t)});const s=$("<div/>").addClass("form-group px-0 mt-2 mb-42").append($("<div/>").addClass("input-group").append($("<label/>").addClass("xs-switch").append(a).append($("<span/>").addClass("xs-slider round"))).append($("<span/>").addClass("lead ml-2").html(Localization.Messages.SubtitleSwitch))),n=this.previewComponent.getSubtitleView();return n.on(VideoPreview.Events.Track.Loaded,(e,t)=>{}),e.append(s).append(n)}}class BaseComprehendTab extends BaseAnalysisTab{async createTimelineButtons(e){const t=this.media.getComprehendResults();if(!(t[e]||{}).metadata)return[];const a=await this.download(t[e].metadata).catch(a=>{console.log("ERR:","fail to download comprehend metadata",t[e].metadata,a.message)});if(!a)return[];const s=await a.Body.transformToString().then(e=>JSON.parse(e)),n=s[0].type?{}:void 0,i=[];for(;s.length;){const e=s.shift(),t=this.createButton(e);n?(n[e.type]=n[e.type]||[],n[e.type].push(t)):i.push(t)}return i.length>0||Object.keys(n).forEach(e=>{i.push(this.createCategory(e,n[e].length)),i.splice(i.length,0,...n[e])}),i}createButton(e){const t=`${e.text} (${Number.parseFloat(e.confidence).toFixed(2)})`,a=`${e.begin?BaseComprehendTab.readableDuration(e.begin):"--"} / ${e.end?BaseComprehendTab.readableDuration(e.end):"--"}`,s=$("<button/>").addClass("btn btn-sm btn-primary mb-1 ml-1").attr("type","button").attr("data-toggle","button").attr("aria-pressed",!1).attr("autocomplete","off").attr("data-mark-in",e.begin).attr("data-mark-out",e.end).attr("data-toggle","tooltip").attr("data-placement","bottom").attr("title",a).append(t).tooltip({trigger:"hover"});return s.off("click").on("click",async t=>{await this.previewComponent.seek(e.begin/1e3)}),s}createCategory(e,t){return $("<span/>").addClass("lead d-block p-0 mt-2 mb-2 ml-1 text-capitalize").append(`${e} (${t})`)}}const{Messages:{KeyphraseTab:TITLE$i}}=Localization;class KeyphraseTab extends BaseComprehendTab{constructor(e){super(TITLE$i,e)}async createContent(){const e=$("<div/>").addClass("col-9 my-4 max-h36r"),t=await this.createTimelineButtons(AnalysisTypes.Comprehend.Keyphrase);return(t||[]).length?(t.forEach(t=>e.append(t)),e):super.createContent()}}const{Messages:{EntityTab:TITLE$h}}=Localization;class EntityTab extends BaseComprehendTab{constructor(e){super(TITLE$h,e)}async createTimelineButtons(e){const t=await super.createTimelineButtons(e),a=await super.createTimelineButtons(AnalysisTypes.Comprehend.CustomEntity);return t.concat(a)}async createContent(){const e=$("<div/>").addClass("col-9 my-4 max-h36r"),t=await this.createTimelineButtons(AnalysisTypes.Comprehend.Entity);return(t||[]).length?(t.forEach(t=>e.append(t)),e):super.createContent()}}const{Messages:{SentimentTab:TITLE$g}}=Localization;class SentimentTab extends BaseComprehendTab{constructor(e){super(TITLE$g,e)}async createContent(){const e=$("<div/>").addClass("col-9 my-4 max-h36r"),t=await this.createTimelineButtons(AnalysisTypes.Comprehend.Sentiment);return(t||[]).length?(t.forEach(t=>e.append(t)),e):super.createContent()}}const{Messages:{TextractTab:TITLE$f}}=Localization;class TextractTab extends BaseAnalysisTab{constructor(e){super(TITLE$f,e)}async createContent(){const e=$("<div/>").addClass("col-12 my-4 max-h36r"),t=this.previewComponent.getPageControlContainer();return t?e.append(t):super.createContent()}}class CustomLabelTab extends BaseRekognitionTab{constructor(e,t){super(AnalysisTypes.Rekognition.CustomLabel,e,t),this.title=`${this.title} (${t.customLabelModels.substring(0,6)}...)`}}const{Messages:{SearchResultTab:TITLE$e,SearchResultDesc:MSG_SEARCH_RESULT_DESC$1,KnownFaces:MSG_KNOWN_FACES,LabelsModeration:MSG_LABEL_MODERATION,TranscriptPhrasesEntities:MSG_TRANSCRIPT_PHRASE_ENTITIES,VisualText:MSG_VISUAL_TEXT,ContentAttributes:MSG_CONTENT_ATTRIBUTES,NoData:MSG_NO_DATA$2,Category:MSG_CATEGORY}}=Localization,COL_TAB$2="col-11",{Rekognition:{Celeb:Celeb$3,FaceMatch:FaceMatch$3,Label:Label$3,CustomLabel:CustomLabel$3,Moderation:Moderation$3,Text:Text$2},Comprehend:{Keyphrase:Keyphrase$3,Entity:Entity$3,CustomEntity:CustomEntity$2},Transcribe:Transcribe$1,Textract:Textract$1}=AnalysisTypes,ANALYSIS_FIELDS$1=[Celeb$3,FaceMatch$3,Label$3,CustomLabel$3,Moderation$3,Text$2,Textract$1,Transcribe$1,Keyphrase$3,Entity$3,CustomEntity$2];class SearchResultTab extends BaseAnalysisTab{constructor(e){super(TITLE$e,e)}async createContent(){const e=$("<div/>").addClass("col-11").addClass("my-4 max-h36r");return e.ready(async()=>(this.loading(!0),await this.refreshSearchResults(e),this.loading(!1))),e}async refreshSearchResults(e){e.children().remove();const t=(this.previewComponent.searchResults||{}).fields||{};if(0===t.length){const t=$("<span/>").addClass("lead").append(MSG_NO_DATA$2);return e.append(t),e}const a=$("<table/>").addClass("table lead-xs");e.append(a);const s=[MSG_CATEGORY,MSG_SEARCH_RESULT_DESC$1].map(e=>$("<th/>").addClass("align-middle text-left b-300").attr("scope","col").append(e));s[0].addClass("col-2"),a.append($("<thead/>").append($("<tr/>").append(s)));const n=$("<tbody/>");a.append(n);const i=this.makeTableRowItem([Celeb$3,FaceMatch$3],t,MSG_KNOWN_FACES);n.append(i);const o=this.makeTableRowItem([AnalysisTypes.Rekognition.Label,AnalysisTypes.Rekognition.CustomLabel,AnalysisTypes.Rekognition.Moderation],t,MSG_LABEL_MODERATION);n.append(o);const r=this.makeTableRowItemSpeechText([AnalysisTypes.Transcribe,AnalysisTypes.Comprehend.Keyphrase,AnalysisTypes.Comprehend.Entity,AnalysisTypes.Comprehend.CustomEntity],t,MSG_TRANSCRIPT_PHRASE_ENTITIES);n.append(r);const l=this.makeTableRowItem([Text$2],t,MSG_VISUAL_TEXT);n.append(l);const d=this.makeTableRowItemTextract(t[Textract$1],MSG_VISUAL_TEXT);n.append(d);const c=Object.keys(t).filter(e=>!ANALYSIS_FIELDS$1.includes(e));if(c.length>0){const e=this.makeTableRowItemContentMetadata(c,t,MSG_CONTENT_ATTRIBUTES);n.append(e)}return e}makeTableRowItem(e,t,a){const s=this.mergeResults(e,t);if(!s.results.length)return;if(!s.timecodeBased)return this.makeTableRowItemNoTimecode(s,a);const n=s.results.map(e=>{const t=$("<section/>").addClass("mb-2"),a=this.makeTrackToggle(e),s=e.timecodes.map(e=>this.makeTimecodeBtn(e));return t.append(a).append(s)});return $("<tr/>").append($("<td/>").addClass("h-100 align-center text-left lead-s").append(a)).append($("<td/>").addClass("h-100 align-middle text-left").append(n))}makeTrackToggle(e){const t="toggle-"+AppUtils.randomHexstring(),a=$("<input/>").addClass("custom-control-input").attr("type","checkbox").attr("id",t).data("registered",!1),s=$("<label/>").addClass("custom-control-label lead-xs b-300").attr("for",t).append(e.name),n=$("<div/>").addClass("custom-control custom-switch mr-2 mb-2").append(a).append(s);return a.off("click").on("click",async()=>{const t=a.prop("checked");!a.data("registered")&&t&&this.registerTimecodeTrack(e),this.previewComponent.trackToggle(e.name,t)}),n}registerTimecodeTrack(e){const t=e.timecodes.map(t=>{const a=new window.vttjs.VTTCue(t.begin/1e3,t.end/1e3,e.name);return a.line=0,a.position=100,a.align="start",a.size=50,a});return this.previewComponent.createTrackFromCues(e.name,t)}makeTimecodeBtn(e){const t=AppUtils.readableDuration(e.begin,!0),a=`${t} / ${AppUtils.readableDuration(e.end,!0)}`,s=$("<button/>").addClass("btn btn-sm btn-primary mb-1 ml-1").attr("type","button").attr("data-toggle","button").attr("aria-pressed",!1).attr("autocomplete","off").attr("data-toggle","tooltip").attr("data-placement","bottom").attr("title",a).append(t).tooltip({trigger:"hover"});return s.off("click").on("click",async t=>{t.stopPropagation(),await this.previewComponent.seek(e.begin/1e3)}),s}mergeResults(e,t){const a={};let s=!1;return e.forEach(e=>{const n=(t[e]||{}).hits;void 0!==n&&0!==n.length&&(n[0].timecodes&&(s=!0),n.forEach(e=>{void 0===a[e.name]&&(a[e.name]={},s&&(a[e.name].timecodes=[])),void 0!==e.timecodes&&(a[e.name].timecodes=a[e.name].timecodes.concat(e.timecodes))}))}),{timecodeBased:s,results:Object.keys(a).map(e=>({name:e,timecodes:this.mergeTimecodes(a[e].timecodes)}))}}mergeTimecodes(e){if(!e||0===e.length)return;const t=e.map(e=>({begin:1e3*Math.round(e.begin/1e3),end:1e3*Math.round(e.end/1e3)})).sort((e,t)=>e.begin-t.begin),a=[];for(a.push(t.shift());t.length;){const e=a[a.length-1],s=t.shift();e.begin!==s.begin?s.begin>e.begin&&s.begin<e.end?e.end=Math.max(s.end,e.end):s.begin!==e.end?a.push(s):e.end=Math.max(s.end,e.end):s.end>e.end&&(e.end=s.end)}return a}makeTableRowItemNoTimecode(e,t){const a=e.results.map(e=>{const t="tag-"+AppUtils.randomHexstring(),a=$("<button/>").addClass("btn btn-sm btn-primary text-capitalize mb-1 ml-1").attr("type","button").attr("data-toggle","button").attr("data-tag",t).attr("aria-pressed",!1).attr("autocomplete","off").append(e.name);return a.off("click").on("click",async s=>{const n="false"===a.attr("aria-pressed"),i=this.previewComponent.getView();if(i){const a=i.parent();let s=a.children("div.search-layer");s.length||(s=$("<div/>").addClass("search-layer"),a.append(s)),n?s.append($("<span/>").addClass("badge badge-pill badge-secondary mr-1 mb-1 lead-xxs p-2 d-block").attr("data-tag",t).append(e.name)):(s.children(`[data-tag="${t}"]`).remove(),s.children().length||s.remove())}return!0}),a});return $("<tr/>").append($("<td/>").addClass("h-100 align-center text-left lead-s").append(t)).append($("<td/>").addClass("h-100 align-middle text-left").append(a))}makeTableRowItemSpeechText(e,t,a){const s=this.mergeResults(e,t);if(!s.results.length)return;if(!s.timecodeBased)return this.makeTableRowItemNoTimecode(s,a);const n=s.results.map(e=>e.timecodes.map(t=>{const a=this.makeTimecodeBtn(t),s=AppUtils.readableDuration(t.begin,!0);return a.html(`${e.name} (${s})`)})).flat();return $("<tr/>").append($("<td/>").addClass("h-100 align-center text-left lead-s").append(a)).append($("<td/>").addClass("h-100 align-middle text-left").append(n))}makeTableRowItemContentMetadata(e,t,a){const s=$("<tr/>"),n=$("<td/>").addClass("h-100 align-center text-left lead-s").append(a);s.append(n);const i=$("<td/>").addClass("h-100 align-middle text-left");s.append(i);const o=$("<table/>").addClass("lead-xs").attr("cellspacing",0).attr("cellpadding",0);i.append(o);const r=$("<tbody/>");return o.append(r),e.forEach(e=>{if(((t[e]||{}).hits||[]).length>0)if("string"==typeof t[e].hits[0]){const a=$("<tr/>");r.append(a);const s=$("<td/>").addClass("h-100 align-center text-left b-300 no-border").append(e);a.append(s);const n=$("<td/>").addClass("h-100 align-middle text-left no-border").append(t[e].hits.join(", "));a.append(n)}else if("object"==typeof t[e].hits[0]){const a=t[e].hits.reduce((e,t)=>({...e,...t}),{});Object.keys(a).forEach(t=>{const s=$("<tr/>");r.append(s);const n=$("<td/>").addClass("h-100 align-center text-left b-300 no-border").append(`${e}.${t}`);s.append(n);const i=$("<td/>").addClass("h-100 align-middle text-left no-border").append(a[t]);s.append(i)})}}),s}makeTableRowItemTextract(e,t){if(!e||!e.hits||0===e.hits.length)return;const a=e.hits;a.length>1&&a.sort((e,t)=>e.page-t.page);const s=$("<tr/>"),n=$("<td/>").addClass("h-100 align-center text-left lead-s").append(t);s.append(n);const i=$("<td/>").addClass("h-100 align-middle text-left");s.append(i);const o=a.map(e=>{const t=e.page,a=`${e.name} (Pg. ${t})`,s=$("<button/>").addClass("btn btn-sm btn-primary mb-1 ml-1").attr("type","button").attr("data-toggle","button").attr("aria-pressed",!1).attr("autocomplete","off").append(a).tooltip({trigger:"hover"});return s.on("click",async e=>{e.stopPropagation(),await this.previewComponent.slideTo(t)}),s});return i.append(o),s}}const ServiceNames={Rekognition:"rekognition",Transcribe:"transcribe",Comprehend:"comprehend",Textract:"textract"},REGION$1=SolutionManifest.Region,SERVICE_AVAILABILITY="service-availability",EXPIRATION_IN_DAYS=6048e5,ALL_SERVICES=Object.values(ServiceNames),WHILTELIST_REGIONS=["us-east-1","us-east-2","us-west-1","us-west-2","ap-south-1","ap-northeast-1","ap-northeast-2","ap-southeast-1","ap-southeast-2","ca-central-1","eu-central-1","eu-west-1","eu-west-2"],HTTP_TIMEOUT=1500;let _singleton$1;class ServiceAvailability{constructor(){_singleton$1=this}async detectServices(e=REGION$1){const t="service-availability-"+e,a=GetSettingStore();let s=await a.getItem(t);if(!s){s=(await Promise.all(ALL_SERVICES.map(t=>this.probe(t,e).then(e=>({[t]:e})).catch(()=>({[t]:!1}))))).reduce((e,t)=>({...e,...t}),{}),await a.putItem(t,s,6048e5).catch(()=>{})}return s}async probe(e,t){if(WHILTELIST_REGIONS.includes(t))return!0;const a=new AbortController,s=setTimeout(()=>a.abort(),1500),n=`https://${e}.${t}.amazonaws.com`,i=await fetch(n,{method:"HEAD",signal:a.signal}).then(()=>!0).catch(()=>!1);return clearTimeout(s),i}}const GetServiceAvailability=()=>(void 0===_singleton$1&&new ServiceAvailability,_singleton$1),{Proxy:{Bucket:PROXY_BUCKET}}=SolutionManifest,ON_FACE_COLLECTION_ADDED="facemanager:collection:added",ON_FACE_COLLECTION_REMOVED="facemanager:collection:removed",ON_FACE_ADDED="facemanager:face:added",ON_FACE_REMOVED="facemanager:face:removed";let _singleton;const _receivers={},_onFaceManagerEvent=(e,t)=>{setTimeout(async()=>{const a=Object.keys(_receivers);try{await Promise.all(a.map(a=>_receivers[a](e,t).catch(t=>{console.error("ERR:",`_onFaceManagerEvent.${e}.${a}:`,t.message)}))),console.log("INFO:",`_onFaceManagerEvent.${e}:`,a.length+" receivers:",a.join(", "))}catch(t){console.error("ERR:",`_onFaceManagerEvent.${e}:`,t)}},10)};class FaceManager{constructor(){this.$faceStore=(void 0===_singleton$4&&new FaceStore,_singleton$4),this.$collections=[],this.$facesByCollection={},_singleton=this}get faceStore(){return this.$faceStore}get collections(){return this.$collections}set collections(e){this.$collections=e}get facesByCollection(){return this.$facesByCollection}set facesByCollection(e){this.$facesByCollection=e}async getCollections(){try{return 0===this.collections.length&&(this.collections=await ApiHelper.getFaceCollections()),this.collections}catch(e){return console.error(e),this.collections}}async refreshCollections(){return this.facesByCollection={},this.collections.length=0,await this.getCollections(),this.collections}async createCollection(e){try{const t=await ApiHelper.createFaceCollection(e);if(!(t||{}).name)return;return this.collections.findIndex(e=>e.name===t.name)<0&&(this.collections.push(t),_onFaceManagerEvent(ON_FACE_COLLECTION_ADDED,t)),t}catch(e){return void console.error(e)}}async deleteCollection(e){try{if(await ApiHelper.deleteFaceCollection(e),this.collections.length){const t=this.collections.findIndex(t=>t.name===e);if(t>=0){const e=this.collections.splice(t,1);_onFaceManagerEvent(ON_FACE_COLLECTION_REMOVED,e[0])}}delete this.facesByCollection[e]}catch(e){console.error(e)}}async getFacesInCollection(e,t){try{if(!t&&this.facesByCollection[e]&&this.facesByCollection[e].faces.length)return this.facesByCollection[e];const a=await ApiHelper.getFacesInCollection(e,{token:t});return void 0===this.facesByCollection[e]&&(this.facesByCollection[e]={faces:[]}),this.facesByCollection[e].faces=this.facesByCollection[e].faces.concat(a.faces),this.facesByCollection[e].token=a.token,this.facesByCollection[e]}catch(e){return void console.error(e)}}async getFaceImage(e){try{if(!e)return;let t=await this.faceStore.getItem(e);if(!t){const a=GetS3Utils(),s=await a.signUrl(PROXY_BUCKET,e);t=await this.storeFace(e,s)}return t?URL.createObjectURL(t):void 0}catch(e){return void console.error(e)}}async deleteFace(e,t){try{if(await ApiHelper.deleteFaceFromCollection(e,t).then(t=>(this.collections.find(t=>t.name===e).faces-=1,t)),this.facesByCollection[e]){const a=this.facesByCollection[e].faces.findIndex(e=>e.faceId===t);if(a>=0){const t=this.facesByCollection[e].faces.splice(a,1);_onFaceManagerEvent(ON_FACE_REMOVED,{collectionId:e,...t[0]})}}}catch(e){console.error(e)}}async indexFace(e,t,a){try{const s={externalImageId:t.replace(/\s/g,"_"),blob:a},n=await ApiHelper.indexFaceToCollection(e,s).then(t=>(this.collections.find(t=>t.name===e).faces+=1,t));let i;if(n.externalImageId&&n.faceId){const t=await this.storeFace(n.key,a).then(e=>URL.createObjectURL(e));if(i={externalImageId:n.externalImageId,faceId:n.faceId,blob:t},void 0===this.facesByCollection[e])return await this.getFacesInCollection(e),_onFaceManagerEvent(ON_FACE_ADDED,{collectionId:e,...i}),i;this.facesByCollection[e].faces.findIndex(e=>e.faceId===i.faceId)<0&&(this.facesByCollection[e].faces.push(i),_onFaceManagerEvent(ON_FACE_ADDED,{collectionId:e,...i}))}return i}catch(e){return void console.error(e)}}async storeFace(e,t){let a=await AppUtils.downscale(t);return a=await fetch(a),a=await a.blob(),await this.faceStore.putItem(e,a),a}}const GetFaceManager=()=>(void 0===_singleton&&new FaceManager,_singleton),RegisterFaceManagerEvent=(e,t)=>!(!e||"function"!=typeof t)&&(_receivers[e]=t,!0),LanguageCodes=[{name:"Afrikaans (South Africa)",value:"af-ZA"},{name:"Arabic (U.A.E.)",value:"ar-AE"},{name:"Arabic (Saudi Arabia)",value:"ar-SA"},{name:"Chinese (PRC)",value:"zh-CN"},{name:"Chinese (Traditional)",value:"zh-TW"},{name:"Danish (Denmark)",value:"da-DK"},{name:"Dutch (Netherlands)",value:"nl-NL"},{name:"German (Switzerland)",value:"de-CH"},{name:"German (Germany)",value:"de-DE"},{name:"English (Scottish)",value:"en-AB"},{name:"English (Australia)",value:"en-AU"},{name:"English (Ireland)",value:"en-IE"},{name:"English (Indian)",value:"en-IN"},{name:"English (New Zealand)",value:"en-NZ"},{name:"English (South Africa)",value:"en-ZA"},{name:"English (United Kingdom)",value:"en-GB"},{name:"English (United States)",value:"en-US"},{name:"English (Welsh)",value:"en-WL"},{name:"Spanish (Spain)",value:"es-ES"},{name:"Spanish (United States)",value:"es-US"},{name:"Farsi (Iran)",value:"fa-IR"},{name:"French (Canada)",value:"fr-CA"},{name:"French (France)",value:"fr-FR"},{name:"Hebrew (Israel)",value:"he-IL"},{name:"Hindi (India)",value:"hi-IN"},{name:"Indonesian (Indonesia)",value:"id-ID"},{name:"Italian (Italy)",value:"it-IT"},{name:"Japanese (Japan)",value:"ja-JP"},{name:"Korean (Korea)",value:"ko-KR"},{name:"Malay (Malaysia)",value:"ms-MY"},{name:"Portuguese (Brazil)",value:"pt-BR"},{name:"Portuguese (Portugal)",value:"pt-PT"},{name:"Russian (Russia)",value:"ru-RU"},{name:"Tamil (India)",value:"ta-IN"},{name:"Thai (Thailand)",value:"th-TH"},{name:"Telugu (India)",value:"te-IN"},{name:"Turkish (Turkey)",value:"tr-TR"}],OPT_CELEB=SolutionManifest.AnalysisTypes.Rekognition.Celeb,OPT_FACE=SolutionManifest.AnalysisTypes.Rekognition.Face,OPT_FACEMATCH=SolutionManifest.AnalysisTypes.Rekognition.FaceMatch,OPT_LABEL=SolutionManifest.AnalysisTypes.Rekognition.Label,OPT_MODERATION=SolutionManifest.AnalysisTypes.Rekognition.Moderation,OPT_PERSON=SolutionManifest.AnalysisTypes.Rekognition.Person,OPT_TEXT=SolutionManifest.AnalysisTypes.Rekognition.Text,OPT_SEGMENT=SolutionManifest.AnalysisTypes.Rekognition.Segment,OPT_CUSTOMLABEL=SolutionManifest.AnalysisTypes.Rekognition.CustomLabel,OPT_MINCONFIDENCE="minConfidence",OPT_FACECOLLECTIONID="faceCollectionId",OPT_CUSTOMLABELMODELS="customLabelModels",OPT_FRAMECATPUREMODE="frameCaptureMode",OPT_TEXTROI="textROI",OPT_FRAMEBASED="framebased",OPT_ENTITY=SolutionManifest.AnalysisTypes.Comprehend.Entity,OPT_KEYPHRASE=SolutionManifest.AnalysisTypes.Comprehend.Keyphrase,OPT_SENTIMENT=SolutionManifest.AnalysisTypes.Comprehend.Sentiment,OPT_CUSTOMENTITY=SolutionManifest.AnalysisTypes.Comprehend.CustomEntity,OPT_CUSTOMENTITYRECOGNIZER="customEntityRecognizer",OPT_TRANSCRIBE=SolutionManifest.AnalysisTypes.Transcribe,OPT_LANGUAGECODE="languageCode",OPT_CUSTOMLANGUAGEMODEL="customLanguageModel",OPT_CUSTOMVOCABULARY="customVocabulary",OPT_TEXTRACT=SolutionManifest.AnalysisTypes.Textract,REKOGNITION_BASIC_OPTIONS=[OPT_CELEB,OPT_FACE,OPT_FACEMATCH,OPT_LABEL,OPT_MODERATION,OPT_PERSON,OPT_TEXT,OPT_SEGMENT],REKOGNITION_ADVANCED_OPTIONS=["minConfidence",OPT_FACECOLLECTIONID,OPT_CUSTOMLABELMODELS,OPT_FRAMECATPUREMODE,"textROI",OPT_CUSTOMLABEL,OPT_FRAMEBASED],COMPREHEND_BASIC_OPTIONS=[OPT_ENTITY,OPT_KEYPHRASE,OPT_SENTIMENT],COMPREHEND_ADVANCED_OPTIONS=[OPT_CUSTOMENTITY,OPT_CUSTOMENTITYRECOGNIZER],TRANSCRIBE_BASIC_OPTIONS=[OPT_TRANSCRIBE],TRANSCRIBE_ADVANCED_OPTIONS=[OPT_LANGUAGECODE,OPT_CUSTOMLANGUAGEMODEL,OPT_CUSTOMVOCABULARY],TEXTRACT_BASIC_OPTIONS=[OPT_TEXTRACT],TEXTROI_GRIDS=["TL","TC","TR","ML","C","MR","BL","BC","BR"],MAX_CUSTOMALBELMODELS=2,AVAILABLE_FRAMECAPTUREMODES=[{name:Localization.Messages.FrameCaptureModeNone,value:SolutionManifest.FrameCaptureMode.MODE_NONE},{name:Localization.Messages.FrameCaptureMode1FPS,value:SolutionManifest.FrameCaptureMode.MODE_1FPS},{name:Localization.Messages.FrameCaptureMode2FPS,value:SolutionManifest.FrameCaptureMode.MODE_2FPS},{name:Localization.Messages.FrameCaptureMode3FPS,value:SolutionManifest.FrameCaptureMode.MODE_3FPS},{name:Localization.Messages.FrameCaptureMode4FPS,value:SolutionManifest.FrameCaptureMode.MODE_4FPS},{name:Localization.Messages.FrameCaptureMode5FPS,value:SolutionManifest.FrameCaptureMode.MODE_5FPS},{name:Localization.Messages.FrameCaptureMode10FPS,value:SolutionManifest.FrameCaptureMode.MODE_10FPS},{name:Localization.Messages.FrameCaptureMode12FPS,value:SolutionManifest.FrameCaptureMode.MODE_12FPS},{name:Localization.Messages.FrameCaptureMode15FPS,value:SolutionManifest.FrameCaptureMode.MODE_15FPS},{name:Localization.Messages.FrameCaptureModeAllFrames,value:SolutionManifest.FrameCaptureMode.MODE_ALL},{name:Localization.Messages.FrameCaptureModeEveryOtherFrame,value:SolutionManifest.FrameCaptureMode.MODE_HALF_FPS},{name:Localization.Messages.FrameCaptureMode1FramePer2Seconds,value:SolutionManifest.FrameCaptureMode.MODE_1F_EVERY_2S},{name:Localization.Messages.FrameCaptureMode1FramePer5Seconds,value:SolutionManifest.FrameCaptureMode.MODE_1F_EVERY_5S},{name:Localization.Messages.FrameCaptureMode1FramePer10Seconds,value:SolutionManifest.FrameCaptureMode.MODE_1F_EVERY_10S},{name:Localization.Messages.FrameCaptureMode1FramePer30Seconds,value:SolutionManifest.FrameCaptureMode.MODE_1F_EVERY_30S},{name:Localization.Messages.FrameCaptureMode1FramePer1Minute,value:SolutionManifest.FrameCaptureMode.MODE_1F_EVERY_1MIN},{name:Localization.Messages.FrameCaptureMode1FramePer2Minutes,value:SolutionManifest.FrameCaptureMode.MODE_1F_EVERY_2MIN},{name:Localization.Messages.FrameCaptureMode1FramePer5Minutes,value:SolutionManifest.FrameCaptureMode.MODE_1F_EVERY_5MIN}],mxAnalysisSettings=e=>class extends e{constructor(...e){super(...e),this.$settingStore=GetSettingStore(),this.$serviceAvailability={},this.$aiOptions=JSON.parse(JSON.stringify(SolutionManifest.AIML)),this.$availableFaceCollections=void 0,this.$availableCustomLabelModels=void 0,this.$availableLanguageCodes=LanguageCodes,this.$availableCustomVocabularies=void 0,this.$availableCustomLanguageModels=void 0,this.$availableCustomEntityRecognizers=void 0,RegisterFaceManagerEvent("mxanalysissettings-"+AppUtils.randomHexstring(),this.onFaceManagerEvent.bind(this)),Spinner.useSpinner()}get parentContainer(){throw new Error("dervied class to implement parentContainer getter")}get settingStore(){return this.$settingStore}get serviceAvailability(){return this.$serviceAvailability}set serviceAvailability(e){this.$serviceAvailability=e}get aiOptions(){return this.$aiOptions}set aiOptions(e){this.$aiOptions=e}get availableFaceCollections(){return this.$availableFaceCollections}set availableFaceCollections(e){this.$availableFaceCollections=e}get availableCustomLabelModels(){return this.$availableCustomLabelModels}set availableCustomLabelModels(e){this.$availableCustomLabelModels=e}get availableLanguageCodes(){return this.$availableLanguageCodes}get availableCustomVocabularies(){return this.$availableCustomVocabularies}set availableCustomVocabularies(e){this.$availableCustomVocabularies=e}get availableCustomLanguageModels(){return this.$availableCustomLanguageModels}set availableCustomLanguageModels(e){this.$availableCustomLanguageModels=e}get availableCustomEntityRecognizers(){return this.$availableCustomEntityRecognizers}set availableCustomEntityRecognizers(e){this.$availableCustomEntityRecognizers=e}get canModify(){return GetUserSession().canModify()}loading(e){return Spinner.loading(e)}async getItem(e){if(this.canModify)return this.settingStore.getItem(e)}async putItem(e,t){if(this.canModify)return this.settingStore.putItem(e,t)}async deleteItem(e){if(this.canModify)return this.settingStore.deleteItem(e)}async show(){if(this.initialized)await this.loadLocalSettings(),await this.refreshContent();else{const e=this.createSkeleton();this.parentContainer.append(e),e.ready(async()=>{try{Spinner.loading(),this.serviceAvailability=await this.checkServiceAvailability(),[this.availableFaceCollections,this.availableCustomLabelModels,this.availableCustomVocabularies,this.availableCustomLanguageModels,this.availableCustomEntityRecognizers]=await Promise.all([this.getAvailableFaceCollections(),this.getAvailableCustomLabelModels(),this.getAvailableCustomVocabulary(),this.getAvailableCustomLanguageModels(),this.getAvailableCustomEntityRecognizers()]),await this.loadLocalSettings(),await this.refreshContent()}catch(e){console.error(e)}finally{Spinner.loading(!1)}})}return super.show()}createSkeleton(){const e=$("<div/>").addClass("row no-gutters"),t=$("<div/>").addClass("col-9 p-0 mx-auto mt-4");e.append(t);const a=this.createDescription();t.append(a);const s=$("<div/>").addClass("col-9 p-0 mx-auto mt-4");e.append(s);const n=this.createRekognitionFeaturesForm();s.append(n);const i=$("<div/>").addClass("col-9 p-0 mx-auto mt-4");e.append(i);const o=this.createTranscribeFeaturesForm();i.append(o);const r=$("<div/>").addClass("col-9 p-0 mx-auto mt-4");e.append(r);const l=this.createComprehendFeaturesForm();r.append(l);const d=$("<div/>").addClass("col-9 p-0 mx-auto mt-4");e.append(d);const c=this.createTextractFeaturesForm();d.append(c);const p=$("<div/>").addClass("col-9 p-0 mx-auto mt-4");e.append(p);const h=this.createControls();return p.append(h),e}createDescription(){return $("<p/>").addClass("lead").html(Localization.Messages.SettingsDesc)}createRekognitionFeaturesForm(){const e=$("<span/>").addClass("d-block p-2 bg-light text-black lead").html(Localization.Messages.RekognitionFeatures),t=$("<p/>").addClass("lead-s mt-4").html(Localization.Messages.RekognitionFeaturesDesc),a=$("<form/>").addClass("col-9 px-0 form-inline mt-4").attr("role","form"),s=this.createMinConfidenceRange();a.append(s);const n=REKOGNITION_BASIC_OPTIONS.map(e=>{const t=e.charAt(0).toUpperCase()+e.slice(1);return this.createToggle(ServiceNames.Rekognition,e,Localization.Messages[t],Localization.Tooltips[t])});a.append(n);const i=this.createFaceCollectionFormGroup();a.append(i);const o=this.createTextROIFormGroup();a.append(o);const r=this.createCustomLabelFormGroup();a.append(r);const l=this.createFrameBasedFormGroup();a.append(l);const d=this.createFrameCaptureModeFormGroup();return a.append(d),a.submit(e=>e.preventDefault()),$("<div/>").addClass("ai-group").addClass("overflow-auto my-auto align-content-start").append($("<div/>").addClass("mt-4").append(e).append(t).append(a))}createComprehendFeaturesForm(){const e=$("<span/>").addClass("d-block p-2 bg-light text-black lead").html(Localization.Messages.ComprehendFeatures),t=$("<p/>").addClass("lead-s mt-4").html(Localization.Messages.ComprehendFeaturesDesc),a=$("<form/>").addClass("col-9 px-0 form-inline mt-4").attr("role","form"),s=COMPREHEND_BASIC_OPTIONS.map(e=>{const t=e.charAt(0).toUpperCase()+e.slice(1);return this.createToggle(ServiceNames.Comprehend,e,Localization.Messages[t],Localization.Tooltips[t])});a.append(s);const n=this.createEntityRecognizerFormGroup();return a.append(n),a.submit(e=>e.preventDefault()),$("<div/>").addClass("ai-group").addClass("overflow-auto my-auto align-content-start").append($("<div/>").addClass("mt-4").append(e).append(t).append(a))}createTranscribeFeaturesForm(){const e=$("<span/>").addClass("d-block p-2 bg-light text-black lead").html(Localization.Messages.TranscribeFeatures),t=$("<p/>").addClass("lead-s mt-4").html(Localization.Messages.TranscribeFeaturesDesc),a=$("<form/>").addClass("col-9 px-0 form-inline mt-4").attr("role","form"),s=TRANSCRIBE_BASIC_OPTIONS.map(e=>{const t=e.charAt(0).toUpperCase()+e.slice(1);return this.createToggle(ServiceNames.Transcribe,e,Localization.Messages[t],Localization.Tooltips[t])});a.append(s);const n=this.createLanguageCodeFormGroup();a.append(n);const i=this.createCustomVocabularyFormGroup();a.append(i);const o=this.createCustomLanguageModelFormGroup();return a.append(o),a.submit(e=>e.preventDefault()),$("<div/>").addClass("ai-group").addClass("overflow-auto my-auto align-content-start").append($("<div/>").addClass("mt-4").append(e).append(t).append(a))}createTextractFeaturesForm(){const e=$("<span/>").addClass("d-block p-2 bg-light text-black lead").html(Localization.Messages.TextractFeatures),t=$("<p/>").addClass("lead-s mt-4").html(Localization.Messages.TextractFeaturesDesc),a=$("<form/>").addClass("col-9 px-0 form-inline mt-4").attr("role","form"),s=TEXTRACT_BASIC_OPTIONS.map(e=>{const t=e.charAt(0).toUpperCase()+e.slice(1);return this.createToggle(ServiceNames.Textract,e,Localization.Messages[t],Localization.Tooltips[t])});return a.append(s),a.submit(e=>e.preventDefault()),$("<div/>").addClass("ai-group").addClass("overflow-auto my-auto align-content-start").append($("<div/>").addClass("mt-4").append(e).append(t).append(a))}createControls(){if(!this.canModify)return;const e=$("<form/>").addClass("form-inline");e.submit(e=>e.preventDefault());const t=$("<div/>").addClass("ml-auto");e.append(t);const a=$("<button/>").addClass("btn btn-outline-success ml-1").attr("data-toggle","tooltip").attr("data-placement","bottom").attr("title",Localization.Tooltips.ApplyToAllUsers).html(Localization.Buttons.ApplyToAllUsers).tooltip({trigger:"hover"});t.append(a);const s=$("<button/>").addClass("btn btn-secondary ml-1").attr("data-toggle","tooltip").attr("data-placement","bottom").attr("title",Localization.Tooltips.RestoreOriginal).html(Localization.Buttons.RestoreOriginal).tooltip({trigger:"hover"});return t.append(s),a.on("click",async()=>this.storeGlobalSettings()),s.on("click",async()=>this.restoreFactorySettings()),e}createMinConfidenceRange(){const e="minConfidence-"+AppUtils.randomHexstring(),t=$("<label/>").addClass("col-4 px-0 justify-content-start").attr("for",e).attr("data-toggle","tooltip").attr("data-placement","bottom").attr("title",Localization.Tooltips.MinConfidence).html(Localization.Messages.MinConfidence);t.tooltip({trigger:"hover"});const a=$("<input/>").addClass("custom-range col-6").attr("data-type","minConfidence").attr("type","range").attr("min",0).attr("max",100).attr("value",this.aiOptions.minConfidence).attr("step",1).attr("id",e),s=$("<input/>").addClass("col-1 text-center text-muted ml-1").attr("data-type","minConfidence").attr("type","text").attr("value",this.aiOptions.minConfidence).attr("disabled","disabled").attr("id",e+"-text");return a.off("input").on("input",async()=>{this.aiOptions.minConfidence=Number.parseInt(a.val(),10),s.val(this.aiOptions.minConfidence),await this.putItem("minConfidence",this.aiOptions.minConfidence)}),$("<div/>").addClass("form-group col-10 px-0 mt-2 mb-2").append(t).append(a).append(s)}createToggle(e,t,a,s,n){const i=$("<input/>").attr("type","checkbox").attr("data-category",e).attr("data-type",t),o=$("<span/>").addClass("col-8 px-0").attr("data-toggle","tooltip").attr("data-placement","bottom").attr("title",s).html(a);o.tooltip({trigger:"hover"});const r=$("<div/>").addClass("form-group col-5 px-0 mt-2 mb-2").append($("<div/>").addClass("input-group col-12 pl-0").append(o).append($("<label/>").addClass("xs-switch").append(i).append($("<span/>").addClass("xs-slider round"))));return this.checkDetectionSupported(t)?this.aiOptions[t]&&i.attr("checked","checked"):(i.attr("disabled","disabled"),r.addClass("text-muted")),i.off("click").on("click",async()=>{const e=i.prop("checked");this.aiOptions[t]=e,n&&await n(e),await this.putItem(t,this.aiOptions[t])}),r}createFrameBasedFormGroup(){return[$("<p/>").addClass("lead-s mt-4").html(Localization.Messages.FramebasedDesc),this.createToggle(ServiceNames.Rekognition,OPT_FRAMEBASED,Localization.Messages.Framebased,Localization.Tooltips.Framebased,this.onFramebasedChange.bind(this))]}createFaceCollectionFormGroup(){return this.createCustomFormGroup({name:OPT_FACECOLLECTIONID,label:Localization.Messages.FaceCollectionId,tooltip:Localization.Tooltips.FaceCollection,default:Localization.Messages.SelectCollection})}createCustomLabelFormGroup(){return[$("<p/>").addClass("lead-s mt-4").html(Localization.Messages.CustomlabelDesc.replace("{{MAX_CUSTOMALBELMODELS}}",2)),this.createMultiselectFormGroup({name:OPT_CUSTOMLABELMODELS,label:Localization.Messages.CustomLabelModels,tooltip:Localization.Tooltips.CustomLabelModels,default:Localization.Messages.SelectModels,beforeChange:this.onCustomLabelModelChange.bind(this)})]}createFrameCaptureModeFormGroup(){return this.createCustomFormGroup({name:OPT_FRAMECATPUREMODE,label:Localization.Messages.FrameCaptureMode,tooltip:Localization.Tooltips.FrameCaptureMode,default:Localization.Messages.SelectFrameCaptureMode})}createTextROIFormGroup(){const e="textROI-"+AppUtils.randomHexstring(),t=$("<label/>").addClass("col-4 px-0 justify-content-start mb-auto").attr("for",e).attr("data-toggle","tooltip").attr("data-placement","bottom").attr("title",Localization.Tooltips.TextROI).html(Localization.Messages.TextROI);t.tooltip({trigger:"hover"});const a=$("<div/>").addClass("row no-gutters text-roi-screen").attr("data-type","textROI");TEXTROI_GRIDS.forEach((e,t)=>{const s=$("<div/>").attr("data-index",t).addClass("d-flex text-roi-grid").append($("<div/>").addClass("mx-auto my-auto lead-sm").html(e));s.off("click").on("click",async()=>{s.hasClass("text-roi-grid-active")?(s.removeClass("text-roi-grid-active"),this.aiOptions.textROI[t]=!1):(s.addClass("text-roi-grid-active"),this.aiOptions.textROI[t]=!0),await this.putItem("textROI",this.aiOptions.textROI)}),a.append(s)});const s=$("<div/>").addClass("col-6 m-0 p-0").attr("id",e).append(a);return $("<div/>").addClass("form-group col-10 px-0 my-2").append(t).append(s)}createLanguageCodeFormGroup(){return this.createCustomFormGroup({name:OPT_LANGUAGECODE,label:Localization.Messages.LanguageCode,tooltip:Localization.Tooltips.LanguageCode,default:Localization.Messages.SelectLanguageCode})}createCustomVocabularyFormGroup(){return this.createCustomFormGroup({name:OPT_CUSTOMVOCABULARY,label:Localization.Messages.CustomVocabulary,tooltip:Localization.Tooltips.CustomVocabulary,default:Localization.Messages.SelectModel})}createCustomLanguageModelFormGroup(){return this.createCustomFormGroup({name:OPT_CUSTOMLANGUAGEMODEL,label:Localization.Messages.CustomLanguageModel,tooltip:Localization.Tooltips.CustomLanguageModel,default:Localization.Messages.SelectModel})}createEntityRecognizerFormGroup(){return this.createCustomFormGroup({name:OPT_CUSTOMENTITYRECOGNIZER,label:Localization.Messages.CustomEntityRecognizer,tooltip:Localization.Tooltips.CustomEntityRecognizer,default:Localization.Messages.SelectModel,onChange:this.onEntityRecognizerChange.bind(this)})}createCustomFormGroup(e){const t=`${e.name}-${AppUtils.randomHexstring()}`,a=$("<label/>").addClass("col-4 px-0 justify-content-start").attr("for",t).attr("data-toggle","tooltip").attr("data-placement","bottom").attr("title",e.tooltip).html(e.label);a.tooltip({trigger:"hover"});const s=$("<select/>").addClass("custom-select custom-select-sm col-7").attr("data-type",e.name).attr("id",t).append($("<option/>").attr("value","undefined").html(e.default));s.on("change",async()=>{const t=s.val();this.aiOptions[e.name]="undefined"===t?void 0:/^[0-9]+$/.test(t)?Number.parseInt(t,10):t,"function"==typeof e.onChange&&await e.onChange(e.name,this.aiOptions[e.name]),await this.putItem(e.name,this.aiOptions[e.name])});return $("<div/>").addClass("form-group col-10 px-0 my-2").append(a).append(s)}createMultiselectFormGroup(e){const t=`${e.name}-${AppUtils.randomHexstring()}`,a=$("<label/>").addClass("col-4 px-0 justify-content-start").attr("for",t).attr("data-toggle","tooltip").attr("data-placement","bottom").attr("title",e.tooltip).html(e.label);a.tooltip({trigger:"hover"});const s=$("<button/>").addClass("col-8 btn btn-sm btn-outline-dark dropdown-toggle overflow-auto").attr("type","button").attr("id",t).attr("data-toggle","dropdown").attr("aria-haspopup",!0).attr("aria-expanded",!1).html(e.default),n=$("<div/>").addClass("dropdown col-8").append(s),i=$("<div/>").addClass("dropdown-menu col-12 lead-xs").attr("data-type",e.name).attr("aria-labelledby",t),o=$("<a/>").addClass("dropdown-item").attr("href","#").attr("data-value","undefined").html(Localization.Messages.SelectNone);o.on("click",async t=>{t.preventDefault(),t.stopPropagation();(!e.beforeChange||await e.beforeChange("undefined",!0))&&(i.find("a.dropdown-item").removeClass("active"),s.html(e.default))}),i.append(o).append($("<div/>").addClass("dropdown-divider")),n.append(i);return $("<div/>").addClass("form-group col-10 px-0 my-2").append(a).append(n)}async onCustomLabelModelChange(e,t){const a=OPT_CUSTOMLABELMODELS;if("undefined"===e)return this.aiOptions[a].length=0,await Promise.all([this.putItem(a,this.aiOptions[a]),this.onCustomLabelChange()]),!0;const s=this.aiOptions[a].findIndex(t=>t===e);return t?this.aiOptions[a].length<2&&(s<0&&this.aiOptions[a].splice(this.aiOptions[a].length,0,e),await Promise.all([this.putItem(a,this.aiOptions[a]),this.onCustomLabelChange(),this.ensureFrameCaptureMode(SolutionManifest.FrameCaptureMode.MODE_1F_EVERY_2S)]),!0):(s>=0&&this.aiOptions[a].splice(s,1),await Promise.all([this.putItem(a,this.aiOptions[a]),this.onCustomLabelChange(),this.ensureFrameCaptureMode(SolutionManifest.FrameCaptureMode.MODE_1F_EVERY_2S)]),!0)}async onFramebasedChange(e){return e&&await this.ensureFrameCaptureMode(SolutionManifest.FrameCaptureMode.MODE_1F_EVERY_2S),!0}async onCustomLabelChange(){return this.aiOptions[OPT_CUSTOMLABEL]=this.aiOptions[OPT_CUSTOMLABELMODELS].length>0,this.putItem(OPT_CUSTOMLABEL,this.aiOptions[OPT_CUSTOMLABEL])}async onEntityRecognizerChange(e,t){if(e===OPT_CUSTOMENTITYRECOGNIZER)return this.aiOptions[OPT_CUSTOMENTITY]=!!t,this.putItem(OPT_CUSTOMENTITY,this.aiOptions[OPT_CUSTOMENTITY])}async ensureFrameCaptureMode(e){const t=this.parentContainer.find(`select[data-type=${OPT_FRAMECATPUREMODE}]`);t.children("option:selected").first().val()===""+SolutionManifest.FrameCaptureMode.MODE_NONE&&t.val(""+e).trigger("change")}checkDetectionSupported(e){return REKOGNITION_BASIC_OPTIONS.indexOf(e)>=0||OPT_FRAMEBASED===e?this.serviceAvailability[ServiceNames.Rekognition]:TRANSCRIBE_BASIC_OPTIONS.indexOf(e)>=0?this.serviceAvailability[ServiceNames.Transcribe]:COMPREHEND_BASIC_OPTIONS.indexOf(e)>=0?this.serviceAvailability[ServiceNames.Comprehend]:TEXTRACT_BASIC_OPTIONS.indexOf(e)>=0&&this.serviceAvailability[ServiceNames.Textract]}async checkServiceAvailability(){return(void 0===_singleton$1&&new ServiceAvailability,_singleton$1).detectServices()}async getAvailableFaceCollections(){const e=GetFaceManager();return this.serviceAvailability[ServiceNames.Rekognition]?e.getCollections():void 0}async getAvailableCustomLabelModels(){return this.serviceAvailability[ServiceNames.Rekognition]?ApiHelper.getRekognitionCustomLabelModels():void 0}async getAvailableCustomVocabulary(){return this.serviceAvailability[ServiceNames.Transcribe]?ApiHelper.getTranscribeCustomVocabulary():void 0}async getAvailableCustomLanguageModels(){return this.serviceAvailability[ServiceNames.Transcribe]?ApiHelper.getTranscribeCustomLanguageModels():void 0}async getAvailableCustomEntityRecognizers(){return this.serviceAvailability[ServiceNames.Transcribe]&&this.serviceAvailability[ServiceNames.Comprehend]?ApiHelper.getComprehendCustomEntityRecognizers():void 0}async refreshContent(){[OPT_FRAMEBASED,...REKOGNITION_BASIC_OPTIONS,...TRANSCRIBE_BASIC_OPTIONS,...COMPREHEND_BASIC_OPTIONS,...TEXTRACT_BASIC_OPTIONS].forEach(e=>this.refreshToggle(e)),[{name:OPT_FACECOLLECTIONID,options:(this.availableFaceCollections||[]).map(e=>({name:`${e.name} (${e.faces} faces)`,value:e.name,canUse:e.faces>0}))},{name:OPT_FRAMECATPUREMODE,options:AVAILABLE_FRAMECAPTUREMODES},{name:OPT_LANGUAGECODE,options:this.availableLanguageCodes||[]},{name:OPT_CUSTOMVOCABULARY,options:(this.availableCustomVocabularies||[]).map(e=>({name:`${e.name} (${e.languageCode})`,value:e.name,canUse:e.canUse}))},{name:OPT_CUSTOMLANGUAGEMODEL,options:(this.availableCustomLanguageModels||[]).map(e=>({name:`${e.name} (${e.languageCode})`,value:e.name,canUse:e.canUse}))},{name:OPT_CUSTOMENTITYRECOGNIZER,options:(this.availableCustomEntityRecognizers||[]).map(e=>({name:`${e.name} (${e.languageCode})`,value:e.name,canUse:e.canUse}))}].forEach(e=>this.refreshCustomFormOptions(e)),[{name:OPT_CUSTOMLABELMODELS,options:(this.availableCustomLabelModels||[]).map(e=>({name:e.name.split("/").shift(),value:e.name,canUse:e.canUse})),default:Localization.Messages.SelectModels,beforeChange:this.onCustomLabelModelChange.bind(this)}].forEach(e=>this.refreshMultiselectFormGroup(e)),this.refreshMinConfidenceRange(),this.refreshTextROIFormGroup()}refreshToggle(e){const t=this.parentContainer.find(`input[data-type=${e}]`),a=t.closest("div.form-group");this.checkDetectionSupported(e)?(a.removeClass("text-muted"),t.removeAttr("disabled"),t.prop("checked",this.aiOptions[e])):(a.addClass("text-muted"),t.attr("disabled","disabled")),this.canModify||t.attr("disabled","disabled")}refreshCustomFormOptions(e){const t=this.parentContainer.find(`select[data-type=${e.name}]`);t.children('option[value!="undefined"]').remove(),e.options.forEach(a=>{const s=$("<option/>").attr("value",a.value).html(a.name);!1===a.canUse?s.attr("disabled","disabled"):(s.removeAttr("disabled"),this.aiOptions[e.name]===a.value&&s.attr("selected","selected")),t.append(s)}),this.canModify||t.attr("disabled","disabled")}refreshMultiselectFormGroup(e){const t=this.parentContainer.find(`div.dropdown-menu[data-type=${e.name}]`),a=t.siblings("button.dropdown-toggle").first();t.children('a.dropdown-item[data-value!="undefined"]').remove(),e.options.forEach(s=>{const n=$("<a/>").addClass("dropdown-item").attr("href","#").attr("data-value",s.value).html(s.name);!1===s.canUse?n.attr("disabled","disabled"):(n.removeAttr("disabled"),this.aiOptions[e.name].findIndex(e=>e===s.value)>=0&&n.addClass("active")),n.on("click",async t=>{t.preventDefault(),t.stopPropagation();const i=n.hasClass("active"),o=!e.beforeChange||await e.beforeChange(s.value,!i);o&&i?n.removeClass("active"):o&&!i&&n.addClass("active");let r=this.aiOptions[e.name].map(e=>e.substring(0,5)+"...");r=r.length?r:e.default,a.text(r),await this.putItem(e.name,this.aiOptions[e.name])}),t.append(n)});let s=this.aiOptions[e.name].map(e=>e.substring(0,5)+"...");s=s.length?s:e.default,a.text(s),this.canModify||a.attr("disabled","disabled")}refreshMinConfidenceRange(){const e=this.parentContainer.find("input[data-type=minConfidence]");e.val(this.aiOptions.minConfidence),this.canModify||e.attr("disabled","disabled")}refreshTextROIFormGroup(){this.parentContainer.find("div[data-type=textROI]").children().each((e,t)=>{const a=$(t),s=Number.parseInt(a.data("index"),10);this.aiOptions.textROI[s]?a.addClass("text-roi-grid-active"):a.removeClass("text-roi-grid-active")})}async loadLocalSettings(){const e=await this.getGlobalAIOptions();return void 0!==e&&(this.aiOptions=e),await Promise.all([...REKOGNITION_BASIC_OPTIONS,...REKOGNITION_ADVANCED_OPTIONS,...TRANSCRIBE_BASIC_OPTIONS,...TRANSCRIBE_ADVANCED_OPTIONS,...COMPREHEND_BASIC_OPTIONS,...COMPREHEND_ADVANCED_OPTIONS,...TEXTRACT_BASIC_OPTIONS].map(e=>this.getItem(e).then(t=>this.aiOptions[e]=void 0===t?this.aiOptions[e]:t))),this.aiOptions}async restoreFactorySettings(){try{Spinner.loading(),await Promise.all([...REKOGNITION_BASIC_OPTIONS,...REKOGNITION_ADVANCED_OPTIONS,...TRANSCRIBE_BASIC_OPTIONS,...TRANSCRIBE_ADVANCED_OPTIONS,...COMPREHEND_BASIC_OPTIONS,...COMPREHEND_ADVANCED_OPTIONS,...TEXTRACT_BASIC_OPTIONS].map(e=>this.deleteItem(e))),await this.removeGlobalAIOptions(),this.aiOptions=JSON.parse(JSON.stringify(SolutionManifest.AIML)),await this.refreshContent()}catch(e){console.error(e)}finally{Spinner.loading(!1)}}async storeGlobalSettings(){try{Spinner.loading(),await ApiHelper.setGlobalAIOptions(this.aiOptions)}catch(e){console.error(e)}finally{Spinner.loading(!1)}}async getGlobalAIOptions(){return ApiHelper.getGlobalAIOptions()}async removeGlobalAIOptions(){return ApiHelper.deleteGlobalAIOptions()}async onFaceManagerEvent(e,t){if(!this.parentContainer)return;const a=this.parentContainer.find(`select[data-type=${OPT_FACECOLLECTIONID}]`),s=a.children("option:selected").first().val();if(this.availableFaceCollections=await this.getAvailableFaceCollections(),this.refreshCustomFormOptions({name:OPT_FACECOLLECTIONID,options:(this.availableFaceCollections||[]).map(e=>({name:`${e.name} (${e.faces} faces)`,value:e.name,canUse:e.faces>0}))}),s&&"undefined"!==s){const e=this.availableFaceCollections.find(e=>e.name===s);e&&e.faces>0&&a.val(e.name).trigger("change")}}},{Messages:{ReAnalyzeTab:TITLE$d},Buttons:{ReAnalyzeContent:BTN_REANALYZE_CONTENT},Alerts:{Oops:OOPS$5,Confirmed:CONFIRMED$1,ReAnalyzeSubmitted:ERR_REANALYZE_SUBMITTED,ReAnalzyeFailed:ERR_REANALYZER_FAILED}}=Localization,COL_TAB$1="col-11";class ReAnalyzeTab extends(mxAnalysisSettings(mxAlert(BaseAnalysisTab))){constructor(e){super(TITLE$d,e),this.$parentContainer=$("<div/>").addClass("col-11 my-4 max-h36r")}get parentContainer(){return this.$parentContainer}async createContent(){return this.parentContainer}createSkeleton(){const e=super.createSkeleton();return e.children().first().remove(),e.children().first().removeClass("mt-4"),e.children("div.col-9").removeClass("col-9").addClass("col-12"),e.find("span.bg-light").removeClass("p-2"),e}createControls(){const e=$("<button/>").addClass("btn btn-success ml-1").html(BTN_REANALYZE_CONTENT);e.off("click").on("click",async t=>{t.preventDefault(),t.stopPropagation();try{this.loading(!0);const t=this.previewComponent.media.uuid,a={input:{aiOptions:await this.loadLocalSettings()}};await ApiHelper.startAnalysisWorkflow(t,a),this.loading(!1);const s=ERR_REANALYZE_SUBMITTED.replace("{{BASENAME}}",this.previewComponent.media.basename);return await this.showConfirm(s),!1}catch(e){const t=ERR_REANALYZER_FAILED.replace("{{BASENAME}}",this.previewComponent.media.basename);return await this.showAlert(t),!1}finally{e.addClass("disabled").attr("disabled","disabled"),this.loading(!1)}});const t=$("<form/>").addClass("form-inline").append($("<div/>").addClass("ml-auto").append(e));return t.submit(e=>e.preventDefault()),t}async showAlert(e,t=2e3){return super.showMessage(this.tabContent,"danger",OOPS$5,e,t)}async showConfirm(e,t=2e3){return super.showMessage(this.tabContent,"success",CONFIRMED$1,e,t)}}const{GraphDefs:{Vertices:Vertices$1}}=SolutionManifest,NODESIZE_BY_TYPE={[Vertices$1.Group]:50,[Vertices$1.Asset]:45,[Vertices$1.Celeb]:30,[Vertices$1.Label]:30,[Vertices$1.Keyword]:30,[Vertices$1.Attribute]:20,[Vertices$1.Checksum]:20},GRAPH_MAPPING=Object.values(Vertices$1).map(e=>({name:e})),GRAPH_W=1200,PAGESIZE=50;class KnowledgeGraph{constructor(e,t,a){this.$id=AppUtils.randomHexstring(),this.$mediaManager=GetMediaManager(),this.$faceManager=GetFaceManager(),this.$media=t,this.$graph=void 0,this.$graphContainer=$("<div/>").addClass("knowledge-graph").attr("id","knowledge-"+this.$id),this.$graphContainer.ready(async()=>{console.log("graphContainer ready"),await this.renderGraph(this.$graphContainer,a)}),e.append(this.$graphContainer),Spinner.useSpinner()}static canSupport(){return SolutionManifest.KnowledgeGraph&&SolutionManifest.KnowledgeGraph.Endpoint&&SolutionManifest.KnowledgeGraph.ApiKey}get id(){return this.$id}get mediaManager(){return this.$mediaManager}get faceManager(){return this.$faceManager}get graphContainer(){return this.$graphContainer}set graphContainer(e){this.$graphContainer=e}get graph(){return this.$graph}set graph(e){this.$graph=e}get graphId(){return this.graphContainer.prop("id")}get media(){return this.$media}getGraphContainer(){return this.graphContainer}getGraphOption(){if(this.graph)return this.graph.getOption()}async renderGraph(e,t={}){try{Spinner.loading(),void 0!==this.graph&&this.graph.dispose(),this.graph=this.buildGraph(e,"dark",t);let a=t.dataset;if(!a&&this.media){const e=this.media.uuid,t={labels:Vertices$1.Celeb};a=await KnowledgeGraph.queryGraph(e,t)}a&&await this.updateGraph(a)}catch(e){console.error(e)}finally{Spinner.loading(!1)}}buildGraph(e,t,a={}){let[s,n]=KnowledgeGraph.computeGraphDimension(e);Array.isArray(a.dimension)&&2===a.dimension.length&&([s,n]=a.dimension),console.log("== buildGraph:",s,"x",n);const i=echarts.init(e[0],t,{renderer:"canvas",useDirtyRect:!1,width:s,height:n});let o={nodes:[],links:[],categories:GRAPH_MAPPING};o=this.makeGraphOptions(o),i.setOption(o);let r=[Vertices$1.Keyword,Vertices$1.Label,Vertices$1.Checksum];a.deselectLegends&&(r=a.deselectLegends),r.forEach(e=>{i.dispatchAction({type:"legendUnSelect",name:e})});let l=this.onGraphDoubleClickEvent.bind(this);return"function"==typeof a.dblclickFn&&(l=a.dblclickFn),i.on("dblclick",async e=>{await l(e)}),i}async updateGraph(e=[]){if(!this.graph)return;const t=this.graph.getOption().series[0];for(;e.length;){const a=e.pop();if(Array.isArray(a))for(;a.length>2;){const e=a.shift(),s=a.shift(),n=a[0],i=await this.createNodeIfNotExist(e,t),o=await this.createNodeIfNotExist(n,t);void 0!==i&&void 0!==o&&this.createRelationship(i,o,s,t)}else await this.createNodeIfNotExist(a,t)}return this.graph.setOption({series:[t]}),t}resetGraph(){if(!this.graph)return;const e=this.graph.getOption();e.series[0].links=[],e.series[0].data=[],this.graph.setOption(e,!0)}async createNodeIfNotExist(e,t){if(void 0===e)return;const a=t.nodes||t.data;let s=a.findIndex(t=>t.value[0].id===e.id);if(s>=0)return a[s];s=a.length;const n=await this.createNode(e,s);return a.push(n),n}async createNode(e,t){const a={id:e.id,label:e.label,name:e.name,traversed:!1,token:0};if(a.label===Vertices$1.Asset){const e=await this.mediaManager.lazyGetByUuid(a.id);void 0!==e&&(a.image=await e.getThumbnail())}else if(a.label===Vertices$1.Celeb&&e.faceId&&e.collectionId){const t=`face-collection/${e.collectionId}/${e.faceId}.png`;a.image=await this.faceManager.getFaceImage(t)}return this.parseNode(a,t)}parseNode(e,t){const a=e.label;return{id:t,name:a,symbolSize:NODESIZE_BY_TYPE[a]||10,...this.computeXYCoord(),value:[e,{}],category:GRAPH_MAPPING.findIndex(e=>e.name===a)}}createRelationship(e,t,a,s){const n=s.links.findIndex(s=>s.value[0].id===a.id||s.source===e.id&&s.target===t.id);if(n>=0)return s.links[n];const i={source:e.id,target:t.id,value:[{id:a.id,label:a.label,desc:`  (${a.label})  `}]};s.links.push(i);let o=e.value[1];return void 0===o[a.label]&&(o[a.label]=[]),o[a.label].push(t.id),o=t.value[1],void 0===o[a.label]&&(o[a.label]=[]),o[a.label].push(e.id),i}computeXYCoord(){let e,t;const a=this.graph;a&&(e=Math.floor((a.getWidth()||1200)/2),t=Math.floor((a.getHeight()||1200)/2));let s=0-e,n=e,i=n-s+10;const o=Math.floor(Math.random()*i+s);s=0-t,n=t,i=n-s+10;return{x:o,y:Math.floor(Math.random()*i+s)}}makeGraphOptions(e){return{title:{},tooltip:{show:!0,trigger:"item",enterable:!0,alwaysShowContent:!1,padding:0,extraCssText:"border-radius: 0",formatter:e=>{if("edge"===e.dataType){const t=$("<div/>").addClass("my-2"),a=$("<p/>").addClass("text-truncate").append(e.value[0].desc||e.name);return t.append(a),t.prop("outerHTML")}if("node"===e.dataType){const t=e.value[0],a=$("<div/>").addClass("mx-2 my-2");if(void 0!==t.image){a.addClass("graph-tooltip");const e=$("<img/>").attr("src",t.image);a.append(e);const s=$("<p/>").addClass("mx-2 my-2 text-truncate").append(t.name);a.append(s)}else{const e=$("<table/>");a.append(e);const s=$("<tbody/>");e.append(s);const n=Object.keys(t).map(e=>$("<tr/>").append($("<td/>").addClass("font-weight-bold").append(e)).append($("<td/>").addClass("px-2").append(AppUtils.shorten(t[e],32))));s.append(n)}return a.prop("outerHTML")}return e.value}},legend:[{data:e.categories.map(e=>e.name)}],animationDuration:1500,animationEasingUpdate:"quinticInOut",series:[{name:"Graph database",type:"graph",layout:"none",data:e.nodes,links:e.links,categories:e.categories,roam:"move",label:{show:!0,position:"right",formatter:e=>AppUtils.shorten(e.value[0].name,32)},lineStyle:{color:"source",curveness:.3},emphasis:{focus:"adjacency",lineStyle:{width:10}}}]}}resize(){return this.graph.resize()}on(e,t){return this.graphContainer.on(e,t)}off(e){return this.graphContainer.off(e)}async onGraphDoubleClickEvent(e){try{Spinner.loading(!0);const t=e.data.value[0];if(!0!==t.traversed){const e={token:t.token},a=await KnowledgeGraph.queryGraph(t.id,e);a&&a.length?t.token+=a.length:t.traversed=!0,await this.updateGraph(a)}}catch(e){console.error(e)}finally{Spinner.loading(!1)}}static computeGraphDimension(e){const t=2*Math.floor(e.width()/2);return[t,2*Math.floor(t/3)]}static async queryGraph(e,t={}){const a={op:"query",type:"vertice",id:e,token:t.token||0,pagesize:t.pagesize||50};return Array.isArray(t.labels)?a.labels=t.labels.join(","):"string"==typeof t.labels&&t.labels.length>0&&(a.labels=t.labels),ApiHelper.graph(a)}static async queryVertices(e){return ApiHelper.graph({op:"query",type:"vertice",ids:e})}static async queryPaths(e,t){return ApiHelper.graph({op:"path",type:"vertice",from:e,to:t.join(",")})}static async pathVertices(e){return ApiHelper.graph({op:"path",type:"vertice",ids:e.join(",")})}}const{Messages:{KnowledgeGraphTab:TITLE$c,KnowledgeGraphTabDesc:DESC,NoData:NO_DATA}}=Localization,COL_TAB="col-11";class KnowledgeGraphTab extends BaseAnalysisTab{constructor(e){super(TITLE$c,e)}static canSupport(){return KnowledgeGraph.canSupport()}async createContent(){const e=$("<div/>").addClass("col-11 my-4 max-h56r");return this.delayContentLoad(e),e}delayContentLoad(e){e.ready(async()=>{let t;try{this.loading(!0);const a=$("<section/>").addClass("col-9 mx-auto");e.append(a);const s=$("<p/>").addClass("lead-sm").append(DESC);a.append(s),t=$("<section/>").addClass("mt-4"),e.append(t);if(!await this.createKnowledgeGraph(t))return void t.append(NO_DATA)}catch(e){console.error(e),t&&t.append(e.message)}finally{this.loading(!1)}})}async createKnowledgeGraph(e){return new KnowledgeGraph(e,this.media)}}const{Rekognition:{Celeb:Celeb$2,Label:Label$2,FaceMatch:FaceMatch$2,Face,Person,Moderation:Moderation$2,Segment,CustomLabel:CustomLabel$2,Text:Text$1},Comprehend:{Keyphrase:Keyphrase$2,Entity:Entity$2,Sentiment}}=AnalysisTypes;class AnalysisComponent{constructor(e){this.$tabControllers=[],e.searchResults&&this.$tabControllers.push(new SearchResultTab(e)),this.$tabControllers.push(new StatisticsTab(e)),KnowledgeGraphTab.canSupport()&&this.$tabControllers.push(new KnowledgeGraphTab(e)),e.media.getTranscribeResults()&&this.$tabControllers.push(new TranscribeTab(e));const t=e.media.getRekognitionResults();let a=Object.keys(t||{});a.forEach(a=>{[].concat(t[a]).forEach(t=>{let s;a===Celeb$2?s=new CelebTab(e,t):a===Label$2?s=new LabelTab(e,t):a===FaceMatch$2?s=new FaceMatchTab(e,t):a===Face?s=new FaceTab(e,t):a===Person?s=new PersonTab(e,t):a===Moderation$2?s=new ModerationTab(e,t):a===Segment?s=new SegmentTab(e,t):a===CustomLabel$2?s=new CustomLabelTab(e,t):a===Text$1&&(s=new TextTab(e,t)),s&&this.$tabControllers.push(s)})});e.media.getImageAutoCaptioning()&&this.$tabControllers.push(new ImageCaptionTab(e));const s=e.media.getRekognitionImageResults();a=Object.keys(s||{}),a.forEach(t=>{[].concat(s[t]).forEach(a=>{let s;t===Celeb$2?s=new CelebImageTab(e,a):t===Label$2?s=new LabelImageTab(e,a):t===FaceMatch$2?s=new FaceMatchImageTab(e,a):t===Face?s=new FaceImageTab(e,a):t===Text$1?s=new TextImageTab(e,a):t===Moderation$2&&(s=new ModerationImageTab(e,a)),s&&this.$tabControllers.push(s)})});const n=e.media.getComprehendResults();Object.keys(n||{}).forEach(t=>{let a;t===Keyphrase$2?a=new KeyphraseTab(e):t===Entity$2?a=new EntityTab(e):t===Sentiment&&(a=new SentimentTab(e)),a&&this.$tabControllers.push(a)});e.media.getTextractResults()&&this.$tabControllers.push(new TextractTab(e));GetUserSession().canWrite()&&this.$tabControllers.push(new ReAnalyzeTab(e))}get previewComponent(){return this.$previewComponent}get media(){return(this.$previewComponent||{}).media}get tabControllers(){return this.$tabControllers}set tabControllers(e){this.$tabControllers=e}async show(){let e=this.tabControllers.find(e=>e.tabContent.hasClass("active"));return e||(e=this.tabControllers[0]),e.show()}async hide(){return Promise.all(this.tabControllers.map(e=>e.hide()))}createTabsAndContents(){const e=$("<ul/>").addClass("nav flex-column ml-2 my-4").attr("role","tablist");this.tabControllers.forEach(t=>e.append(t.tabLink));const t=this.tabControllers.map(e=>e.tabContent);return[e,t]}createContents(){const[e,t]=this.createTabsAndContents(),a=$("<nav/>").addClass("col-2 d-none d-md-block sidebar vh-70").css("min-height",300).append(e),s=$("<div/>").addClass("tab-content").addClass("col-10 p-0 m-0 vh-70").append(t);return $("<div/>").addClass("col-12 p-0 m-0").append($("<div/>").addClass("row no-gutters").append(a).append(s))}}class CropUtils{constructor(){this.$cropper=void 0,this.$canvas=void 0}get cropper(){return this.$cropper}set cropper(e){this.$cropper=e}get canvas(){return this.$canvas}set canvas(e){this.$canvas=e}async load(e){await this.unload(),e.is("video")&&(this.canvas=this.createCanvas(e),e.before(this.canvas));const t=this.canvas||e;return this.cropper=new Cropper(t[0],{aspectRatio:1,autoCropArea:.5,zoomOnWheel:!1}),this}async unload(){return this.canvas&&this.canvas.remove(),this.canvas=void 0,this.cropper&&this.cropper.destroy(),this.cropper=void 0,this}createCanvas(e){let{width:t,height:a}=e[0].getBoundingClientRect();t=Math.floor(t+.5),a=Math.floor(a+.5);const s=$("<canvas/>").addClass("collapse").attr("width",t).attr("height",a).css("position","absolute").css("top",0).css("left",0);return s[0].getContext("2d").drawImage(e[0],0,0,s[0].width,s[0].height),s}async snapshot(){if(!this.cropper)throw new Error("cropper not loaded");return this.cropper.getCroppedCanvas().toDataURL("image/png")}}const OOPS$4=Localization.Alerts.Oops,CONFIRMED=Localization.Alerts.Confirmed,MSG_NAME=Localization.Messages.Name,MSG_SELECT_COLLECTION=Localization.Messages.SelectFaceCollection,MSG_CONFIRMATION=Localization.Alerts.ConfirmFaceIndexed,MSG_ENABLE_SNAPSHOT_MODE=Localization.Messages.EnableSnapshotMode,ERR_INVALID_COLLECTION=Localization.Alerts.InvalidFaceCollectionSelection,ERR_INVALID_FACE_NAME=Localization.Alerts.InvalidIndexedName,BTN_INDEX_FACE=Localization.Buttons.IndexFace,TOOLTIP_INDEX_FACE=Localization.Tooltips.IndexFace,RANDOM_ID$5=AppUtils.randomHexstring(),ID_CONTAINER$1="snapshot-"+RANDOM_ID$5,ID_SNAPSHOT_TOGGLE="snapshot-toggle-"+RANDOM_ID$5,ID_SELECT_COLLECTION="collection-select-"+RANDOM_ID$5;class SnapshotComponent extends(mxAlert(class{})){constructor(e){super(),this.$previewComponent=e,this.$faceManager=GetFaceManager(),this.$cropUtils=new CropUtils,this.$container=$("<div/>").addClass("col-12 p-0 m-0 my-2 bg-white").attr("id",ID_CONTAINER$1),RegisterFaceManagerEvent("snapshotcomponent",this.onFaceManagerEvent.bind(this)),Spinner.useSpinner()}get ids(){return this.$ids}get container(){return this.$container}get previewComponent(){return this.$previewComponent}get faceManager(){return this.$faceManager}get cropUtils(){return this.$cropUtils}async hide(){await this.cropUtils.unload(),this.container.children().remove()}createComponent(){this.container.children().remove();const e=$("<div/>").addClass("row no-gutters");this.container.append(e);const t=$("<div/>").addClass("col-lg-9 col-md-12 col-sm-12 p-0 m-0");e.append(t);const a=this.createFaceIndexForm();t.append(a);const s=$("<div/>").addClass("col-lg-3 col-md-12 col-sm-12 p-0 m-0 my-auto text-right");e.append(s);const n=this.createSnapshotToggle(a);return s.append(n),this.container}createFaceIndexForm(){const e=$("<form/>").addClass("form-inline needs-validation my-2").attr("novalidate","novalidate"),t=$("<span/>").addClass("lead-s mx-2").html(MSG_NAME);e.append(t);const a=$("<input/>").addClass("form-control form-control-sm col-4 disabled").attr("pattern","^[a-zA-Z0-9 _.-]{0,255}$").attr("placeholder","(Blank)").attr("disabled","disabled");e.append(a);const s=$("<select/>").addClass("custom-select custom-select-sm col-4 disabled").attr("id",ID_SELECT_COLLECTION).attr("disabled","disabled");e.append(s);const n=$("<option/>").attr("value","undefined").html(MSG_SELECT_COLLECTION);s.append(n);const i=$("<button/>").addClass("btn btn-sm btn-success disabled").attr("disabled","disabled").attr("data-toggle","tooltip").attr("data-placement","bottom").attr("title",TOOLTIP_INDEX_FACE).html(BTN_INDEX_FACE).tooltip({trigger:"hover"});return e.append(i),e.ready(async()=>{e.submit(e=>e.preventDefault()),i.on("click",async t=>{try{Spinner.loading(),i.tooltip("hide");const n=s.val(),o=a.val();if("undefined"===n)throw this.shake(e),ERR_INVALID_COLLECTION;if(!this.validateForm(t,e)||!o)throw this.shake(e),a.focus(),ERR_INVALID_FACE_NAME;const r=await this.cropUtils.snapshot();await this.faceManager.indexFace(n,o,r),this.container.find("input#"+ID_SNAPSHOT_TOGGLE).trigger("click");const l=MSG_CONFIRMATION.replace("{{NAME}}",o).replace("{{FACECOLLECTION}}",n);return await this.showConfirm(l,2e3),!0}catch(e){let t=e;return e instanceof Error&&(t=e.message),await this.showAlert(t,5e3),!1}finally{Spinner.loading(!1)}});try{Spinner.loading();const e=(await this.faceManager.getCollections()).map(e=>$("<option/>").attr("value",e.name).html(e.name));s.append(e)}catch(e){console.errror(e)}finally{Spinner.loading(!1)}}),e}createSnapshotToggle(e){const t=$("<div/>").addClass("custom-control custom-switch mr-2"),a=$("<input/>").addClass("custom-control-input").attr("type","checkbox").attr("id",ID_SNAPSHOT_TOGGLE);t.append(a);const s=$("<label/>").addClass("custom-control-label").attr("for",ID_SNAPSHOT_TOGGLE).append(MSG_ENABLE_SNAPSHOT_MODE);return t.append(s),a.on("click",async()=>{if(a.prop("checked")){await this.previewComponent.pause();const t=this.previewComponent.getView();await this.cropUtils.load(t),e.children().removeAttr("disabled").removeClass("disabled")}else await this.cropUtils.unload(),await this.previewComponent.unpause(),e.children().attr("disabled","disabled").addClass("disabled")}),t}validateForm(e,t){return e.preventDefault(),!1!==t[0].checkValidity()||(e.stopPropagation(),!1)}async showAlert(e,t){if(this.previewComponent){const a=this.previewComponent.container;return super.showMessage(a,"danger",OOPS$4,e,t)}}async showConfirm(e,t){if(this.previewComponent){const a=this.previewComponent.container;return super.showMessage(a,"success",CONFIRMED,e,t)}}async onFaceManagerEvent(e,t){if(e!==ON_FACE_COLLECTION_ADDED&&e!==ON_FACE_COLLECTION_REMOVED)return;const a=this.container.find("select#"+ID_SELECT_COLLECTION);let s=a.find(`option[value="${t.name}"]`);e===ON_FACE_COLLECTION_ADDED?0===s.length&&(s=$("<option/>").attr("value",t.name).html(t.name),a.append(s)):e===ON_FACE_COLLECTION_REMOVED&&s.length>0&&(s.is(":selected")&&a.val("undefined").trigger("change"),s.remove())}}const{Messages:{CollectionTab:COLLECTION_TAB$2,VideoTab:VIDEO_TAB$2,PhotoTab:PHOTO_TAB$2,PodcastTab:PODCAST_TAB$2,DocumentTab:DOCUMENT_TAB$2}}=Localization,MEDIATYPE_TO_TAB={[MediaTypes.Video]:VIDEO_TAB$2,[MediaTypes.Photo]:PHOTO_TAB$2,[MediaTypes.Podcast]:PODCAST_TAB$2,[MediaTypes.Document]:DOCUMENT_TAB$2},BKGD_PREVIEW="bg-white",BKGD_TECHVIEW="bg-f0",BKGD_ANALYSISVIEW="bg-light",DATA_VIEW="data-view",VIEW_PREVIEW="preview",VIEW_TECH="technical",VIEW_ANALYSIS="analysis";class BasePreviewSlideComponent extends BaseSlideComponent{constructor(){super(),this.$previewComponent=void 0,this.$analysisComponent=void 0,this.$snapshotComponent=void 0}static get Events(){return PreviewSlideComponentEvents}get previewComponent(){return this.$previewComponent}set previewComponent(e){this.$previewComponent=e}get analysisComponent(){return this.$analysisComponent}set analysisComponent(e){this.$analysisComponent=e}get snapshotComponent(){return this.$snapshotComponent}set snapshotComponent(e){this.$snapshotComponent=e}get media(){return(this.$previewComponent||{}).media}get canWrite(){return GetUserSession().canWrite()}async setMedia(e,t){void 0===t&&this.media===e||(await this.hide(),this.previewComponent=await MediaFactory.createPreviewComponent(e,t),this.analysisComponent=new AnalysisComponent(this.previewComponent)),e.type!==MediaTypes.Video&&e.type!==MediaTypes.Photo||this.canWrite&&!this.snapshotComponent&&(this.snapshotComponent=new SnapshotComponent(this.previewComponent))}async show(){if(!this.initialized){const e=this.createSkeleton();e.ready(async()=>{this.createObserver(e),await this.previewComponent.load(),await this.analysisComponent.show()}),this.slide.append(e)}return this.slide[0].scrollIntoView({behavior:"smooth"}),super.show()}async hide(){return this.snapshotComponent&&await this.snapshotComponent.hide(),this.snapshotComponent=void 0,this.previewComponent&&await this.previewComponent.unload(),this.previewComponent=void 0,this.analysisComponent&&await this.analysisComponent.hide(),this.analysisComponent=void 0,super.hide()}createSkeleton(){const e=$("<div/>").addClass("row no-gutters"),t=$("<div/>").addClass("col-6 p-0 overflow-auto vh-70x").addClass("bg-white").attr(DATA_VIEW,"preview");e.append(t);const a=this.createPreview();t.append(a);const s=$("<div/>").addClass("col-6 p-0 m-0 overflow-auto vh-70x").addClass("bg-f0").attr(DATA_VIEW,VIEW_TECH);e.append(s);const n=this.createTechnicalView();s.append(n);const i=$("<div/>").addClass("col-12 p-0 m-0 overflow-auto").addClass("bg-light").attr(DATA_VIEW,"analysis");e.append(i);const o=this.createAnalysisView();i.append(o);const r=this.createCloseButton();return e.append(r),e}createPreview(){const e=$("<div/>").addClass("col-12 p-0 m-0").append(this.previewComponent.container);let t;return this.snapshotComponent&&(t=this.snapshotComponent.createComponent()),[e,t]}createTechnicalView(){return TechnicalComponentHelper.createContents(this.media)}createAnalysisView(){return this.analysisComponent.createContents()}createCloseButton(){const e=$("<i/>").addClass("far fa-times-circle text-secondary").attr("data-toggle","tooltip").attr("data-placement","bottom").attr("title",Localization.Buttons.ClosePreview).css("font-size","3rem").tooltip({trigger:"hover"}),t=$("<div/>").addClass("close-preview").append($("<button/>").addClass("btn btn-sm btn-link").attr("type","button").append(e));return t.on("click",async e=>{e.preventDefault(),this.slide.trigger(BasePreviewSlideComponent.Events.Preview.Close,[this.media])}),t}createObserver(e){const t=this.media;if(!t)return;const a=MEDIATYPE_TO_TAB[t.type],s=t.uuid,n=[COLLECTION_TAB$2,a,s].join("/");ObserverHelper.setHashOnVisible(e,n)}}class VideoPreviewSlideComponent extends BasePreviewSlideComponent{}const{Messages:{ProcessingTab:MSG_PROCESSING_TAB$1,MediaInProcess:MSG_MEDIA_INPROCESS,MediaError:MSG_MEDIA_ERROR,RemoveMedia:MSG_REMOVE_MEDIA},Alerts:{DeleteMediaNotAllowed:ERR_DELETE_MEDIA_NOT_ALLOWED},Buttons:{Close:BTN_CLOSE}}=Localization;class BaseMediaTab extends BaseTab{constructor(e,t={}){super(e,{fontSize:"1.1rem",...t}),this.$ids={...super.ids,carousel:{container:"media-"+this.id}},this.$categorySlideComponent=void 0,this.$previewSlideComponent=void 0,Spinner.useSpinner()}get categorySlideComponent(){return this.$categorySlideComponent}get previewSlideComponent(){return this.$previewSlideComponent}get canWrite(){return GetUserSession().canWrite()}loading(e){return Spinner.loading(e)}async show(e){if(!this.initialized){const e=$("<div/>").addClass("row no-gutters");this.tabContent.append(e);const t=await this.createCarousel();e.append(t)}return await this.categorySlideComponent.show(e),super.show(e)}async createCarousel(){this.categorySlideComponent.on(BaseCategorySlideComponent.Events.Media.Removing,async(e,t)=>{if(!this.canWrite)return this.showPermissionErrorDialog(t);if(t.overallStatus===SolutionManifest.Statuses.Processing)return this.showProcessingDialog(t);await this.showRemoveMediaDialog(t)&&(this.loading(!0),await this.categorySlideComponent.onMediaRemoved(t),this.loading(!1))}),this.categorySlideComponent.on(BaseCategorySlideComponent.Events.Media.Selected,async(e,t,a)=>t.overallStatus===SolutionManifest.Statuses.Processing?this.showProcessingDialog(t):t.overallStatus===SolutionManifest.Statuses.Error?this.showErrorDialog(t):(this.loading(!0),await this.previewSlideComponent.setMedia(t,a),this.loading(!1),this.slideTo(this.previewSlideComponent.slideId))),this.previewSlideComponent.on(BasePreviewSlideComponent.Events.Preview.Close,async()=>{this.slideTo(this.categorySlideComponent.slideId)});const e=[{id:this.categorySlideComponent.slideId,el:this.categorySlideComponent.getSlide()},{id:this.previewSlideComponent.slideId,el:this.previewSlideComponent.getSlide()}],t=$("<div/>").addClass("carousel-inner");for(let a=0;a<e.length;a++){const s=0===a?"carousel-item active":"carousel-item";t.append($("<div/>").addClass(s).attr("id",e[a].id).append(e[a].el))}const a=$("<div/>").addClass("carousel slide w-100").attr("data-ride",!1).attr("data-interval",!1).attr("id",this.ids.carousel.container).append(t);return a.on("slide.bs.carousel",async e=>{const t=$(e.relatedTarget).prop("id");return t===this.previewSlideComponent.slideId?this.previewSlideComponent.show():t===this.categorySlideComponent.slideId?this.categorySlideComponent.show():void 0}),a}async showPermissionErrorDialog(e){return this.showDialog(e.basename,ERR_DELETE_MEDIA_NOT_ALLOWED)}async showProcessingDialog(e){const t=MSG_MEDIA_INPROCESS.replace("{{BASENAME}}",e.basename).replace("{{PROCESSINGTAB}}",MSG_PROCESSING_TAB$1);return this.showDialog(e.basename,t)}async showErrorDialog(e){const t=MSG_MEDIA_ERROR.replace("{{BASENAME}}",e.basename).replace("{{PROCESSINGTAB}}",MSG_PROCESSING_TAB$1);return this.showDialog(e.basename,t)}async showRemoveMediaDialog(e){let t=!1;const a=MSG_REMOVE_MEDIA.replace("{{BASENAME}}",e.basename),s=$("<button/>").addClass("btn btn-sm btn-outline-danger").append("Yes, remove it");return s.off("click").on("click",async e=>{e.stopPropagation(),e.preventDefault(),t=!0;$(e.currentTarget).parents('div[role="dialog"]').modal("hide")}),await this.showDialog(e.basename,a,[s]),t}async showDialog(e,t,a){return new Promise(s=>{const n=$("<button/>").addClass("btn btn-sm btn-primary").attr("type","button").attr("data-dismiss","modal").append(BTN_CLOSE),i=$("<div/>").addClass("modal-dialog").attr("role","document").append($("<div/>").addClass("modal-content").append($("<div/>").addClass("modal-header").append($("<h5/>").addClass("modal-title lead").html(e))).append($("<div/>").addClass("modal-body").append(t)).append($("<div/>").addClass("modal-footer").append(a).append(n))),o=$("<div/>").addClass("modal fade").attr("tabindex",-1).attr("role","dialog").append(i);o.off("hidden.bs.modal").on("hidden.bs.modal",()=>s(o.remove())),this.tabContent.append(o),o.modal({backdrop:"static",keyboard:!1,show:!0})})}slideTo(e){const t=this.tabContent.find("#"+this.ids.carousel.container).first(),a=t.find("#"+e).index();t.carousel(a)}}const{Messages:{VideoTab:TITLE$b}}=Localization;class VideoTab extends BaseMediaTab{constructor(e){super(TITLE$b,e),this.$categorySlideComponent=new VideoCategorySlideComponent,this.$previewSlideComponent=new VideoPreviewSlideComponent}}class PhotoCategorySlideComponent extends BaseCategorySlideComponent{constructor(){super(MediaTypes.Photo,{objectFit:"cover"})}}class PhotoPreviewSlideComponent extends BasePreviewSlideComponent{}const{Messages:{PhotoTab:TITLE$a}}=Localization;class PhotoTab extends BaseMediaTab{constructor(e){super(TITLE$a,e),this.$categorySlideComponent=new PhotoCategorySlideComponent,this.$previewSlideComponent=new PhotoPreviewSlideComponent}}class PodcastCategorySlideComponent extends BaseCategorySlideComponent{constructor(){super(MediaTypes.Podcast,{objectFit:"cover"})}}class PodcastPreviewSlideComponent extends BasePreviewSlideComponent{}const{Messages:{PodcastTab:TITLE$9}}=Localization;class PodcastTab extends BaseMediaTab{constructor(e){super(TITLE$9,e),this.$categorySlideComponent=new PodcastCategorySlideComponent,this.$previewSlideComponent=new PodcastPreviewSlideComponent}}class DocumentCategorySlideComponent extends BaseCategorySlideComponent{constructor(){super(MediaTypes.Document,{objectFit:"cover"})}}class DocumentPreviewSlideComponent extends BasePreviewSlideComponent{}const{Messages:{DocumentTab:TITLE$8}}=Localization;class DocumentTab extends BaseMediaTab{constructor(e){super(TITLE$8,e),this.$categorySlideComponent=new DocumentCategorySlideComponent,this.$previewSlideComponent=new DocumentPreviewSlideComponent}}const{GraphDefs:{Vertices},Statuses}=SolutionManifest,{Messages:{CollectionTab:COLLECTION_TAB$1,SearchTab:SEARCH_TAB$1,VideoTab:VIDEO_TAB$1,PhotoTab:PHOTO_TAB$1,PodcastTab:PODCAST_TAB$1,DocumentTab:DOCUMENT_TAB$1,Search:MSG_SEARCH_PLACEHOLDER,SearchDesc:MSG_SEARCH_DESC,PageSize10:MSG_OPTION_PAGESIZE_10,PageSize30:MSG_OPTION_PAGESIZE_30,PageSize50:MSG_OPTION_PAGESIZE_50,SearchResultDesc:MSG_SEARCH_RESULT_DESC,NoData:MSG_NO_DATA$1,More:MSG_MORE,SearchExampleSyntax:MSG_SEARCH_EXAMPLE_SYNTAX,SearchExampleSyntaxDesc:MSG_SEARCH_EXAMPLE_SYNTAX_DESC,SearchExample1:MSG_SEARCH_EXAMPLE_1,SearchExample1Desc:MSG_SEARCH_EXAMPLE_1_DESC,SearchExample2:MSG_SEARCH_EXAMPLE_2,SearchExample2Desc:MSG_SEARCH_EXAMPLE_2_DESC,SearchExample3:MSG_SEARCH_EXAMPLE_3,SearchExample3Desc:MSG_SEARCH_EXAMPLE_3_DESC,SearchExample4:MSG_SEARCH_EXAMPLE_4,SearchExample4Desc:MSG_SEARCH_EXAMPLE_4_DESC,SearchExample5:MSG_SEARCH_EXAMPLE_5,SearchExample5Desc:MSG_SEARCH_EXAMPLE_5_DESC,Name:TH_NAME,KnownFaces:TH_KNOWN_FACES,LabelsModeration:TH_LABEL_MODERATION,TranscriptPhrasesEntities:TH_TRANSCRIPT_PHRASE_ENTITIES,VisualText:TH_VISUAL_TEXT,ContentAttributes:TH_CONTENT_ATTRIBS,Submit:BTN_SUBMIT,NoMoreData:BTN_NO_MORE,LoadMore:BTN_LOAD_MORE$1,KGViewConnections:MSG_VIEW_CONNECTIONS},Alerts:{InvalidSearchTerm:ERR_INVALID_SEARCH_TERM}}=Localization,{Rekognition:{Celeb:Celeb$1,FaceMatch:FaceMatch$1,Label:Label$1,CustomLabel:CustomLabel$1,Moderation:Moderation$1,Text},Comprehend:{Keyphrase:Keyphrase$1,Entity:Entity$1,CustomEntity:CustomEntity$1},Transcribe,Textract}=AnalysisTypes,RANDOM_ID$4=AppUtils.randomHexstring(),ID_SEARCHRESULT_LIST="results-list-"+RANDOM_ID$4,ID_SEARCHRESULT_CONTAINER="results-container-"+RANDOM_ID$4,KEY_SEARCHOPTIONS="search-options",OPTKEY_QUERY="query",OPTKEY_PAGESIZE="pageSize",OPTVAL_PAGESIZE10=10,OPTVAL_PAGESIZE30=30,OPTVAL_PAGESIZE50=50,ANALYSIS_FIELDS=[Celeb$1,FaceMatch$1,Label$1,CustomLabel$1,Moderation$1,Text,Textract,Transcribe,Keyphrase$1,Entity$1,CustomEntity$1],DEFAULT_OPTIONS={[MediaTypes.Video]:!0,[MediaTypes.Photo]:!0,[MediaTypes.Podcast]:!0,[MediaTypes.Document]:!0,pageSize:OPTVAL_PAGESIZE10,query:void 0},DATA_UUID$1="data-uuid",ALL_CHARACTER_SETS="[\\p{L}\\p{P}\\p{N}\\p{Sc}\\s]+",NUM_SEARCH_ITEM_SHOW=2;class SearchCategorySlideComponent extends BaseSlideComponent{constructor(){super(),this.$searchOptions={},this.$mediaManager=GetMediaManager(),this.$settingStore=GetSettingStore(),this.$knowledgeGraph=void 0}get searchOptions(){return this.$searchOptions}set searchOptions(e){this.$searchOptions=e}get mediaManager(){return this.$mediaManager}get settingStore(){return this.$settingStore}get knowledgeGraph(){return this.$knowledgeGraph}set knowledgeGraph(e){this.$knowledgeGraph=e}async show(){if(!this.initialized){await this.loadSettings();const e=$("<div/>").addClass("row no-gutters");this.slide.append(e);const t=$("<div/>").addClass("col-9 p-0 mx-auto mt-4");e.append(t);const a=this.createDescription();t.append(a);const s=$("<div/>").addClass("col-9 p-0 mx-auto mb-2");e.append(s);const n=this.createSearchExamples();s.append(n);const i=$("<div/>").addClass("col-9 p-0 mx-auto");e.append(i);const o=this.createCriteriaForm();i.append(o);const r=$("<div/>").addClass("col-12 p-0 mx-auto mt-4").addClass("bg-light");e.append(r);const l=this.createSearchResults();if(r.append(l),KnowledgeGraph.canSupport()){const t=$("<div/>").addClass("col-12 p-0 mx-auto mt-4").addClass("bg-white");e.append(t);const a=this.createGraph();t.append(a)}e.ready(()=>{const t=[COLLECTION_TAB$1,SEARCH_TAB$1].join("/");ObserverHelper.setHashOnVisible(e,t)})}return super.show()}createDescription(){return $("<p/>").addClass("lead").html(MSG_SEARCH_DESC)}createCriteriaForm(){const e=$("<form/>").addClass("col-12 px-0 form-inline needs-validation").attr("novalidate","novalidate").attr("role","form"),t=$("<div/>").addClass("form-group col-12 p-0 mt-2");e.append(t);const a=this.createMediaTypeCheckboxes();t.append(a);const s=$("<div/>").addClass("form-group col-12 p-0 mt-2");e.append(s);const n=this.createSearchInput(e);s.append(n);const i=this.createSubmitButton(e);s.append(i);const o=this.createPageSizeSelection();return s.append(o),e}createMediaTypeCheckboxes(){return[[MediaTypes.Video,VIDEO_TAB$1],[MediaTypes.Photo,PHOTO_TAB$1],[MediaTypes.Podcast,PODCAST_TAB$1],[MediaTypes.Document,DOCUMENT_TAB$1]].map(e=>this.createCheckbox(...e))}createSearchInput(e){const t=$("<input/>").addClass("form-control mr-2 col-6").attr("type","search").attr("pattern",ALL_CHARACTER_SETS).attr("placeholder",MSG_SEARCH_PLACEHOLDER);return t.focusout(async e=>(this.searchOptions.query=t.val()||void 0,!0)),t.keypress(async e=>{if(13===e.which){e.preventDefault(),this.searchOptions.query=t.val()||void 0;return t.siblings('button[type="submit"]').trigger("click")}return!0}),t}createSubmitButton(e){const t=$("<button/>").addClass("btn btn-outline-success my-2").attr("type","submit").append(BTN_SUBMIT);return t.on("click",async a=>{if(a.preventDefault(),!this.validateForm(a,e)){this.shake(e),await this.showAlert(ERR_INVALID_SEARCH_TERM);return t.siblings('input[type="search"]').focus(),!1}return!!this.searchOptions.query&&(this.resetSearchResults(),this.resetGraphResults(),await Promise.all([this.saveSettings(this.searchOptions),this.startSearch(this.searchOptions)]),!1)}),t}createPageSizeSelection(){const e="select-"+AppUtils.randomHexstring(),t=$("<select/>").addClass("custom-select mx-2").attr("id",e);t.on("change",e=>(this.searchOptions.pageSize=Number(t.val()),!0));const a=[[OPTVAL_PAGESIZE10,MSG_OPTION_PAGESIZE_10],[OPTVAL_PAGESIZE30,MSG_OPTION_PAGESIZE_30],[OPTVAL_PAGESIZE50,MSG_OPTION_PAGESIZE_50]].map(e=>{const t=$("<option/>").attr("value",e[0]).html(e[1]);return e[0]===this.searchOptions.pageSize&&t.attr("selected","selected"),t});return t.append(a),t}createCheckbox(e,t){const a=$("<div/>").addClass("form-check form-check-inline mr-2"),s=Array.isArray(e)?e:[e],n=s.reduce((e,t)=>e||this.searchOptions[t],!1),i="checkbox-"+AppUtils.randomHexstring(),o=$("<input/>").addClass("form-check-input").attr("type","checkbox").attr("id",i).attr("value",s.join(",")).prop("checked",n);o.on("click",e=>{const t=o.is(":checked");return s.forEach(e=>this.searchOptions[e]=t),!0}),a.append(o);const r=$("<label/>").addClass("form-check-label mx-1").attr("for",i);return a.append(r),r.append(t),a}validateForm(e,t){return e.preventDefault(),!1!==t[0].checkValidity()||(e.stopPropagation(),!1)}createSearchResults(){const e=$("<div/>").addClass("col-12 p-0 m-0 pb-4").attr("id",ID_SEARCHRESULT_CONTAINER),t=$("<div/>").addClass("col-11 p-0 mx-auto mt-4");e.append(t);const a=$("<p/>").addClass("lead").html(MSG_SEARCH_RESULT_DESC);t.append(a);const s=$("<div/>").addClass("col-12");t.append(s);const n=$("<p/>").addClass("lead text-center text-muted my-4").addClass("search-result-warning").addClass("collapse").append(MSG_NO_DATA$1);s.append(n);const i=$("<div/>").addClass("col-11 p-0 mx-auto mt-4");e.append(i);const o=$("<table/>").addClass("table table-hover lead-xs");i.append(o);const r=this.makeSearchResultTableHeaders();o.append($("<thead/>").append(r)),o.append($("<tbody/>").attr("id",ID_SEARCHRESULT_LIST));const l=$("<div/>").addClass("col-9 p-0 mx-auto mt-4");e.append(l);const d=$("<form/>").addClass("form-inline collapse");l.append(d),d.submit(e=>e.preventDefault());const c=$("<div/>").addClass("mx-auto");d.append(c);const p=$("<button/>").addClass("btn btn-outline-dark").addClass("scan-more-results").data("hits",0).data("nexttoken",0).html(BTN_LOAD_MORE$1);return c.append(p),p.on("click",async()=>this.scanMoreResults(p)),e}makeSearchResultTableHeaders(){const e=$("<tr/>"),t=["#",TH_NAME,TH_KNOWN_FACES,TH_LABEL_MODERATION,TH_TRANSCRIPT_PHRASE_ENTITIES,TH_VISUAL_TEXT,TH_CONTENT_ATTRIBS].map(e=>$("<th/>").addClass("align-middle text-center b-300").attr("scope","col").append(e));return e.append(t),e}searchResultContainer(){return this.slide.find("#"+ID_SEARCHRESULT_CONTAINER)}async refreshSearchResults(e){const t=this.searchResultContainer();t.find(".search-result-warning").addClass("collapse");const a=t.find("#"+ID_SEARCHRESULT_LIST),s=e.hits.length;for(let t=0;t<s;t+=1){const s=e.hits[t],n=s.id;let i=a.find(`tr[data-uuid="${n}"]`);if(i.length>0)continue;let o=this.mediaManager.findMediaByUuid(n);o||(o=await this.mediaManager.insertMedia({uuid:n})),o&&o.overallStatus===Statuses.Completed&&(i=this.createMediaListItem(o,s),a.append(i))}return this.refreshLoadButton(s,e.totalHits,e.nextToken)}createMediaListItem(e,t){const a=$("<tr/>").attr("data-uuid",e.uuid),s=this.createThumbnail(e);a.append(s);const n=AppUtils.shorten(e.basename,24),i=this.makeTableRowItem(n);i.attr("data-toggle","tooltip").attr("data-placement","bottom").attr("title",e.basename).tooltip({trigger:"hover"}),a.append(i);const o=this.makeTableRowItemByIndexTypes([Celeb$1,FaceMatch$1],t.fields);a.append(o);const r=this.makeTableRowItemByIndexTypes([Label$1,CustomLabel$1,Moderation$1],t.fields);a.append(r);const l=this.makeTableRowItemByIndexTypes([Transcribe,Keyphrase$1,Entity$1,CustomEntity$1],t.fields);a.append(l);const d=this.makeTableRowItemByIndexTypes([Text,Textract],t.fields);a.append(d);const c=this.makeTableRowItemContentMetadata(t.fields);return a.append(c),a.on("click",a=>(a.preventDefault(),this.slide.trigger(CategorySlideComponentEvents.Media.Selected,[e,t]))),a}makeTableRowItemByIndexTypes(e,t){let a=e.map(e=>(t[e]||{}).highlights||[]).flat(1).filter(e=>e);a=[...new Set(a)];const s=a.slice(0,2).map(e=>$("<span/>").addClass("badge badge-pill badge-secondary mr-1 mb-1 lead-xxs p-2").html(e)),n=a.length-2;if(n>0){const e=$("<span/>").addClass("badge badge-pill badge-light mr-1 mb-1 lead-xxs p-2").append(`${n} ${MSG_MORE.toLowerCase()}`),t=a.slice(2).join("<br/>");e.attr("data-toggle","tooltip").attr("data-placement","bottom").attr("data-html","true").attr("title",t).tooltip({trigger:"hover"}),s.push(e)}return this.makeTableRowItem(s)}makeTableRowItem(e){const t=$("<td/>").addClass("w-96min align-middle text-center b-300");return e&&e.length?t.append(e):t.append("-"),t}makeTableRowItemContentMetadata(e){let t=Object.keys(e).map(t=>ANALYSIS_FIELDS.includes(t)?[]:e[t].highlights||[]).flat(1).filter(e=>e);t=[...new Set(t)];const a=t.slice(0,2).map(e=>$("<span/>").addClass("badge badge-pill badge-secondary mr-1 mb-1 lead-xxs p-2").html(e)),s=t.length-2;if(s>0){const e=$("<span/>").addClass("badge badge-pill badge-light mr-1 mb-1 lead-xxs p-2").append(`${s} ${MSG_MORE.toLowerCase()}`),n=t.slice(2).join("<br/>");e.attr("data-toggle","tooltip").attr("data-placement","bottom").attr("data-html","true").attr("title",n).tooltip({trigger:"hover"}),a.push(e)}return this.makeTableRowItem(a)}createThumbnail(e){const t=$("<td/>").addClass("align-middle text-center bg-light p-0 m-0"),a=$("<div/>").addClass("overlay-container");t.append(a);const s=$("<img/>").addClass("search-thumbnail");a.append(s);let n="bg-dark";e.type===MediaTypes.Video?n="bg-success":e.type===MediaTypes.Podcast?n="bg-primary":e.type===MediaTypes.Photo?n="bg-secondary":e.type===MediaTypes.Document&&(n="bg-warning");const i=$("<div/>").addClass("abs justify-content-end");a.append(i);const o=$("<div/>").addClass("lead-xxs text-white b-300 px-2").addClass(n).append(e.type);return i.append(o),s.ready(async()=>{const t=await e.getThumbnail();s.attr("src",t)}),t}refreshLoadButton(e,t,a){const s=this.searchResultContainer().find("form");s.removeClass("collapse");const n=s.find("button");n.data("nexttoken",a);const i=n.data("hits");return n.data("hits",i+e),a===t?n.addClass("disabled").attr("disabled","disabled").html(BTN_NO_MORE):n.removeClass("disabled").removeAttr("disabled").html(BTN_LOAD_MORE$1),n}resetSearchResults(){const e=this.searchResultContainer();e.find("#"+ID_SEARCHRESULT_LIST).children().remove();const t=e.find("form");t.addClass("collapse");const a=t.find(".scan-more-results");return a.data("hits",0),a.data("nexttoken",0),e}async scanMoreResults(e){const t=e.data("nexttoken");this.searchOptions.query&&t&&await this.startSearch({...this.searchOptions,token:Number(t)})}async loadSettings(){return this.searchOptions=await this.settingStore.getItem("search-options")||DEFAULT_OPTIONS,this.searchOptions}async saveSettings(e){const t={...e};return delete t.query,this.settingStore.putItem("search-options",t)}async startSearch(e){try{this.loading(!0);const t=window.btoa(encodeURIComponent(e.query)),a=await ApiHelper.search({...e,query:t});if(0===a.totalHits)return void this.displayNoResults();if(0===(a.hits||[]).length)return;a.hits.length>1&&a.hits.sort((e,t)=>t.score-e.score),await Promise.all([this.refreshSearchResults(a),this.refreshGraphResults(a)])}catch(e){console.error(e),this.displaySearchError(e)}finally{this.loading(!1)}}displayNoResults(){this.searchResultContainer().find(".search-result-warning").removeClass("text-danger collapse").addClass("text-muted").text(MSG_NO_DATA$1)}displaySearchError(e){this.searchResultContainer().find(".search-result-warning").removeClass("text-muted collapse").addClass("text-danger").text(e.message)}createSearchExamples(){const e=$("<details/>"),t=$("<summary/>").addClass("my-3");e.append(t);const a=$("<span/>").addClass("lead ml-2").html(MSG_SEARCH_EXAMPLE_SYNTAX);t.append(a);const s=$("<p/>").addClass("lead-s").append(MSG_SEARCH_EXAMPLE_SYNTAX_DESC);e.append(s);const n=[[MSG_SEARCH_EXAMPLE_1,MSG_SEARCH_EXAMPLE_1_DESC],[MSG_SEARCH_EXAMPLE_2,MSG_SEARCH_EXAMPLE_2_DESC],[MSG_SEARCH_EXAMPLE_3,MSG_SEARCH_EXAMPLE_3_DESC],[MSG_SEARCH_EXAMPLE_4,MSG_SEARCH_EXAMPLE_4_DESC],[MSG_SEARCH_EXAMPLE_5,MSG_SEARCH_EXAMPLE_5_DESC]].map(e=>[$("<p/>").addClass("lead-s font-weight-bold my-2").append(e[0]),$("<span/>").addClass("lead-s font-italic d-block mb-4").append(e[1])]).flat(1);return e.append(n),e}createGraph(){const e=[],t=$("<details/>").addClass("col-11 m-0 p-0 mt-4 mx-auto");e.push(t);const a=$("<summary/>").addClass("my-3");t.append(a);const s=$("<span/>").addClass("lead").html(MSG_VIEW_CONNECTIONS);a.append(s);const n=$("<div/>").addClass("col-11 m-0 p-0 mx-auto").addClass("mt-4").addClass("collapse");return e.push(n),n.ready(async()=>{const e=2*Math.floor(n.width()/2);let t=.7*$(window).height();t=2*Math.floor(t/2),t=Math.max(t,600),console.log("graphContainer.ready",e,t),await this.renderKnowledgeGraph(n,e,t)}),t.on("click",async()=>{t.prop("open")?n.addClass("collapse"):n.removeClass("collapse")}),e}async renderKnowledgeGraph(e,t,a){try{if(!0===e.data("rendered"))return;this.loading(!0);const s=this.searchResultContainer().find("#"+ID_SEARCHRESULT_LIST),n=[];s.find("tr[data-uuid]").each((e,t)=>{n.push($(t).data("uuid"))});let i=[];n.length>0&&(i=await KnowledgeGraph.queryVertices(n)),console.log("vertices",i);const o={dataset:i,deselectLegends:[Vertices.Checksum],dimension:[t,a],dblclickFn:this.onGraphDoubleClickEvent.bind(this)};this.knowledgeGraph=new KnowledgeGraph(e,void 0,o)}catch(e){console.error(e)}finally{e.data("rendered",!0),this.loading(!1)}}async refreshGraphResults(e){if(!this.knowledgeGraph)return;const t=e.hits.map(e=>e.id),a=this.knowledgeGraph.getGraphOption().series[0].data.filter(e=>e.name===Vertices.Asset).map(e=>e.value[0].id);for(;a.length;){const e=a.pop(),s=t.find(t=>t===e);s>=0&&t.splice(s,1)}if(0===t.length)return;const s=await KnowledgeGraph.queryVertices(t);await this.knowledgeGraph.updateGraph(s)}resetGraphResults(){this.knowledgeGraph&&this.knowledgeGraph.resetGraph()}async onGraphDoubleClickEvent(e){const t=e.data.value[0];if(e.name===Vertices.Asset&&!0!==t.querypaths)try{t.querypaths=!0,this.loading(!0);const e=[];if(this.knowledgeGraph.getGraphOption().series[0].data.forEach(a=>{a.name===Vertices.Asset&&a.value[0].id!==t.id&&e.push(a.value[0].id)}),!e.length)return;const a=await KnowledgeGraph.queryPaths(t.id,e);await this.knowledgeGraph.updateGraph(a)}catch(e){console.error(e)}finally{this.loading(!1)}else await this.knowledgeGraph.onGraphDoubleClickEvent(e)}}class SearchPreviewSlideComponent extends BasePreviewSlideComponent{}const{Messages:{SearchTab:TITLE$7}}=Localization;class SearchTab extends BaseMediaTab{constructor(e){super(TITLE$7,e),this.$categorySlideComponent=new SearchCategorySlideComponent,this.$previewSlideComponent=new SearchPreviewSlideComponent,this.$tabLink.addClass("ml-auto"),this.$tabLink.find("a").addClass("search-border")}}const{Messages:{CollectionTab:TITLE$6,VideoTab:MSG_VIDEO_TAB,PhotoTab:MSG_PHOTO_TAB,PodcastTab:MSG_PODCAST_TAB,DocumentTab:MSG_DOCUMENT_TAB,SearchTab:MSG_SEARCH_TAB}}=Localization,[VIDEO_TAB,PHOTO_TAB,PODCAST_TAB,DOCUMENT_TAB,SEARCH_TAB,RECOMMEND_TAB]=[MSG_VIDEO_TAB,MSG_PHOTO_TAB,MSG_PODCAST_TAB,MSG_DOCUMENT_TAB,MSG_SEARCH_TAB].map(e=>e.replaceAll(" ","")),ORDERED_CONTROLLERS$1=[VIDEO_TAB,PHOTO_TAB,PODCAST_TAB,DOCUMENT_TAB,SEARCH_TAB,RECOMMEND_TAB];class CollectionTab extends BaseTab{constructor(){super(TITLE$6),this.$ids={...super.ids,tablist:"tablist-"+this.id,tabcontent:"tabcontent-"+this.id},this.$tabControllers={[VIDEO_TAB]:new VideoTab,[PHOTO_TAB]:new PhotoTab,[PODCAST_TAB]:new PodcastTab,[DOCUMENT_TAB]:new DocumentTab,[SEARCH_TAB]:new SearchTab}}get ids(){return this.$ids}get tabControllers(){return this.$tabControllers}async show(e){const{current:t,next:a}=this.parseHashtag(e);if(!this.initialized){const e=$("<nav/>").addClass("navbar navbar-expand-lg navbar-light bg-light").append(this.createTabToggle()).append(this.createTabItems());this.tabContent.append(e),this.tabContent.append(this.createTabContents())}let s=this.tabControllers[t];if(!s){const e=this.tabContent.find(".tab-pane.active.show").attr("aria-labelledby");e&&(s=Object.values(this.tabControllers).find(t=>t.tabId===e))}return s?await s.show(a):await this.tabControllers[VIDEO_TAB].show(""),super.show(e)}createTabToggle(){const e=this.ids.tablist;return $("<button/>").addClass("navbar-toggler").attr("type","button").attr("data-toggle","collapse").attr("data-target","#"+e).attr("aria-controls",e).attr("aria-expanded","false").attr("aria-label","Collection tabs").append($("<span/>").addClass("navbar-toggler-icon"))}createTabItems(){const e=this.ids.tablist,t=$("<div/>").addClass("collapse navbar-collapse").attr("id",e),a=$("<div/>").addClass("navbar-nav w-100").attr("role","tablist");return t.append(a),ORDERED_CONTROLLERS$1.forEach(e=>{const t=this.tabControllers[e];void 0!==t&&a.append(t.tabLink)}),t}createTabContents(){const e=$("<div/>").addClass("tab-content").attr("id",this.ids.tabcontent);return ORDERED_CONTROLLERS$1.forEach(t=>{const a=this.tabControllers[t];void 0!==a&&e.append(a.tabContent)}),e}}const{MimeGetMime:MimeGetMime$1}=window.MimeWrapper;class BaseFile extends(mxReadable(class{})){constructor(e,t,a=!0){super(),this.$displayName=e,this.$canSupport=!!a,this.$file=t,this.$mime=MimeGetMime$1(t),this.$fileId="file-"+AppUtils.randomHexstring()}static get Events(){return{File:{Remove:"file:remove"}}}get file(){return this.$file}get mime(){return this.$mime}get displayName(){return this.$displayName}get canSupport(){return this.$canSupport}get fileId(){return this.$fileId}async createItem(){const e=$("<li/>").addClass("list-group-item d-flex").attr("data-file-id",this.fileId).attr("data-display-name",this.displayName),t=$("<i/>").addClass(this.getIcon()+" align-self-center").css("font-size","3rem").css("font-weight",300).css("color","#888"),a=$("<dl/>").addClass("row lead-xs ml-2 col-9 no-gutters").append($("<dt/>").addClass("text-left col-sm-1").append(Localization.Messages.FileName)).append($("<dd/>").addClass("col-sm-11 my-0").append(this.displayName)).append($("<dt/>").addClass("text-left col-sm-1 my-0").append(Localization.Messages.FileSize)).append($("<dd/>").addClass("col-sm-11 my-0").append(BaseFile.readableFileSize(this.file.size))).append($("<dt/>").addClass("text-left col-sm-1 my-0").append(Localization.Messages.FileType)).append($("<dd/>").addClass("col-sm-11 my-0").append(this.mime||"--")),s=$("<button/>").addClass("btn btn-sm btn-secondary text-capitalize mb-1 ml-1").attr("data-toggle","tooltip").attr("data-placement","bottom").attr("title",Localization.Tooltips.RemoveFromList).append(Localization.Buttons.Remove).tooltip({trigger:"hover",boundary:"window"});s.off("click").on("click",t=>{e.trigger(BaseFile.Events.File.Remove,[this])});const n=$("<i/>").addClass("fas fa-exclamation-circle mr-2").css("font-size","1.2rem").css("color","#dc3545").attr("data-toggle","tooltip").attr("data-placement","bottom").attr("title",Localization.Tooltips.UploadOnly).tooltip({trigger:"hover",boundary:"window"});this.canSupport&&n.addClass("collapse");const i=$("<div/>").addClass("ml-auto align-self-center").append(n).append(s);return e.append(t).append(a).append(i)}getIcon(){const[e,t]=(this.mime||"").split("/");return"video"===e?"far fa-file-video":"audio"===e?"far fa-file-audio":"image"===e?"far fa-file-image":"pdf"===t?"far fa-file-pdf":"msword"===t||"vnd.openxmlformats-officedocument.wordprocessingml.document"===t?"far fa-file-word":"vnd.ms-powerpoint"===t||"vnd.openxmlformats-officedocument.presentationml.presentation"===t?"far fa-file-powerpoint":"vnd.ms-excel"===t||"vnd.openxmlformats-officedocument.spreadsheetml.sheet"===t?"far fa-file-excel":"zip"===t||"x-7z-compressed"===t||"vnd.rar"===t||"gzip"===t?"far fa-file-archive":"csv"===t?"fas fa-file-csv":"json"===t||"xml"===t?"far fa-file-code":"far fa-file-alt"}}class FileItem extends BaseFile{constructor(e,t,a){super(e,t,a),this.$uuid=void 0,this.$checksum=void 0,this.$attributes=void 0,this.$analysis=void 0}get uuid(){return this.$uuid}get checksum(){return this.$checksum}get attributes(){return this.$attributes}get analysis(){return this.$analysis}get group(){return(this.attributes||{}).group}setUuid(e){this.$uuid=e}setChecksum(e){this.$checksum=e}setAttributes(e){this.$attributes={...e}}setAnalysis(e){this.$analysis={...e}}resolveKey(){const e=(this.attributes||{}).group,t=this.displayName,a="/"===t.charAt(0)?t.slice(1):t;if(e)return`${e}/${a}`;if(a.indexOf("/")>0)return a;const s=a.lastIndexOf(".");return`${a.substring(0,s<0?a.length:s)}/${a}`}}var mxDropzone=e=>class extends e{fileEntrySupported(){return"function"==typeof DataTransferItem.prototype.webkitGetAsEntry}canSupport(e){return!0}createDropzone(e){const t=$("<div/>").addClass("d-flex justify-content-center dropzone-bg").append($("<span/>").addClass("align-self-center").html(e)),a=$("<div/>").addClass("dropzone").append($("<p>").addClass("lead m-auto").append(t));return["dragenter","dragover","dragleave","drop"].forEach(e=>{a.off(e).on(e,e=>{e.preventDefault(),e.stopPropagation()})}),a.on("dragenter",async e=>{}),a.on("dragleave",async e=>{}),a.on("drop",async e=>this.processDropEvent(e)),a}async processDropEvent(e){try{"function"==typeof this.loading&&this.loading(!0);const t=await this.processDropItems(e.originalEvent.dataTransfer);return Promise.all(t.map(e=>this.processEachFileItem(e)))}catch(e){return}finally{"function"==typeof this.loading&&this.loading(!1)}}async processDropItems(e){return this.fileEntrySupported()?this.useGetAsEntry(e):this.useFileReader(e)}async useGetAsEntry(e){const t=[],a=[];for(let s=0;s<e.items.length;s++){const n=e.items[s].webkitGetAsEntry();n.isFile?t.push(this.readFileEntry(n)):a.push(this.readDirectoryEntry(n))}const s=await Promise.all(t);return(await Promise.all(a)).reduce((e,t)=>e.concat(t),s).filter(e=>e)}async readFileEntry(e){return new Promise((t,a)=>{e.file(a=>t(new FileItem(e.fullPath,a,this.canSupport(a))),()=>t(void 0))})}async readEntries(e){return new Promise(t=>{e.readEntries(e=>{if(0===e.length)return t(void 0);const a=[],s=[];for(;e.length;){const t=e.shift();t.isFile?a.push(this.readFileEntry(t)):s.push(this.readDirectoryEntry(t))}return t({files:a,dirs:s})})})}async readDirectoryEntry(e){const t=e.createReader(),a=[],s=[];let n;do{n=await this.readEntries(t),n&&(a.splice(a.length,0,...n.files),s.splice(s.length,0,...n.dirs))}while(void 0!==n);const i=await Promise.all(a);return(await Promise.all(s)).reduce((e,t)=>e.concat(t),i)}async useFileReader(e){const t=[];for(let a=0;a<e.files.length;a++)t.push(this.readFile(e.files[a]));return await Promise.all(t)}async readFile(e){return new FileItem(e.name,e,this.canSupport(e))}async processEachFileItem(e){throw new Error("subclass to implement")}};class BaseUploadSlideComponent extends BaseSlideComponent{static get Controls(){return{Back:"slide:control:back",Next:"slide:control:next",Cancel:"slide:control:cancel",Done:"slide:control:done",StartOver:"slide:control:startover",QuickUpload:"slide:control:quickupload",StartNow:"slide:control:startnow"}}}const{MimeGetKind}=window.MimeWrapper;class DropzoneSlideComponent extends(mxDropzone(BaseUploadSlideComponent)){constructor(){super(),this.$ids={...this.$ids,uploadList:"upload-list"},this.$fileList=[]}static get Events(){return{Dropzone:{Item:{Added:"dropzone:file:added",Empty:"dropzone:file:empty"}}}}get fileList(){return this.$fileList}canSupport(e){const t=MimeGetKind(e);return t===MediaTypes.Video||t===MediaTypes.Audio||t===MediaTypes.Image||t===MediaTypes.Document}async processDropEvent(e){const t=await super.processDropEvent(e);return t&&(this.fileList.splice(this.fileList.length,0,...t),this.slide.trigger(DropzoneSlideComponent.Events.Dropzone.Item.Added)),t}async processEachFileItem(e){const t=await e.createItem();return t.on(FileItem.Events.File.Remove,()=>this.onFileRemove(t)),this.slide.find("."+this.ids.uploadList).find(".list-group").append(t),e}async clearData(){return this.slide.find("."+this.ids.uploadList).find(".list-group").children().remove(),this.fileList.length=0,this.slide.trigger(DropzoneSlideComponent.Events.Dropzone.Item.Empty),this}async getData(){return this.fileList}async createSlide(){const e=this.createDescription(),t=this.createDropzone(Localization.Messages.DropFileHere),a=this.createUploadList(),s=this.createControls(),n=$("<div/>").addClass("row no-gutters").append($("<div/>").addClass("col-12 p-0 m-0").append(e)).append($("<div/>").addClass("col-12 p-0 m-0 mt-4").append(t)).append($("<div/>").addClass("col-12 p-0 m-0 mt-4").append(a)).append($("<div/>").addClass("col-12 p-0 m-0 mt-4").append(s));return this.slide.append(n),super.createSlide()}createDescription(){return $("<p/>").addClass("lead").html(Localization.Messages.DropzoneDesc)}createControls(){const e=$("<input/>").attr("type","file").attr("multiple","multiple").attr("accept","*").css("display","none"),t=$("<button/>").addClass("btn btn-secondary").html(Localization.Buttons.BrowseFiles),a=$("<div/>").addClass("mr-auto").append(t).append(e),s=$("<button/>").addClass("btn btn-light ml-1").html(Localization.Buttons.Startover),n=$("<button/>").addClass("btn btn-success ml-1").attr("disabled","disabled").html(Localization.Buttons.QuickUpload),i=$("<button/>").addClass("btn btn-primary ml-1").attr("disabled","disabled").html(Localization.Buttons.Next);this.slide.on(DropzoneSlideComponent.Events.Dropzone.Item.Empty,()=>{n.attr("disabled","disabled"),i.attr("disabled","disabled")}),this.slide.on(DropzoneSlideComponent.Events.Dropzone.Item.Added,()=>{this.slide.find("."+this.ids.uploadList).attr("open",""),n.removeAttr("disabled"),i.removeAttr("disabled")}),t.off("click").on("click",()=>e.click()),e.off("change").on("change",async()=>{await this.processInputEvent(event.currentTarget),e.val("")}),s.off("click").on("click",async e=>this.slide.trigger(DropzoneSlideComponent.Controls.StartOver)),n.off("click").on("click",async e=>this.slide.trigger(DropzoneSlideComponent.Controls.QuickUpload,[this.fileList])),i.off("click").on("click",async e=>this.slide.trigger(DropzoneSlideComponent.Controls.Next,[this.fileList]));const o=$("<form/>").addClass("form-inline").append(a).append($("<div/>").addClass("ml-auto").append(s).append(n).append(i));return o.submit(e=>e.preventDefault()),o}async processInputEvent(e){try{this.loading(!0);let t=await this.useFileReader(e);return t=await Promise.all((t||[]).map(e=>this.processEachFileItem(e))),t.length>0&&(this.fileList.splice(this.fileList.length,0,...t),this.slide.trigger(DropzoneSlideComponent.Events.Dropzone.Item.Added)),t}catch(e){return}finally{this.loading(!1)}}createUploadList(){const e=$("<details/>").addClass("my-2 "+this.ids.uploadList).append($("<summary/>").addClass("mb-2").append(Localization.Messages.FileToBeProcessed)),t=$("<ul/>").addClass("list-group");return e.append(t)}onFileRemove(e){const t=e.data("file-id"),a=this.fileList.findIndex(e=>e.fileId===t);a>=0&&this.fileList.splice(a,1),this.fileList.length||this.slide.trigger(DropzoneSlideComponent.Events.Dropzone.Item.Empty),setTimeout(()=>e.remove(),300)}}class AttributeSlideComponent extends BaseUploadSlideComponent{constructor(){super(),this.$ids={...this.$ids,groupName:"attr-"+AppUtils.randomHexstring(),attributeForm:"attr-"+AppUtils.randomHexstring()},this.$group="",this.$attributeList=[]}static get Constants(){return{Attribute:{Max:20}}}get group(){return this.$group}set group(e){this.$group=e}get attributeList(){return this.$attributeList}async saveData(){const e=this.slide.find("#"+this.ids.groupName);this.group=e.val(),this.attributeList.length=0;this.slide.find("#"+this.ids.attributeForm).children(".input-group").each((e,t)=>{const a=$(t).find('[data-attr-type="key"]').val(),s=$(t).find('[data-attr-type="value"]').val();a&&s&&this.attributeList.push({key:a,value:s})})}async getData(){const e=this.attributeList.reduce((e,t)=>({...e,[t.key]:t.value}),{});return this.group&&(e.group=this.group),e}async clearData(){this.slide.find("#"+this.ids.attributeForm).children(".input-group").remove(),this.slide.find("#"+this.ids.groupName).val(""),this.attributeList.length=0,this.group=""}async createSlide(){const e=this.createDescription(),t=this.createGroupName(),a=this.createAttributes(),s=$("<div/>").addClass("attr-group").addClass("overflow-auto my-auto align-content-start").append(t).append(a),n=this.createControls(),i=$("<div/>").addClass("row no-gutters").append($("<div/>").addClass("col-12 p-0 m-0 mt-4").append(e)).append($("<div/>").addClass("col-12 p-0 m-0 mt-4").append(s)).append($("<div/>").addClass("col-12 p-0 m-0 mt-4").append(n));return this.slide.append(i),super.createSlide()}createDescription(){return $("<p/>").addClass("lead").html(Localization.Messages.AttributeDesc)}createControls(){const e=$("<button/>").addClass("btn btn-light ml-1").html(Localization.Buttons.Back),t=$("<button/>").addClass("btn btn-success ml-1").html(Localization.Buttons.QuickUpload),a=$("<button/>").addClass("btn btn-primary ml-1").html(Localization.Buttons.Next);e.off("click").on("click",async e=>this.slide.trigger(AttributeSlideComponent.Controls.Back)),t.off("click").on("click",async e=>{await this.saveData(),this.slide.trigger(AttributeSlideComponent.Controls.QuickUpload)}),a.off("click").on("click",async e=>{let t=!0;if(this.slide.find("form.needs-validation").each((e,a)=>(t=a[0].checkValidity(),t)),!1===t)return e.preventDefault(),void e.stopPropagation();await this.saveData(),this.slide.trigger(AttributeSlideComponent.Controls.Next)});const s=$("<form/>").addClass("form-inline").append($("<div/>").addClass("ml-auto").append(e).append(t).append(a));return s.submit(e=>e.preventDefault()),s}createGroupName(){const e=$("<span/>").addClass("d-block p-2 bg-light text-black lead").html("Group Name"),t=$("<p/>").addClass("mt-2").html(Localization.Messages.GroupDesc),a=$("<input/>").addClass("form-control mr-2").attr("id",this.ids.groupName).attr("pattern","^[a-zA-Z0-9_-]{0,128}$").attr("placeholder","(Blank)"),s=$("<form/>").addClass("col-4 px-0 needs-validation").attr("novalidate","novalidate").append($("<label/>").addClass("mr-2 sr-only").attr("for",this.ids.groupName).html(Localization.Messages.GroupName)).append(a);return a.focusout(async e=>!!this.validateForm(e,s)||(this.shake(s),await this.showAlert(Localization.Alerts.InvalidGroupName),a.focus(),!1)),a.keypress(async e=>!(13===e.which&&!this.validateForm(e,s))||(this.shake(s),await this.showAlert(Localization.Alerts.InvalidGroupName),a.focus(),!1)),$("<div/>").addClass("mt-0").append(e).append(t).append(s)}createAttributes(){const e=$("<span/>").addClass("d-block p-2 bg-light text-black lead").html("Additional attributes"),t=$("<p/>").addClass("mt-2").html(Localization.Messages.AttrDesc),a=$("<button/>").addClass("btn btn-success mb-2").attr("type","button").html("Add attribute"),s=$("<form/>").addClass("col-9 px-0 needs-validation").attr("id",this.ids.attributeForm).attr("novalidate","novalidate").append(a);return a.off("click").on("click",async e=>(e.preventDefault(),s.children(".input-group").length>=AttributeSlideComponent.Constants.Attribute.Max?(e.stopPropagation(),this.shake(s),await this.showAlert(Localization.Alerts.MaxNumOfAttrs),!1):(s.append(this.createKeyValue()),!0))),$("<div/>").addClass("mt-4").append(e).append(t).append(s)}createKeyValue(){const e=$("<div/>").addClass("input-group mb-2 mr-sm-2"),t=$("<input/>").addClass("form-control col-3").attr("data-attr-type","key").attr("type","text").attr("placeholder","(Key)").attr("pattern","^[a-zA-Z0-9_-]{0,128}$"),a=$("<input/>").addClass("form-control").attr("data-attr-type","value").attr("type","text").attr("placeholder","(Value)").attr("pattern","^[a-zA-Z0-9_%., -]{0,255}$"),s=$("<button/>").addClass("btn btn-secondary ml-1").append($("<i/>").addClass("far fa-times-circle"));return s.off("click").on("click",t=>{t.preventDefault(),e.remove()}),[t,a].forEach(t=>{t.focusout(async a=>{const s=e.parent("form").first();return!(!this.validateForm(a,s)&&!t[0].validity.valid)||(this.shake(s),await this.showAlert(Localization.Alerts.InvalidKeyValue),t.focus(),!1)}),t.keypress(async a=>{if(13===a.which){const s=e.parent("form").first();if(!this.validateForm(a,s)&&!t[0].validity.valid)return this.shake(s),await this.showAlert(Localization.Alerts.InvalidKeyValue),t.focus(),!1}return!0})}),e.append(t).append(a).append(s),e}validateForm(e,t){return e.preventDefault(),!1!==t[0].checkValidity()||(e.stopPropagation(),!1)}}const DATATYPE_SLIDE_CONTROLS="slide-controls";class AnalysisSlideComponent extends(mxAnalysisSettings(BaseUploadSlideComponent)){get parentContainer(){return this.slide}createDescription(){return $("<p/>").addClass("lead").html(Localization.Messages.ReviewAnalysisSettings)}createControls(){const e=$("<button/>").addClass("btn btn-light ml-1").html(Localization.Buttons.Back),t=$("<button/>").addClass("btn btn-primary ml-1").html(Localization.Buttons.Next);e.off("click").on("click",async e=>this.slide.trigger(AnalysisSlideComponent.Controls.Back)),t.off("click").on("click",async e=>this.slide.trigger(AnalysisSlideComponent.Controls.Next));const a=$("<form/>").addClass("form-inline").attr("data-type","slide-controls").append($("<div/>").addClass("ml-auto").append(e).append(t));return a.submit(e=>e.preventDefault()),a}async createSlide(){return await this.show(),this.slide.find("form.col-9").removeClass("col-9").addClass("col-12"),this.slide.find("form[data-type=slide-controls]").parent().removeClass("col-9").addClass("col-12"),super.createSlide()}async getData(){return this.loadLocalSettings()}}const{MimeGetMime}=window.MimeWrapper,MSG_STATUS_NOT_STARTED=Localization.Statuses.NotStarted,MSG_STATUS_WAITING=Localization.Statuses.Waiting,MSG_STATUS_PROCESSING=Localization.Statuses.Processing,MSG_STATUS_COMPLETED=Localization.Statuses.Completed,MSG_STATUS_ERROR=Localization.Statuses.Error,MSG_STATUS_TOTAL=Localization.Statuses.Total,MSG_VALIDATE_UUID=Localization.Messages.ValidateUuid,MSG_COMPUTE_CHECKSUM=Localization.Messages.ComputeChecksum,MSG_UPLOAD_STATUS=Localization.Messages.UploadStatus,MSG_UPLOAD_S3=Localization.Messages.UploadS3,MSG_FINALIZE_UPLOAD_DESC=Localization.Messages.FinalizeUploadDesc,MSG_SUMMARY=Localization.Messages.Summary,PROPKEY_SOURCE=Localization.Messages.Source,PROPKEY_FILENAME=Localization.Messages.FileName,PROPKEY_FILESIZE=Localization.Messages.FileSize,PROPKEY_FILETYPE=Localization.Messages.FileType,PROPKEY_LASTMODIFIED=Localization.Messages.LastModified,PROPKEY_DESTINATION=Localization.Messages.Destination,PROPKEY_BUCKET=Localization.Messages.Bucket,PROPKEY_KEY=Localization.Messages.Key,PROPKEY_ATTRIBUTES=Localization.Messages.Attributes,BTN_CANCEL=Localization.Buttons.Cancel,BTN_START_NOW=Localization.Buttons.StartNow,BTN_DONE=Localization.Buttons.Done,BTN_DOWNLOAD_SUMMARY=Localization.Buttons.DownloadSummary,ERR_UPLOAD_S3=Localization.Alerts.UploadS3Error,ERR_CREATE_UUID=Localization.Alerts.CreateUuidError,ERR_COMPUTE_CHECKSUM=Localization.Alerts.ComputeChecksumError,ERR_START_WORKFLOW=Localization.Alerts.StartWorkflowError,MD5_CHUNK_SIZE=8388608;class FinalizeSlideComponent extends BaseUploadSlideComponent{constructor(){super(),this.$ids={...this.$ids,tablist:"finalize-"+AppUtils.randomHexstring(),tabcontent:"finalize-"+AppUtils.randomHexstring()},this.$report=[],this.$fileList=[],this.$bucket=SolutionManifest.Ingest.Bucket}static get Events(){return{Overall:{Started:"finalize:overall:started",Progress:"finalize:overall:progress",Completed:"finalize:overall:completed"},Process:{Uuid:"finalize:process:uuid",Checksum:"finalize:process:checksum",UploadS3:"finalize:process:uploads3",Statuses:{Started:"finalize:process:started",Completed:"finalize:process:completed",Error:"finalize:process:error"}}}}get bucket(){return this.$bucket}get fileList(){return this.$fileList}set fileList(e){this.$fileList=e}get report(){return this.$report}set report(e){this.$report=e}async getData(){const{elapsed:e,bytes:t}=this.report.reduce((e,t)=>({elapsed:e.elapsed+t.elapsed,bytes:e.bytes+t.src.bytes}),{elapsed:0,bytes:0}),a=this.report.filter(e=>e.error);return{completed:this.report.length-a.length,errors:a.length,elapsed:e,bytes:t,items:this.report}}async clearData(){this.report.length=0,this.slide.find("#"+this.ids.tablist).children().remove(),this.slide.find("#"+this.ids.tabcontent).children().remove(),this.fileList.length=0}async createSlide(){const e=this.createDescription(),t=this.createControls(),a=this.createFinalizedList(),s=$("<div/>").addClass("row no-gutters").append($("<div/>").addClass("col-12 p-0 m-0 mt-4").append(e)).append($("<div/>").addClass("col-12 p-0 m-0 mt-4").append(a)).append($("<div/>").addClass("col-12 p-0 m-0 mt-4").append(t));return this.slide.append(s),super.createSlide()}createDescription(){const e=$("<a/>").attr("href",AWSConsoleS3.getLink(this.bucket)).attr("target","_blank").html(this.bucket),t=MSG_FINALIZE_UPLOAD_DESC.replace("{{BUCKET}}",e.prop("outerHTML"));return $("<p/>").addClass("lead").html(t)}createControls(){const e=$("<button/>").addClass("btn btn-light ml-1").html(BTN_CANCEL),t=$("<button/>").addClass("btn btn-success ml-1").html(BTN_START_NOW),a=$("<button/>").addClass("btn btn-success ml-1 collapse").html(BTN_DONE),s=$("<span/>").addClass("lead collapse").html(MSG_STATUS_NOT_STARTED),n=$("<a/>").addClass("btn btn-light ml-1 collapse").attr("role","button").attr("href","").attr("download","").attr("target","_blank").html(BTN_DOWNLOAD_SUMMARY),i=()=>{n.addClass("collapse"),a.addClass("collapse"),t.removeClass("collapse"),e.removeClass("collapse"),s.addClass("collapse").removeClass("text-success text-danger").html(MSG_STATUS_NOT_STARTED)};let o;e.off("click").on("click",async e=>{i(),this.slide.trigger(FinalizeSlideComponent.Controls.Cancel)}),t.off("click").on("click",async e=>this.startNow()),a.off("click").on("click",async e=>{i(),this.slide.trigger(FinalizeSlideComponent.Controls.Done)}),this.slide.on(FinalizeSlideComponent.Events.Overall.Started,async(a,s)=>{o=s,t.attr("disabled","disabled"),e.attr("disabled","disabled")}),this.slide.on(FinalizeSlideComponent.Events.Overall.Progress,async(e,t)=>{s.removeClass("collapse").html(`${MSG_STATUS_PROCESSING} (${t+1} / ${o})...`)}),this.slide.on(FinalizeSlideComponent.Events.Overall.Completed,async(i,r)=>{const l=URL.createObjectURL(new Blob([JSON.stringify(r,null,2)],{type:"application/json"}));n.prop("href",l).prop("download","summary.json"),t.addClass("collapse").removeAttr("disabled"),e.addClass("collapse").removeAttr("disabled"),n.removeClass("collapse"),a.removeClass("collapse");const d=`${MSG_STATUS_COMPLETED} / ${MSG_STATUS_ERROR} / ${MSG_STATUS_TOTAL}: (${r.completed} / ${r.errors} / ${o})`;s.addClass("text-dark").html(d)});const r=$("<form/>").addClass("form-inline").append($("<div/>").addClass("ml-auto").append(s)).append($("<div/>").addClass("ml-auto").append(e).append(t).append(n).append(a));return r.submit(e=>e.preventDefault()),r}createFinalizedList(){const e=$("<div/>").addClass("col-4 px-0 mx-0 overflow-auto h-96").append($("<div/>").addClass("list-group").attr("role","tablist").attr("id",this.ids.tablist)),t=$("<div/>").addClass("col-8 px-0 mx-2 overflow-auto my-auto h-96").append($("<div/>").addClass("tab-content ml-2").attr("id",this.ids.tabcontent));return $("<div/>").addClass("finalize-contaniner").append(e).append(t)}addList(e){const t=this.slide.find("#"+this.ids.tablist).first(),a=this.slide.find("#"+this.ids.tabcontent).first();e.forEach(e=>{const s="tab-"+e.fileId;t.append(this.createItemTab(s,e.file.name,MSG_STATUS_NOT_STARTED)),a.append(this.createItemContent(s,e))}),this.fileList=e}createItemTab(e,t,a){return $("<a/>").addClass("list-group-item list-group-item-action").attr("data-toggle","list").attr("role","tab").attr("href","#"+e).append($("<div/>").addClass("marquee").append($("<span/>").addClass("marquee-target").append(t))).append($("<span/>").addClass("badge badge-light badge-custom").attr("data-status",a).html(a))}createItemContent(e,t){const a=$("<div/>").addClass("tab-pane fade").attr("id",e).attr("role","tabpanel"),s=$("<div/>").addClass("mx-auto"),n=this.createContentSummary(e,t),i=this.createContentStatus(e,t);return s.append(n).append(i),a.append(s)}createContentSummary(e,t){const a=$("<div/>").attr("data-type","summary"),s=$("<span/>").addClass("d-block p-2 text-black bg-light lead my-2").html(MSG_SUMMARY);a.append(s);const n=t.resolveKey(),i={[PROPKEY_SOURCE]:{[PROPKEY_FILENAME]:t.displayName,[PROPKEY_FILESIZE]:`${AppUtils.readableFileSize(t.file.size)} (${t.file.size} bytes)`,[PROPKEY_FILETYPE]:t.file.type,[PROPKEY_LASTMODIFIED]:new Date(t.file.lastModified).toISOString()},[PROPKEY_DESTINATION]:{[PROPKEY_BUCKET]:this.bucket,[PROPKEY_KEY]:n},[PROPKEY_ATTRIBUTES]:t.attributes};return Object.keys(i).forEach(e=>{const t=$("<details/>").addClass("p-2 my-1").append($("<summary/>").append($("<span/>").addClass("lead").html(e))),s=$("<form/>").addClass("form-inline mt-2");Object.keys(i[e]).forEach(t=>{s.append($("<label/>").addClass("col-3 justify-content-start").html(t)).append($("<input/>").addClass("form-control form-control-sm col-9").attr("type","text").attr("disabled","disabled").attr("value",i[e][t]))}),a.append(t.append(s))}),a}createContentStatus(e,t){const a=$("<div/>").addClass("p-2 my-1").attr("data-file-id",t.fileId),s=$("<div/>").addClass("d-block p-2 text-black bg-light lead my-2").append($("<span/>").addClass("d-inline-flex mr-1").html(MSG_UPLOAD_STATUS)).append($("<span/>").addClass("badge badge-light badge-custom").attr("data-status",MSG_STATUS_NOT_STARTED).html(""+MSG_STATUS_NOT_STARTED)),n=this.createUuidFlow(a,t.fileId),i=this.createChecksumFlow(a,t.fileId),o=this.createUploadS3Flow(a,t.fileId);return a.append(s).append(n).append(i).append(o)}createUuidFlow(e,t){const a=this.createFlow("uuid",MSG_VALIDATE_UUID),s=`${FinalizeSlideComponent.Events.Process.Uuid}:${t}`;return e.on(s,async(s,n)=>{const i={fileId:n.fileId,elapsed:0,src:{name:n.displayName,bytes:n.file.size,type:MimeGetMime(n),lastModified:new Date(n.file.lastModified).getTime()},metrics:{uuid:{startTime:(new Date).getTime()}}},o=`${FinalizeSlideComponent.Events.Process.Statuses.Started}:${n.fileId}`,r=`${FinalizeSlideComponent.Events.Process.Statuses.Error}:${n.fileId}`;if(this.slide.trigger(o,[n.fileId]),i.uuid=await this.createValidUuid(a),i.metrics.uuid.endTime=(new Date).getTime(),i.elapsed+=i.metrics.uuid.endTime-i.metrics.uuid.startTime,!i.uuid)return i.error=ERR_CREATE_UUID,this.slide.trigger(r,[n.fileId,i.error,i]);n.setUuid(i.uuid);const l=`${FinalizeSlideComponent.Events.Process.Checksum}:${t}`;return e.trigger(l,[n,i])}),a}createChecksumFlow(e,t){const a=this.createFlow("checksum",MSG_COMPUTE_CHECKSUM),s=`${FinalizeSlideComponent.Events.Process.Checksum}:${t}`;return e.on(s,async(s,n,i)=>{const o={...i,metrics:{...i.metrics,checksum:{type:"md5",startTime:(new Date).getTime()}}};if(o.checksum=await this.computeChecksum(a,n),o.metrics.checksum.endTime=(new Date).getTime(),o.elapsed+=o.metrics.checksum.endTime-o.metrics.checksum.startTime,!o.checksum){o.error=ERR_COMPUTE_CHECKSUM;const e=`${FinalizeSlideComponent.Events.Process.Statuses.Error}:${n.fileId}`;return this.slide.trigger(e,[n.fileId,o.error,o])}n.setChecksum(o.checksum);const r=`${FinalizeSlideComponent.Events.Process.UploadS3}:${t}`;return e.trigger(r,[n,o])}),a}createUploadS3Flow(e,t){const a=this.createFlow("uploads3",MSG_UPLOAD_S3),s=`${FinalizeSlideComponent.Events.Process.UploadS3}:${t}`;return e.on(s,async(e,t,s)=>{const n={...s,dst:{bucket:this.bucket,key:t.resolveKey(),attrs:t.attributes},metrics:{...s.metrics,uploads3:{startTime:(new Date).getTime()}}};let i=await this.uploadS3(a,t,n.dst.bucket,n.dst.key);if(n.metrics.uploads3.endTime=(new Date).getTime(),n.elapsed+=n.metrics.uploads3.endTime-n.metrics.uploads3.startTime,!i){n.error=ERR_UPLOAD_S3;const e=`${FinalizeSlideComponent.Events.Process.Statuses.Error}:${t.fileId}`;return this.slide.trigger(e,[t.fileId,n.error,n])}if(t.canSupport&&(i=await this.startWorkflow(t),!i)){n.error=ERR_START_WORKFLOW;const e=`${FinalizeSlideComponent.Events.Process.Statuses.Error}:${t.fileId}`;return this.slide.trigger(e,[t.fileId,n.error,n])}const o=`${FinalizeSlideComponent.Events.Process.Statuses.Completed}:${t.fileId}`;return this.slide.trigger(o,[t.fileId,n])}),a}createFlow(e,t){return $("<div/>").addClass("col-12 px-0 d-flex").append($("<div/>").addClass("col-3 justify-content-start my-2").html(t)).append($("<div/>").addClass("col-9 p-0 m-0 d-flex").attr("data-process",e).append($("<div/>").addClass("col-12 justify-content-start px-0 my-2 collapse").attr("data-field","result").html("result goes here")).append(this.createUploadProgressBar()).append($("<div/>").addClass("col-2 align-self-center").attr("data-field","progress").append(this.createUploadProgressInput())))}createUploadProgressBar(){return $("<div/>").addClass("col-10 progress px-0 align-self-center").attr("data-field","progress").css("height","3px").append($("<div/>").addClass("progress-bar bg-success").attr("role","progressbar").attr("aria-valuemin",0).attr("aria-valuemax",100).attr("aria-valuenow",0).css("width","0%"))}createUploadProgressInput(){return $("<input/>").addClass("col-12 px-0 text-center text-muted ml-1").attr("type","text").attr("value","0%").attr("disabled","disabled")}async createValidUuid(e){const t=e.find('[role="progressbar"]'),a=e.find("input"),s=e.find('[data-field="result"]');let n,i,o=10;let r=0;this.updateProgress(t,a,o);do{n=AppUtils.uuid4(),i=await ApiHelper.getRecord(n).catch(()=>({})),o+=10,this.updateProgress(t,a,o)}while(i.uuid&&r++<4);if(!i.uuid)return this.updateProgress(t,a,100),this.showResult(t,a,s,"success",n),n;this.showResult(t,a,s,"danger",ERR_CREATE_UUID)}async computeChecksum(e,t){const a=e.find('[role="progressbar"]'),s=e.find("input"),n=e.find('[data-field="result"]');let i=1;this.updateProgress(a,s,i);const o=this.getChunkSize(t.file.size);let r;for(let e=0;e<o;e++){if(r=await this.computeChunkChecksum(t.file,e,r).catch(e=>e),r instanceof Error)return void this.showResult(a,s,n,"danger",r.message);i=Math.ceil(r.end/t.file.size*100),this.updateProgress(a,s,i)}const l=this.finalizeChecksum(r);return this.showResult(a,s,n,"success",l),l}getChunkSize(e){return Math.ceil(e/8388608)}computeChunkChecksum(e,t,a){return new Promise((s,n)=>{const i=8388608*t,o=Math.min(i+8388608,e.size),r=new SparkMD5.ArrayBuffer;a&&r.setState(a.state);const l=new FileReader;l.onload=e=>{r.append(e.target.result);const t=r.getState();s({state:t,start:i,end:o})},l.onerror=e=>n(e),l.readAsArrayBuffer(e.slice(i,o))})}finalizeChecksum(e){const t=new SparkMD5.ArrayBuffer;return t.setState(e.state),t.end()}resolvePath(e,t){const a="/"===t.charAt(0)?t.slice(1):t;if(e)return`${e}/${a}`;if(a.indexOf("/")>0)return a;const s=a.lastIndexOf(".");return`${a.substring(0,s<0?a.length:s)}/${a}`}async uploadS3(e,t,a,s){const n=e.find('[role="progressbar"]'),i=e.find("input"),o=e.find('[data-field="result"]');this.updateProgress(n,i,1);const r=this.updateProgress.bind(this,n,i);let l=await this.requestMultipartUpload(a,s,t,r).catch(e=>{console.error("ERR:","requestMultipartUpload:",s,e.message),this.showResult(n,i,o,"danger",ERR_UPLOAD_S3)});if(void 0!==l)return l=$("<a/>").attr("href",`https://s3.console.aws.amazon.com/s3/object/${a}/${s}?region=${SolutionManifest.Region}`).attr("target","_blank").html(`s3://${a}/${s}`).prop("outerHTML"),this.showResult(n,i,o,"success",l),l}requestMultipartUpload(e,t,a,s){const n=GetS3Utils(),i={Bucket:e,Key:t,Body:a.file,ContentType:a.mime,Metadata:{...a.attributes,uuid:a.uuid,md5:a.checksum,webupload:(new Date).toISOString()}};return n.upload(i,s)}updateProgress(e,t,a){let s=a;"object"==typeof s&&void 0!==s.loaded&&(s=Math.ceil(s.loaded/s.total*100)),e.css("width",s+"%").attr("aria-valuenow",s),t.val(s+"%")}async startWorkflow(e){return ApiHelper.startWorkflow({input:{bucket:this.bucket,key:e.resolveKey(),uuid:e.uuid,group:e.group,aiOptions:e.analysis,attributes:e.attributes,destination:{bucket:SolutionManifest.Proxy.Bucket}}})}showResult(e,t,a,s,n){const i="text-"+s,o=$("<span/>").addClass(i).html(n);a.html("").append(o),e.parent().addClass("collapse"),t.parent().addClass("collapse"),a.removeClass("collapse")}async startNow(){let e=0;const t=this.fileList;for(this.slide.trigger(FinalizeSlideComponent.Events.Overall.Started,[t.length]);t.length;)this.slide.trigger(FinalizeSlideComponent.Events.Overall.Progress,[e++]),await this.processFile(t.shift());const a=await this.getData();this.slide.trigger(FinalizeSlideComponent.Events.Overall.Completed,[a])}async processFile(e){return new Promise((t,a)=>{const s=`${FinalizeSlideComponent.Events.Process.Statuses.Started}:${e.fileId}`,n=`${FinalizeSlideComponent.Events.Process.Statuses.Completed}:${e.fileId}`,i=`${FinalizeSlideComponent.Events.Process.Statuses.Error}:${e.fileId}`;this.slide.on(s,async(e,t)=>{this.updateBadge(MSG_STATUS_PROCESSING,t);this.slide.find(`a[href="#tab-${t}"]`).tab("show"),this.slide.off(s)}),this.slide.on(n,async(e,a,s)=>{this.report.push(s),this.updateBadge(MSG_STATUS_COMPLETED,a),this.slide.off(n),t(a)}),this.slide.on(i,async(e,a,s,n)=>{this.report.push(n),this.slide.off(i),this.updateBadge(MSG_STATUS_ERROR,a),t(a)});const o=this.slide.find(`[data-file-id="${e.fileId}"]`),r=`${FinalizeSlideComponent.Events.Process.Uuid}:${e.fileId}`;o.trigger(r,[e])})}updateBadge(e,t){let a,s;t?(a=this.slide.find(`a[href="#tab-${t}"]`).find("[data-status]"),s=this.slide.find("#tab-"+t).find("[data-status]")):(a=this.slide.find("#"+this.ids.tablist).find("[data-status]"),s=this.slide.find("#"+this.ids.tabcontent).find("[data-status]"));const n="badge-primary badge-secondary badge-success badge-danger badge-light";switch(e){case MSG_STATUS_NOT_STARTED:a.removeClass(n).addClass("badge-light").html(e),s.removeClass(n).addClass("badge-light").html(e);break;case MSG_STATUS_WAITING:a.removeClass(n).addClass("badge-secondary").html(e),s.removeClass(n).addClass("badge-secondary").html(e);break;case MSG_STATUS_PROCESSING:a.removeClass(n).addClass("badge-primary").html(e),s.removeClass(n).addClass("badge-primary").html(e);break;case MSG_STATUS_COMPLETED:a.removeClass(n).addClass("badge-success").html(e),s.removeClass(n).addClass("badge-success").html(e);break;case MSG_STATUS_ERROR:a.removeClass(n).addClass("badge-danger").html(e),s.removeClass(n).addClass("badge-danger").html(e)}}}const{Messages:{UploadTab:TITLE$5},Alerts:{Oops:OOPS$3}}=Localization,HASHTAG$5=TITLE$5.replaceAll(" ","");class UploadTab extends(mxAlert(BaseTab)){constructor(){super(TITLE$5,{hashtag:HASHTAG$5}),this.$ids={...super.ids,carousel:{container:"upload-"+this.id,slides:{dropzone:"upload-dropzone-"+this.id,attributes:"upload-attributes-"+this.id,analysis:"upload-analysis-"+this.id,finalize:"upload-finalize-"+this.id}}},this.$dropzoneComponent=new DropzoneSlideComponent,this.$attributeComponent=new AttributeSlideComponent,this.$analysisComponent=new AnalysisSlideComponent,this.$finalizeComponent=new FinalizeSlideComponent}get ids(){return this.$ids}get dropzoneComponent(){return this.$dropzoneComponent}get attributeComponent(){return this.$attributeComponent}get analysisComponent(){return this.$analysisComponent}get finalizeComponent(){return this.$finalizeComponent}async show(e){if(!this.initialized){const e=$("<div/>").addClass("row no-gutters").append(await this.createCarousel());this.tabContent.append(e)}return super.show(e)}async hide(){return await this.clearComponentData(),super.hide()}async createCarousel(){const e=[await this.createDropzoneSlide(),await this.createAttributeSlide(),await this.createAnalysisSlide(),await this.createFinalizeSlide()],t=$("<div/>").addClass("carousel-inner");for(let a=0;a<e.length;a++){const[s,n]=e[a],i=0===a?"carousel-item active":"carousel-item";t.append($("<div/>").addClass(i).attr("id",s).append(n))}const a=$("<div/>").addClass("carousel slide").attr("data-ride",!1).attr("data-interval",!1).attr("id",this.ids.carousel.container).append(t);return $("<div/>").addClass("col-9 col-sm-9 col-md-9 mx-auto mt-4").append(a)}async createDropzoneSlide(){const e=await this.dropzoneComponent.createSlide();return e.on(DropzoneSlideComponent.Controls.StartOver,async e=>(await this.clearComponentData(),!0)),e.on(DropzoneSlideComponent.Controls.QuickUpload,async e=>(await this.dropzoneComponent.saveData(),await this.slideToFinalize(),!0)),e.on(DropzoneSlideComponent.Controls.Next,async e=>(await this.dropzoneComponent.saveData(),this.slideTo(this.attributeComponent.slideId),!0)),[this.dropzoneComponent.slideId,e]}async createAttributeSlide(){const e=await this.attributeComponent.createSlide();return e.on(AttributeSlideComponent.Controls.Back,async e=>(this.slideTo(this.dropzoneComponent.slideId),!0)),e.on(AttributeSlideComponent.Controls.QuickUpload,async e=>(await this.slideToFinalize(),!0)),e.on(AttributeSlideComponent.Controls.Next,async e=>(this.slideTo(this.analysisComponent.slideId),!0)),[this.attributeComponent.slideId,e]}async createAnalysisSlide(){const e=await this.analysisComponent.createSlide();return e.on(AnalysisSlideComponent.Controls.Back,async e=>(this.slideTo(this.attributeComponent.slideId),!0)),e.on(AnalysisSlideComponent.Controls.Next,async e=>(await this.slideToFinalize(),!0)),[this.analysisComponent.slideId,e]}async createFinalizeSlide(){const e=await this.finalizeComponent.createSlide();return e.on(FinalizeSlideComponent.Controls.Cancel,async e=>(await this.clearComponentData(),this.slideTo(this.dropzoneComponent.slideId),!0)),e.on(FinalizeSlideComponent.Controls.Done,async e=>(await this.clearComponentData(),this.slideTo(this.dropzoneComponent.slideId),!0)),[this.finalizeComponent.slideId,e]}async slideToFinalize(){const e=await this.dropzoneComponent.getData(),t=await this.attributeComponent.getData(),a=await this.analysisComponent.getData();return e.forEach(e=>{e.setAttributes(t),e.setAnalysis(a)}),this.finalizeComponent.addList(e),this.slideTo(this.finalizeComponent.slideId)}slideTo(e){const t=this.tabContent.find("#"+this.ids.carousel.container).first(),a=t.find("#"+e).index();t.carousel(a)}async showAlert(e,t){return super.showMessage(this.tabContent,"danger",OOPS$3,e,t)}async clearComponentData(){return Promise.all([this.dropzoneComponent.clearData(),this.attributeComponent.clearData(),this.analysisComponent.clearData(),this.finalizeComponent.clearData()])}}const{Statuses:{Processing:STATUS_PROCESSING,Completed:STATUS_COMPLETED,Error:STATUS_ERROR}}=SolutionManifest,{Messages:{ProcessingTab:TITLE$4,ProcessingDesc:MSG_PROCESSSING_DESC,NoMoreData:MSG_NO_MORE_DATA$1,LoadMore:MSG_LOAD_MORE,ErrorDesc:MSG_ERROR_DESC},Tooltips:{ViewJobOnAWSConsole:TOOLTIP_VIEW_ON_CONSOLE}}=Localization,HASHTAG$4=TITLE$4.replaceAll(" ",""),RANDOM_ID$3=AppUtils.randomHexstring(),ID_PROCESSINGLIST="processing-"+RANDOM_ID$3,ID_PROCESSINGLIST_BTN="processing-btn-"+RANDOM_ID$3,ID_ERRORLIST="error-"+RANDOM_ID$3,ID_ERRORLIST_BTN="error-btn-"+RANDOM_ID$3,DATA_UUID="data-uuid",INFO_BASIC="info-basic",CSS_DESCRIPTIONLIST={dl:"row lead-xs ml-2 my-auto col-9 no-gutters",dt:"col-sm-2 my-0 text-left",dd:"col-sm-10 my-0"};class ProcessingTab extends BaseTab{constructor(){super(TITLE$4,{hashtag:HASHTAG$4}),this.$mediaManager=GetMediaManager(),RegisterMediaEvent("processingtab",this.onMediaEvent.bind(this)),Spinner.useSpinner()}get mediaManager(){return this.$mediaManager}async onMediaEvent(e,t){return e===ON_MEDIA_ADDED?this.onMediaAdded(t):e===ON_MEDIA_UPDATED?this.onMediaUpdated(t):e===ON_MEDIA_ERROR?this.onMediaError(t):void 0}async onMediaAdded(e){const t=this.tabContent.find("#"+ID_PROCESSINGLIST);let a=t.find(`li[data-uuid="${e.uuid}"]`);return 0===a.length&&(a=await this.createMediaListItem(e),t.append(a)),a}async onMediaUpdated(e){const t=this.tabContent.find("#"+ID_PROCESSINGLIST).find(`li[data-uuid="${e.uuid}"]`);if(e.overallStatus===STATUS_COMPLETED)return t.remove();let a;return t.length>0&&(a=await this.createMediaListItem(e),t.replaceWith(a)),a}async onMediaError(e){let t=this.tabContent.find("#"+ID_PROCESSINGLIST),a=t.find(`li[data-uuid="${e.uuid}"]`);return a.remove(),t=this.tabContent.find("#"+ID_ERRORLIST),a=t.find(`li[data-uuid="${e.uuid}"]`),0===a.length&&(a=await this.createMediaListItem(e),t.append(a)),a}async show(e){if(this.initialized)await this.refreshContent();else{const e=this.createSkeleton();this.tabContent.append(e)}return super.show(e)}createSkeleton(){const e=$("<div/>").addClass("row no-gutters"),t=this.createProcessingSection();e.append(t);const a=this.createErrorSection();return e.append(a),e}createProcessingSection(){const e=$("<div/>").addClass("col-12 p-0 m-0 pb-4"),t=$("<div/>").addClass("col-9 p-0 mx-auto mt-4");e.append(t);const a=this.createProcessingDescription();t.append(a);const s=$("<div/>").addClass("col-9 p-0 mx-auto mt-4");e.append(s);const n=this.createProcessingList();s.append(n);const i=$("<div/>").addClass("col-9 p-0 mx-auto mt-4");e.append(i);const[o,r]=this.createControls(ID_PROCESSINGLIST_BTN);return i.append(o),r.on("click",async()=>{await this.scanMoreProcessingJobs(n,r,!1)}),e.ready(async()=>{await this.scanMoreProcessingJobs(n,r,!0)}),e}createProcessingDescription(){return $("<p/>").addClass("lead").html(MSG_PROCESSSING_DESC)}createProcessingList(){return $("<ul/>").addClass("list-group").attr("id",ID_PROCESSINGLIST)}async scanMoreProcessingJobs(e,t,a=!1){try{Spinner.loading();let s=await this.mediaManager.scanProcessingRecords();if(a&&(s=this.mediaManager.findProcessingMedias(),e.children().remove()),s){const t=await Promise.all(s.map(e=>this.createMediaListItem(e)));e.append(t.filter(e=>void 0!==e))}this.mediaManager.noMoreProccessingJob()?t.addClass("disabled").attr("disabled","disabled").html(MSG_NO_MORE_DATA$1):t.removeClass("disabled").removeAttr("disabled").html(MSG_LOAD_MORE)}catch(e){console.error(e)}finally{Spinner.loading(!1)}}createErrorSection(){const e=$("<div/>").addClass("col-12 p-0 m-0 pb-4 bg-light"),t=$("<div/>").addClass("col-9 p-0 mx-auto mt-4");e.append(t);const a=this.createErrorDescription();t.append(a);const s=$("<div/>").addClass("col-9 p-0 mx-auto mt-4");e.append(s);const n=this.createErrorList();s.append(n);const i=$("<div/>").addClass("col-9 p-0 mx-auto mt-4");e.append(i);const[o,r]=this.createControls(ID_ERRORLIST_BTN);return i.append(o),r.on("click",async()=>{await this.scanMoreErrorJobs(n,r,!1)}),e.ready(async()=>{await this.scanMoreErrorJobs(n,r,!0)}),e}createErrorDescription(){return $("<p/>").addClass("lead").html(MSG_ERROR_DESC)}createErrorList(){return $("<ul/>").addClass("list-group").attr("id",ID_ERRORLIST)}async scanMoreErrorJobs(e,t,a=!1){try{Spinner.loading();let s=await this.mediaManager.scanErrorRecords();if(a&&(s=this.mediaManager.findErrorMedias(),e.children().remove()),s){const t=await Promise.all(s.map(e=>this.createMediaListItem(e)));e.append(t.filter(e=>void 0!==e))}this.mediaManager.noMoreErrorJob()?t.addClass("disabled").attr("disabled","disabled").html(MSG_NO_MORE_DATA$1):t.removeClass("disabled").removeAttr("disabled").html(MSG_LOAD_MORE)}catch(e){console.error(e)}finally{Spinner.loading(!1)}}createControls(e){const t=$("<form/>").addClass("form-inline");t.submit(e=>e.preventDefault());const a=$("<div/>").addClass("mx-auto");t.append(a);const s=$("<button/>").addClass("btn btn-outline-dark").attr("id",e).html(MSG_LOAD_MORE);return a.append(s),[t,s]}async refreshContent(){let e,t;e=this.tabContent.find("#"+ID_PROCESSINGLIST),t=this.tabContent.find("button#"+ID_PROCESSINGLIST_BTN),await this.scanMoreProcessingJobs(e,t,!0),e=this.tabContent.find("#"+ID_ERRORLIST),t=this.tabContent.find("button#"+ID_ERRORLIST_BTN),await this.scanMoreErrorJobs(e,t,!0)}async createMediaListItem(e){const t=$("<li/>").addClass("list-group-item list-group-item-action no-gutters p-0").css("cursor","pointer").attr(DATA_UUID,e.uuid).attr("data-toggle","tooltip").attr("data-placement","bottom").attr("title",TOOLTIP_VIEW_ON_CONSOLE).tooltip({trigger:"hover"});t.on("click",()=>{const t=AWSConsoleStepFunctions.getExecutionLink(e.executionArn);return window.open(t,"_blank"),!1});const a=$("<div/>").addClass("row no-gutters").attr("data-type",INFO_BASIC);t.append(a);const s=$("<div/>").addClass("col-2");a.append(s);const n=await this.createThumbnail(e);s.append(n);let i="bg-success";e.overallStatus===STATUS_ERROR?i="bg-danger":e.overallStatus===STATUS_PROCESSING&&(i="bg-primary");const o=$("<div/>").addClass("col-1 d-flex").addClass(i);a.append(o);const r=$("<span/>").addClass("lead-xxs mx-auto my-auto text-white").html(e.overallStatus);o.append(r);const l=$("<div/>").addClass("col-9 d-flex");a.append(l);const d=new DescriptionList(CSS_DESCRIPTIONLIST),c=d.createTableList();return["basename","timestamp","status"].forEach(t=>d.appendTableList(c,e,t)),l.append(c),t}async createThumbnail(e){const t=$("<img/>").addClass("btn-bkgd w-100 h-96px").css("object-fit","cover");return t.ready(async()=>{const a=await e.getThumbnail();t.attr("src",a)}),t}}class PieGraph extends(mxReadable(class{})){constructor(e,t,a){super(),this.$graphContainer=$("<div/>").addClass("pie-graph mx-auto").attr("id","pie-"+AppUtils.randomHexstring()),this.$dataset=t.sort((e,t)=>e.value-t.value);const s=this.makeGraphOptions(e,this.$dataset,a),n=echarts.init(this.$graphContainer[0]),i=this.onRenderedEvent.bind(this,n);n.on("rendered",async()=>i()),n.setOption(s),this.$graph=n}get graphContainer(){return this.$graphContainer}set graphContainer(e){this.$graphContainer=e}get graph(){return this.$graph}set graph(e){this.$graph=e}get datasets(){return this.$datasets}set datasets(e){this.$datasets=e}get graphId(){return this.graphContainer.prop("id")}getGraphContainer(){return this.graphContainer}makeGraphOptions(e,t,a={}){return{title:{text:e,left:"center",top:20,textStyle:{fontSize:16,fontWeight:200}},tooltip:{trigger:"item",formatter:a.formatter||"{b} : {c} files ({d}%)"},series:[{type:"pie",radius:"60%",center:["50%","50%"],data:t,roseType:"radius",label:{fontSize:12},labelLine:{smooth:.2,length:15,length2:15},itemStyle:{shadowBlur:20,shadowColor:"rgba(91, 12, 10, 0.5)"},animationType:"scale",animationEasing:"elasticOut",animationDelay:()=>{const e=new Uint32Array(1);return(window.crypto||window.msCrypto).getRandomValues(e),e[0]%200+1}}]}}destroy(){this.graph&&this.graph.dispose(),this.graph=void 0,this.graphContainer&&this.graphContainer.remove(),this.graphContainer=void 0,this.datasets&&(this.datasets.length=0)}onRenderedEvent(e){e.getWidth()<=0||e.getHeight()<=0?setTimeout(()=>e.resize(),200):e.off("rendered")}resize(){return this.graph.resize()}}const RANDOM_ID$2=AppUtils.randomHexstring(),ID_OVERALLGRAPH="pie-"+RANDOM_ID$2,ID_AGGREGATIONGRAPH="aggs-"+RANDOM_ID$2,AGGS_TYPE_KNOWNFACES="knownFaces",AGGS_TYPE_LABELS="labels",AGGS_TYPE_MODERATIONS="moderations",AGGS_TYPE_KEYPHRASES="keyphrases",AGGS_TYPE_ENTITIES="entities",AGGREGATION_SIZE=20,{Rekognition:{Celeb,FaceMatch,Label,CustomLabel,Moderation},Comprehend:{Keyphrase,Entity,CustomEntity}}=AnalysisTypes,AGGS_ANALYSIS=[Celeb,FaceMatch,Label,CustomLabel,Moderation,Keyphrase,Entity,CustomEntity],{Messages:{StatsTab:TITLE$3,StatsDesc:MSG_STATS_DESC,OverallStats:MSG_OVERALL_STATS,Aggregations:MSG_AGGREGATIONS,NoData:MSG_NO_DATA,TotalCount:MSG_TOTAL_COUNT,TotalSize:MSG_TOTAL_SIZE,WorkflowStatuses:MSG_WORKFLOW_STATUSES,MostRecentStats:MSG_MOST_RECENT_STATS,TopKnownFaces:MSG_TOP_KNOWN_FACES,TopLabels:MSG_TOP_LABELS,TopModerations:MSG_TOP_MODERATIONS,TopKeyphrases:MSG_TOP_KEYPHRASES,TopEntities:MSG_TOP_ENTITIES},Tooltips:{RefreshStats:TOOLTIP_REFRESH_STATS},Buttons:{Refresh:BTN_REFRESH$1}}=Localization,HASHTAG$3=TITLE$3.replaceAll(" ","");class StatsTab extends BaseTab{constructor(){super(TITLE$3,{hashtag:HASHTAG$3}),this.$pieGraphs={overall:{totalCount:void 0,totalSize:void 0,status:void 0,recents:void 0},aggs:{knownFaces:void 0,labels:void 0,moderations:void 0,keyphrases:void 0,entities:void 0}},Spinner.useSpinner()}get overallCountGraph(){return this.$pieGraphs.overall.totalCount}set overallCountGraph(e){this.$pieGraphs.overall.totalCount=e}get overallSizeGraph(){return this.$pieGraphs.overall.totalSize}set overallSizeGraph(e){this.$pieGraphs.overall.totalSize=e}get overallStatusGraph(){return this.$pieGraphs.overall.status}set overallStatusGraph(e){this.$pieGraphs.overall.status=e}get mostRecentGraph(){return this.$pieGraphs.overall.recents}set mostRecentGraph(e){this.$pieGraphs.overall.recents=e}get aggsGraphs(){return this.$pieGraphs.aggs}get knownFacesGraph(){return this.$pieGraphs.aggs.knownFaces}set knownFacesGraph(e){this.$pieGraphs.aggs.knownFaces=e}get labelsGraph(){return this.$pieGraphs.aggs.labels}set labelsGraph(e){this.$pieGraphs.aggs.labels=e}get moderationsGraph(){return this.$pieGraphs.aggs.moderations}set moderationsGraph(e){this.$pieGraphs.aggs.moderations=e}get keyphrasesGraph(){return this.$pieGraphs.aggs.keyphrases}set keyphrasesGraph(e){this.$pieGraphs.aggs.keyphrases=e}get entitiesGraph(){return this.$pieGraphs.aggs.entities}set entitiesGraph(e){this.$pieGraphs.aggs.entities=e}async show(e){if(this.initialized)await this.refreshContent();else{const e=this.createSkeleton();this.tabContent.append(e)}return super.show(e)}createSkeleton(){const e=$("<div/>").addClass("row no-gutters"),t=$("<div/>").addClass("col-9 p-0 mx-auto mt-4");e.append(t);const a=this.createDescription();t.append(a);const s=$("<div/>").addClass("col-9 p-0 mx-auto");e.append(s);const n=this.createOverallStatus();s.append(n);const i=$("<div/>").addClass("col-12 p-0 m-0 p-0 bg-light");e.append(i);const o=this.createAggregations();i.append(o);const r=$("<div/>").addClass("col-9 p-0 mx-auto mt-4");e.append(r);const l=this.createControls();return r.append(l),e.ready(async()=>{await this.refreshContent()}),e}createDescription(){return $("<p/>").addClass("lead").html(MSG_STATS_DESC)}createOverallStatus(){const e=$("<div/>").addClass("col-12 p-0 m-0"),t=$("<span/>").addClass("d-block p-0 lead").html(MSG_OVERALL_STATS);e.append(t);const a=$("<div/>").addClass("row no-gutters").attr("id",ID_OVERALLGRAPH);return e.append(a),e}createAggregations(){const e=$("<div/>").addClass("col-9 p-0 mx-auto mt-4"),t=$("<span/>").addClass("d-block p-0 lead").html(MSG_AGGREGATIONS);e.append(t);const a=$("<div/>").addClass("row no-gutters").attr("id",ID_AGGREGATIONGRAPH);return e.append(a),e}createControls(){const e=$("<form/>").addClass("form-inline"),t=$("<div/>").addClass("mx-auto");e.append(t),e.submit(e=>e.preventDefault());const a=$("<button/>").addClass("btn btn-success").attr("data-toggle","tooltip").attr("data-placement","bottom").attr("title",TOOLTIP_REFRESH_STATS).html(BTN_REFRESH$1).tooltip({trigger:"hover"});return t.append(a),a.on("click",()=>this.refreshContent()),e}async refreshContent(){try{Spinner.loading();const e=[];e.push(await ApiHelper.getStats({size:20}).then(e=>this.refreshOverallStats(e))),e.push(await ApiHelper.getStats({size:20,aggregate:AGGS_ANALYSIS.join(",")}).then(e=>this.refreshAggregations(e.aggregations))),await Promise.all(e)}catch(e){console.error(e)}finally{Spinner.loading(!1)}}async refreshOverallStats(e){console.log("refreshOverallStats",e);const t=this.tabContent.find("#"+ID_OVERALLGRAPH);if(t.children().remove(),!e.stats.types){const e=$("<p/>").addClass("text-center text-muted").append(MSG_NO_DATA);return t.append(e)}const a=await Promise.all([this.refreshOverallCountStats(e.stats.types),this.refreshOverallSizeStats(e.stats.types),this.refreshOverallStatusStats(e.stats.overallStatuses),this.refreshMostRecentStats(e.recents)]);return t.append(a)}async refreshOverallCountStats(e){const t=$("<div/>").addClass("col-6 m-0 p-0");this.overallCountGraph&&this.overallCountGraph.destroy();const a=e.reduce((e,t)=>e.concat({name:t.type,value:t.count}),[]),s=a.reduce((e,t)=>e+t.value,0),n=new PieGraph(`${MSG_TOTAL_COUNT} (${s} files)`,a,{formatter:"<strong>{b}</strong>: {c} files ({d}%)"});this.overallCountGraph=n;const i=n.getGraphContainer();return t.append(i),t}async refreshOverallSizeStats(e){const t=$("<div/>").addClass("col-6 m-0 p-0");this.overallSizeGraph&&this.overallSizeGraph.destroy();const a=e.reduce((e,t)=>e.concat({name:t.type,value:t.fileSize.total}),[]),s=a.reduce((e,t)=>e+t.value,0),n=`${MSG_TOTAL_SIZE} (${AppUtils.readableFileSize(s)})`,i=new PieGraph(n,a,{formatter:e=>`<strong>${e.data.name}:</strong> ${AppUtils.readableFileSize(e.data.value)}`});this.overallSizeGraph=i;const o=i.getGraphContainer();return t.append(o),t}async refreshOverallStatusStats(e){const t=$("<div/>").addClass("col-6 m-0 p-0");this.overallStatusGraph&&this.overallStatusGraph.destroy();const a=e.reduce((e,t)=>e.concat({name:t.overallStatus,value:t.count}),[]),s=a.reduce((e,t)=>e+t.value,0),n=new PieGraph(`${MSG_WORKFLOW_STATUSES} (${s} processes)`,a,{formatter:"<strong>{b}</strong>: {c} counts ({d}%)"});this.overallStatusGraph=n;const i=n.getGraphContainer();return t.append(i),t}async refreshMostRecentStats(e){const t=$("<div/>").addClass("col-6 m-0 p-0");if(this.mostRecentGraph&&this.mostRecentGraph.destroy(),!e||!e.length)return;const a=e.map(e=>({...e,name:e.basename,value:e.fileSize})),s=`${MSG_MOST_RECENT_STATS} (${e.length})`,n=new PieGraph(s,a,{formatter:e=>["<strong>name:</strong> "+e.data.basename,"<strong>uuid:</strong>: "+e.data.uuid,"<strong>duration:</strong>: "+AppUtils.readableDuration(e.data.duration),"<strong>filesize:</strong>: "+AppUtils.readableFileSize(e.data.fileSize),"<strong>lastmodified:</strong>: "+AppUtils.isoDateTime(e.data.lastModified),"<strong>type:</strong>: "+e.data.type].join("<br/>")});this.mostRecentGraph=n;const i=n.getGraphContainer();return t.append(i),t}async refreshAggregations(e){console.log("refreshAggregations",e);const t=this.tabContent.find("#"+ID_AGGREGATIONGRAPH);if(t.children().remove(),void 0===e||0===Object.keys(e).length){const e=$("<p/>").addClass("text-center text-muted").append(MSG_NO_DATA);return t.append(e)}const a=[{type:"knownFaces",title:MSG_TOP_KNOWN_FACES,dataset:this.mergeAggs(e[Celeb],e[FaceMatch])},{type:"labels",title:MSG_TOP_LABELS,dataset:this.mergeAggs(e[Label],e[CustomLabel])},{type:"moderations",title:MSG_TOP_MODERATIONS,dataset:e[Moderation]||[]},{type:"keyphrases",title:MSG_TOP_KEYPHRASES,dataset:e[Keyphrase]||[]},{type:"entities",title:MSG_TOP_ENTITIES,dataset:this.mergeAggs(e[Entity],e[CustomEntity])}],s=await Promise.all(a.map(e=>this.refreshAggregateByType(e.type,e.title,e.dataset)));return t.append(s)}mergeAggs(e=[],t=[]){const a=[];return t.forEach(t=>{const s=e.find(e=>e.name===t.name);s?s.count=Math.max(s.count,t.count):a.push(t)}),e.concat(a)}async refreshAggregateByType(e,t,a){this.aggsGraphs[e]&&this.aggsGraphs[e].destroy();const s=$("<div/>").addClass("col-6 m-0 p-0"),n=a.reduce((e,t)=>e.concat({name:t.name,value:t.count}),[]),i=new PieGraph(t,n,{formatter:"<strong>{b}</strong>: {c} documents"});this.aggsGraphs[e]=i;const o=i.getGraphContainer();return s.append(o),s}}const{Messages:{FaceCollectionTab:TITLE$2,FaceCollectionDesc:MSG_FACE_COLLECTION_DESC,AvailableFaceCollections:MSG_AVAILABLE_FACE_COLLECTIONS,SelectFaceCollection:MSG_SELECT_FACE_COLLECTION,Alternatively:MSG_ALTERNATIVELY,IndexedFacesInCollection:MSG_FACES_IN_COLLECTION,NoMoreData:MSG_NO_MORE_DATA},Tooltips:{RemoveFaceCollection:TOOLTIP_REMOVE_COLLECTION,RemoveFaceFromCollection:TOOLTIP_REMOVE_FACE},Buttons:{CreateNewCollection:BTN_CREATE_NEW_COLLECTION,RemoveFaceCollection:BTN_REMOVE_COLLECTION,LoadMore:BTN_LOAD_MORE},Alerts:{Oops:OOPS$2,InvalidFaceCollectionName:ERR_INVALID_FACE_COLLECTION_NAME}}=Localization,HASHTAG$2=TITLE$2.replaceAll(" ","");class FaceCollectionTab extends(mxAlert(BaseTab)){constructor(){super(TITLE$2,{hashtag:HASHTAG$2}),this.$faceCollectionContainerId="facecolllectioncontainer-"+this.id,this.$indexedFaceContainerId="indexedfacecontainer-"+this.id,this.$faceManager=GetFaceManager(),RegisterFaceManagerEvent("facecollectiontab",this.onFaceManagerEvent.bind(this)),Spinner.useSpinner()}get faceManager(){return this.$faceManager}get faceCollectionContainerId(){return this.$faceCollectionContainerId}get indexedFaceContainerId(){return this.$indexedFaceContainerId}async show(e){if(!this.initialized){const e=await this.createContent();this.tabContent.append(e)}return super.show(e)}async createContent(){const e=$("<div/>").addClass("row no-gutters"),t=$("<div/>").addClass("col-9 p-0 mx-auto mt-4");e.append(t);const a=this.createDescription();t.append(a);const s=$("<div/>").addClass("col-9 p-0 mx-auto mt-4");e.append(s);const n=this.createCollectionList();s.append(n);const i=$("<div/>").addClass("col-12 p-0 m-0 p-0 bg-light");e.append(i);const o=$("<div/>").addClass("col-9 p-0 mx-auto mt-4 collapse").attr("id",this.indexedFaceContainerId);return i.append(o),e}createDescription(){return $("<p/>").addClass("lead").html(MSG_FACE_COLLECTION_DESC)}createCollectionList(){const e=$("<div/>").addClass("col-12 p-0 m-0"),t=$("<span/>").addClass("d-block p-0 lead").html(MSG_AVAILABLE_FACE_COLLECTIONS);e.append(t);const a=$("<form/>").addClass("form-inline needs-validation my-4").attr("novalidate","novalidate");e.append(a);const s=$("<select/>").addClass("custom-select custom-select-sm col-3").attr("id",this.faceCollectionContainerId);a.append(s);const n=$("<option/>").attr("value","undefined").html(MSG_SELECT_FACE_COLLECTION);s.append(n);const i=$("<button/>").addClass("btn btn-sm btn-outline-dark");a.append(i);const o=$("<i/>").addClass("fas fa-sync-alt");i.append(o);const r=$("<span/>").addClass("lead ml-4 mr-1").html(MSG_ALTERNATIVELY);a.append(r);const l=$("<input/>").addClass("form-control form-control-sm col-3").attr("pattern","^[a-zA-Z0-9_.-]{0,255}$").attr("placeholder","(Blank)");a.append(l);const d=$("<button/>").addClass("btn btn-sm btn-success").append(BTN_CREATE_NEW_COLLECTION);return a.append(d),e.ready(async()=>{const e=this.tabContent.find("#"+this.indexedFaceContainerId);a.submit(e=>e.preventDefault()),s.on("change",async()=>{const t=s.val();return"undefined"===t?e.addClass("collapse"):this.renderIndexedFaces(t,e)}),i.on("click",async()=>(await this.refreshCollectionList(s),!1)),d.on("click",async e=>{if(!this.validateForm(e,a))return this.shake(a),await this.showAlert(ERR_INVALID_FACE_COLLECTION_NAME),l.focus(),!1;if(!l.val())return!1;try{Spinner.loading();const e=l.val(),t=await this.faceManager.createCollection(e);if(t){const e=$("<option/>").attr("value",t.name),a=`${t.name} (${t.faces} faces)`;e.html(a),s.append(e),s.val(t.name).trigger("change")}return l.val(""),!0}catch(e){return console.error(e),!1}finally{Spinner.loading(!1)}});const t=(await this.faceManager.getCollections()).map(e=>{const t=$("<option/>").attr("value",e.name),a=`${e.name} (${e.faces} faces)`;return t.html(a),t});s.append(t)}),e}validateForm(e,t){return e.preventDefault(),!1!==t[0].checkValidity()||(e.stopPropagation(),!1)}async renderIndexedFaces(e,t){try{Spinner.loading(),t.children().remove();let a=this.faceManager.getFacesInCollection(e);const s=$("<div/>").addClass("row no-gutters");t.append(s);const n=$("<div/>").addClass("col-6 p-0 m-0");s.append(n);let i=MSG_FACES_IN_COLLECTION.replace("{{FACE_COLLECTION}}",e);i=$("<span/>").addClass("d-block p-0 lead").html(i),n.append(i);const o=$("<div/>").addClass("col-6 p-0 m-0 text-left");s.append(o);const r=this.makeFaceCollectionDeleteBtn(e);o.append(r.addClass("float-right"));const l=$("<table/>").addClass("table table-hover my-4 lead-xs");t.append(l);const d=$("<thead/>");l.append(d);const c=this.makeFaceTableHeaderRow();d.append(c);const p=$("<tbody/>");l.append(p),a=await a;const h=a.faces.map(t=>this.makeFaceTableRow(e,t));p.append(h);const u=this.makeLoadMoreBtn(l,e,a.token);t.append(u),t.removeClass("collapse")}catch(e){console.error(e)}finally{Spinner.loading(!1)}}makeFaceTableHeaderRow(){const e=$("<tr/>"),t=["#","ExternalImageId","FriendlyName","FaceId","Remove?"].map(e=>$("<th/>").addClass("align-middle text-center lead-sm").attr("scope","col").append(e));return e.append(t),e}makeFaceTableRow(e,t){const a=$("<tr/>");let s=t.key;void 0!==t.blob&&(s=t.blob);const n=this.makeFaceTableRowImage(s);a.append(n);const i=this.makeFaceTableRowItem(t.externalImageId);a.append(i);const o=this.makeFaceTableRowItem(AppUtils.toFriendlyName(t.externalImageId));a.append(o);const r=this.makeFaceTableRowItem(t.faceId);a.append(r);const l=this.makeFaceTableRowDeleteBtn(e,t.faceId);return a.append(l),a}makeFaceTableRowImage(e){const t=$("<td/>").addClass("h-100 align-middle text-center").addClass("m-0 p-0");return t.ready(async()=>{let a,s;if(s=e&&0===e.indexOf("blob:")?e:await this.faceManager.getFaceImage(e),void 0===s){a=$("<div/>").addClass("face-thumbnail");const e=$("<i/>").addClass("fas fa-eye-slash text-white");a.append(e)}else a=$("<img/>").addClass("face-thumbnail").attr("src",s);t.append(a)}),t}makeFaceTableRowItem(e){return $("<td/>").addClass("h-100 align-middle text-center").append(e)}makeFaceCollectionDeleteBtn(e){const t=$("<button/>").addClass("btn btn-sm btn-danger").attr("type","button").attr("data-toggle","tooltip").attr("data-placement","bottom").attr("title",TOOLTIP_REMOVE_COLLECTION).html(BTN_REMOVE_COLLECTION).tooltip({trigger:"hover"});return t.on("click",async()=>{try{Spinner.loading(),t.tooltip("hide").addClass("disabled").attr("disabled","disabled"),await this.faceManager.deleteCollection(e);const a=this.tabContent.find("select#"+this.faceCollectionContainerId);a.val("undefined").trigger("change"),a.find(`option[value="${e}"]`).remove()}catch(e){console.error(e)}finally{Spinner.loading(!1)}}),t}makeFaceTableRowDeleteBtn(e,t){const a=$("<td/>").addClass("h-100 align-middle text-center"),s=$("<button/>").addClass("btn btn-sm btn-outline-danger").attr("type","button").attr("data-toggle","tooltip").attr("data-placement","bottom").attr("title",TOOLTIP_REMOVE_FACE).tooltip({trigger:"hover"});a.append(s);const n=$("<i/>").addClass("far fa-trash-alt");return s.append(n),s.on("click",async()=>{try{Spinner.loading(),s.tooltip("hide").addClass("disabled").attr("disabled","disabled"),await this.faceManager.deleteFace(e,t);s.parents("tr").remove()}catch(e){console.error(e)}finally{Spinner.loading(!1)}}),a}makeLoadMoreBtn(e,t,a){const s=$("<div/>").addClass("col-12 text-center mb-4"),n=$("<button/>").addClass("btn btn-sm btn-outline-dark").html(BTN_LOAD_MORE);return s.append(n),n.data("token",a),a&&"undefined"!==a||n.addClass("disabled").attr("disabled","disabled").html(MSG_NO_MORE_DATA),n.on("click",async()=>{try{Spinner.loading();const a=n.data("token"),s=await this.faceManager.getFacesInCollection(t,a),i=e.find("tbody"),o=s.faces.map(e=>this.makeFaceTableRow(t,e));i.append(o),n.data("token",s.token),s.token||n.addClass("disabled").attr("disabled","disabled").html(MSG_NO_MORE_DATA)}catch(e){console.error(e)}finally{Spinner.loading(!1)}}),s}async refreshCollectionList(e){try{Spinner.loading(),e.val("undefined").trigger("change"),e.find('option[value!="undefined"]').remove();const t=(await this.faceManager.refreshCollections()).map(e=>$("<option/>").attr("value",e.name).html(`${e.name} (${e.faces} faces)`));e.append(t)}catch(e){console.error(e)}finally{Spinner.loading(!1)}}async showAlert(e,t){return super.showMessage(this.tabContent,"danger",OOPS$2,e,t)}async onFaceManagerEvent(e,t){if(e!==ON_FACE_ADDED&&e!==ON_FACE_REMOVED)return;const a=this.tabContent.find("select#"+this.faceCollectionContainerId).find(`option[value="${t.collectionId}"]`);if(0===a.length)return;const s=await this.faceManager.getFacesInCollection(t.collectionId).then(e=>e.faces),n=`${a.val()} (${s.length} faces)`;if(a.html(n),e===ON_FACE_ADDED&&a.is(":selected")){const e=this.tabContent.find("#"+this.indexedFaceContainerId).find("tbody");if(0===e.length)return;const a=this.makeFaceTableRow(t.collectionId,t);e.append(a)}}}const{Messages:{SettingsTab:TITLE$1,DatastoreFeature:MSG_DATASTORE_FEATURE,DatastoreFeatureDesc:MSG_DATASTORE_FEATURE_DESC},Buttons:{CleanupDatastore:BTN_CLEANUP_DATASTORE}}=Localization,HASHTAG$1=TITLE$1.replaceAll(" ","");class SettingsTab extends(mxAnalysisSettings(BaseTab)){constructor(){super(TITLE$1,{hashtag:HASHTAG$1})}get parentContainer(){return this.tabContent}createSkeleton(){const e=super.createSkeleton(),t=this.createDatastoreForm();return e.children().first().after($("<div/>").addClass("col-9 p-0 mx-auto mt-4").append(t)),e}createDatastoreForm(){const e=$("<span/>").addClass("d-block p-2 bg-light text-black lead").html(MSG_DATASTORE_FEATURE),t=$("<p/>").addClass("lead-s mt-4").html(MSG_DATASTORE_FEATURE_DESC),a=$("<form/>").addClass("col-9 px-0 form-inline mt-4").attr("role","form"),s=$("<button/>").addClass("btn btn-sm btn-outline-danger").attr("type","button").attr("data-toggle","button").attr("aria-pressed","false").attr("autocomplete","off").append(BTN_CLEANUP_DATASTORE);return s.off("click").on("click",async e=>{this.loading(!0),e.preventDefault(),e.stopPropagation();const t=GetLocalStoreDB();return await t.clearAllStores(),this.loading(!1),!1}),a.append(s),a.submit(e=>e.preventDefault()),$("<div/>").addClass("ai-group").addClass("overflow-auto my-auto align-content-start").append($("<div/>").addClass("mt-4").append(e).append(t).append(a))}}const{Messages:{UserManagementTab:TITLE,UserManagementDesc:DESCRIPTION,Username:MSG_USERNAME,Email:MSG_EMAIL,Group:MSG_GROUP,Status:MSG_STATUS,LastModified:MSG_LASTMODIFIED,RemoveUser:MSG_REMOVE_USER,PermissionViewer:VIEWER_PERMISSION,PermissionCreator:CREATOR_PERMISSION,PermissionAdmin:ADMIN_PERMISSION,CurrentUsers:MSG_CURRENT_USER_LIST,CreateNewUsers:MSG_CREATE_NEW_USERS,CreateNewUsersDesc:MSG_CREATE_NEW_USERS_DESC},Tooltips:{RemoveUserFromCognito:TOOLTIP_REMOVE_USER,RefreshUserTable:TOOLTIP_REFRESH_USER_TABLE},Buttons:{AddEmail:BTN_ADD_EMAIL,ConfirmAndAddUsers:BTN_CONFIRM_AND_ADD,Refresh:BTN_REFRESH},Alerts:{Oops:OOPS$1,InvalidEmailAddress:ERR_INVALID_EMAIL_ADDRESS,UsernameConformance:ERR_INVALID_USERNAME,NoNewUsers:ERR_NO_USER_TO_ADD,FailAddingUsers:ERR_FAIL_ADDING_USERS}}=Localization,HASHTAG=TITLE.replaceAll(" ",""),TABLE_HEADER=[MSG_USERNAME,MSG_EMAIL,MSG_GROUP,MSG_STATUS,MSG_LASTMODIFIED,MSG_REMOVE_USER];class UserManagementTab extends(mxAlert(BaseTab)){constructor(){super(TITLE,{hashtag:HASHTAG}),Spinner.useSpinner()}loading(e){return Spinner.loading(e)}async show(e){if(!this.initialized){const e=await this.createContent();this.tabContent.append(e)}return super.show(e)}async createContent(){const e=$("<div/>").addClass("row no-gutters"),t=this.createDescriptionSection();e.append(t);const a=await this.createUserTableSection();e.append(a);const s=this.createAddUsersSection();return e.append(s),e}createDescriptionSection(){const e=$("<div/>").addClass("col-9 p-0 mx-auto mt-4"),t=AWSConsoleCongito.getUserPoolLink(SolutionManifest.Cognito.UserPoolId);let a=DESCRIPTION.replace("{{CONSOLE_USERPOOL}}",t);return a=$("<p/>").addClass("lead").html(a),e.append(a),e}async createUserTableSection(){const e=ApiHelper.getUsers(),t=$("<div/>").addClass("col-9 p-0 mx-auto mt-4 vh-30"),a=$("<div/>").addClass("col-12 p-0 mb-4 d-flex justify-content-between");t.append(a);const s=$("<span/>").addClass("lead").append(MSG_CURRENT_USER_LIST);a.append(s);const n=$("<button/>").addClass("btn btn-sm btn-outline-dark").attr("type","button").attr("data-toggle","tooltip").attr("data-placement","bottom").attr("title",TOOLTIP_REFRESH_USER_TABLE).html(BTN_REFRESH).tooltip({trigger:"hover"});n.on("click",async()=>{this.loading(!0),await this.refreshUserTable(),this.loading(!1)}),a.append(n);const i=$("<table/>").attr("id","table-"+this.id).addClass("table table-sm lead-xs no-border");t.append(i);const o=$("<tbody/>");i.append(o);const r=this.makeTableHeaderRow();o.append(r);const l=(await e).map(e=>this.makeTableRowItem(e));return o.append(l),t}makeTableHeaderRow(){const e=$("<tr/>"),t=TABLE_HEADER.map(e=>$("<th/>").addClass("align-middle text-center lead-sm").attr("scope","col").append(e));return e.append(t),e}makeTableRowItem(e){const t=$("<tr/>").attr("data-username",e.username);let a=e.group===SolutionManifest.Cognito.Group.Admin?ADMIN_PERMISSION:e.group===SolutionManifest.Cognito.Group.Creator?CREATOR_PERMISSION:VIEWER_PERMISSION;a=`${e.group}<br/>(${a})`;const s=$("<button/>").addClass("btn btn-sm btn-outline-danger").attr("type","button").attr("data-toggle","tooltip").attr("data-placement","bottom").attr("title",TOOLTIP_REMOVE_USER).append($("<i/>").addClass("far fa-trash-alt")).tooltip({trigger:"hover"});s.off("click").on("click",async()=>{this.loading(!0),s.tooltip("hide").addClass("disabled").attr("disabled","disabled"),await this.onRemoveUser(e.username),t.remove(),this.loading(!1)});const n=[e.username,e.email,a,e.status,new Date(e.lastModified).toISOString(),s].map(e=>$("<td/>").addClass("h-100 align-middle text-center col-2").append(e||"--"));return t.append(n),t}createAddUsersSection(){const e=$("<div/>").addClass("col-12 p-0 m-0 bg-light"),t=$("<div/>").addClass("col-9 p-0 mx-auto mt-4");e.append(t);const a=$("<span/>").addClass("d-block p-0 lead mb-4").append(MSG_CREATE_NEW_USERS);t.append(a);let s=MSG_CREATE_NEW_USERS_DESC.replace("{{ADD_EMAIL}}",BTN_ADD_EMAIL).replace("{{CONFIRM_AND_ADD}}",BTN_CONFIRM_AND_ADD);s=$("<p/>").addClass("lead-s").append(s),t.append(s);const n=this.createAddUserControls();return t.append(n),e}createAddUserControls(){const e="form-"+this.id,t=$("<form/>").addClass("col-9 px-0 needs-validation").attr("id",e).attr("novalidate","novalidate"),a=$("<div/>").addClass("form-group mt-2");t.append(a);const s=$("<button/>").addClass("btn btn-primary btn-sm mb-2 mr-1").attr("type","button").html(BTN_ADD_EMAIL);a.append(s);const n=$("<button/>").addClass("btn btn-success btn-sm mb-2 mr-1").attr("type","button").html(BTN_CONFIRM_AND_ADD);return a.append(n),s.on("click",async e=>(e.preventDefault(),a.before(this.createEmailField()),!0)),n.on("click",async e=>{e.preventDefault();let s=[];const n=t.children(".input-group");return n.each((e,t)=>{const a=$(t).find('[data-attr-type="email"]').val(),n=$(t).find("select").val();let i=$(t).find('input[type="text"]').val();void 0!==i&&0!==i.length||(i=void 0),a&&n&&s.push({email:a,group:n,username:i})}),s.length?(this.loading(!0),s=await this.onAddNewUsers(s),this.loading(!1),n.children().remove()):(this.shake(a),this.showAlert(ERR_NO_USER_TO_ADD))}),t}async refreshUserTable(e){const t=void 0!==e?e.slice(0):await ApiHelper.getUsers(),a=this.tabContent.find("table#table-"+this.id).find("tbody");a.children("[data-username]").each((e,a)=>{const s=$(a).data("username"),n=t.findIndex(e=>e.username===s);if(n>=0){const e=t.splice(n,1)[0],s=this.makeTableRowItem(e);$(a).replaceWith(s)}});const s=t.map(e=>this.makeTableRowItem(e));a.append(s)}createEmailField(){const e=$("<div/>").addClass("input-group mb-2 mr-sm-2"),t=$("<input/>").addClass("form-control col-3").attr("data-attr-type","email").attr("type","email").attr("required","required").attr("placeholder","(Email)");e.append(t);const a=$("<select/>").addClass("custom-select col-2").attr("id","select-"+this.id);e.append(a);const s=Object.values(SolutionManifest.Cognito.Group).map(e=>$("<option/>").attr("value",e).html(e));s[0].attr("selected","selected"),a.append(s);const n=$("<input/>").addClass("form-control col-3").attr("type","text").attr("pattern","[a-zA-Z0-9._%+-]{1,128}").attr("placeholder",`(${MSG_USERNAME})`);e.append(n);const i=$("<button/>").addClass("btn btn-secondary ml-1").append($("<i/>").addClass("far fa-times-circle"));return e.append(i),i.on("click",t=>{t.preventDefault(),e.remove()}),[[t,ERR_INVALID_EMAIL_ADDRESS],[n,ERR_INVALID_USERNAME]].forEach(t=>{t[0].focusout(async a=>{const s=e.parent("form").first();return!(!this.validateForm(a,s)&&!t[0].get(0).validity.valid)||(this.shake(e),await this.showAlert(t[1]),t[0].focus(),!1)}),t[0].keypress(async a=>{if(13===a.which){const s=e.parent("form").first();if(!this.validateForm(a,s)&&!t[0].get(0).validity.valid)return this.shake(e),await this.showAlert(t[1]),t[0].focus(),!1}return!0})}),e}validateForm(e,t){return e.preventDefault(),!1!==t[0].checkValidity()||(e.stopPropagation(),!1)}async showAlert(e,t){return super.showMessage(this.tabContent,"danger",OOPS$1,e,t)}async onRemoveUser(e){return ApiHelper.deleteUser(e)}async onAddNewUsers(e){const t=await ApiHelper.addUsers(e),a=t.filter(e=>void 0===e.error);await this.refreshUserTable(a);const s=t.filter(e=>void 0!==e.error);if(s.length>0){console.error(s);const e=s.map(e=>`<strong>${e.email}</strong>`).join(", "),t=ERR_FAIL_ADDING_USERS.replace("{{USERS}}",e);await this.showAlert(t)}return a}}const{Messages:{SolutionName:SOLUTION_NAME,CollectionTab:MSG_COLLECTION_TAB,UploadTab:MSG_UPLOAD_TAB,ProcessingTab:MSG_PROCESSING_TAB,StatsTab:MSG_STATS_TAB,FaceCollectionTab:MSG_FACECOLLECTION_TAB,SettingsTab:MSG_SETTINGS_TAB,UserManagementTab:MSG_USERMANAGEMENT_TAB},Tooltips:{Logout:TOOLTIP_LOGOUT,VisitSolutionPage:TOOLTIP_SOLUTION_PAGE}}=Localization,[COLLECTION_TAB,UPLOAD_TAB,PROCESSING_TAB,STATS_TAB,FACECOLLECTION_TAB,SETTINGS_TAB,USERMANAGEMENT_TAB]=[MSG_COLLECTION_TAB,MSG_UPLOAD_TAB,MSG_PROCESSING_TAB,MSG_STATS_TAB,MSG_FACECOLLECTION_TAB,MSG_SETTINGS_TAB,MSG_USERMANAGEMENT_TAB].map(e=>e.replaceAll(" ","")),ORDERED_CONTROLLERS=[COLLECTION_TAB,UPLOAD_TAB,PROCESSING_TAB,STATS_TAB,FACECOLLECTION_TAB,SETTINGS_TAB,USERMANAGEMENT_TAB],RANDOM_ID$1=AppUtils.randomHexstring(),ID_MAIN_CONTAINER="main-"+RANDOM_ID$1,ID_MAIN_TOASTLIST="main-toast-"+RANDOM_ID$1,ID_MAIN_TABLIST="main-tabs-"+RANDOM_ID$1,ID_MAIN_TABCONTENT="main-content-"+RANDOM_ID$1,SOLUTION_URL="https://aws.amazon.com/solutions/media2cloud/",SOLUTION_ICON$1="/images/m2c-short-white.png";function parseHashtag(e=""){let t=e;"#"===t[0]&&(t=t.slice(1));const a=t.split("/");return{current:a[0],next:a.slice(1).join("/")}}class MainView{constructor(){this.$view=$("<div/>").attr("id",ID_MAIN_CONTAINER),this.$tabControllers=this.initTabControllersByGroup()}get view(){return this.$view}get tabControllers(){return this.$tabControllers}initTabControllersByGroup(){const e={},t=GetUserSession();return t.canRead()&&(e[COLLECTION_TAB]=new CollectionTab,e[PROCESSING_TAB]=new ProcessingTab,e[STATS_TAB]=new StatsTab),t.canWrite()&&(e[UPLOAD_TAB]=new UploadTab,e[FACECOLLECTION_TAB]=new FaceCollectionTab,e[SETTINGS_TAB]=new SettingsTab),t.canModify()&&(e[USERMANAGEMENT_TAB]=new UserManagementTab),e}appendTo(e){return e.append(this.view)}async show(e){await this.hide();const t=$("<nav/>").addClass("navbar navbar-expand-lg navbar-dark bg-dark").append(this.createLogo()).append(this.createNavToggle()).append(this.createTabItems()).append(this.createLogoutIcon());return this.view.append(t),this.view.append(this.createTabContents()),this.view.append(this.createPadding()),this.view.append(this.createToastLayer()),this._show(e)}async _show(e){const{current:t,next:a}=parseHashtag(e);let s=t;return void 0===this.tabControllers[s]&&(s=COLLECTION_TAB),this.tabControllers[s].show(a)}async hide(){return Promise.all(Object.values(this.tabControllers).map(e=>e.hide()))}createLogo(){const e=$("<a/>").addClass("navbar-brand").attr("href",SOLUTION_URL).attr("target","_blank").attr("data-toggle","tooltip").attr("data-placement","bottom").attr("title",TOOLTIP_SOLUTION_PAGE).css("font-size","1rem");return e.tooltip(),e.append($("<img/>").addClass("d-inline-block align-top").attr("src",SOLUTION_ICON$1).attr("height",48).attr("alt",SOLUTION_NAME))}createNavToggle(){const e=ID_MAIN_TABLIST;return $("<button/>").addClass("navbar-toggler").attr("type","button").attr("data-toggle","collapse").attr("data-target","#"+e).attr("aria-controls",e).attr("aria-expanded","false").attr("aria-label","Toggle navigation").append($("<span/>").addClass("navbar-toggler-icon"))}createTabItems(){const e=ID_MAIN_TABLIST,t=$("<div/>").addClass("collapse navbar-collapse").attr("id",e),a=$("<div/>").addClass("navbar-nav").attr("role","tablist");return t.append(a),ORDERED_CONTROLLERS.forEach(e=>{const t=this.tabControllers[e];void 0!==t&&a.append(t.tabLink)}),t}createLogoutIcon(){const e=GetUserSession(),t=$("<button/>").addClass("btn btn-sm btn-link text-white").attr("type","button").attr("data-toggle","tooltip").attr("data-placement","bottom").attr("title",`${(e||{}).username}, ${TOOLTIP_LOGOUT}`).css("font-size","1rem").tooltip();t.on("click",async()=>(await e.signOut(),window.location.reload()));const a=$("<i/>").addClass("fas fa-user-circle").css("font-size","2rem");return t.html(a),t}createTabContents(){const e=$("<div/>").addClass("tab-content").attr("id",ID_MAIN_TABCONTENT);return ORDERED_CONTROLLERS.forEach(t=>{const a=this.tabControllers[t];void 0!==a&&e.append(a.tabContent)}),e}createPadding(){return $("<div/>").addClass("row no-gutters").css("height",100).append($("<div/>").addClass("col-12 lead-sm d-flex justify-content-center align-self-center").append($("<span/>").addClass("lead-sm mr-2").append(`Version ${SolutionManifest.Version} (${SolutionManifest.LastUpdated})`)))}createToastLayer(e=ID_MAIN_TOASTLIST){return $("<div/>").addClass("position-absolute w-100 d-flex flex-column").css("z-index",1e3).css("margin-left","60%").attr("id",e)}}
/*!
 * Copyright 2016 Amazon.com,
 * Inc. or its affiliates. All Rights Reserved.
 *
 * Licensed under the Amazon Software License (the "License").
 * You may not use this file except in compliance with the
 * License. A copy of the License is located at
 *
 *     http://aws.amazon.com/asl/
 *
 * or in the "license" file accompanying this file. This file is
 * distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
 * CONDITIONS OF ANY KIND, express or implied. See the License
 * for the specific language governing permissions and
 * limitations under the License.
 */const monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekNames=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];class DateHelper{getNowString(){const e=new Date,t=weekNames[e.getUTCDay()],a=monthNames[e.getUTCMonth()],s=e.getUTCDate();let n=e.getUTCHours();n<10&&(n="0"+n);let i=e.getUTCMinutes();i<10&&(i="0"+i);let o=e.getUTCSeconds();o<10&&(o="0"+o);return`${t} ${a} ${s} ${n}:${i}:${o} UTC ${e.getUTCFullYear()}`}}function BigInteger(e,t){null!=e&&this.fromString(e,t)}function nbi(){return new BigInteger(null)}let dbits;const canary=0xdeadbeefcafe,j_lm=!0;function am1(e,t,a,s,n,i){for(;--i>=0;){const i=t*this[e++]+a[s]+n;n=Math.floor(i/67108864),a[s++]=67108863&i}return n}function am2(e,t,a,s,n,i){const o=32767&t,r=t>>15;for(;--i>=0;){let t=32767&this[e];const i=this[e++]>>15,l=r*t+i*o;t=o*t+((32767&l)<<15)+a[s]+(1073741823&n),n=(t>>>30)+(l>>>15)+r*i+(n>>>30),a[s++]=1073741823&t}return n}function am3(e,t,a,s,n,i){const o=16383&t,r=t>>14;for(;--i>=0;){let t=16383&this[e];const i=this[e++]>>14,l=r*t+i*o;t=o*t+((16383&l)<<14)+a[s]+n,n=(t>>28)+(l>>14)+r*i,a[s++]=268435455&t}return n}const inBrowser="undefined"!=typeof navigator;inBrowser&&"Microsoft Internet Explorer"===navigator.appName?(BigInteger.prototype.am=am2,dbits=30):inBrowser&&"Netscape"!==navigator.appName?(BigInteger.prototype.am=am1,dbits=26):(BigInteger.prototype.am=am3,dbits=28),BigInteger.prototype.DB=dbits,BigInteger.prototype.DM=(1<<dbits)-1,BigInteger.prototype.DV=1<<dbits;const BI_FP=52;BigInteger.prototype.FV=2**52,BigInteger.prototype.F1=52-dbits,BigInteger.prototype.F2=2*dbits-52;const BI_RM="0123456789abcdefghijklmnopqrstuvwxyz",BI_RC=new Array;let rr,vv;for(rr="0".charCodeAt(0),vv=0;vv<=9;++vv)BI_RC[rr++]=vv;for(rr="a".charCodeAt(0),vv=10;vv<36;++vv)BI_RC[rr++]=vv;for(rr="A".charCodeAt(0),vv=10;vv<36;++vv)BI_RC[rr++]=vv;function int2char(e){return BI_RM.charAt(e)}function intAt(e,t){const a=BI_RC[e.charCodeAt(t)];return null==a?-1:a}function bnpCopyTo(e){for(let t=this.t-1;t>=0;--t)e[t]=this[t];e.t=this.t,e.s=this.s}function bnpFromInt(e){this.t=1,this.s=e<0?-1:0,e>0?this[0]=e:e<-1?this[0]=e+this.DV:this.t=0}function nbv(e){const t=nbi();return t.fromInt(e),t}function bnpFromString(e,t){let a;if(16===t)a=4;else if(8===t)a=3;else if(2===t)a=1;else if(32===t)a=5;else{if(4!==t)throw new Error("Only radix 2, 4, 8, 16, 32 are supported");a=2}this.t=0,this.s=0;let s=e.length,n=!1,i=0;for(;--s>=0;){const t=intAt(e,s);t<0?"-"===e.charAt(s)&&(n=!0):(n=!1,0===i?this[this.t++]=t:i+a>this.DB?(this[this.t-1]|=(t&(1<<this.DB-i)-1)<<i,this[this.t++]=t>>this.DB-i):this[this.t-1]|=t<<i,i+=a,i>=this.DB&&(i-=this.DB))}this.clamp(),n&&BigInteger.ZERO.subTo(this,this)}function bnpClamp(){const e=this.s&this.DM;for(;this.t>0&&this[this.t-1]===e;)--this.t}function bnToString(e){if(this.s<0)return"-"+this.negate().toString(e);let t;if(16===e)t=4;else if(8===e)t=3;else if(2===e)t=1;else if(32===e)t=5;else{if(4!==e)throw new Error("Only radix 2, 4, 8, 16, 32 are supported");t=2}let a,s=(1<<t)-1,n=!1,i="",o=this.t,r=this.DB-o*this.DB%t;if(o-- >0)for(r<this.DB&&(a=this[o]>>r)>0&&(n=!0,i=int2char(a));o>=0;)r<t?(a=(this[o]&(1<<r)-1)<<t-r,a|=this[--o]>>(r+=this.DB-t)):(a=this[o]>>(r-=t)&s,r<=0&&(r+=this.DB,--o)),a>0&&(n=!0),n&&(i+=int2char(a));return n?i:"0"}function bnNegate(){const e=nbi();return BigInteger.ZERO.subTo(this,e),e}function bnAbs(){return this.s<0?this.negate():this}function bnCompareTo(e){let t=this.s-e.s;if(0!==t)return t;let a=this.t;if(t=a-e.t,0!==t)return this.s<0?-t:t;for(;--a>=0;)if(0!=(t=this[a]-e[a]))return t;return 0}function nbits(e){let t,a=1;return 0!=(t=e>>>16)&&(e=t,a+=16),0!=(t=e>>8)&&(e=t,a+=8),0!=(t=e>>4)&&(e=t,a+=4),0!=(t=e>>2)&&(e=t,a+=2),0!=(t=e>>1)&&(e=t,a+=1),a}function bnBitLength(){return this.t<=0?0:this.DB*(this.t-1)+nbits(this[this.t-1]^this.s&this.DM)}function bnpDLShiftTo(e,t){let a;for(a=this.t-1;a>=0;--a)t[a+e]=this[a];for(a=e-1;a>=0;--a)t[a]=0;t.t=this.t+e,t.s=this.s}function bnpDRShiftTo(e,t){for(let a=e;a<this.t;++a)t[a-e]=this[a];t.t=Math.max(this.t-e,0),t.s=this.s}function bnpLShiftTo(e,t){const a=e%this.DB,s=this.DB-a,n=(1<<s)-1;let i,o=Math.floor(e/this.DB),r=this.s<<a&this.DM;for(i=this.t-1;i>=0;--i)t[i+o+1]=this[i]>>s|r,r=(this[i]&n)<<a;for(i=o-1;i>=0;--i)t[i]=0;t[o]=r,t.t=this.t+o+1,t.s=this.s,t.clamp()}function bnpRShiftTo(e,t){t.s=this.s;const a=Math.floor(e/this.DB);if(a>=this.t)return void(t.t=0);const s=e%this.DB,n=this.DB-s,i=(1<<s)-1;t[0]=this[a]>>s;for(let e=a+1;e<this.t;++e)t[e-a-1]|=(this[e]&i)<<n,t[e-a]=this[e]>>s;s>0&&(t[this.t-a-1]|=(this.s&i)<<n),t.t=this.t-a,t.clamp()}function bnpSubTo(e,t){let a=0,s=0,n=Math.min(e.t,this.t);for(;a<n;)s+=this[a]-e[a],t[a++]=s&this.DM,s>>=this.DB;if(e.t<this.t){for(s-=e.s;a<this.t;)s+=this[a],t[a++]=s&this.DM,s>>=this.DB;s+=this.s}else{for(s+=this.s;a<e.t;)s-=e[a],t[a++]=s&this.DM,s>>=this.DB;s-=e.s}t.s=s<0?-1:0,s<-1?t[a++]=this.DV+s:s>0&&(t[a++]=s),t.t=a,t.clamp()}function bnpMultiplyTo(e,t){const a=this.abs(),s=e.abs();let n=a.t;for(t.t=n+s.t;--n>=0;)t[n]=0;for(n=0;n<s.t;++n)t[n+a.t]=a.am(0,s[n],t,n,0,a.t);t.s=0,t.clamp(),this.s!==e.s&&BigInteger.ZERO.subTo(t,t)}function bnpSquareTo(e){const t=this.abs();let a=e.t=2*t.t;for(;--a>=0;)e[a]=0;for(a=0;a<t.t-1;++a){const s=t.am(a,t[a],e,2*a,0,1);(e[a+t.t]+=t.am(a+1,2*t[a],e,2*a+1,s,t.t-a-1))>=t.DV&&(e[a+t.t]-=t.DV,e[a+t.t+1]=1)}e.t>0&&(e[e.t-1]+=t.am(a,t[a],e,2*a,0,1)),e.s=0,e.clamp()}function bnpDivRemTo(e,t,a){const s=e.abs();if(s.t<=0)return;const n=this.abs();if(n.t<s.t)return null!=t&&t.fromInt(0),void(null!=a&&this.copyTo(a));null==a&&(a=nbi());const i=nbi(),o=this.s,r=e.s,l=this.DB-nbits(s[s.t-1]);l>0?(s.lShiftTo(l,i),n.lShiftTo(l,a)):(s.copyTo(i),n.copyTo(a));const d=i.t,c=i[d-1];if(0===c)return;const p=c*(1<<this.F1)+(d>1?i[d-2]>>this.F2:0),h=this.FV/p,u=(1<<this.F1)/p,m=1<<this.F2;let g=a.t,C=g-d,S=null==t?nbi():t;for(i.dlShiftTo(C,S),a.compareTo(S)>=0&&(a[a.t++]=1,a.subTo(S,a)),BigInteger.ONE.dlShiftTo(d,S),S.subTo(i,i);i.t<d;)i[i.t++]=0;for(;--C>=0;){let e=a[--g]===c?this.DM:Math.floor(a[g]*h+(a[g-1]+m)*u);if((a[g]+=i.am(0,e,a,C,0,d))<e)for(i.dlShiftTo(C,S),a.subTo(S,a);a[g]<--e;)a.subTo(S,a)}null!=t&&(a.drShiftTo(d,t),o!==r&&BigInteger.ZERO.subTo(t,t)),a.t=d,a.clamp(),l>0&&a.rShiftTo(l,a),o<0&&BigInteger.ZERO.subTo(a,a)}function bnMod(e){const t=nbi();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(BigInteger.ZERO)>0&&e.subTo(t,t),t}function bnpInvDigit(){if(this.t<1)return 0;const e=this[0];if(0==(1&e))return 0;let t=3&e;return t=t*(2-(15&e)*t)&15,t=t*(2-(255&e)*t)&255,t=t*(2-((65535&e)*t&65535))&65535,t=t*(2-e*t%this.DV)%this.DV,t>0?this.DV-t:-t}function bnEquals(e){return 0===this.compareTo(e)}function bnpAddTo(e,t){let a=0,s=0,n=Math.min(e.t,this.t);for(;a<n;)s+=this[a]+e[a],t[a++]=s&this.DM,s>>=this.DB;if(e.t<this.t){for(s+=e.s;a<this.t;)s+=this[a],t[a++]=s&this.DM,s>>=this.DB;s+=this.s}else{for(s+=this.s;a<e.t;)s+=e[a],t[a++]=s&this.DM,s>>=this.DB;s+=e.s}t.s=s<0?-1:0,s>0?t[a++]=s:s<-1&&(t[a++]=this.DV+s),t.t=a,t.clamp()}function bnAdd(e){const t=nbi();return this.addTo(e,t),t}function bnSubtract(e){const t=nbi();return this.subTo(e,t),t}function bnMultiply(e){const t=nbi();return this.multiplyTo(e,t),t}function bnDivide(e){const t=nbi();return this.divRemTo(e,t,null),t}function Montgomery(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function montConvert(e){const t=nbi();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(BigInteger.ZERO)>0&&this.m.subTo(t,t),t}function montRevert(e){const t=nbi();return e.copyTo(t),this.reduce(t),t}function montReduce(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(let t=0;t<this.m.t;++t){let a=32767&e[t];const s=a*this.mpl+((a*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(a=t+this.m.t,e[a]+=this.m.am(0,s,e,t,0,this.m.t);e[a]>=e.DV;)e[a]-=e.DV,e[++a]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)}function montSqrTo(e,t){e.squareTo(t),this.reduce(t)}function montMulTo(e,t,a){e.multiplyTo(t,a),this.reduce(a)}function bnModPow(e,t,a){let s,n=e.bitLength(),i=nbv(1),o=new Montgomery(t);if(n<=0)return i;s=n<18?1:n<48?3:n<144?4:n<768?5:6;let r=new Array,l=3,d=s-1,c=(1<<s)-1;if(r[1]=o.convert(this),s>1){const e=nbi();for(o.sqrTo(r[1],e);l<=c;)r[l]=nbi(),o.mulTo(e,r[l-2],r[l]),l+=2}let p,h,u=e.t-1,m=!0,g=nbi();for(n=nbits(e[u])-1;u>=0;){for(n>=d?p=e[u]>>n-d&c:(p=(e[u]&(1<<n+1)-1)<<d-n,u>0&&(p|=e[u-1]>>this.DB+n-d)),l=s;0==(1&p);)p>>=1,--l;if((n-=l)<0&&(n+=this.DB,--u),m)r[p].copyTo(i),m=!1;else{for(;l>1;)o.sqrTo(i,g),o.sqrTo(g,i),l-=2;l>0?o.sqrTo(i,g):(h=i,i=g,g=h),o.mulTo(g,r[p],i)}for(;u>=0&&0==(e[u]&1<<n);)o.sqrTo(i,g),h=i,i=g,g=h,--n<0&&(n=this.DB-1,--u)}const C=o.revert(i);return a(null,C),C}Montgomery.prototype.convert=montConvert,Montgomery.prototype.revert=montRevert,Montgomery.prototype.reduce=montReduce,Montgomery.prototype.mulTo=montMulTo,Montgomery.prototype.sqrTo=montSqrTo,BigInteger.prototype.copyTo=bnpCopyTo,BigInteger.prototype.fromInt=bnpFromInt,BigInteger.prototype.fromString=bnpFromString,BigInteger.prototype.clamp=bnpClamp,BigInteger.prototype.dlShiftTo=bnpDLShiftTo,BigInteger.prototype.drShiftTo=bnpDRShiftTo,BigInteger.prototype.lShiftTo=bnpLShiftTo,BigInteger.prototype.rShiftTo=bnpRShiftTo,BigInteger.prototype.subTo=bnpSubTo,BigInteger.prototype.multiplyTo=bnpMultiplyTo,BigInteger.prototype.squareTo=bnpSquareTo,BigInteger.prototype.divRemTo=bnpDivRemTo,BigInteger.prototype.invDigit=bnpInvDigit,BigInteger.prototype.addTo=bnpAddTo,BigInteger.prototype.toString=bnToString,BigInteger.prototype.negate=bnNegate,BigInteger.prototype.abs=bnAbs,BigInteger.prototype.compareTo=bnCompareTo,BigInteger.prototype.bitLength=bnBitLength,BigInteger.prototype.mod=bnMod,BigInteger.prototype.equals=bnEquals,BigInteger.prototype.add=bnAdd,BigInteger.prototype.subtract=bnSubtract,BigInteger.prototype.multiply=bnMultiply,BigInteger.prototype.divide=bnDivide,BigInteger.prototype.modPow=bnModPow,BigInteger.ZERO=nbv(0),BigInteger.ONE=nbv(1);const{SHA256,HmacSHA256,lib:{WordArray},enc:{Base64}}=CryptoJS,{Buffer}=window.Polyfill,INIT_N=["FFFFFFFFFFFFFFFFC90FDAA22168C234C4C6628B80DC1CD1","29024E088A67CC74020BBEA63B139B22514A08798E3404DD","EF9519B3CD3A431B302B0A6DF25F14374FE1356D6D51C245","E485B576625E7EC6F44C42E9A637ED6B0BFF5CB6F406B7ED","EE386BFB5A899FA5AE9F24117C4B1FE649286651ECE45B3D","C2007CB8A163BF0598DA48361C55D39A69163FA8FD24CF5F","83655D23DCA3AD961C62F356208552BB9ED529077096966D","670C354E4ABC9804F1746C08CA18217C32905E462E36CE3B","E39E772C180E86039B2783A2EC07A28FB5C55DF06F4C52C9","DE2BCBF6955817183995497CEA956AE515D2261898FA0510","15728E5A8AAAC42DAD33170D04507A33A85521ABDF1CBA64","ECFB850458DBEF0A8AEA71575D060C7DB3970F85A6E1E4C7","ABF5AE8CDB0933D71E8C94E04A25619DCEE3D2261AD2EE6B","F12FFA06D98A0864D87602733EC86A64521F2B18177B200C","BBE117577A615D6C770988C0BAD946E208E24FA074E5AB31","43DB5BFCE0FD108E4B82D120A93AD2CAFFFFFFFFFFFFFFFF"].join(""),INFOBITS=Buffer.from("Caldera Derived Key","utf8");function randomBytes(e){return Buffer.from(WordArray.random(e).toString(),"hex")}class AuthenticationHelper{constructor(e){this.$userPoolId=e,this.$userPoolName=e.split("_")[1],this.N=new BigInteger(INIT_N,16),this.g=new BigInteger("2",16),this.k=new BigInteger(this.hexHash(`00${this.N.toString(16)}0${this.g.toString(16)}`),16),this.a=this.randomizeSmallA(),this.A=void 0}get userPoolId(){return this.$userPoolId}get userPoolName(){return this.$userPoolName}hexHash(e){return this.hash(Buffer.from(e,"hex"))}hash(e){let t=e;e instanceof Buffer&&(t=WordArray.create(e));const a=SHA256(t).toString();return new Array(64-a.length).join("0")+a}randomizeSmallA(){return new BigInteger(randomBytes(128).toString("hex"),16).mod(this.N)}async calculateA(){return this.A?this.A:new Promise((e,t)=>{this.g.modPow(this.a,this.N,(a,s)=>{if(a)t(a);else{if(s.mod(this.N).equals(BigInteger.ZERO))return console.error("ERR:","calculateA:","A mod N cannot be 0"),void t(new Error("A mod N cannot be 0"));this.A=s,e(this.A)}})})}async calculateU(e,t){return new BigInteger(this.hexHash(this.padHex(e)+this.padHex(t)),16)}async calculateS(e,t,a){return new Promise((s,n)=>{const i=this.g,o=this.k,r=this.N,l=this.a;i.modPow(t,r,(i,d)=>{if(i)return void n(i);a.subtract(o.multiply(d)).modPow(l.add(e.multiply(t)),r,(e,t)=>{e?n(e):s(t.mod(r))})})})}async calculateHKDF(e,t){const a=WordArray.create(Buffer.concat([INFOBITS,Buffer.from(String.fromCharCode(1),"utf8")]));let s=e;s instanceof Buffer&&(s=WordArray.create(e));let n=t;n instanceof Buffer&&(n=WordArray.create(t));const i=HmacSHA256(s,n),o=HmacSHA256(a,i);return Buffer.from(o.toString(),"hex").slice(0,16)}async computePasswordAuthenticationKey(e,t,a,s){if(a.mod(this.N).equals(BigInteger.ZERO))throw console.error("ERR:","computePasswordAuthenticationKey:","B mod N cannot be 0"),new Error("B mod N cannot be 0");const n=await this.calculateU(this.A,a);if(n.equals(BigInteger.ZERO))throw console.error("ERR:","calculateU:","U value is 0"),new Error("U cannot be 0");const i=`${this.userPoolName}${e}:${t}`,o=this.hash(i),r=new BigInteger(this.hexHash(this.padHex(s)+o),16),l=await this.calculateS(n,r,a);return await this.calculateHKDF(Buffer.from(this.padHex(l),"hex"),Buffer.from(this.padHex(n.toString(16)),"hex"))}passwordClaimSignature(e,t,a,s){const n=WordArray.create(Buffer.concat([Buffer.from(this.userPoolName,"utf8"),Buffer.from(t,"utf8"),Buffer.from(a,"base64"),Buffer.from(s,"utf8")])),i=WordArray.create(e),o=HmacSHA256(n,i);return Base64.stringify(o)}padHex(e){let t=e.toString(16);return t.length%2==1?t="0"+t:"89ABCDEFabcdef".indexOf(t[0])>=0&&(t="00"+t),t}static hex2BigInt(e){return new BigInteger(e,16)}}const{CognitoIdentityProviderClient,InitiateAuthCommand,RespondToAuthChallengeCommand,ForgotPasswordCommand,ConfirmForgotPasswordCommand,AuthFlowType,ChallengeNameType:ChallengeNameType$1}=window.AWSv3,REGION=SolutionManifest.Region,USERPOOL_ID=SolutionManifest.Cognito.UserPoolId,CLIENT_ID=SolutionManifest.Cognito.ClientId,_cognitoIdpClient=new CognitoIdentityProviderClient({region:REGION});class AuthenticationFlow{constructor(e=USERPOOL_ID,t=CLIENT_ID,a=AuthFlowType.USER_SRP_AUTH){this.$userPoolId=e,this.$clientId=t,this.$authFlow=a,this.$currentUserSession=void 0,this.$authenticationHelper=new AuthenticationHelper(e)}get userPoolId(){return this.$userPoolId}get clientId(){return this.$clientId}get authFlow(){return this.$authFlow}get authenticationHelper(){return this.$authenticationHelper}get currentUserSession(){return this.$currentUserSession}set currentUserSession(e){this.$currentUserSession=e}async authenticateUser(e,t){let a;return a=await this.initiateAuth(e,t),void 0!==a.AuthenticationResult||a.ChallengeName===ChallengeNameType$1.PASSWORD_VERIFIER&&(a=await this.authPasswordVerificationChallenge(a,t),console.log(ChallengeNameType$1.PASSWORD_VERIFIER,a),void 0!==a.AuthenticationResult)?(this.currentUserSession=await CreateUserSessionFromAuth(a.AuthenticationResult),this.currentUserSession):a}async newPasswordRequired(e,t,a){let s;if(e.ChallengeName===ChallengeNameType$1.NEW_PASSWORD_REQUIRED&&(s=await this.authNewPasswordChallenge(e,t,a),console.log(ChallengeNameType$1.NEW_PASSWORD_REQUIRED,s),void 0!==s.AuthenticationResult))return this.currentUserSession=await CreateUserSessionFromAuth(s.AuthenticationResult),this.currentUserSession;throw new Error("ERR: newPasswordRequired: fail to get AuthenticationResult")}async forgotPassword(e){const t={ClientId:this.clientId,Username:e},a=new ForgotPasswordCommand(t),s=await _cognitoIdpClient.send(a);return console.log("ForgotPasswordCommand",s),s}async makeAuthParams(e,t){const a={AuthFlow:this.authFlow,ClientId:this.clientId,AuthParameters:{USERNAME:e}};if(a.AuthFlow===AuthFlowType.USER_PASSWORD_AUTH)a.AuthParameters.PASSWORD=t;else{if(a.AuthFlow!==AuthFlowType.USER_SRP_AUTH)throw new Error("invalid authentication flow");{const e=await this.authenticationHelper.calculateA();a.AuthParameters.SRP_A=e.toString(16)}}return a}async initiateAuth(e,t){const a=await this.makeAuthParams(e,t),s=new InitiateAuthCommand(a),n=await _cognitoIdpClient.send(s);return console.log("InitiateAuthCommand",n),n}async authPasswordVerificationChallenge(e,t){const a=e.ChallengeParameters.USER_ID_FOR_SRP,s=AuthenticationHelper.hex2BigInt(e.ChallengeParameters.SRP_B),n=AuthenticationHelper.hex2BigInt(e.ChallengeParameters.SALT),i=await this.authenticationHelper.computePasswordAuthenticationKey(a,t,s,n),o=e.ChallengeParameters.SECRET_BLOCK,r=(new DateHelper).getNowString(),l={USERNAME:a,PASSWORD_CLAIM_SECRET_BLOCK:o,PASSWORD_CLAIM_SIGNATURE:this.authenticationHelper.passwordClaimSignature(i,a,o,r),TIMESTAMP:r},d=new RespondToAuthChallengeCommand({ChallengeName:e.ChallengeName,ClientId:this.clientId,ChallengeResponses:l,Session:e.Session,ClientMetadata:{}});return _cognitoIdpClient.send(d)}async authNewPasswordChallenge(e,t,a){console.log("data",e,"newPassword",a),JSON.parse(e.ChallengeParameters.userAttributes),JSON.parse(e.ChallengeParameters.requiredAttributes);const s={USERNAME:t,NEW_PASSWORD:a},n=new RespondToAuthChallengeCommand({ChallengeName:e.ChallengeName,ClientId:this.clientId,ChallengeResponses:s,Session:e.Session,ClientMetadata:{}});return _cognitoIdpClient.send(n)}async confirmPasswordChange(e,t,a){const s={ClientId:this.clientId,Username:e,Password:t,ConfirmationCode:a},n=new ConfirmForgotPasswordCommand(s),i=await _cognitoIdpClient.send(n);return console.log("ConfirmForgotPasswordCommand",i),i}}const{ChallengeNameType}=window.AWSv3,SOLUTION_ICON="/images/m2c-full-black.png",COPYRIGHT="copyright &copy; 2023",OOPS=Localization.Alerts.Oops,MSG_TITLE=Localization.Messages.Title,MSG_PASSWORD_REQ=Localization.Messages.PwdRequirement,MSG_RESET_SEND_CODE=Localization.Messages.ResetSendCode,MSG_RESET_PASSWORD=Localization.Messages.ResetPwd,MSG_MISMATCH_PASSWORDS=Localization.Alerts.MismatchPwds,MSG_PASSWORD_NOT_CONFORM=Localization.Alerts.PwdConformance,MSG_SIGNIN_PROBLEM=Localization.Alerts.SignInProblem,MSG_USERNAME_NOT_CONFORM=Localization.Alerts.UsernameConformance,RANDOM_ID=AppUtils.randomHexstring(),ID_SPINNER="signin-spinner-"+RANDOM_ID,ID_CONTAINER="signin-"+RANDOM_ID,ID_MODAL="signin-modal-"+RANDOM_ID,ID_CAROUSEL="signin-carousel-"+RANDOM_ID,ID_PASSWORD="signin-password-"+RANDOM_ID,ID_PASSWORD_01="signin-password-01-"+RANDOM_ID,ID_PASSWORD_02="signin-password-02-"+RANDOM_ID,SLIDEID_SIGNIN="slide-signin-"+RANDOM_ID,SLIDEID_NEW_PASSWORD="slide-new-password-"+RANDOM_ID,SLIDEID_SEND_CODE="slide-send-code-"+RANDOM_ID,SLIDEID_RESET_PASSWORD="slide-reset-password-"+RANDOM_ID,ON_SIGNIN_VIEW_HIDDEN="signin:view:hidden",_tmpFlowData={};class SignInFlow{constructor(){this.$view=$("<div/>").attr("id",ID_CONTAINER),this.$authFlow=new AuthenticationFlow}appendTo(e){return e.append(this.view)}get view(){return this.$view}get authFlow(){return this.$authFlow}async show(){let e;await this.hide();try{if(e=(await this.userSignInFromCache()||{}).username,void 0!==e)return this.view.trigger("signin:view:hidden")}catch(e){}finally{if(void 0===e){const t=GetSettingStore();e=await t.getItem(OPT_USERNAME)}}const t=$("<div/>").addClass("modal fade").attr("id",ID_MODAL).attr("tabindex",-1).attr("role","dialog");this.view.append(t);const a=$("<div/>").addClass("modal-dialog").attr("role","document");t.append(a);const s=$("<div/>").addClass("modal-content");a.append(s);const n=$("<div/>").addClass("modal-header");s.append(n);const i=$("<h5/>").addClass("modal-title lead").html(MSG_TITLE);n.append(i);const o=$("<div/>").addClass("modal-body");s.append(o);const r=this.createCarousel(e);o.append(r);const l=$("<div/>").addClass("modal-footer");s.append(l);const d=this.createCopyright();l.append(d);const c=this.createSpinner();return a.append(c),t.on("hidden.bs.modal",()=>{Object.keys(_tmpFlowData).forEach(e=>delete _tmpFlowData[e]),this.view.trigger("signin:view:hidden")}),t.modal({backdrop:"static",keyboard:!1,show:!0})}async hide(){this.view.children().remove()}async userSignIn(){const e=GetUserSession();if(void 0!==await e.signIn()){const e=(void 0===_singleton$3&&new IotSubscriber,_singleton$3);await e.connect()}return e}async userSignInFromCache(){const e=await LoadUserSessionFromCache();return void 0===e?e:this.userSignIn()}createCarousel(e){const t=$("<div/>").addClass("carousel slide").attr("data-ride",!1).attr("data-interval",!1).attr("id",ID_CAROUSEL),a=$("<div/>").addClass("carousel-inner");t.append(a);const s=[{id:SLIDEID_SIGNIN,el:this.createSignInForm(e)},{id:SLIDEID_NEW_PASSWORD,el:this.createNewPasswordForm()},{id:SLIDEID_SEND_CODE,el:this.createResetSendCodeForm()},{id:SLIDEID_RESET_PASSWORD,el:this.createResetPasswordForm()}].map(e=>$("<div/>").addClass("carousel-item").attr("id",e.id).append(e.el));return s[0].addClass("active"),a.append(s),t}createSignInForm(e){const t=$("<form/>").addClass("form-signin text-center needs-validation").attr("novalidate","novalidate"),a=this.createLogo();t.append(a);const s="signin-username-"+RANDOM_ID,n=this.createUserInput(s,"Username",e);t.append(n);const i=ID_PASSWORD,o=this.createPasswordInput(i,"Password");t.append(o);const r=this.createSubmitButton();t.append(r);const l=this.createResetLink();return t.append(l),l.on("click",async()=>{this.slideTo(SLIDEID_SEND_CODE)}),t.submit(async e=>{e.preventDefault();try{if(this.loading(),!1===t[0].checkValidity())throw e.stopPropagation(),this.shake(),MSG_PASSWORD_NOT_CONFORM;const[a,n]=[s,i].map(e=>t.find("#"+e)),o=await this.authFlow.authenticateUser(a.val(),n.val());if(o instanceof UserSession)return await this.userSignIn(),a.val(""),n.val(""),setTimeout(()=>{this.view.find("div#"+ID_MODAL).modal("hide")},10),!0;if(o.ChallengeName===ChallengeNameType.NEW_PASSWORD_REQUIRED)return _tmpFlowData.username=a.val(),_tmpFlowData.challengeResponse=o,this.slideTo(SLIDEID_NEW_PASSWORD),!0;throw console.log("ERR:","authenticateUser:",o),new Error("fail to authenticate user, "+(o.$metadata||{}).httpStatusCode)}catch(e){let t=e;return e instanceof Error&&(t=[MSG_SIGNIN_PROBLEM,`<br><pre class="text-danger small">(error: ${e.message})</pre>`].join("")),await this.showMessage("danger",OOPS,t),!1}finally{this.loading(!1)}}),t}createNewPasswordForm(){const e=$("<div/>"),t=$("</p>").addClass("text-muted").html(MSG_PASSWORD_REQ);e.append(t);const a=$("<form/>").addClass("form-signin text-center needs-validation").attr("novalidate","novalidate");e.append(a);const s=[[ID_PASSWORD_01,"New Password"],[ID_PASSWORD_02,"Confirm Password"]].map(e=>this.createPasswordInput(...e));a.append(s);const n=this.createSubmitButton("Confirm");return a.append(n),a.submit(async e=>{e.preventDefault();const[t,s]=[ID_PASSWORD_01,ID_PASSWORD_02].map(e=>a.find("#"+e));try{if(this.loading(),t.val()!==s.val())throw e.stopPropagation(),this.shake(),MSG_MISMATCH_PASSWORDS;if(!1===a[0].checkValidity())throw e.stopPropagation(),this.shake(),MSG_PASSWORD_NOT_CONFORM;return await this.authFlow.newPasswordRequired(_tmpFlowData.challengeResponse,_tmpFlowData.username,t.val()),await this.userSignIn(),t.val(""),s.val(""),setTimeout(()=>{this.view.find("div#"+ID_MODAL).modal("hide")},10),!0}catch(e){let t=e;return e instanceof Error&&(t=`<pre class="text-danger">(error: ${e.message})</pre>`),await this.showMessage("danger",OOPS,t),s.val(""),!1}finally{this.loading(!1)}}),e}createResetSendCodeForm(){const e=$("<div/>"),t=$("</p>").addClass("text-muted").html(MSG_RESET_SEND_CODE);e.append(t);const a=$("<form/>").addClass("form-signin text-center needs-validation").attr("novalidate","novalidate");e.append(a);const s="reset-form-username-"+RANDOM_ID,n=this.createUserInput(s,"Username");a.append(n);const i=this.createSubmitButton("Send code");return a.append(i),a.submit(async e=>{e.preventDefault();const t=a.find("input#"+s);try{if(!1===a[0].checkValidity())throw e.stopPropagation(),this.shake(),MSG_USERNAME_NOT_CONFORM;const s=t.val();return await this.authFlow.forgotPassword(s),_tmpFlowData.username=s,this.slideTo(SLIDEID_RESET_PASSWORD),!0}catch(e){let a=e;return e instanceof Error&&(a=`<pre class="text-danger">(error: ${e.message})</pre>`),await this.showMessage("danger",OOPS,a),t.val(""),!1}}),e}createResetPasswordForm(){const e=$("<div/>"),t=$("</p>").addClass("text-muted").html(MSG_RESET_PASSWORD);e.append(t);const a=$("<form/>").addClass("form-signin text-center needs-validation").attr("novalidate","novalidate");e.append(a);const s="reset-form-confirmation-code-"+RANDOM_ID,n=this.createCodeInput(s);a.append(n);const i="reset-form-reset-password-"+RANDOM_ID,o=this.createPasswordInput(i,"New Password");a.append(o);const r=this.createSubmitButton("Reset Password");return a.append(r),a.submit(async e=>{e.preventDefault();const t=n.find("input#"+s),r=o.find("input#"+i);try{if(this.loading(),!1===a[0].checkValidity())throw e.stopPropagation(),this.shake(),MSG_PASSWORD_NOT_CONFORM;return await this.authFlow.confirmPasswordChange(_tmpFlowData.username,r.val(),t.val()),await this.authFlow.authenticateUser(_tmpFlowData.username,r.val()),await this.userSignIn(),t.val(""),r.val(""),setTimeout(()=>{this.view.find("div#"+ID_MODAL).modal("hide")},10),!0}catch(e){let a=e;return e instanceof Error&&(a=`<pre class="text-danger">(error: ${e.message})</pre>`),r.val(""),t.val(""),await this.showMessage("danger",OOPS,a),!1}finally{this.loading(!1)}}),e}createLogo(){return $("<img/>").addClass("mb-4").attr("src",SOLUTION_ICON).attr("alt","media2cloud logo").attr("width",240)}createUserInput(e,t,a="",s="sr-only"){const n=$("<div/>").addClass("text-left"),i=$("<label/>").addClass(s).attr("for",e).html(t);n.append(i);const o=$("<input/>").addClass("form-control").attr("type","text").attr("id",e).attr("pattern","[a-zA-Z0-9._%+-]+").attr("placeholder",t).attr("value",a).attr("required","required").attr("autofocus","autofocus");n.append(o);const r=$("<div/>").addClass("invalid-feedback").html("Invalid username");return n.append(r),n}createPasswordInput(e="signin-password-"+RANDOM_ID,t="Password",a="sr-only"){const s=$("<div/>").addClass("text-left"),n=$("<label/>").addClass(a).attr("for",e).html(t);s.append(n);const i=$("<input/>").addClass("form-control").attr("type","password").attr("id",e).attr("pattern","(?=.*[0-9])(?=.*[a-z])(?=.*[A-Z]).{8,}").attr("placeholder","Password").attr("required","required");s.append(i);const o=$("<div/>").addClass("invalid-feedback").html("Invalid password");return s.append(o),s}createCodeInput(e,t="Verification Code",a,s=""){const n=$("<div/>").addClass("text-left mb-2"),i=$("<label/>").addClass(s).attr("for",e).html(t);n.append(i);const o=$("<input/>").addClass("form-control").attr("type","text").attr("id",e).attr("pattern","[0-9]{6}").attr("placeholder",t).attr("value",a).attr("required","required").attr("autofocus","autofocus");n.append(o);const r=$("<div/>").addClass("invalid-feedback").html("Invalid code");return n.append(r),n}createSubmitButton(e="Sign in"){const t=$("<div/>").addClass("mt-4"),a=$("<button/>").addClass("btn btn-primary btn-block").attr("type","submit").html(e);return t.append(a),t}createResetLink(){return $("<button/>").addClass("btn btn-sm btn-link mt-2").attr("type","button").html("Forgot password?")}createCopyright(){return $("<p/>").addClass("font-weight-light text-muted mb-0").html(COPYRIGHT)}createSpinner(){let e=this.view.find("#"+ID_SPINNER);if(e.length>0)return;e=$("<div/>").attr("id",ID_SPINNER).addClass("collapse").addClass("spinner-grow text-secondary loading-4");const t=$("<span/>").addClass("lead-sm sr-only").html("Loading...");return e.append(t),e}loading(e=!0){const t=this.view.find("#"+ID_SPINNER);return e?t.removeClass("collapse"):t.addClass("collapse")}async showMessage(e,t,a,s=5e3){return new Promise(n=>{const i="alert-"+e,o=$("<div/>").addClass("alert alert-dismissible fade show").addClass(i).attr("role","alert"),r=$("<h4/>").addClass("alert-heading").html(t);o.append(r);const l=$("<p/>").html(a);o.append(l);const d=$("<button/>").addClass("close").attr("type","button").attr("data-dismiss","alert").attr("aria-label","Close").append($("<span/>").attr("aria-hidden",!0).html("&times;"));o.append(d);let c=setTimeout(()=>{o.alert("close"),c=void 0},s);o.on("close.bs.alert",()=>{clearInterval(c),c=void 0}),o.on("closed.bs.alert",()=>{o.alert("dispose"),o.remove(),n()});this.view.find("div#"+ID_MODAL).append(o)})}shake(e=200){const t=this.view.find("div#"+ID_MODAL);t.addClass("shake-sm").on("webkitAnimationEnd oanimationend msAnimationEnd animationend",a=>t.delay(e).removeClass("shake-sm"))}slideTo(e){const t=this.view.find("div#"+ID_CAROUSEL).first(),a=t.find("#"+e).index();t.carousel(a)}}const ID_DEMOAPP="#demo-app";class DemoApp{constructor(){this.$ids={container:"app-"+AppUtils.randomHexstring()};const e=$("<div/>").attr("id",this.ids.container),t=new SignInFlow;t.appendTo(e),t.view.on("signin:view:hidden",()=>setTimeout(async()=>{const t=new MainView;t.appendTo(e);const a=document.location.hash.slice(1);t.show(a)},10)),this.$signInFlow=t,this.$view=e}get ids(){return this.$ids}get view(){return this.$view}get signInFlow(){return this.$signInFlow}appendTo(e){e.append(this.view)}async show(){return this.hide(),await this.openIndexedDB(),this.signInFlow.show()}async hide(){return this.closeIndexedDB()}async openIndexedDB(){return GetLocalStoreDB().open().catch(e=>console.error(e))}async closeIndexedDB(){return GetLocalStoreDB().close().catch(e=>console.error(e))}}$(document).ready(async()=>{const e=new DemoApp;e.appendTo($(ID_DEMOAPP)),await e.show(),$(window).on("unload",async()=>{console.log("unload","demoApp.hide"),await e.hide()}),$(window).on("popstate",async e=>{console.log("popstate","hash",e.currentTarget.location.hash),location.reload()})});export{DemoApp as default};